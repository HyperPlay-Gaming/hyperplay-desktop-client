LavaPack.loadBundle([[1988,{"./chunk-EXN2TFDJ.js":1989,"@metamask/post-message-stream":1624,"@metamask/snaps-execution-environments/package.json":1992,"@metamask/snaps-utils":2118,"@metamask/utils":2255},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var o,i,r,s,a,c,l,d,p,u=e("./chunk-EXN2TFDJ.js"),m=e("@metamask/post-message-stream"),h=e("@metamask/snaps-execution-environments/package.json"),g=(o=h)&&o.__esModule?o:{default:o},f=e("@metamask/snaps-utils"),w=e("@metamask/utils"),b=`https://execution.metamask.io/iframe/${g.default.version}/index.html`;i=new WeakMap,r=new WeakMap,s=new WeakSet,a=function(e){const{jobId:t,data:n}=e;this.jobs[t]?"terminateJob"!==n.method?this.jobs[t].stream.write(n):u.__privateMethod.call(void 0,this,d,p).call(this,t):u.__privateMethod.call(void 0,this,c,l).call(this,t).then((()=>{u.__privateMethod.call(void 0,this,s,a).call(this,e)})).catch((e=>{f.logError.call(void 0,"[Worker] Error initializing job:",e)}))},c=new WeakSet,l=async function(e){const t=await f.createWindow.call(void 0,u.__privateGet.call(void 0,this,r),e),n=new(0,m.WindowPostMessageStream)({name:"parent",target:"child",targetWindow:t,targetOrigin:"*"});return n.on("data",(t=>{u.__privateGet.call(void 0,this,i).write({data:t,jobId:e})})),this.jobs[e]={id:e,window:t,stream:n},this.jobs[e]},d=new WeakSet,p=function(e){w.assert.call(void 0,this.jobs[e],`Job "${e}" not found.`);const t=document.getElementById(e);w.assert.call(void 0,t,`Iframe with ID "${e}" not found.`),t.remove(),this.jobs[e].stream.destroy(),delete this.jobs[e]};var v=class e{constructor(e,t){u.__privateAdd.call(void 0,this,s),u.__privateAdd.call(void 0,this,c),u.__privateAdd.call(void 0,this,d),u.__privateAdd.call(void 0,this,i,void 0),u.__privateAdd.call(void 0,this,r,void 0),this.jobs={},u.__privateSet.call(void 0,this,i,e),u.__privateGet.call(void 0,this,i).on("data",u.__privateMethod.call(void 0,this,s,a).bind(this)),u.__privateSet.call(void 0,this,r,t)}static initialize(t,n=b){return new e(t,n)}};n.ProxySnapExecutor=v}}},{package:"@metamask/snaps-execution-environments",file:"node_modules/@metamask/snaps-execution-environments/dist/chunk-3JCT4MWT.js"}],[1989,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var o=(t=>void 0!==e?e:"undefined"!=typeof Proxy?new Proxy(t,{get:(t,n)=>(void 0!==e?e:t)[n]}):t)((function(t){if(void 0!==e)return e.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')})),i=(e,t,n)=>{if(!t.has(e))throw TypeError("Cannot "+n)};n.__require=o,n.__privateGet=(e,t,n)=>(i(e,t,"read from private field"),n?n.call(e):t.get(e)),n.__privateAdd=(e,t,n)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,n)},n.__privateSet=(e,t,n,o)=>(i(e,t,"write to private field"),o?o.call(e,n):t.set(e,n),n),n.__privateMethod=(e,t,n)=>(i(e,t,"access private method"),n)}}},{package:"@metamask/snaps-execution-environments",file:"node_modules/@metamask/snaps-execution-environments/dist/chunk-EXN2TFDJ.js"}],[1990,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){}}},{package:"@metamask/snaps-execution-environments",file:"node_modules/@metamask/snaps-execution-environments/dist/chunk-MCXWFCGV.js"}],[1991,{"./chunk-3JCT4MWT.js":1988,"./chunk-EXN2TFDJ.js":1989,"./chunk-MCXWFCGV.js":1990},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),e("./chunk-MCXWFCGV.js");var o=e("./chunk-3JCT4MWT.js");e("./chunk-EXN2TFDJ.js"),n.ProxySnapExecutor=o.ProxySnapExecutor}}},{package:"@metamask/snaps-execution-environments",file:"node_modules/@metamask/snaps-execution-environments/dist/index.js"}],[1992,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){t.exports={name:"@metamask/snaps-execution-environments",version:"6.4.0",description:"Snap sandbox environments for executing SES javascript",repository:{type:"git",url:"https://github.com/MetaMask/snaps.git"},sideEffects:!1,exports:{".":{import:"./dist/index.mjs",require:"./dist/index.js",types:"./dist/types/index.d.ts"},"./dist/browserify/node-process/bundle.js":{default:"./dist/browserify/node-process/bundle.js"},"./dist/browserify/node-thread/bundle.js":{default:"./dist/browserify/node-thread/bundle.js"},"./package.json":"./package.json"},main:"./dist/index.js",module:"./dist/index.mjs",types:"./dist/types/index.d.ts",files:["dist"],scripts:{test:"rimraf coverage && jest && yarn test:browser && yarn posttest",posttest:"ts-node scripts/coverage.ts && rimraf coverage/jest coverage/wdio","test:browser":"wdio run wdio.config.js","test:ci":"yarn test","test:watch":"jest --watch","lint:eslint":"eslint . --cache --ext js,ts,jsx,tsx","lint:misc":'prettier --no-error-on-unmatched-pattern --loglevel warn "**/*.json" "**/*.md" "**/*.html" "!CHANGELOG.md" --ignore-path ./.prettierignore',"lint:fix":"yarn lint:eslint --fix && yarn lint:misc --write","lint:changelog":"../../scripts/validate-changelog.sh @metamask/snaps-execution-environments",lint:"yarn lint:eslint && yarn lint:misc --check && yarn lint:changelog && yarn lint:dependencies",clean:"rimraf '*.tsbuildinfo' 'dist' 'src/__GENERATED__/' 'coverage/*' '__test__/*'",build:"tsup --clean && yarn build:types && yarn build:lavamoat","build:types":"tsc --project tsconfig.build.json","build:lavamoat":"lavamoat scripts/build.js --policy lavamoat/build-system/policy.json  --policyOverride lavamoat/build-system/policy-override.json","build:lavamoat:policy":"yarn build:lavamoat --writeAutoPolicy && node scripts/build.js --writeAutoPolicy","auto-changelog-init":"auto-changelog init","publish:preview":"yarn npm publish --tag preview","lint:ci":"yarn lint",start:"node scripts/start.js","lint:dependencies":"depcheck","build:ci":"tsup --clean"},dependencies:{"@metamask/json-rpc-engine":"^9.0.0","@metamask/object-multiplex":"^2.0.0","@metamask/post-message-stream":"^8.1.0","@metamask/providers":"^17.0.0","@metamask/rpc-errors":"^6.2.1","@metamask/snaps-sdk":"^5.0.0","@metamask/snaps-utils":"^7.6.0","@metamask/utils":"^8.3.0",nanoid:"^3.1.31","readable-stream":"^3.6.2",superstruct:"^1.0.3"},devDependencies:{"@babel/core":"^7.23.2","@babel/preset-env":"^7.23.2","@babel/preset-typescript":"^7.23.2","@esbuild-plugins/node-globals-polyfill":"^0.2.3","@esbuild-plugins/node-modules-polyfill":"^0.2.2","@lavamoat/allow-scripts":"^3.0.4","@lavamoat/lavapack":"^6.1.1","@lavamoat/lavatube":"^1.0.0","@metamask/auto-changelog":"^3.4.4","@metamask/eslint-config":"^12.1.0","@metamask/eslint-config-jest":"^12.1.0","@metamask/eslint-config-nodejs":"^12.1.0","@metamask/eslint-config-typescript":"^12.1.0","@swc/core":"1.3.78","@swc/jest":"^0.2.26","@types/express":"^4.17.17","@types/jest":"^27.5.1","@types/node":"18.14.2","@typescript-eslint/eslint-plugin":"^5.42.1","@typescript-eslint/parser":"^5.42.1","@wdio/browser-runner":"^8.19.0","@wdio/cli":"^8.19.0","@wdio/globals":"^8.19.0","@wdio/mocha-framework":"^8.19.0","@wdio/spec-reporter":"^8.19.0","@wdio/static-server-service":"^8.19.0","babel-plugin-tsconfig-paths-module-resolver":"^1.0.4",babelify:"^10.0.0",browserify:"^17.0.0",deepmerge:"^4.2.2",depcheck:"^1.4.7",esbuild:"^0.18.10",eslint:"^8.27.0","eslint-config-prettier":"^8.5.0","eslint-plugin-import":"^2.26.0","eslint-plugin-jest":"^27.1.5","eslint-plugin-jsdoc":"^39.6.2","eslint-plugin-n":"^15.7.0","eslint-plugin-prettier":"^4.2.1","eslint-plugin-promise":"^6.1.1","expect-webdriverio":"^4.4.1","istanbul-lib-coverage":"^3.2.0","istanbul-lib-report":"^3.0.0","istanbul-reports":"^3.1.5",jest:"^29.0.2","jest-environment-node":"^29.5.0","jest-fetch-mock":"^3.0.3",lavamoat:"^8.0.4","lavamoat-browserify":"^17.0.5",prettier:"^2.7.1","prettier-plugin-packagejson":"^2.2.11",rimraf:"^4.1.2","serve-handler":"^6.1.5",ses:"^1.1.0",terser:"^5.17.7","ts-node":"^10.9.1",tsup:"^8.0.1",typescript:"~4.8.4",vite:"^4.3.9","vite-tsconfig-paths":"^4.0.5","wdio-chromedriver-service":"^8.1.1","wdio-geckodriver-service":"^5.0.2",webdriverio:"^8.19.0",yargs:"^17.7.1"},engines:{node:"^18.16 || >=20"},publishConfig:{access:"public",registry:"https://registry.npmjs.org/"}}}}},{package:"@metamask/snaps-execution-environments",file:"node_modules/@metamask/snaps-execution-environments/package.json"}],[2488,{"@trezor/connect-common":2483},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ServiceWorkerWindowChannel=void 0;const o=e("@trezor/connect-common");class i extends o.AbstractMessageChannel{constructor({name:e,channel:t,logger:n,lazyHandshake:o,legacyMode:i,allowSelfOrigin:r=!1,currentId:s}){super({channel:t,sendFn:e=>{if(!this.port)throw new Error("port not assigned");this.port.postMessage(e)},logger:n,lazyHandshake:o,legacyMode:i}),this.name=e,this.allowSelfOrigin=r,this.currentId=s,this.connect()}connect(){chrome.runtime.onConnect.addListener((e=>{var t,n,o,i;e.name===this.name&&((null===(t=this.currentId)||void 0===t?void 0:t.call(this))&&(null===(n=this.currentId)||void 0===n?void 0:n.call(this))!==(null===(i=null===(o=e.sender)||void 0===o?void 0:o.tab)||void 0===i?void 0:i.id)||(this.port=e,this.port.onMessage.addListener(((e,{sender:t})=>{var n,o,i,r;if(!t)return void(null===(n=this.logger)||void 0===n||n.error("service-worker-window","no sender"));const{origin:s}=t,a=["https://connect.trezor.io","https://staging-connect.trezor.io","https://suite.corp.sldev.cz","https://dev.suite.sldev.cz","http://localhost:8088"],c=null===(o=null===chrome||void 0===chrome?void 0:chrome.runtime)||void 0===o?void 0:o.id;c&&a.push(`chrome-extension://${c}`),s?a.includes(s)?(s!==self.origin||this.allowSelfOrigin)&&this.onMessage(e):null===(r=this.logger)||void 0===r||r.error("connect-webextension/messageChannel/extensionPort/onMessage","origin not whitelisted",s):null===(i=this.logger)||void 0===i||i.error("connect-webextension/messageChannel/extensionPort/onMessage","no origin")}))))})),this.isConnected=!0}disconnect(){var e;this.isConnected&&(null===(e=this.port)||void 0===e||e.disconnect(),this.clear(),this.isConnected=!1)}}n.ServiceWorkerWindowChannel=i}}},{package:"@trezor/connect-web",file:"node_modules/@trezor/connect-web/lib/channels/serviceworker-window.js"}],[2489,{"@trezor/connect-common":2483},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.WindowWindowChannel=void 0;const o=e("@trezor/connect-common");class i extends o.AbstractMessageChannel{constructor({windowHere:e,windowPeer:t,channel:n,logger:o,origin:i}){super({channel:n,sendFn:e=>{var n;null===(n=t())||void 0===n||n.postMessage(e,i)},logger:o}),this._listener=this.listener.bind(this),this._windowHere=e,this.connect()}listener(e){const t=Object.assign(Object.assign({},e.data),{success:!0,origin:e.origin,payload:e.data.payload||{},channel:e.data.channel||{peer:this.channel.here,here:this.channel.peer}});this.onMessage(t)}connect(){this._windowHere.addEventListener("message",this._listener),this.isConnected=!0}disconnect(){this.isConnected&&(this._windowHere.removeEventListener("message",this._listener),this.isConnected=!1)}}n.WindowWindowChannel=i}}},{package:"@trezor/connect-web",file:"node_modules/@trezor/connect-web/lib/channels/window-window.js"}],[2490,{"@trezor/connect/lib/data/connectSettings":2503},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.parseConnectSettings=n.getEnv=void 0;const o=e("@trezor/connect/lib/data/connectSettings");n.getEnv=()=>{var e;if("undefined"!=typeof chrome&&void 0!==(null===(e=chrome.runtime)||void 0===e?void 0:e.onConnect))return"webextension";if("undefined"!=typeof navigator){if("string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase())return"react-native";if(navigator.userAgent.toLowerCase().indexOf(" electron/")>-1)return"electron"}return"web"};n.parseConnectSettings=(e={})=>{var t;const i=Object.assign({popup:!0},e);let r;if("undefined"!=typeof window?r=window.__TREZOR_CONNECT_SRC:"undefined"!=typeof global&&(r=global.__TREZOR_CONNECT_SRC),"string"==typeof r&&(i.connectSrc=r,i.debug=!0),"undefined"!=typeof window&&"string"==typeof(null===(t=window.location)||void 0===t?void 0:t.search)){const e=((e,t)=>{const n=new URLSearchParams(e),o={};return Array.from(n.entries()).forEach((([e,n])=>{t.includes(e)&&(o[e]=decodeURIComponent(n))})),o})(window.location.search,["trezor-connect-src"]);e["trezor-connect-src"]&&(i.debug=!0,i.connectSrc=e["trezor-connect-src"])}return"string"!=typeof e.env&&(i.env=(0,n.getEnv)()),(0,o.parseConnectSettings)(i)}}}},{package:"@trezor/connect-web",file:"node_modules/@trezor/connect-web/lib/connectSettings.js"}],[2491,{"./inlineStyles":2492,"@trezor/connect/lib/constants/errors":2498,"@trezor/connect/lib/events":2510,"@trezor/connect/lib/utils/debug":2537,"@trezor/connect/lib/utils/urlUtils":2538,"@trezor/utils":2578,tslib:4308},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.initIframeLogger=n.clearTimeout=n.postMessage=n.init=n.dispose=n.error=n.timeout=n.initPromise=n.origin=n.instance=void 0;const o=e("tslib"),i=e("@trezor/utils"),r=o.__importStar(e("@trezor/connect/lib/constants/errors")),s=e("@trezor/connect/lib/events"),a=e("@trezor/connect/lib/utils/urlUtils"),c=e("@trezor/connect/lib/utils/debug"),l=o.__importDefault(e("./inlineStyles"));n.initPromise=(0,i.createDeferred)(),n.timeout=0;n.dispose=()=>{if(n.instance&&n.instance.parentNode)try{n.instance.parentNode.removeChild(n.instance)}catch(e){}n.instance=null,n.timeout=0};n.init=async e=>{n.initPromise=(0,i.createDeferred)();const t=document.getElementById("trezorconnect");let o;if(t?n.instance=t:(n.instance=document.createElement("iframe"),n.instance.frameBorder="0",n.instance.width="0px",n.instance.height="0px",n.instance.style.position="absolute",n.instance.style.display="none",n.instance.style.border="0px",n.instance.style.width="0px",n.instance.style.height="0px",n.instance.id="trezorconnect"),"web"===e.env){const t=e.manifest?JSON.stringify(e.manifest):"undefined",n=`version=${e.version}&manifest=${encodeURIComponent(btoa(JSON.stringify(t)))}`;o=`${e.iframeSrc}?${n}`}else o=e.iframeSrc;n.instance.setAttribute("src",o),e.webusb&&console.warn('webusb option is deprecated. use `transports: ["WebUsbTransport"] instead`'),navigator.usb&&n.instance.setAttribute("allow","usb"),n.origin=(0,a.getOrigin)(n.instance.src),n.timeout=window.setTimeout((()=>{n.initPromise.reject(r.TypedError("Init_IframeTimeout"))}),1e4);const c=()=>{var t,o;if(!n.instance)return void n.initPromise.reject(r.TypedError("Init_IframeBlocked"));try{const e=null===(t=n.instance.contentWindow)||void 0===t?void 0:t.location.origin;if(!e||"null"===e)return window.clearTimeout(n.timeout),n.error=r.TypedError("Init_IframeBlocked"),(0,n.dispose)(),void n.initPromise.reject(n.error)}catch(e){}let i;"undefined"!=typeof chrome&&chrome.runtime&&void 0!==chrome.runtime.onConnect&&(chrome.runtime.onConnect.addListener((()=>{})),i=chrome.runtime.id),null===(o=n.instance.contentWindow)||void 0===o||o.postMessage({type:s.IFRAME.INIT,payload:{settings:e,extension:i}},n.origin),n.instance.onload=null};n.instance.attachEvent?n.instance.attachEvent("onload",c):n.instance.onload=c,document.body&&(document.body.appendChild(n.instance),(()=>{if(!n.instance)throw r.TypedError("Init_IframeBlocked");const e=n.instance.ownerDocument,t=e.head||e.getElementsByTagName("head")[0],o=document.createElement("style");o.setAttribute("type","text/css"),o.setAttribute("id","TrezorConnectStylesheet"),o.styleSheet?(o.styleSheet.cssText=l.default,t.appendChild(o)):(o.appendChild(document.createTextNode(l.default)),t.append(o))})());try{await n.initPromise.promise}catch(e){throw n.instance&&(n.instance.parentNode&&n.instance.parentNode.removeChild(n.instance),n.instance=null),e}finally{window.clearTimeout(n.timeout),n.timeout=0}};n.postMessage=e=>{var t;if(!n.instance)throw r.TypedError("Init_IframeBlocked");null===(t=n.instance.contentWindow)||void 0===t||t.postMessage(e,n.origin)};n.clearTimeout=()=>{window.clearTimeout(n.timeout)};n.initIframeLogger=()=>{(0,c.setLogWriter)((()=>({add:e=>{(0,n.postMessage)({type:s.IFRAME.LOG,payload:e})}})))}}}},{package:"@trezor/connect-web",file:"node_modules/@trezor/connect-web/lib/iframe/index.js"}],[2492,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});n.default='.trezorconnect-container{position:fixed!important;display:-webkit-box!important;display:-webkit-flex!important;display:-ms-flexbox!important;display:flex!important;-webkit-box-orient:vertical!important;-webkit-box-direction:normal!important;-webkit-flex-direction:column!important;-ms-flex-direction:column!important;flex-direction:column!important;-webkit-box-align:center!important;-webkit-align-items:center!important;-ms-flex-align:center!important;align-items:center!important;z-index:10000!important;width:100%!important;height:100%!important;top:0!important;left:0!important;background:rgba(0,0,0,.35)!important;overflow:auto!important;padding:20px!important;margin:0!important}.trezorconnect-container .trezorconnect-window{position:relative!important;display:block!important;width:370px!important;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif!important;margin:auto!important;border-radius:3px!important;background-color:#fff!important;text-align:center!important;overflow:hidden!important}.trezorconnect-container .trezorconnect-window .trezorconnect-head{text-align:left;padding:12px 24px!important;display:-webkit-box!important;display:-webkit-flex!important;display:-ms-flexbox!important;display:flex!important;-webkit-box-align:center!important;-webkit-align-items:center!important;-ms-flex-align:center!important;align-items:center!important}.trezorconnect-container .trezorconnect-window .trezorconnect-head .trezorconnect-logo{-webkit-box-flex:1;-webkit-flex:1;-ms-flex:1;flex:1}.trezorconnect-container .trezorconnect-window .trezorconnect-head .trezorconnect-close{cursor:pointer!important;height:24px!important}.trezorconnect-container .trezorconnect-window .trezorconnect-head .trezorconnect-close svg{fill:#757575;-webkit-transition:fill .3s ease-in-out!important;transition:fill .3s ease-in-out!important}.trezorconnect-container .trezorconnect-window .trezorconnect-head .trezorconnect-close:hover svg{fill:#494949}.trezorconnect-container .trezorconnect-window .trezorconnect-body{padding:24px 24px 32px!important;background:#FBFBFB!important;border-top:1px solid #EBEBEB}.trezorconnect-container .trezorconnect-window .trezorconnect-body h3{color:#505050!important;font-size:16px!important;font-weight:500!important}.trezorconnect-container .trezorconnect-window .trezorconnect-body p{margin:8px 0 24px!important;font-weight:400!important;color:#A9A9A9!important;font-size:12px!important}.trezorconnect-container .trezorconnect-window .trezorconnect-body button{width:100%!important;padding:12px 24px!important;margin:0!important;border-radius:3px!important;font-size:14px!important;font-weight:300!important;cursor:pointer!important;background:#01B757!important;color:#fff!important;border:0!important;-webkit-transition:background-color .3s ease-in-out!important;transition:background-color .3s ease-in-out!important}.trezorconnect-container .trezorconnect-window .trezorconnect-body button:hover{background-color:#00AB51!important}.trezorconnect-container .trezorconnect-window .trezorconnect-body button:active{background-color:#009546!important}/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImlucHV0IiwiJHN0ZGluIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQWNBLHlCQUNJLFNBQUEsZ0JBQ0EsUUFBQSxzQkFDQSxRQUFBLHVCQUNBLFFBQUEsc0JBRUEsUUFBQSxlQUNBLG1CQUFBLG1CQUNBLHNCQUFBLGlCQUNBLHVCQUFBLGlCQUNBLG1CQUFBLGlCQUNBLGVBQUEsaUJBRUEsa0JBQUEsaUJBQ0Esb0JBQUEsaUJBQ0EsZUFBQSxpQkNmTSxZQUFhLGlCREFyQixRQUFTLGdCQWtCSCxNQUFBLGVBQ0EsT0FBQSxlQUNBLElBQUEsWUFDQSxLQUFBLFlBQ0EsV0FBQSwwQkFDQSxTQUFBLGVBQ0EsUUFBQSxlQUNBLE9BQUEsWUNkUiwrQ0RYRSxTQUFVLG1CQTZCQSxRQUFBLGdCQUNBLE1BQUEsZ0JBQ0EsWUFBQSxjQUFBLG1CQUFBLFdBQUEsT0FBQSxpQkFBQSxNQUFBLHFCQUNBLE9BQUEsZUNmVixjQUFlLGNEakJmLGlCQWlCRSxlQWtCWSxXQUFBLGlCQ2ZkLFNBQVUsaUJEbUJJLG1FQUNBLFdBQUEsS0NoQmQsUUFBUyxLQUFLLGVEeEJkLFFBQVMsc0JBMENTLFFBQUEsdUJBQ0EsUUFBQSxzQkNmbEIsUUFBUyxlRGlCSyxrQkE1QlosaUJBOEJvQixvQkFBQSxpQkNoQmxCLGVBQWdCLGlCRC9CWixZQWlCTixpQkFzQ1EsdUZBQ0EsaUJBQUEsRUNwQlYsYUFBYyxFRHBDVixTQUFVLEVBMkRBLEtBQUEsRUFFQSx3RkNwQmQsT0FBUSxrQkR6Q1IsT0FBUSxlQWlFTSw0RkFDQSxLQUFBLFFBQ0EsbUJBQUEsS0FBQSxJQUFBLHNCQ3BCZCxXQUFZLEtBQUssSUFBSyxzQkR3QlIsa0dBQ0EsS0FBQSxRQUVBLG1FQUNBLFFBQUEsS0FBQSxLQUFBLGVBQ0EsV0FBQSxrQkFDQSxXQUFBLElBQUEsTUFBQSxRQUVBLHNFQUNBLE1BQUEsa0JBQ0EsVUFBQSxlQ3JCZCxZQUFhLGNEd0JLLHFFQ3JCbEIsT0FBUSxJQUFJLEVBQUksZUR3QkYsWUFBQSxjQUNJLE1BQUEsa0JDdEJsQixVQUFXLGVBRWIsMEVBQ0UsTUFBTyxlQUNQLFFBQVMsS0FBSyxlQUNkLE9BQVEsWUFDUixjQUFlLGNBQ2YsVUFBVyxlQUNYLFlBQWEsY0FDYixPQUFRLGtCQUNSLFdBQVksa0JBQ1osTUFBTyxlQUNQLE9BQVEsWUFDUixtQkFBb0IsaUJBQWlCLElBQUssc0JBQzFDLFdBQVksaUJBQWlCLElBQUssc0JBRXBDLGdGQUNFLGlCQUFrQixrQkFFcEIsaUZBQ0UsaUJBQWtCIn0= */'}}},{package:"@trezor/connect-web",file:"node_modules/@trezor/connect-web/lib/iframe/inlineStyles.js"}],[2493,{"./connectSettings":2490,"./iframe":2491,"./popup":2494,"./webusb/button":2496,"@trezor/connect/lib/constants/errors":2498,"@trezor/connect/lib/data/config":2502,"@trezor/connect/lib/events":2510,"@trezor/connect/lib/exports":2517,"@trezor/connect/lib/factory":2518,"@trezor/connect/lib/utils/debug":2537,"@trezor/utils":2578,events:3276,tslib:4308},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});const o=e("tslib"),i=o.__importDefault(e("events")),r=o.__importStar(e("@trezor/connect/lib/constants/errors")),s=e("@trezor/connect/lib/events"),a=e("@trezor/connect/lib/factory"),c=e("@trezor/connect/lib/utils/debug"),l=e("@trezor/connect/lib/data/config"),d=e("@trezor/utils"),p=o.__importStar(e("./iframe")),u=o.__importStar(e("./popup")),m=o.__importDefault(e("./webusb/button")),h=e("./connectSettings"),g=new i.default,f=(0,c.initLog)("@trezor/connect-web");let w,b=(0,h.parseConnectSettings)();const v=(0,d.createDeferredManager)({initialId:1}),y=()=>{const e=new u.PopupManager(b,{logger:f});return e.on(s.POPUP.CLOSED,(e=>{p.postMessage({type:s.POPUP.CLOSED,payload:e?{error:e}:null})})),e},E=()=>(g.removeAllListeners(),p.dispose(),b=(0,h.parseConnectSettings)(),w&&w.close(),Promise.resolve(undefined)),x=e=>{if(e.origin!==p.origin)return;const t=(0,s.parseMessage)(e.data);switch(f.log("handleMessage",t),t.event){case s.RESPONSE_EVENT:{const{id:e=0,success:n,payload:o}=t;v.resolve(e,{id:e,success:n,payload:o})||f.warn(`Unknown message id ${e}`);break}case s.DEVICE_EVENT:case s.TRANSPORT_EVENT:case s.BLOCKCHAIN_EVENT:g.emit(t.event,t),g.emit(t.type,t.payload);break;case s.UI_EVENT:if(t.type===s.IFRAME.BOOTSTRAP){p.clearTimeout();break}t.type===s.IFRAME.LOADED&&p.initPromise.resolve(),t.type===s.IFRAME.ERROR&&p.initPromise.reject(t.payload.error),g.emit(t.event,t),g.emit(t.type,t.payload);break;default:f.log("Undefined message",e.data)}},k=async(e={})=>{var t;if(p.instance)throw r.TypedError("Init_AlreadyInitialized");if(b=(0,h.parseConnectSettings)(Object.assign(Object.assign({},b),e)),!b.manifest)throw r.TypedError("Init_ManifestMissing");if((null===(t=b.transports)||void 0===t?void 0:t.length)||(b.transports=["BridgeTransport","WebUsbTransport"]),b.lazyLoad)b.lazyLoad=!1;else{w||(w=y()),f.enabled=!!b.debug,window.addEventListener("message",x),window.addEventListener("unload",E);var n=Object.assign({},b);n.env="webextension",await p.init(n),!1!==b.sharedLogger&&p.initIframeLogger()}},U=async e=>{if(!p.instance&&!p.timeout){if(b=(0,h.parseConnectSettings)(b),!b.manifest)return(0,s.createErrorMessage)(r.TypedError("Init_ManifestMissing"));w||(w=y()),w.request();try{var t=Object.assign({},b);t.env="webextension",await k(t)}catch(e){return w&&(["Init_IframeBlocked","Init_IframeTimeout"].includes(e.code)?w.postMessage((0,s.createUiMessage)(s.UI.IFRAME_FAILURE)):w.clear()),(0,s.createErrorMessage)(e)}}if(p.timeout)return(0,s.createErrorMessage)(r.TypedError("Init_ManifestMissing"));if(p.error)return(0,s.createErrorMessage)(p.error);b.popup&&w&&w.request();try{const{promiseId:t,promise:n}=v.create();p.postMessage({id:t,type:s.IFRAME.CALL,payload:e});const o=await n;return o?(!o.success&&"Device_CallInProgress"!==o.payload.code&&w&&w.unlock(),o):(w&&w.unlock(),(0,s.createErrorMessage)(r.TypedError("Method_NoResponse")))}catch(e){return f.error("__call error",e),w&&w.clear(!1),(0,s.createErrorMessage)(e)}},Q=(0,a.factory)({eventEmitter:g,manifest:e=>{b=(0,h.parseConnectSettings)(Object.assign(Object.assign({},b),{manifest:e}))},init:k,call:U,requestLogin:async e=>{if("function"==typeof e.callback){const{callback:t}=e,n=async e=>{const{data:n}=e;if(n&&n.type===s.UI.LOGIN_CHALLENGE_REQUEST)try{const e=await t();p.postMessage({type:s.UI.LOGIN_CHALLENGE_RESPONSE,payload:e})}catch(e){p.postMessage({type:s.UI.LOGIN_CHALLENGE_RESPONSE,payload:e.message})}};window.addEventListener("message",n,!1);const o=await U(Object.assign(Object.assign({method:"requestLogin"},e),{asyncChallenge:!0,callback:null}));return window.removeEventListener("message",n),o}return U(Object.assign({method:"requestLogin"},e))},uiResponse:e=>{if(!p.instance)throw r.TypedError("Init_NotInitialized");p.postMessage(e)},renderWebUSBButton:e=>{(0,m.default)(e,b.webusbSrc)},disableWebUSB:()=>{if(!p.instance)throw r.TypedError("Init_NotInitialized");p.postMessage({type:s.TRANSPORT.DISABLE_WEBUSB})},requestWebUSBDevice:async()=>{try{await window.navigator.usb.requestDevice({filters:l.config.webusb}),p.postMessage({type:s.TRANSPORT.REQUEST_DEVICE})}catch(e){}},cancel:e=>{w&&w.emit(s.POPUP.CLOSED,e)},dispose:E});n.default=Q,o.__exportStar(e("@trezor/connect/lib/exports"),n)}}},{package:"@trezor/connect-web",file:"node_modules/@trezor/connect-web/lib/index.js"}],[2494,{"../channels/serviceworker-window":2488,"../channels/window-window":2489,"./showPopupRequest":2495,"@trezor/connect/lib/events":2510,"@trezor/connect/lib/utils/urlUtils":2538,"@trezor/utils":2578,events:3276,tslib:4308},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.PopupManager=void 0;const o=e("tslib").__importDefault(e("events")),i=e("@trezor/utils"),r=e("@trezor/connect/lib/events"),s=e("@trezor/connect/lib/utils/urlUtils"),a=e("./showPopupRequest"),c=e("../channels/serviceworker-window"),l=e("../channels/window-window");class d extends o.default{constructor(e,{logger:t}){var n;super(),this.locked=!1,this.extensionTabId=0,this.injectContentScript=e=>{chrome.permissions.getAll((t=>{var n;(null===(n=t.permissions)||void 0===n?void 0:n.includes("scripting"))&&chrome.scripting.executeScript({target:{tabId:e},func:()=>{}}).then((()=>this.logger.debug("content script injected"))).catch((e=>this.logger.error("content script injection error",e)))}))},this.settings=e,this.origin=(0,s.getOrigin)(e.popupSrc),this.logger=t,"webextension"===this.settings.env?this.channel=new c.ServiceWorkerWindowChannel({name:"trezor-connect",channel:{here:"@trezor/connect-webextension",peer:"@trezor/connect-content-script"},logger:t,currentId:()=>{var e,t;if("tab"===(null===(e=this.popupWindow)||void 0===e?void 0:e.mode))return null===(t=this.popupWindow)||void 0===t?void 0:t.tab.id},legacyMode:!this.settings.useCoreInPopup}):this.channel=new l.WindowWindowChannel({windowHere:window,windowPeer:()=>{var e,t;if("window"===(null===(e=this.popupWindow)||void 0===e?void 0:e.mode))return null===(t=this.popupWindow)||void 0===t?void 0:t.window},channel:{here:"@trezor/connect-web",peer:"@trezor/connect-popup"},logger:t,origin:this.origin}),this.settings.useCoreInPopup||(this.iframeHandshakePromise=(0,i.createDeferred)(r.IFRAME.LOADED),this.channelIframe=new l.WindowWindowChannel({windowHere:window,windowPeer:()=>window,channel:{here:"@trezor/connect-web",peer:"@trezor/connect-iframe"},logger:t,origin:this.origin}),null===(n=this.channelIframe)||void 0===n||n.on("message",this.handleMessage.bind(this))),this.settings.useCoreInPopup?(this.handshakePromise=(0,i.createDeferred)(),this.channel.on("message",this.handleCoreMessage.bind(this))):"webextension"===this.settings.env?this.channel.on("message",this.handleExtensionMessage.bind(this)):this.channel.on("message",this.handleMessage.bind(this)),this.channel.init()}async request(){var e,t,n,o,i,r;if(this.settings.useCoreInPopup&&"tab"===(null===(e=this.popupWindow)||void 0===e?void 0:e.mode)){await(r=null===(n=null===(t=this.popupWindow)||void 0===t?void 0:t.tab)||void 0===n?void 0:n.id,new Promise((e=>{if(!r)return e(!1);chrome.tabs.get(r,(function(){chrome.runtime.lastError?e(!1):e(!0)}))})))||this.clear()}if(this.locked)return void("tab"===(null===(o=this.popupWindow)||void 0===o?void 0:o.mode)&&this.popupWindow.tab.id?chrome.tabs.update(this.popupWindow.tab.id,{active:!0}):"window"===(null===(i=this.popupWindow)||void 0===i?void 0:i.mode)&&this.popupWindow.window.focus());this.popupWindow&&!this.locked&&this.close();const s=this.open.bind(this);this.locked=!0;const a="webextension"===this.settings.env?1:850;this.requestTimeout=setTimeout((()=>{this.requestTimeout=undefined,s()}),a)}unlock(){this.locked=!1}open(){const e=this.settings.popupSrc;this.settings.useCoreInPopup?this.openWrapper(e):(this.popupPromise=(0,i.createDeferred)(r.POPUP.LOADED),this.openWrapper(e),this.closeInterval=setInterval((()=>{this.popupWindow&&("tab"===this.popupWindow.mode&&this.popupWindow.tab.id?chrome.tabs.get(this.popupWindow.tab.id,(e=>{e||(this.emit(r.POPUP.CLOSED),this.clear())})):"window"===this.popupWindow.mode&&this.popupWindow.window.closed&&(this.clear(),this.emit(r.POPUP.CLOSED)))}),500),this.openTimeout=setTimeout((()=>{this.clear(),(0,a.showPopupRequest)(this.open.bind(this),(()=>{this.emit(r.POPUP.CLOSED)}))}),3e3))}openWrapper(e){if("webextension"===this.settings.env)chrome.windows.getCurrent((t=>{this.logger.debug("opening popup. currentWindow: ",t),"normal"!==t.type?chrome.windows.create({url:e},(e=>{chrome.tabs.query({windowId:null==e?void 0:e.id,active:!0},(e=>{this.popupWindow={mode:"tab",tab:e[0]},this.injectContentScript(e[0].id)}))})):chrome.tabs.query({currentWindow:!0,active:!0},(t=>{this.extensionTabId=t[0].id,chrome.tabs.create({url:e,index:t[0].index+1},(e=>{this.popupWindow={mode:"tab",tab:e},this.injectContentScript(e.id)}))}))}));else{const t=window.open(e,"modal");if(!t)return;this.popupWindow={mode:"window",window:t}}this.channel.isConnected||this.channel.connect()}handleCoreMessage(e){var t;e.type===r.POPUP.CORE_LOADED?(this.channel.postMessage({type:r.POPUP.HANDSHAKE,payload:{settings:this.settings}}),null===(t=this.handshakePromise)||void 0===t||t.resolve()):e.type===r.POPUP.CLOSED&&this.channel.resolveMessagePromises({code:"Method_Interrupted",error:r.POPUP.CLOSED})}handleExtensionMessage(e){e.type===r.POPUP.ERROR||e.type===r.POPUP.LOADED||e.type===r.POPUP.BOOTSTRAP?this.handleMessage(e):e.type===r.POPUP.EXTENSION_USB_PERMISSIONS?chrome.tabs.query({currentWindow:!0,active:!0},(e=>{chrome.tabs.create({url:"trezor-usb-permissions.html",index:e[0].index+1},(e=>{}))})):e.type===r.POPUP.CLOSE_WINDOW&&this.clear()}handleMessage(e){var t,n;if(e.type===r.IFRAME.LOADED)null===(t=this.iframeHandshakePromise)||void 0===t||t.resolve(e.payload);else if(e.type===r.POPUP.BOOTSTRAP)this.openTimeout&&clearTimeout(this.openTimeout);else if(e.type===r.POPUP.ERROR&&this.popupWindow){const t=e.payload&&"string"==typeof e.payload.error?e.payload.error:null;this.emit(r.POPUP.CLOSED,t?`Popup error: ${t}`:null),this.clear()}else e.type===r.POPUP.LOADED?(this.openTimeout&&clearTimeout(this.openTimeout),this.popupPromise&&this.popupPromise.resolve(),null===(n=this.iframeHandshakePromise)||void 0===n||n.promise.then((e=>{var t=Object.assign({},this.settings);t.env="webextension",this.channel.postMessage({type:r.POPUP.INIT,payload:Object.assign(Object.assign({},e),{settings:t})})}))):e.type!==r.POPUP.CANCEL_POPUP_REQUEST&&e.type!==r.UI.CLOSE_UI_WINDOW||this.clear(!1)}clear(e=!0){this.locked=!1,this.popupPromise=undefined,this.handshakePromise=(0,i.createDeferred)(),this.channel&&this.channel.disconnect(),this.requestTimeout&&(clearTimeout(this.requestTimeout),this.requestTimeout=undefined),this.openTimeout&&(clearTimeout(this.openTimeout),this.openTimeout=undefined),this.closeInterval&&(clearInterval(this.closeInterval),this.closeInterval=undefined),e&&this.extensionTabId&&(chrome.tabs.update(this.extensionTabId,{active:!0}),this.extensionTabId=0)}close(){if(this.popupWindow){if(this.logger.debug("closing popup"),"tab"===this.popupWindow.mode){let e=chrome.runtime.lastError;this.popupWindow.tab.id&&chrome.tabs.remove(this.popupWindow.tab.id,(()=>{e=chrome.runtime.lastError,e&&this.logger.error("closed with error",e)}))}else"window"===this.popupWindow.mode&&this.popupWindow.window.close();this.popupWindow=undefined}}async postMessage(e){var t,n;if(!this.popupWindow&&e.type!==r.UI.REQUEST_UI_WINDOW&&this.openTimeout)return this.clear(),void(0,a.showPopupRequest)(this.open.bind(this),(()=>{this.emit(r.POPUP.CLOSED)}));this.popupPromise&&await this.popupPromise.promise,"window"===(null===(t=this.popupWindow)||void 0===t?void 0:t.mode)?this.popupWindow.window.postMessage(e,this.origin):"tab"===(null===(n=this.popupWindow)||void 0===n?void 0:n.mode)&&this.channel.postMessage(e)}}n.PopupManager=d}}},{package:"@trezor/connect-web",file:"node_modules/@trezor/connect-web/lib/popup/index.js"}],[2495,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.showPopupRequest=void 0;const o="TrezorConnectInteractionLayer",i=`\n    <div class="trezorconnect-container" id="${o}">\n        <div class="trezorconnect-window">\n            <div class="trezorconnect-head">\n                <svg class="trezorconnect-logo" x="0px" y="0px" viewBox="0 0 163.7 41.9" width="78px" height="20px" preserveAspectRatio="xMinYMin meet">\n                    <polygon points="101.1,12.8 118.2,12.8 118.2,17.3 108.9,29.9 118.2,29.9 118.2,35.2 101.1,35.2 101.1,30.7 110.4,18.1 101.1,18.1"/>\n                    <path d="M158.8,26.9c2.1-0.8,4.3-2.9,4.3-6.6c0-4.5-3.1-7.4-7.7-7.4h-10.5v22.3h5.8v-7.5h2.2l4.1,7.5h6.7L158.8,26.9z M154.7,22.5 h-4V18h4c1.5,0,2.5,0.9,2.5,2.2C157.2,21.6,156.2,22.5,154.7,22.5z"/>\n                    <path d="M130.8,12.5c-6.8,0-11.6,4.9-11.6,11.5s4.9,11.5,11.6,11.5s11.7-4.9,11.7-11.5S137.6,12.5,130.8,12.5z M130.8,30.3 c-3.4,0-5.7-2.6-5.7-6.3c0-3.8,2.3-6.3,5.7-6.3c3.4,0,5.8,2.6,5.8,6.3C136.6,27.7,134.2,30.3,130.8,30.3z"/>\n                    <polygon points="82.1,12.8 98.3,12.8 98.3,18 87.9,18 87.9,21.3 98,21.3 98,26.4 87.9,26.4 87.9,30 98.3,30 98.3,35.2 82.1,35.2 "/>\n                    <path d="M24.6,9.7C24.6,4.4,20,0,14.4,0S4.2,4.4,4.2,9.7v3.1H0v22.3h0l14.4,6.7l14.4-6.7h0V12.9h-4.2V9.7z M9.4,9.7 c0-2.5,2.2-4.5,5-4.5s5,2,5,4.5v3.1H9.4V9.7z M23,31.5l-8.6,4l-8.6-4V18.1H23V31.5z"/>\n                    <path d="M79.4,20.3c0-4.5-3.1-7.4-7.7-7.4H61.2v22.3H67v-7.5h2.2l4.1,7.5H80l-4.9-8.3C77.2,26.1,79.4,24,79.4,20.3z M71,22.5h-4V18 h4c1.5,0,2.5,0.9,2.5,2.2C73.5,21.6,72.5,22.5,71,22.5z"/>\n                    <polygon points="40.5,12.8 58.6,12.8 58.6,18.1 52.4,18.1 52.4,35.2 46.6,35.2 46.6,18.1 40.5,18.1 "/>\n                </svg>\n                <div class="trezorconnect-close">\n                    <svg x="0px" y="0px" viewBox="24 24 60 60" width="24px" height="24px" preserveAspectRatio="xMinYMin meet">\n                        <polygon class="st0" points="40,67.9 42.1,70 55,57.1 67.9,70 70,67.9 57.1,55 70,42.1 67.9,40 55,52.9 42.1,40 40,42.1 52.9,55 "/>\n                    </svg>\n                </div>\n            </div>\n            <div class="trezorconnect-body">\n                <h3>Popup was blocked</h3>\n                <p>Please click to "Continue" to open popup manually</p>\n                <button class="trezorconnect-open">Continue</button>\n            </div>\n        </div>\n    </div>\n`;n.showPopupRequest=(e,t)=>{if(document.getElementById(o))return;const n=document.createElement("div");n.id=o,n.className="trezorconnect-container",n.innerHTML=i,document.body&&document.body.appendChild(n);n.getElementsByClassName("trezorconnect-open")[0].onclick=()=>{e(),document.body&&document.body.removeChild(n)};n.getElementsByClassName("trezorconnect-close")[0].onclick=()=>{t(),document.body&&document.body.removeChild(n)}}}}},{package:"@trezor/connect-web",file:"node_modules/@trezor/connect-web/lib/popup/showPopupRequest.js"}],[2496,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});n.default=(e="",t)=>{const n=e||".trezor-webusb-button",o=document.querySelectorAll(n),i=`${t}?${Date.now()}`;o.forEach((e=>{if(e.getElementsByTagName("iframe").length<1){const t=e.getBoundingClientRect(),n=document.createElement("iframe");n.frameBorder="0",n.width=`${Math.round(t.width)}px`,n.height=`${Math.round(t.height)}px`,n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.style.zIndex="1",n.setAttribute("allow","usb"),n.setAttribute("scrolling","no"),n.src=i,e.append(n)}}))}}}},{package:"@trezor/connect-web",file:"node_modules/@trezor/connect-web/lib/webusb/button.js"}],[4416,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(n!==undefined){var o=n.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(n,"__esModule",{value:!0}),n.CallbackProcessor=void 0;n.CallbackProcessor=class{constructor(){o(this,"currentMessageId",0),o(this,"messageCallbacks",new Map)}registerCallback(e){return this.currentMessageId+=1,this.messageCallbacks.set(this.currentMessageId,e),this.currentMessageId}processCallback(e){if(this.messageCallbacks.has(e.messageId)){const t=this.messageCallbacks.get(e.messageId);if(t)return this.messageCallbacks.delete(e.messageId),t(e)}return null}}}}},{package:"$root$",file:"offscreen/scripts/callback-processor.ts"}],[4417,{"../../shared/constants/offscreen-communication":4438},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(){chrome.runtime.onMessage.addListener(((e,t,n)=>{if(e.target===o.OffscreenCommunicationTarget.latticeOffscreen)return async function(e){const t=window.open(e);if(!t)throw new Error("Failed to open Lattice connector.");return t}(e.params.url).then((e=>{const t=setInterval((()=>{e.closed&&(clearInterval(t),n({error:new Error("Lattice connector closed.")}))}),500);window.addEventListener("message",(i=>{if(i.origin===o.KnownOrigins.lattice||i.source!==e)try{clearInterval(t);const e=JSON.parse(i.data);e.deviceID&&e.password||n({error:new Error("Invalid credentials returned from Lattice.")}),n({result:e})}catch(e){n({error:e})}}),!1)})),!0}))};var o=e("../../shared/constants/offscreen-communication")}}},{package:"$root$",file:"offscreen/scripts/lattice.ts"}],[4418,{"../../shared/constants/offscreen-communication":4438,"./callback-processor":4416},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(){const e=document.createElement("iframe");e.src="https://metamask.github.io/eth-ledger-bridge-keyring",e.allow="hid",document.body.appendChild(e),window.addEventListener("message",(({origin:t,data:n,source:i})=>{if(t===o.KnownOrigins.ledger&&i===(null==e?void 0:e.contentWindow)&&n){if(n.action===s)return void chrome.runtime.sendMessage({action:o.OffscreenCommunicationEvents.ledgerDeviceConnect,payload:n.payload.connected});a.processCallback(n)}})),chrome.runtime.onMessage.addListener(((t,n,i)=>{var s;if(t.target!==o.OffscreenCommunicationTarget.ledgerOffscreen)return;if(null==e||!e.contentWindow){return void i({success:!1,payload:{error:new Error("Ledger iframe not present")}})}const c=a.registerCallback(i),l={...t,target:r,messageId:c};return null==e||null===(s=e.contentWindow)||void 0===s||s.postMessage(l,o.KnownOrigins.ledger),!0}))};var o=e("../../shared/constants/offscreen-communication"),i=e("./callback-processor");const r="LEDGER-IFRAME",s="ledger-connection-event",a=new i.CallbackProcessor}}},{package:"$root$",file:"offscreen/scripts/ledger.ts"}],[4420,{"../../shared/constants/offscreen-communication":4438,"@trezor/connect-web":2493},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(){chrome.runtime.onMessage.addListener(((e,t,n)=>{if(e.target===i.OffscreenCommunicationTarget.trezorOffscreen){switch(e.action){case i.TrezorAction.init:o.default.on(o.DEVICE_EVENT,(e=>{var t;e.type===o.DEVICE.CONNECT&&null!==(t=e.payload.features)&&void 0!==t&&t.model&&chrome.runtime.sendMessage({target:i.OffscreenCommunicationTarget.extension,event:i.OffscreenCommunicationEvents.trezorDeviceConnect,payload:e.payload.features.model})})),o.default.init({...e.params,env:"web"}).then((()=>{n()}));break;case i.TrezorAction.dispose:o.default.dispose(),n();break;case i.TrezorAction.getPublicKey:o.default.getPublicKey(e.params).then((e=>{n(e)}));break;case i.TrezorAction.signTransaction:o.default.ethereumSignTransaction(e.params).then((e=>{n(e)}));break;case i.TrezorAction.signMessage:o.default.ethereumSignMessage(e.params).then((e=>{n(e)}));break;case i.TrezorAction.signTypedData:o.default.ethereumSignTypedData(e.params).then((e=>{n(e)}));break;default:n({success:!1,payload:{error:"Trezor action not supported"}})}return!0}}))};var o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=r(t);if(n&&n.has(e))return n.get(e);var o={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var a=i?Object.getOwnPropertyDescriptor(e,s):null;a&&(a.get||a.set)?Object.defineProperty(o,s,a):o[s]=e[s]}return o.default=e,n&&n.set(e,o),o}(e("@trezor/connect-web")),i=e("../../shared/constants/offscreen-communication");function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(r=function(e){return e?n:t})(e)}}}},{package:"$root$",file:"offscreen/scripts/trezor.ts"}],[4419,{"../../shared/constants/offscreen-communication":4438,"./lattice":4417,"./ledger":4418,"./trezor":4420,"@metamask/post-message-stream":1624,"@metamask/snaps-execution-environments":1991},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var o=e("@metamask/post-message-stream"),i=e("@metamask/snaps-execution-environments"),r=e("../../shared/constants/offscreen-communication"),s=l(e("./ledger")),a=l(e("./trezor")),c=l(e("./lattice"));function l(e){return e&&e.__esModule?e:{default:e}}(0,s.default)(),(0,a.default)(),(0,c.default)();const d=new o.BrowserRuntimePostMessageStream({name:"child",target:"parent"});i.ProxySnapExecutor.initialize(d),chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.extensionMain,isBooted:!0})}}},{package:"$root$",file:"offscreen/scripts/offscreen.ts"}]],[4419],{});