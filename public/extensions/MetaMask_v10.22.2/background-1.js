LavaPack.loadBundle([[170,{"../../../../../shared/constants/app":4973,"./ethereum-chain-utils":172,"@metamask/controller-utils":1316,"@metamask/network-controller":1752,"@metamask/rpc-errors":1955,lodash:4086,"uri-js":4890},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var n=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var s=u(t);if(s&&s.has(e))return s.get(e);var n={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if("default"!==r&&{}.hasOwnProperty.call(e,r)){var a=i?Object.getOwnPropertyDescriptor(e,r):null;a&&(a.get||a.set)?Object.defineProperty(n,r,a):n[r]=e[r]}return n.default=e,s&&s.set(e,n),n}(e("uri-js")),i=e("@metamask/controller-utils"),r=e("@metamask/network-controller"),a=e("@metamask/rpc-errors"),o=e("lodash"),c=e("../../../../../shared/constants/app"),l=e("./ethereum-chain-utils");function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,s=new WeakMap;return(u=function(e){return e?s:t})(e)}const h={methodNames:[c.MESSAGE_TYPE.ADD_ETHEREUM_CHAIN],implementation:async function(e,t,s,c,{addNetwork:u,updateNetwork:h,getNetworkConfigurationByChainId:d,setActiveNetwork:m,requestUserApproval:p,getCurrentChainIdForDomain:f,getCaveat:g,requestPermittedChainsPermissionIncrementalForOrigin:y,rejectApprovalRequestsForOrigin:w,setTokenNetworkFilter:S,setEnabledNetworks:v,getEnabledNetworks:b}){let k;try{k=(0,l.validateAddEthereumChainParams)(e.params[0])}catch(e){return c(e)}const{chainId:_,chainName:T,firstValidBlockExplorerUrl:E,firstValidRPCUrl:P,ticker:C}=k,{origin:O}=e,A=f(O),I=d(_);if(I&&I.chainId===_&&I.nativeCurrency!==C)return c(a.rpcErrors.invalidParams({message:`nativeCurrency.symbol does not match currency symbol for a network the user already has added with the same chainId. Received:\n${C}`}));let M=I,j=null==I?void 0:I.rpcEndpoints.findIndex(({url:e})=>n.equal(e,P)),N=E?null==I?void 0:I.blockExplorerUrls.findIndex(e=>n.equal(e,E)):undefined;const R=!I||j!==I.defaultRpcEndpointIndex||E&&N!==I.defaultBlockExplorerUrlIndex;if(R)try{if(await p({origin:O,type:i.ApprovalType.AddEthereumChain,requestData:{chainId:_,rpcPrefs:{blockExplorerUrl:E},chainName:T,rpcUrl:P,ticker:C}}),I){const e=(0,o.cloneDeep)(I);-1===j&&(e.rpcEndpoints=[...e.rpcEndpoints,{url:P,type:r.RpcEndpointType.Custom,name:T}],j=e.rpcEndpoints.length-1),e.defaultRpcEndpointIndex=j,E&&(-1===N&&(e.blockExplorerUrls=[...e.blockExplorerUrls,E],N=e.blockExplorerUrls.length-1),e.defaultBlockExplorerUrlIndex=N),M=await h(e.chainId,e,A===_?{replacementSelectedRpcEndpointIndex:e.defaultRpcEndpointIndex}:undefined)}else M=await u({blockExplorerUrls:E?[E]:[],defaultBlockExplorerUrlIndex:E?0:undefined,chainId:_,defaultRpcEndpointIndex:0,name:T,nativeCurrency:C,rpcEndpoints:[{url:P,name:T,type:r.RpcEndpointType.Custom}]})}catch(e){return c(e)}const{networkClientId:x}=M.rpcEndpoints[M.defaultRpcEndpointIndex];return(0,l.switchChain)(t,c,_,x,{isAddFlow:!0,autoApprove:R,setActiveNetwork:m,getCaveat:g,requestPermittedChainsPermissionIncrementalForOrigin:y,rejectApprovalRequestsForOrigin:w,setTokenNetworkFilter:S,setEnabledNetworks:v,getEnabledNetworks:b})},hookNames:{addNetwork:!0,updateNetwork:!0,getNetworkConfigurationByChainId:!0,setActiveNetwork:!0,requestUserApproval:!0,getCurrentChainIdForDomain:!0,getCaveat:!0,requestPermittedChainsPermissionIncrementalForOrigin:!0,rejectApprovalRequestsForOrigin:!0,setTokenNetworkFilter:!0,setEnabledNetworks:!0,getEnabledNetworks:!0}};s.default=h}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/add-ethereum-chain.js"}],[171,{"../../../../../shared/constants/app":4973},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;const n={methodNames:[e("../../../../../shared/constants/app").MESSAGE_TYPE.ETH_ACCOUNTS],implementation:async function(e,t,s,n,{getAccounts:i}){return t.result=i(),n()},hookNames:{getAccounts:!0}};s.default=n}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/eth-accounts.ts"}],[172,{"../../../../../shared/constants/app":4973,"../../../../../shared/constants/network":4989,"../../../../../shared/modules/network.utils":5089,"../../util":225,"@metamask/chain-agnostic-permission":1296,"@metamask/controller-utils":1316,"@metamask/rpc-errors":1955,"@metamask/utils":2359},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.switchChain=async function(e,t,s,i,{origin:c,isAddFlow:u,isSwitchFlow:h,autoApprove:d,setActiveNetwork:m,getCaveat:p,requestPermittedChainsPermissionIncrementalForOrigin:f,setTokenNetworkFilter:g,setEnabledNetworks:y,getEnabledNetworks:w,rejectApprovalRequestsForOrigin:S,requestUserApproval:v,hasApprovalRequestsForOrigin:b,toNetworkConfiguration:k,fromNetworkConfiguration:_}){try{const T=p({target:r.Caip25EndowmentPermissionName,caveatType:r.Caip25CaveatType});if(T){if((0,r.getPermittedEthChainIds)(T.value).includes(s))null!=b&&b()&&!u&&await v({origin:c,type:n.ApprovalType.SwitchEthereumChain,requestData:{toNetworkConfiguration:k,fromNetworkConfiguration:_}});else{let e;h&&(e={isSwitchEthereumChain:!0}),await f({chainId:s,autoApprove:d,metadata:e})}}else await f({chainId:s,autoApprove:d});if(null==S||S(),await m(i),g(s),(0,o.isPrefixedFormattedHexString)(s)){const e=w(a.KnownCaipNamespace.Eip155),t=Object.keys(e);if(!t.includes(s)){if(l.FEATURED_NETWORK_CHAIN_IDS.includes(s)){y([...t.filter(e=>l.FEATURED_NETWORK_CHAIN_IDS.includes(e)),s],a.KnownCaipNamespace.Eip155)}else y([s],a.KnownCaipNamespace.Eip155)}}else{const{namespace:e}=(0,a.parseCaipChainId)(s),t=w(e),n=Object.keys(t);n.includes(s)||y([...n,s],e)}return e.result=null,t()}catch(e){return t(e)}},s.validateAddEthereumChainParams=function(e){if(!e||"object"!=typeof e)throw i.rpcErrors.invalidParams({message:`Expected single, object parameter. Received:\n${JSON.stringify(e)}`});const{chainId:t,chainName:s,blockExplorerUrls:n,nativeCurrency:r,rpcUrls:a,...o}=e,l=Object.keys(o).filter(e=>!["iconUrls"].includes(e));if(l.length>0)throw i.rpcErrors.invalidParams({message:`Received unexpected keys on object parameter. Unsupported keys:\n${l}`});const d=h(t);if(!a||!Array.isArray(a)||0===a.length)throw i.rpcErrors.invalidParams({message:`Expected an array with at least one valid string HTTPS url 'rpcUrls', Received:\n${a}`});const m=e=>{const t=(0,u.getValidUrl)(e);return null!==t&&("localhost"===t.hostname||"127.0.0.1"===t.hostname||"https:"===t.protocol)},p=a.find(e=>m(e)),f=Array.isArray(n)?n.find(e=>m(e)):null;if(!p)throw i.rpcErrors.invalidParams({message:`Expected an array with at least one valid string HTTPS url 'rpcUrls', Received:\n${a}`});if("string"!=typeof s||!s)throw i.rpcErrors.invalidParams({message:`Expected non-empty string 'chainName'. Received:\n${s}`});const g=s.length>100?s.substring(0,100):s;if(null!==r){if("object"!=typeof r||Array.isArray(r))throw i.rpcErrors.invalidParams({message:`Expected null or object 'nativeCurrency'. Received:\n${r}`});if(18!==r.decimals)throw i.rpcErrors.invalidParams({message:`Expected the number 18 for 'nativeCurrency.decimals' when 'nativeCurrency' is provided. Received: ${r.decimals}`});if(!r.symbol||"string"!=typeof r.symbol)throw i.rpcErrors.invalidParams({message:`Expected a string 'nativeCurrency.symbol'. Received: ${r.symbol}`})}const y=(null==r?void 0:r.symbol)||c.UNKNOWN_TICKER_SYMBOL;if(y!==c.UNKNOWN_TICKER_SYMBOL&&("string"!=typeof y||y.length<1||y.length>6))throw i.rpcErrors.invalidParams({message:`Expected 1-6 character string 'nativeCurrency.symbol'. Received:\n${y}`});return{chainId:d,chainName:g,firstValidBlockExplorerUrl:f,firstValidRPCUrl:p,ticker:y}},s.validateChainId=h,s.validateSwitchEthereumChainParams=function(e){var t;if(null===(t=e.params)||void 0===t||!t[0]||"object"!=typeof e.params[0])throw i.rpcErrors.invalidParams({message:`Expected single, object parameter. Received:\n${JSON.stringify(e.params)}`});const{chainId:s,...n}=e.params[0];if(Object.keys(n).length>0)throw i.rpcErrors.invalidParams({message:`Received unexpected keys on object parameter. Unsupported keys:\n${Object.keys(n)}`});return h(s)};var n=e("@metamask/controller-utils"),i=e("@metamask/rpc-errors"),r=e("@metamask/chain-agnostic-permission"),a=e("@metamask/utils"),o=e("../../../../../shared/modules/network.utils"),c=e("../../../../../shared/constants/app"),l=e("../../../../../shared/constants/network"),u=e("../../util");function h(e){const t="string"==typeof e?e.toLowerCase():null;if(!(0,o.isPrefixedFormattedHexString)(t))throw i.rpcErrors.invalidParams({message:`Expected 0x-prefixed, unpadded, non-zero hexadecimal string 'chainId'. Received:\n${e}`});if(!(0,o.isSafeChainId)(parseInt(e,16)))throw i.rpcErrors.invalidParams({message:`Invalid chain ID "${t}": numerical value greater than max safe value. Received:\n${e}`});return t}}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/ethereum-chain-utils.js"}],[173,{"../../../../../shared/constants/app":4973},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;const n={methodNames:[e("../../../../../shared/constants/app").MESSAGE_TYPE.GET_PROVIDER_STATE],implementation:async function(e,t,s,n,{getProviderState:i}){return t.result={...await i(e.origin)},n()},hookNames:{getProviderState:!0}};s.default=n}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/get-provider-state.ts"}],[174,{"./add-ethereum-chain":170,"./eth-accounts":171,"./get-provider-state":173,"./log-web3-shim-usage":175,"./request-accounts":176,"./send-metadata":177,"./switch-ethereum-chain":178,"./watch-asset":182},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.handlers=s.ethAccountsHandler=s.eip1193OnlyHandlers=void 0;var n=h(e("./add-ethereum-chain")),i=h(e("./eth-accounts")),r=h(e("./get-provider-state")),a=h(e("./log-web3-shim-usage")),o=h(e("./request-accounts")),c=h(e("./send-metadata")),l=h(e("./switch-ethereum-chain")),u=h(e("./watch-asset"));function h(e){return e&&e.__esModule?e:{default:e}}s.handlers=[n.default,r.default,a.default,c.default,u.default],s.eip1193OnlyHandlers=[l.default,i.default,o.default],s.ethAccountsHandler=i.default}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/index.ts"}],[175,{"../../../../../shared/constants/app":4973},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;const n={methodNames:[e("../../../../../shared/constants/app").MESSAGE_TYPE.LOG_WEB3_SHIM_USAGE],implementation:function(e,t,s,n,{getWeb3ShimUsageState:i,setWeb3ShimUsageRecorded:r}){const{origin:a}=e;i(a)===undefined&&r(a);return t.result=!0,n()},hookNames:{getWeb3ShimUsageState:!0,setWeb3ShimUsageRecorded:!0}};s.default=n}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/log-web3-shim-usage.ts"}],[176,{"../../../../../shared/constants/app":4973,"../../../../../shared/constants/metametrics":4986,"../../util":225,"@metamask/rpc-errors":1955},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var n=e("@metamask/rpc-errors"),i=e("../../../../../shared/constants/app"),r=e("../../../../../shared/constants/metametrics"),a=e("../../util");const o={methodNames:[i.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS],implementation:async function(e,t,s,o,{getAccounts:l,getUnlockPromise:u,sendMetrics:h,metamaskState:d,getCaip25PermissionFromLegacyPermissionsForOrigin:m,requestPermissionsForOrigin:p}){const{origin:f}=e;if(c.has(f))return t.error=n.rpcErrors.resourceUnavailable(`Already processing ${i.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS}. Please wait.`),o();let g=l({ignoreLock:!0});if(g.length>0){try{c.add(f),await u(!0),t.result=g,o()}catch(e){o(e)}finally{c.delete(f)}return undefined}try{const e=m();await p(e)}catch(e){return o(e)}if(g=l({ignoreLock:!0}),(0,a.shouldEmitDappViewedEvent)(d.metaMetricsId)){const e=!Object.keys(d.permissionHistory).includes(f);h({event:r.MetaMetricsEventName.DappViewed,category:r.MetaMetricsEventCategory.InpageProvider,referrer:{url:f},properties:{is_first_visit:e,number_of_accounts:Object.keys(d.accounts).length,number_of_accounts_connected:g.length}},{excludeMetaMetricsId:!0})}return t.result=g,o()},hookNames:{getAccounts:!0,getUnlockPromise:!0,sendMetrics:!0,metamaskState:!0,getCaip25PermissionFromLegacyPermissionsForOrigin:!0,requestPermissionsForOrigin:!0}};s.default=o;const c=new Set}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/request-accounts.js"}],[177,{"../../../../../shared/constants/app":4973,"@metamask/rpc-errors":1955},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var n=e("@metamask/rpc-errors");const i={methodNames:[e("../../../../../shared/constants/app").MESSAGE_TYPE.SEND_METADATA],implementation:function(e,t,s,i,{addSubjectMetadata:r,subjectType:a}){const{origin:o,params:c}=e;if(!c||"object"!=typeof c||Array.isArray(c))return i(n.rpcErrors.invalidParams({data:c}));{const{icon:e=null,name:t=null,...s}=c;r({...s,iconUrl:e,name:t,subjectType:a,origin:o})}return t.result=!0,i()},hookNames:{addSubjectMetadata:!0,subjectType:!0}};s.default=i}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/send-metadata.js"}],[178,{"../../../../../shared/constants/app":4973,"./ethereum-chain-utils":172,"@metamask/rpc-errors":1955,"@metamask/snaps-utils":2242},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var n=e("@metamask/rpc-errors"),i=e("@metamask/snaps-utils"),r=e("../../../../../shared/constants/app"),a=e("./ethereum-chain-utils");const o={methodNames:[r.MESSAGE_TYPE.SWITCH_ETHEREUM_CHAIN],implementation:async function(e,t,s,o,{getNetworkConfigurationByChainId:c,setActiveNetwork:l,requestUserApproval:u,getCaveat:h,getCurrentChainIdForDomain:d,requestPermittedChainsPermissionIncrementalForOrigin:m,rejectApprovalRequestsForOrigin:p,setTokenNetworkFilter:f,setEnabledNetworks:g,getEnabledNetworks:y,hasApprovalRequestsForOrigin:w}){let S;try{S=(0,a.validateSwitchEthereumChainParams)(e)}catch(e){return o(e)}const{origin:v}=e,b=d(v);if(b===S)return t.result=null,o();const k=c(S),_=null==k?void 0:k.rpcEndpoints[k.defaultRpcEndpointIndex].networkClientId;if(!_)return o(n.providerErrors.custom({code:4902,message:`Unrecognized chain ID "${S}". Try adding the chain using ${r.MESSAGE_TYPE.ADD_ETHEREUM_CHAIN} first.`}));const T=c(b),E=c(S);return(0,a.switchChain)(t,o,S,_,{origin:v,isSwitchFlow:!0,autoApprove:(0,i.isSnapId)(v),setActiveNetwork:l,getCaveat:h,requestPermittedChainsPermissionIncrementalForOrigin:m,rejectApprovalRequestsForOrigin:p,setTokenNetworkFilter:f,setEnabledNetworks:g,getEnabledNetworks:y,requestUserApproval:u,hasApprovalRequestsForOrigin:w,toNetworkConfiguration:E,fromNetworkConfiguration:T})},hookNames:{getNetworkConfigurationByChainId:!0,setActiveNetwork:!0,requestUserApproval:!0,getCaveat:!0,getCurrentChainIdForDomain:!0,requestPermittedChainsPermissionIncrementalForOrigin:!0,rejectApprovalRequestsForOrigin:!0,setTokenNetworkFilter:!0,setEnabledNetworks:!0,getEnabledNetworks:!0,hasApprovalRequestsForOrigin:!0}};s.default=o}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/switch-ethereum-chain.js"}],[179,{"../../../../../shared/constants/permissions":4993,"../../../controllers/permissions":100,"@metamask/chain-agnostic-permission":1296,"@metamask/permission-controller":1816},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.getPermissionsHandler=void 0;var n=e("@metamask/permission-controller"),i=e("@metamask/chain-agnostic-permission"),r=e("../../../controllers/permissions"),a=e("../../../../../shared/constants/permissions");s.getPermissionsHandler={methodNames:[n.MethodNames.GetPermissions],implementation:async function(e,t,s,n,{getPermissionsForOrigin:o,getAccounts:c}){var l;const u={...o()},h=u[i.Caip25EndowmentPermissionName],d=null==h||null===(l=h.caveats)||void 0===l||null===(l=l.find(({type:e})=>e===i.Caip25CaveatType))||void 0===l?void 0:l.value;if(delete u[i.Caip25EndowmentPermissionName],d){const e=c({ignoreLock:!0});e.length>0&&(u[a.RestrictedMethods.eth_accounts]={...h,parentCapability:a.RestrictedMethods.eth_accounts,caveats:[{type:a.CaveatTypes.restrictReturnedAccounts,value:e}]});const t=(0,i.getPermittedEthChainIds)(d);t.length>0&&(u[r.PermissionNames.permittedChains]={...h,parentCapability:r.PermissionNames.permittedChains,caveats:[{type:a.CaveatTypes.restrictNetworkSwitching,value:t}]})}return t.result=Object.values(u),n()},hookNames:{getPermissionsForOrigin:!0,getAccounts:!0}}}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/wallet-getPermissions.ts"}],[1794,{"./push-utils.cjs":1795},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.createSubscribeToPushNotifications=s.deleteRegToken=s.createRegToken=void 0;var n=e("./push-utils.cjs");Object.defineProperty(s,"createRegToken",{enumerable:!0,get:function(){return n.createRegToken}}),Object.defineProperty(s,"deleteRegToken",{enumerable:!0,get:function(){return n.deleteRegToken}}),Object.defineProperty(s,"createSubscribeToPushNotifications",{enumerable:!0,get:function(){return n.createSubscribeToPushNotifications}})}}},{package:"@metamask/notification-services-controller",file:"node_modules/@metamask/notification-services-controller/dist/NotificationServicesPushController/web/index.cjs"}],[1795,{"../../NotificationServicesController/index.cjs":1768,"../../shared/to-raw-notification.cjs":1799,"firebase/app":3678,"firebase/messaging":3679,"firebase/messaging/sw":3680,loglevel:4094},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(s,"__esModule",{value:!0}),s.createSubscribeToPushNotifications=s.deleteRegToken=s.createRegToken=s.supportedCache=void 0;const i=e("firebase/app"),r=e("firebase/messaging"),a=e("firebase/messaging/sw"),o=n(e("loglevel")),c=e("../../NotificationServicesController/index.cjs"),l=e("../../shared/to-raw-notification.cjs");s.supportedCache=null;const u=async e=>{if(!await(async()=>(s.supportedCache??(s.supportedCache=await(0,a.isSupported)()),s.supportedCache))())return null;const t=await(async e=>{try{return(0,i.getApp)()}catch{const t={apiKey:e.apiKey,authDomain:e.authDomain,storageBucket:e.storageBucket,projectId:e.projectId,messagingSenderId:e.messagingSenderId,appId:e.appId,measurementId:e.measurementId};return(0,i.initializeApp)(t)}})(e);return(0,a.getMessaging)(t)};s.createRegToken=async function(e){try{const t=await u(e);if(!t)return null;return await(0,r.getToken)(t,{serviceWorkerRegistration:self.registration,vapidKey:e.vapidKey})}catch{return null}},s.deleteRegToken=async function(e){try{const t=await u(e);return!t||(await(0,r.deleteToken)(t),!0)}catch{return!1}},s.createSubscribeToPushNotifications=function(e){return async function(t){const s=await async function(e,t){const s=await u(e);if(!s)return null;const n=(0,a.onBackgroundMessage)(s,async e=>{try{const s=e?.data?.data?JSON.parse(e?.data?.data):undefined;if(!s)return;const n=(0,l.toRawOnChainNotification)(s),i=c.Processors.processNotification(n);await t(i)}catch(t){throw o.default.error("Unable to send push notification:",{notification:e?.data?.data,error:t}),new Error("Unable to send push notification")}});return()=>n()}(t,async t=>{e.messenger.publish("NotificationServicesPushController:onNewNotifications",t),await e.onReceivedHandler(t)}),n=function(e){const t=t=>{const s=t?.notification?.data;e(t,s)};return self.addEventListener("notificationclick",t),()=>self.removeEventListener("notificationclick",t)}((t,s)=>{e.messenger.publish("NotificationServicesPushController:pushNotificationClicked",s),e.onClickHandler(t,s)});return()=>{s?.(),n()}}}}}},{package:"@metamask/notification-services-controller",file:"node_modules/@metamask/notification-services-controller/dist/NotificationServicesPushController/web/push-utils.cjs"}],[18,{"@metamask/assets-controllers":1181},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.DeFiPositionsControllerInit=void 0;var n=e("@metamask/assets-controllers");s.DeFiPositionsControllerInit=({initMessenger:e,controllerMessenger:t,getController:s,trackEvent:i})=>({controller:new n.DeFiPositionsController({messenger:t,isEnabled:()=>{var t;const n=s("PreferencesController"),{useExternalServices:i}=n.state,r=e.call("RemoteFeatureFlagController:getState"),a=Boolean(null==r||null===(t=r.remoteFeatureFlags)||void 0===t?void 0:t.assetsDefiPositionsEnabled);return i&&a},trackEvent:i})})}}},{package:"$root$",file:"app/scripts/controller-init/defi-positions/defi-positions-controller-init.ts"}],[180,{"../../../../../shared/constants/permissions":4993,"../../../controllers/permissions":100,"@metamask/chain-agnostic-permission":1296,"@metamask/controller-utils":1316,"@metamask/permission-controller":1816,lodash:4086},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.requestPermissionsHandler=void 0;var n=e("lodash"),i=e("@metamask/controller-utils"),r=e("@metamask/permission-controller"),a=e("@metamask/chain-agnostic-permission"),o=e("../../../../../shared/constants/permissions"),c=e("../../../controllers/permissions");s.requestPermissionsHandler={methodNames:[r.MethodNames.RequestPermissions],implementation:async function(e,t,s,l,{getAccounts:u,requestPermissionsForOrigin:h,getCaip25PermissionFromLegacyPermissionsForOrigin:d}){const{params:m}=e;if(!Array.isArray(m)||!(0,i.isPlainObject)(m[0]))return l((0,r.invalidParams)({data:{request:e}}));let[p]=m;delete p[a.Caip25EndowmentPermissionName];const f=(0,n.pick)(p,[o.RestrictedMethods.eth_accounts,c.PermissionNames.permittedChains]);delete p[o.RestrictedMethods.eth_accounts],delete p[c.PermissionNames.permittedChains];const g=Object.keys(f).length>0;if(g){const e=d(f);p={...p,...e}}let y={};const[w]=await h(p);if(y={...w},g){var S;const e=y[a.Caip25EndowmentPermissionName];if(!e)throw new Error(`could not find ${a.Caip25EndowmentPermissionName} permission.`);const t=null===(S=e.caveats)||void 0===S||null===(S=S.find(({type:e})=>e===a.Caip25CaveatType))||void 0===S?void 0:S.value;if(!t)throw new Error(`could not find ${a.Caip25CaveatType} in granted ${a.Caip25EndowmentPermissionName} permission.`);delete y[a.Caip25EndowmentPermissionName];const s=u();y[o.RestrictedMethods.eth_accounts]={...e,parentCapability:o.RestrictedMethods.eth_accounts,caveats:[{type:o.CaveatTypes.restrictReturnedAccounts,value:s}]};const n=(0,a.getPermittedEthChainIds)(t);n.length>0&&(y[c.PermissionNames.permittedChains]={...e,parentCapability:c.PermissionNames.permittedChains,caveats:[{type:o.CaveatTypes.restrictNetworkSwitching,value:n}]})}return t.result=Object.values(y).filter(e=>e!==undefined),l()},hookNames:{getAccounts:!0,requestPermissionsForOrigin:!0,getCaip25PermissionFromLegacyPermissionsForOrigin:!0}}}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/wallet-requestPermissions.ts"}],[1805,{"./ObservableStore":1807},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.ComposedStore=void 0;const n=e("./ObservableStore");class i extends n.ObservableStore{constructor(e){super({}),this._children=e||{},Object.keys(this._children).forEach(e=>{const t=this._children[e];this._addChild(e,t)})}_addChild(e,t){const s=t=>{const s=this.getState();s[e]=t,this.putState(s)};t.subscribe(s),s(t.getState())}}s.ComposedStore=i}}},{package:"@metamask/obs-store",file:"node_modules/@metamask/obs-store/dist/ComposedStore.js"}],[1806,{"./ObservableStore":1807},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.MergedStore=void 0;const n=e("./ObservableStore");class i extends n.ObservableStore{constructor(e=[]){super({}),this._children=e,e.forEach(e=>this._addChild(e)),this._updateWholeState()}_addChild(e){e.subscribe(()=>this._updateWholeState())}_updateWholeState(){const e=this._children.map(e=>e.getState()),t=Object.assign({},...e);this.putState(t)}}s.MergedStore=i}}},{package:"@metamask/obs-store",file:"node_modules/@metamask/obs-store/dist/MergedStore.js"}],[1807,{"@metamask/safe-event-emitter":1957},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(s,"__esModule",{value:!0}),s.ObservableStore=void 0;const i=n(e("@metamask/safe-event-emitter"));class r extends i.default{constructor(e){super(),e===undefined?this._state={}:this._state=e}getState(){return this._getState()}putState(e){this._putState(e),this.emit("update",e)}updateState(e){if(e&&"object"==typeof e){const t=this.getState();this.putState(Object.assign(Object.assign({},t),e))}else this.putState(e)}subscribe(e){this.on("update",e)}unsubscribe(e){this.removeListener("update",e)}_getState(){return this._state}_putState(e){this._state=e}}s.ObservableStore=r}}},{package:"@metamask/obs-store",file:"node_modules/@metamask/obs-store/dist/ObservableStore.js"}],[1808,{"readable-stream":4452},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.storeAsStream=void 0;const n=e("readable-stream");class i extends n.Duplex{constructor(e){super({objectMode:!0}),this.resume(),this.handler=e=>this.push(e),this.obsStore=e,this.obsStore.subscribe(this.handler)}pipe(e,t){const s=super.pipe(e,t);return e.write(this.obsStore.getState()),s}_write(e,t,s){this.obsStore.putState(e),s()}_read(e){return undefined}_destroy(e,t){this.obsStore.unsubscribe(this.handler),super._destroy(e,t)}}s.storeAsStream=function(e){return new i(e)}}}},{package:"@metamask/obs-store",file:"node_modules/@metamask/obs-store/dist/asStream.js"}],[1809,{"./ComposedStore":1805,"./MergedStore":1806,"./ObservableStore":1807,"./asStream":1808,"./transform":1810},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n=this&&this.__createBinding||(Object.create?function(e,t,s,n){n===undefined&&(n=s),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[s]}})}:function(e,t,s,n){n===undefined&&(n=s),e[n]=t[s]}),i=this&&this.__exportStar||function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||n(t,e,s)};Object.defineProperty(s,"__esModule",{value:!0}),i(e("./asStream"),s),i(e("./ComposedStore"),s),i(e("./MergedStore"),s),i(e("./ObservableStore"),s),i(e("./transform"),s)}}},{package:"@metamask/obs-store",file:"node_modules/@metamask/obs-store/dist/index.js"}],[181,{"../../../../../shared/constants/permissions":4993,"../../../controllers/permissions":100,"@metamask/chain-agnostic-permission":1296,"@metamask/permission-controller":1816,"@metamask/utils":2359},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.revokePermissionsHandler=void 0;var n=e("@metamask/permission-controller"),i=e("@metamask/utils"),r=e("@metamask/chain-agnostic-permission"),a=e("../../../../../shared/constants/permissions"),o=e("../../../controllers/permissions");s.revokePermissionsHandler={methodNames:[n.MethodNames.RevokePermissions],implementation:function(e,t,s,c,{revokePermissionsForOrigin:l,rejectApprovalRequestsForOrigin:u}){const{params:h}=e,d=null==h?void 0:h[0];if(!d)return c((0,n.invalidParams)({data:{request:e}}));const m=Object.keys(d).filter(e=>e!==r.Caip25EndowmentPermissionName);if(!(0,i.isNonEmptyArray)(m))return c((0,n.invalidParams)({data:{request:e}}));const p=[a.RestrictedMethods.eth_accounts,o.PermissionNames.permittedChains],f=m.filter(e=>!p.includes(e));f.length!==m.length&&f.push(r.Caip25EndowmentPermissionName);return l(f),u(),t.result=null,c()},hookNames:{revokePermissionsForOrigin:!0,rejectApprovalRequestsForOrigin:!0,updateCaveat:!0}}}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/wallet-revokePermissions.ts"}],[1810,{"readable-stream":4452},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.storeTransformStream=void 0;const n=e("readable-stream");s.storeTransformStream=function(e){return new n.Transform({objectMode:!0,transform:(t,s,n)=>{try{const s=e(t);return n(undefined,s),undefined}catch(e){return n(e),undefined}}})}}}},{package:"@metamask/obs-store",file:"node_modules/@metamask/obs-store/dist/transform.js"}],[182,{"../../../../../shared/constants/app":4973,"@metamask/controller-utils":1316,"@metamask/rpc-errors":1955},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var n=e("@metamask/controller-utils"),i=e("@metamask/rpc-errors"),r=e("../../../../../shared/constants/app");const a={methodNames:[r.MESSAGE_TYPE.WATCH_ASSET,r.MESSAGE_TYPE.WATCH_ASSET_LEGACY],implementation:async function(e,t,s,r,{handleWatchAssetRequest:a}){try{const{params:{options:s,type:o},origin:c,networkClientId:l}=e,{tokenId:u}=s;return[n.ERC721,n.ERC1155].includes(o)&&u!==undefined&&"string"!=typeof u?r(i.rpcErrors.invalidParams({message:`Expected parameter 'tokenId' to be type 'string'. Received type '${typeof u}'`})):(await a({asset:s,type:o,origin:c,networkClientId:l}),t.result=!0,r())}catch(e){return r(e)}},hookNames:{handleWatchAssetRequest:!0}};s.default=a}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/watch-asset.js"}],[1823,{"./enums.cjs":1824,"@metamask/base-controller":1241,"@metamask/utils":2359},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n,i,r,a,o,c,l,u,h,d=this&&this.__classPrivateFieldSet||function(e,t,s,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,s):i?i.value=s:t.set(e,s),s},m=this&&this.__classPrivateFieldGet||function(e,t,s,n){if("a"===s&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)};Object.defineProperty(s,"__esModule",{value:!0}),s.PermissionLogController=void 0;const p=e("@metamask/base-controller"),f=e("@metamask/utils"),g=e("./enums.cjs"),y={permissionHistory:{},permissionActivityLog:[]};class w extends p.BaseController{constructor({messenger:e,restrictedMethods:t,state:s}){super({messenger:e,name:"PermissionLogController",metadata:{permissionHistory:{persist:!0,anonymous:!1},permissionActivityLog:{persist:!1,anonymous:!1}},state:{...y,...s}}),n.add(this),i.set(this,void 0),d(this,i,t,"f")}updateAccountsHistory(e,t){if(0===t.length)return;const s={eth_accounts:{accounts:m(this,n,"m",r).call(this,t,Date.now())}};m(this,n,"m",l).call(this,e,s)}createMiddleware(){return(e,t,s)=>{const{origin:r,method:l}=e,h=l.startsWith(g.WALLET_PREFIX),d="eth_requestAccounts"===l;if(!g.LOG_IGNORE_METHODS.includes(l)&&(h||m(this,i,"f").has(l))||d){const i=m(this,n,"m",a).call(this,e,h),l=m(this,n,"m",u).call(this,e);return void s(e=>{const s=Date.now();m(this,n,"m",o).call(this,i,t,s),l&&!t.error&&t.result&&r&&m(this,n,"m",c).call(this,l,r,t.result,s,d),e()})}s()}}}s.PermissionLogController=w,i=new WeakMap,n=new WeakSet,r=function(e,t){return e.reduce((e,s)=>({...e,[s]:t}),{})},a=function(e,t){const s={id:e.id,method:e.method,methodType:t?g.LOG_METHOD_TYPES.internal:g.LOG_METHOD_TYPES.restricted,origin:e.origin,requestTime:Date.now(),responseTime:null,success:null};return this.update(e=>{const t=[...e.permissionActivityLog,s];e.permissionActivityLog=t.length>g.LOG_LIMIT?t.slice(1):t}),s},o=function(e,t,s){e&&t&&this.update(n=>{n.permissionActivityLog=n.permissionActivityLog.map(n=>n.id===e.id?{...n,success:(0,f.hasProperty)(t,"result"),responseTime:s}:n)})},c=function(e,t,s,i,a){let o;if(a){const e=s;o={eth_accounts:{accounts:m(this,n,"m",r).call(this,e,i),lastApproved:i}}}else{o=s.reduce((t,s)=>{const a=s.parentCapability;if(!e.includes(a))return t;if("eth_accounts"===a){const e=m(this,n,"m",h).call(this,s);return{...t,[a]:{lastApproved:i,accounts:m(this,n,"m",r).call(this,e,i)}}}return{...t,[a]:{lastApproved:i}}},{})}Object.keys(o).length>0&&m(this,n,"m",l).call(this,t,o)},l=function(e,t){const{permissionHistory:s}=this.state,n=s[e]??{},i={...n,...t},r=n.eth_accounts,a=t.eth_accounts;if(r&&a){const e=a.lastApproved??r.lastApproved;i.eth_accounts={lastApproved:e,accounts:{...r.accounts,...a.accounts}}}this.update(t=>{t.permissionHistory={...s,[e]:i}})},u=function(e){const{method:t,params:s}=e;return"eth_requestAccounts"===t?["eth_accounts"]:t===`${g.WALLET_PREFIX}requestPermissions`&&s&&Array.isArray(s)&&s[0]&&"object"==typeof s[0]&&!Array.isArray(s[0])?Object.keys(s[0]):null},h=function(e){if("eth_accounts"!==e.parentCapability||!e.caveats)return[];const t=new Set;for(const s of e.caveats)if(s.type===g.CAVEAT_TYPES.restrictReturnedAccounts&&Array.isArray(s.value))for(const e of s.value)t.add(e);return[...t]}}}},{package:"@metamask/permission-log-controller",file:"node_modules/@metamask/permission-log-controller/dist/PermissionLogController.cjs"}],[1824,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n;Object.defineProperty(s,"__esModule",{value:!0}),s.LOG_LIMIT=s.LOG_METHOD_TYPES=s.LOG_IGNORE_METHODS=s.CAVEAT_TYPES=s.WALLET_PREFIX=void 0,s.WALLET_PREFIX="wallet_",s.CAVEAT_TYPES=Object.freeze({restrictReturnedAccounts:"restrictReturnedAccounts"}),s.LOG_IGNORE_METHODS=["wallet_registerOnboarding","wallet_watchAsset"],function(e){e.restricted="restricted",e.internal="internal"}(n||(s.LOG_METHOD_TYPES=n={})),s.LOG_LIMIT=100}}},{package:"@metamask/permission-log-controller",file:"node_modules/@metamask/permission-log-controller/dist/enums.cjs"}],[1825,{"./PermissionLogController.cjs":1823},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n=this&&this.__createBinding||(Object.create?function(e,t,s,n){n===undefined&&(n=s);var i=Object.getOwnPropertyDescriptor(t,s);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,n,i)}:function(e,t,s,n){n===undefined&&(n=s),e[n]=t[s]}),i=this&&this.__exportStar||function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||n(t,e,s)};Object.defineProperty(s,"__esModule",{value:!0}),i(e("./PermissionLogController.cjs"),s)}}},{package:"@metamask/permission-log-controller",file:"node_modules/@metamask/permission-log-controller/dist/index.cjs"}],[183,{"./createMethodMiddleware":168,"./createUnsupportedMethodMiddleware":169},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0});var n=e("./createMethodMiddleware");Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&(e in s&&s[e]===n[e]||Object.defineProperty(s,e,{enumerable:!0,get:function(){return n[e]}}))});var i=e("./createUnsupportedMethodMiddleware");Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&(e in s&&s[e]===i[e]||Object.defineProperty(s,e,{enumerable:!0,get:function(){return i[e]}}))})}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/index.js"}],[184,{"./operation-safener":162,loglevel:4094,"webextension-polyfill":4949},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.getRequestSafeReload=function(e){const t=new r.OperationSafener({op:async t=>{try{await e.set(t)}catch(e){i.default.error("MetaMask - Persistence failed",e),null==o||o.captureException(e)}},wait:1e3});return{update:async(...e)=>t.execute(...e),requestSafeReload:async()=>{await t.evacuate(),n.default.runtime.reload()}}};var n=a(e("webextension-polyfill")),i=a(e("loglevel")),r=e("./operation-safener");function a(e){return e&&e.__esModule?e:{default:e}}const{sentry:o}=global}}},{package:"$root$",file:"app/scripts/lib/safe-reload.ts"}],[1843,{"./ppom-controller":1844},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.PPOMController=s.NETWORK_CACHE_DURATION=void 0;var n=e("./ppom-controller");Object.defineProperty(s,"NETWORK_CACHE_DURATION",{enumerable:!0,get:function(){return n.NETWORK_CACHE_DURATION}}),Object.defineProperty(s,"PPOMController",{enumerable:!0,get:function(){return n.PPOMController}})}}},{package:"@metamask/ppom-validator",file:"node_modules/@metamask/ppom-validator/dist/index.js"}],[1844,{"./ppom-storage":1845,"./util":1846,"@metamask/base-controller":1851,"@metamask/controller-utils":1316,"await-semaphore":3146},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n,i,r,a,o,c,l,u,h,d,m,p,f,g,y,w,S,v,b,k,_,T,E,P,C,O,A,I,M,j,N,R,x=this&&this.__classPrivateFieldSet||function(e,t,s,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,s):i?i.value=s:t.set(e,s),s},D=this&&this.__classPrivateFieldGet||function(e,t,s,n){if("a"===s&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)};Object.defineProperty(s,"__esModule",{value:!0}),s.PPOMController=s.NETWORK_CACHE_DURATION=void 0;const L=e("@metamask/base-controller"),F=e("@metamask/controller-utils"),U=e("await-semaphore"),H=e("./ppom-storage"),$=e("./util");s.NETWORK_CACHE_DURATION=6048e5;const B=["eth_call","eth_blockNumber","eth_createAccessList","eth_getLogs","eth_getFilterLogs","eth_getTransactionByHash","eth_chainId","eth_getBlockByHash","eth_getBlockByNumber","eth_getCode","eth_getStorageAt","eth_getBalance","eth_getTransactionCount","trace_call","trace_callMany","debug_traceCall","trace_filter"],W={versionInfo:{persist:!0,anonymous:!1},storageMetadata:{persist:!0,anonymous:!1}},q="PPOMController",K={headers:{"Content-Type":"application/json"}};class V extends L.BaseController{constructor({chainId:e,messenger:t,provider:s,storageBackend:w,securityAlertsEnabled:S,onPreferencesChange:v,ppomProvider:T,cdnBaseUrl:E,providerRequestLimit:P,state:C,blockaidPublicKey:O,nativeCrypto:A}){super({name:q,metadata:W,messenger:t,state:{versionInfo:C?.versionInfo??[],storageMetadata:C?.storageMetadata??[]}}),n.add(this),i.set(this,void 0),r.set(this,void 0),a.set(this,void 0),o.set(this,void 0),c.set(this,void 0),l.set(this,void 0),u.set(this,void 0),h.set(this,0),d.set(this,void 0),m.set(this,void 0),p.set(this,{}),f.set(this,void 0),g.set(this,!1),y.set(this,undefined),x(this,d,(0,$.addHexPrefix)(e),"f"),x(this,r,s,"f"),x(this,c,T,"f"),x(this,a,new H.PPOMStorage({storageBackend:w,readMetadata:()=>[...this.state.storageMetadata],writeMetadata:e=>{this.update(t=>{t.storageMetadata=e})}}),"f"),x(this,o,new U.Mutex,"f"),x(this,l,E,"f"),x(this,u,P??300,"f"),x(this,m,S,"f"),x(this,f,O,"f"),x(this,y,A,"f"),v(D(this,n,"m",b).bind(this)),D(this,n,"m",k).call(this),D(this,n,"m",_).call(this)}async usePPOM(e,t){const s=t??D(this,d,"f");if(!D(this,m,"f"))throw Error("User has securityAlertsEnabled set to false");if(!(0,$.blockaidValidationSupportedForNetwork)(s))throw Error(`Blockaid validation not available on network with chainId: ${s}`);return await D(this,o,"f").use(async()=>{const t=await D(this,n,"m",E).call(this,s);x(this,h,0,"f"),x(this,p,{},"f");return{...await e(t),providerRequestsCount:{...D(this,p,"f")}}})}}s.PPOMController=V,i=new WeakMap,r=new WeakMap,a=new WeakMap,o=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,h=new WeakMap,d=new WeakMap,m=new WeakMap,p=new WeakMap,f=new WeakMap,g=new WeakMap,y=new WeakMap,n=new WeakSet,w=async function(){if(D(this,m,"f")&&!D(this,g,"f")){const{ppomInit:e}=D(this,c,"f");await e("./ppom_bg.wasm"),x(this,g,!0,"f")}},S=function(){D(this,n,"m",T).call(this).catch(e=>{console.error(`Error in resetting ppom: ${e.message}`)});const{storageMetadata:e}=this.state;this.update(e=>{e.versionInfo=[],e.storageMetadata=[]}),D(this,a,"f").deleteAllFiles(e).catch(e=>{console.error(`Error in deleting files: ${e.message}`)})},v=function(e){const t=this.messagingSystem.call("NetworkController:getNetworkClientById",e.selectedNetworkClientId),{chainId:s}=t.configuration,i=(0,$.addHexPrefix)(s);i!==D(this,d,"f")&&(x(this,d,i,"f"),D(this,n,"m",T).call(this).catch(e=>{console.error(`Error in resetting ppom: ${e.message}`)}))},b=function(e){const t=e.securityAlertsEnabled;t!==D(this,m,"f")&&(x(this,m,t,"f"),t||D(this,n,"m",S).call(this))},k=function(){this.messagingSystem.registerActionHandler(`${q}:usePPOM`,this.usePPOM.bind(this))},_=function(){const e=D(this,n,"m",v).bind(this);this.messagingSystem.subscribe("NetworkController:networkDidChange",e)},T=async function(){await D(this,o,"f").use(async()=>{D(this,i,"f")&&(D(this,i,"f").free(),x(this,i,undefined,"f"))})},E=async function(e){const t=await D(this,n,"m",P).call(this);let s;return(D(this,i,"f")===undefined||t)&&(s=await D(this,n,"m",R).call(this,e),D(this,d,"f")===e&&(D(this,i,"f")&&D(this,i,"f").free(),x(this,i,s,"f")),D(this,a,"f").syncMetadata(this.state.versionInfo).catch(e=>{console.error(`Error while trying to sync metadata: ${e.message}`)})),s},P=async function(){const e=await D(this,n,"m",M).call(this);return!!e&&(this.update(t=>{t.versionInfo=e}),!0)},C=function(e,t){return e.find(e=>e.name===t.name&&e.chainId===t.chainId&&e.version===t.version&&e.checksum===t.checksum)},O=async function(e){const t=await Promise.all(e.map(async e=>{let t;try{t=await D(this,n,"m",A).call(this,e)}catch(t){console.error(`Error in getting file ${e.filePath}: ${t.message}`)}return t?[e.name,new Uint8Array(t)]:undefined}));return t?.filter(e=>e?.[1]!==undefined)},A=async function(e){const{storageMetadata:t}=this.state;if(D(this,n,"m",C).call(this,t,e))try{return await D(this,a,"f").readFile(e.name,e.chainId)}catch(e){console.error(`Error in reading file: ${e.message}`)}(0,$.checkFilePath)(e.filePath);const s=(0,$.constructURLHref)(D(this,l,"f"),e.filePath),i=await D(this,n,"m",j).call(this,s);return await(0,$.validateSignature)(i,e.hashSignature,D(this,f,"f"),e.filePath,D(this,y,"f")),await D(this,a,"f").writeFile({data:i,...e}).catch(e=>{console.error(`Error in writing file: ${e.message}`)}),i},I=async function(e,t={},s="GET"){const n=await(0,F.safelyExecute)(async()=>(0,F.timeoutFetch)(e,{method:s,cache:"no-cache",redirect:"error",...t},1e4),!0),i=304===n?.status;if(!n?.status||n?.status<200||n?.status>399)throw new Error(`Failed to fetch file with url: ${e}`);return{cached:i,response:n}},M=async function(){const e=(0,$.constructURLHref)(D(this,l,"f"),"ppom_version.json"),{cached:t,response:s}=await D(this,n,"m",I).call(this,e,{headers:K});return t&&this.state.versionInfo?.length?undefined:s.json()},j=async function(e){const{response:t}=await D(this,n,"m",I).call(this,e);return await t.arrayBuffer()},N=async function(e,t){if(D(this,h,"f")>D(this,u,"f"))return $.PROVIDER_ERRORS.limitExceeded();if(x(this,h,D(this,h,"f")+1,"f"),!B.includes(e))return $.PROVIDER_ERRORS.methodNotSupported();D(this,p,"f")[e]=D(this,p,"f")[e]?Number(D(this,p,"f")[e])+1:1;const s=(0,$.createPayload)(e,t);try{const e=await D(this,r,"f").request(s);return{jsonrpc:"2.0",id:s.id,result:e}}catch(e){return{jsonrpc:"2.0",id:s.id,error:e}}},R=async function(e){await D(this,n,"m",w).call(this);const t=this.state.versionInfo.filter(({chainId:t})=>t===e);if(t?.length===undefined||0===t?.length)throw new Error(`Aborting initialising PPOM as no files are found for the network with chainId: ${e}`);const s=await D(this,n,"m",O).call(this,t);if(s?.length!==t?.length)throw new Error(`Aborting initialising PPOM as not all files could not be downloaded for the network with chainId: ${e}`);const{PPOM:i}=D(this,c,"f");return i.new(D(this,n,"m",N).bind(this),s)}}}},{package:"@metamask/ppom-validator",file:"node_modules/@metamask/ppom-validator/dist/ppom-controller.js"}],[1845,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n,i,r,a=this&&this.__classPrivateFieldSet||function(e,t,s,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,s):i?i.value=s:t.set(e,s),s},o=this&&this.__classPrivateFieldGet||function(e,t,s,n){if("a"===s&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)};Object.defineProperty(s,"__esModule",{value:!0}),s.PPOMStorage=void 0;s.PPOMStorage=class{constructor({storageBackend:e,readMetadata:t,writeMetadata:s}){n.set(this,void 0),i.set(this,void 0),r.set(this,void 0),a(this,n,e,"f"),a(this,i,t,"f"),a(this,r,s,"f")}async syncMetadata(e){const t=o(this,i,"f").call(this),s=[];for(const n of t){try{await this.readFile(n.name,n.chainId)}catch(e){console.error("Error: ",e);continue}e.find(e=>e.name===n.name&&e.chainId===n.chainId&&e.version===n.version&&e.checksum===n.checksum)&&s.push(n)}const a=await o(this,n,"f").dir();for(const{name:e,chainId:t}of a)s.find(s=>s.name===e&&s.chainId===t)||await o(this,n,"f").delete({name:e,chainId:t});return o(this,r,"f").call(this,s),s}async deleteAllFiles(e){for(const t of e){const{name:e,chainId:s}=t;try{await o(this,n,"f").delete({name:e,chainId:s})}catch(t){console.error(`Error in deleting file: ${e}, ${s}`,t)}}}async readFile(e,t){const s=o(this,i,"f").call(this).find(s=>s.name===e&&s.chainId===t);if(!s)throw new Error(`File metadata (${e}, ${t}) not found`);const r=await o(this,n,"f").read({name:e,chainId:t},s.checksum);if(!r)throw new Error(`Storage File (${e}, ${t}) not found`);return r}async writeFile({data:e,name:t,chainId:s,version:a,checksum:c}){await o(this,n,"f").write({name:t,chainId:s},e,c);const l=o(this,i,"f").call(this),u=l.find(e=>e.name===t&&e.chainId===s);u?(u.version=a,u.checksum=c):l.push({name:t,chainId:s,version:a,checksum:c}),o(this,r,"f").call(this,l)}},n=new WeakMap,i=new WeakMap,r=new WeakMap}}},{package:"@metamask/ppom-validator",file:"node_modules/@metamask/ppom-validator/dist/ppom-storage.js"}],[1846,{buffer:3316,"crypto-js":3434,elliptic:3490,"json-rpc-random-id":3917},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){(function(t){(function(){var n=this&&this.__createBinding||(Object.create?function(e,t,s,n){n===undefined&&(n=s);var i=Object.getOwnPropertyDescriptor(t,s);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,n,i)}:function(e,t,s,n){n===undefined&&(n=s),e[n]=t[s]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&n(t,e,s);return i(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(s,"__esModule",{value:!0}),s.checkFilePath=s.addHexPrefix=s.constructURLHref=s.validateSignature=s.PROVIDER_ERRORS=s.createPayload=s.IdGenerator=s.blockaidValidationSupportedForNetwork=s.SUPPORTED_NETWORK_CHAINIDS=void 0;const o=r(e("crypto-js")),c=a(e("elliptic")),l=a(e("json-rpc-random-id")),u=c.default.eddsa;s.SUPPORTED_NETWORK_CHAINIDS={MAINNET:"0x1",BSC:"0x38",OPTIMISM:"0xa",POLYGON:"0x89",AVALANCHE:"0xa86a",ARBITRUM:"0xa4b1",LINEA_MAINNET:"0xe708",BASE:"0x2105",SEPOLIA:"0xaa36a7",OPBNB:"0xcc",ZKSYNC:"0x144",SCROLL:"0x82750",BERACHAIN:"0x138d4",METACHAIN_ONE:"0x1b6e6"};s.blockaidValidationSupportedForNetwork=e=>Object.values(s.SUPPORTED_NETWORK_CHAINIDS).some(t=>t===e),s.IdGenerator=(0,l.default)();s.createPayload=(e,t)=>({id:(0,s.IdGenerator)(),jsonrpc:"2.0",method:e,params:t??[]}),s.PROVIDER_ERRORS={limitExceeded:()=>({jsonrpc:"2.0",id:(0,s.IdGenerator)(),error:{code:-32005,message:"Limit exceeded"}}),methodNotSupported:()=>({jsonrpc:"2.0",id:(0,s.IdGenerator)(),error:{code:-32601,message:"Method not supported"}})};s.validateSignature=async(e,s,n,i,r,a)=>{const c=await(async(e,t,s=!0)=>{if(t)return t.createHash("sha256").update(e).digest("hex");if("crypto"in globalThis&&"object"==typeof globalThis.crypto&&globalThis.crypto.subtle?.digest&&s){const t=await globalThis.crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(t)).map(e=>e.toString(16).padStart(2,"0")).join("")}return(0,o.SHA256)(o.default.lib.WordArray.create(e)).toString()})(e,r,a);if(!new u("ed25519").keyFromPublic(n).verify(t.from(c),s))throw Error(`Signature verification failed for file path: ${i}`)};s.constructURLHref=(e,t)=>new URL(`https://${e}/${t}`.replace(/https:\/\/https:\/\//gu,"https://").replace(/\/\//gu,"/")).href;s.addHexPrefix=e=>"string"!=typeof e||e.match(/^-?0x/u)?e:e.match(/^-?0X/u)?e.replace("0X","0x"):`0x${parseInt(e,10).toString(16)}`;s.checkFilePath=e=>{if(!e.match(/^[\w./]+$/u))throw new Error(`Invalid file path for data file: ${e}`)}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/ppom-validator",file:"node_modules/@metamask/ppom-validator/dist/util.js"}],[1847,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.BaseControllerV1=s.isBaseControllerV1=void 0,s.isBaseControllerV1=function(e){return"name"in e&&"string"==typeof e.name&&"config"in e&&"object"==typeof e.config&&"defaultConfig"in e&&"object"==typeof e.defaultConfig&&"state"in e&&"object"==typeof e.state&&"defaultState"in e&&"object"==typeof e.defaultState&&"disabled"in e&&"boolean"==typeof e.disabled&&"subscribe"in e&&"function"==typeof e.subscribe};class n{constructor(e={},t={}){this.defaultConfig={},this.defaultState={},this.disabled=!1,this.name="BaseController",this.internalConfig=this.defaultConfig,this.internalState=this.defaultState,this.internalListeners=[],this.initialState=t,this.initialConfig=e}initialize(){return this.internalState=this.defaultState,this.internalConfig=this.defaultConfig,this.configure(this.initialConfig),this.update(this.initialState),this}get config(){return this.internalConfig}get state(){return this.internalState}configure(e,t=!1,s=!0){if(s){this.internalConfig=t?e:Object.assign(this.internalConfig,e);for(const e of Object.keys(this.internalConfig)){const t=this.internalConfig[e];t!==undefined&&(this[e]=t)}}else for(const t of Object.keys(e))if(this.internalConfig[t]!==undefined){const s=e[t];this.internalConfig[t]=s,this[t]=s}}notify(){this.disabled||this.internalListeners.forEach(e=>{e(this.internalState)})}subscribe(e){this.internalListeners.push(e)}unsubscribe(e){const t=this.internalListeners.findIndex(t=>e===t);return t>-1&&this.internalListeners.splice(t,1),t>-1}update(e,t=!1){this.internalState=t?Object.assign({},e):Object.assign({},this.internalState,e),this.notify()}}s.BaseControllerV1=n,s.default=n}}},{package:"@metamask/ppom-validator>@metamask/base-controller",file:"node_modules/@metamask/ppom-validator/node_modules/@metamask/base-controller/dist/BaseControllerV1.cjs"}],[1848,{immer:3881},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n,i=this&&this.__classPrivateFieldSet||function(e,t,s,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,s):i?i.value=s:t.set(e,s),s},r=this&&this.__classPrivateFieldGet||function(e,t,s,n){if("a"===s&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)};Object.defineProperty(s,"__esModule",{value:!0}),s.getPersistentState=s.getAnonymizedState=s.BaseController=s.isBaseController=void 0;const a=e("immer");(0,a.enablePatches)(),s.isBaseController=function(e){return"name"in e&&"string"==typeof e.name&&"state"in e&&"object"==typeof e.state&&"metadata"in e&&"object"==typeof e.metadata};function o(e,t,s){return Object.keys(e).reduce((n,i)=>{try{const r=t[i];if(!r)throw new Error(`No metadata found for '${String(i)}'`);const a=r[s],o=e[i];return"function"==typeof a?n[i]=a(o):a&&(n[i]=o),n}catch(e){return setTimeout(()=>{throw e}),n}},{})}s.BaseController=class{constructor({messenger:e,metadata:t,name:s,state:r}){n.set(this,void 0),this.messagingSystem=e,this.name=s,i(this,n,(0,a.freeze)(r,!0),"f"),this.metadata=t,this.messagingSystem.registerActionHandler(`${s}:getState`,()=>this.state),this.messagingSystem.registerInitialEventPayload({eventType:`${s}:stateChange`,getPayload:()=>[this.state,[]]})}get state(){return r(this,n,"f")}set state(e){throw new Error("Controller state cannot be directly mutated; use 'update' method instead.")}update(e){const[t,s,o]=a.produceWithPatches(r(this,n,"f"),e);return i(this,n,t,"f"),this.messagingSystem.publish(`${this.name}:stateChange`,t,s),{nextState:t,patches:s,inversePatches:o}}applyPatches(e){const t=(0,a.applyPatches)(r(this,n,"f"),e);i(this,n,t,"f"),this.messagingSystem.publish(`${this.name}:stateChange`,t,e)}destroy(){this.messagingSystem.clearEventSubscriptions(`${this.name}:stateChange`)}},n=new WeakMap,s.getAnonymizedState=function(e,t){return o(e,t,"anonymous")},s.getPersistentState=function(e,t){return o(e,t,"persist")}}}},{package:"@metamask/ppom-validator>@metamask/base-controller",file:"node_modules/@metamask/ppom-validator/node_modules/@metamask/base-controller/dist/BaseControllerV2.cjs"}],[1849,{"./RestrictedMessenger.cjs":1850},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n,i,r,a,o=this&&this.__classPrivateFieldGet||function(e,t,s,n){if("a"===s&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)};Object.defineProperty(s,"__esModule",{value:!0}),s.ControllerMessenger=s.Messenger=void 0;const c=e("./RestrictedMessenger.cjs");class l{constructor(){n.set(this,new Map),i.set(this,new Map),r.set(this,new Map),a.set(this,new Map)}registerActionHandler(e,t){if(o(this,n,"f").has(e))throw new Error(`A handler for ${e} has already been registered`);o(this,n,"f").set(e,t)}unregisterActionHandler(e){o(this,n,"f").delete(e)}clearActions(){o(this,n,"f").clear()}call(e,...t){const s=o(this,n,"f").get(e);if(!s)throw new Error(`A handler for ${e} has not been registered`);return s(...t)}registerInitialEventPayload({eventType:e,getPayload:t}){o(this,r,"f").set(e,t)}publish(e,...t){const s=o(this,i,"f").get(e);if(s)for(const[e,n]of s.entries())try{if(n){const s=o(this,a,"f").get(e),i=n(...t);i!==s&&(o(this,a,"f").set(e,i),e(i,s))}else e(...t)}catch(e){setTimeout(()=>{throw e})}}subscribe(e,t,s){let n=o(this,i,"f").get(e);if(n||(n=new Map,o(this,i,"f").set(e,n)),n.set(t,s),s){const n=o(this,r,"f").get(e);if(n){const e=s(...n());o(this,a,"f").set(t,e)}}}unsubscribe(e,t){const s=o(this,i,"f").get(e);if(!s||!s.has(t))throw new Error(`Subscription not found for event: ${e}`);s.get(t)&&o(this,a,"f").delete(t),s.delete(t)}clearEventSubscriptions(e){o(this,i,"f").delete(e)}clearSubscriptions(){o(this,i,"f").clear()}getRestricted({name:e,allowedActions:t,allowedEvents:s}){return new c.RestrictedMessenger({messenger:this,name:e,allowedActions:t,allowedEvents:s})}}s.Messenger=l,s.ControllerMessenger=l,n=new WeakMap,i=new WeakMap,r=new WeakMap,a=new WeakMap}}},{package:"@metamask/ppom-validator>@metamask/base-controller",file:"node_modules/@metamask/ppom-validator/node_modules/@metamask/base-controller/dist/Messenger.cjs"}],[185,{"../util":225,"@segment/loosely-validate-event":2437,buffer:3316,"is-retry-allowed":3899,lodash:4086,"remove-trailing-slash":4537,timers:3318},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){(function(t,n){(function(){Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var i=l(e("remove-trailing-slash")),r=l(e("@segment/loosely-validate-event")),a=e("lodash"),o=l(e("is-retry-allowed")),c=e("../util");function l(e){return e&&e.__esModule?e:{default:e}}const u=()=>({});s.default=class{constructor(e,t={}){this.writeKey=e,this.host=(0,i.default)(t.host||"https://api.segment.io"),this.flushInterval=t.flushInterval||1e4,this.flushAt=t.flushAt||Math.max(t.flushAt,1)||20,this.queue=[],this.path="/v1/batch",this.maxQueueSize=460800,this.flushed=!1,this.retryCount=3,Object.defineProperty(this,"enable",{configurable:!1,writable:!1,enumerable:!0,value:!0})}_validate(e,t){(0,r.default)(e,t)}_message(e,t,s){return this._validate(t,e),this.enqueue(e,t,s),this}identify(e,t){return this._message("identify",e,t)}track(e,t){return this._message("track",e,t)}page(e,t){return this._message("page",e,t)}enqueue(e,t,s=u){if(!this.enable)return void n(s);const i={...t,type:e};if(i.context={...i.context,library:{name:"analytics-node"}},i.timestamp||(i.timestamp=new Date),i.messageId||(i.messageId=(0,c.generateRandomId)()),i.anonymousId&&!(0,a.isString)(i.anonymousId)&&(i.anonymousId=JSON.stringify(i.anonymousId)),i.userId&&!(0,a.isString)(i.userId)&&(i.userId=JSON.stringify(i.userId)),this.queue.push({message:i,callback:s}),!this.flushed)return this.flushed=!0,void this.flush();const r=this.queue.length>=this.flushAt,o=this.queue.reduce((e,t)=>e+JSON.stringify(t).length,0)>=this.maxQueueSize;(r||o)&&this.flush(),this.flushInterval&&!this.timer&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))}flush(e=u){if(!this.enable)return n(e),Promise.resolve();if(this.timer&&(clearTimeout(this.timer),this.timer=null),!this.queue.length)return n(e),Promise.resolve();const s=this.queue.splice(0,this.flushAt),i=s.map(e=>e.callback),r={batch:s.map(e=>e.message),timestamp:new Date,sentAt:new Date},a={Authorization:`Basic ${t.from(this.writeKey,"utf8").toString("base64")}`};return this._sendRequest(`${this.host}${this.path}`,{method:"POST",body:JSON.stringify(r),headers:a},t=>{n(()=>{i.forEach(e=>e(t,r)),e(t,r)})},0)}_retryRequest(e,t,s,n){const i=100*Math.pow(2,n);setTimeout(()=>{this._sendRequest(e,t,s,n+1)},i)}async _sendRequest(e,t,s,n){return fetch(e,t).then(async i=>{if(i.ok)s();else if(this._isErrorRetryable({response:i})&&n<=this.retryCount)this._retryRequest(e,t,s,n);else{const e=new Error(i.statusText);s(e)}}).catch(i=>{this._isErrorRetryable(i)&&n<=this.retryCount?this._retryRequest(e,t,s,n):s(i)})}_isErrorRetryable(e){return!!function(e){return!e.response&&Boolean(e.code)&&"ECONNABORTED"!==e.code&&(0,o.default)(e)}(e)||!!e.response&&(e.response.status>=500&&e.response.status<=599||429===e.response.status)}}}).call(this)}).call(this,e("buffer").Buffer,e("timers").setImmediate)}}},{package:"$root$",file:"app/scripts/lib/segment/analytics.js"}],[1850,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n,i,r,a,o,c,l,u,h=this&&this.__classPrivateFieldSet||function(e,t,s,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,s):i?i.value=s:t.set(e,s),s},d=this&&this.__classPrivateFieldGet||function(e,t,s,n){if("a"===s&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)};Object.defineProperty(s,"__esModule",{value:!0}),s.RestrictedControllerMessenger=s.RestrictedMessenger=void 0;class m{constructor({controllerMessenger:e,messenger:t,name:s,allowedActions:c,allowedEvents:l}){if(n.add(this),i.set(this,void 0),r.set(this,void 0),a.set(this,void 0),o.set(this,void 0),t&&e)throw new Error("Both messenger properties provided. Provide message using only 'messenger' option, 'controllerMessenger' is deprecated");if(!t&&!e)throw new Error("Messenger not provided");h(this,i,t??e,"f"),h(this,r,s,"f"),h(this,a,c,"f"),h(this,o,l,"f")}registerActionHandler(e,t){if(!d(this,n,"m",u).call(this,e))throw new Error(`Only allowed registering action handlers prefixed by '${d(this,r,"f")}:'`);d(this,i,"f").registerActionHandler(e,t)}unregisterActionHandler(e){if(!d(this,n,"m",u).call(this,e))throw new Error(`Only allowed unregistering action handlers prefixed by '${d(this,r,"f")}:'`);d(this,i,"f").unregisterActionHandler(e)}call(e,...t){if(!d(this,n,"m",l).call(this,e))throw new Error(`Action missing from allow list: ${e}`);return d(this,i,"f").call(e,...t)}registerInitialEventPayload({eventType:e,getPayload:t}){if(!d(this,n,"m",u).call(this,e))throw new Error(`Only allowed publishing events prefixed by '${d(this,r,"f")}:'`);d(this,i,"f").registerInitialEventPayload({eventType:e,getPayload:t})}publish(e,...t){if(!d(this,n,"m",u).call(this,e))throw new Error(`Only allowed publishing events prefixed by '${d(this,r,"f")}:'`);d(this,i,"f").publish(e,...t)}subscribe(e,t,s){if(!d(this,n,"m",c).call(this,e))throw new Error(`Event missing from allow list: ${e}`);return s?d(this,i,"f").subscribe(e,t,s):d(this,i,"f").subscribe(e,t)}unsubscribe(e,t){if(!d(this,n,"m",c).call(this,e))throw new Error(`Event missing from allow list: ${e}`);d(this,i,"f").unsubscribe(e,t)}clearEventSubscriptions(e){if(!d(this,n,"m",u).call(this,e))throw new Error(`Only allowed clearing events prefixed by '${d(this,r,"f")}:'`);d(this,i,"f").clearEventSubscriptions(e)}}s.RestrictedMessenger=m,s.RestrictedControllerMessenger=m,i=new WeakMap,r=new WeakMap,a=new WeakMap,o=new WeakMap,n=new WeakSet,c=function(e){const t=d(this,o,"f");return d(this,n,"m",u).call(this,e)||null!==t&&t.includes(e)},l=function(e){const t=d(this,a,"f");return d(this,n,"m",u).call(this,e)||null!==t&&t.includes(e)},u=function(e){return e.startsWith(`${d(this,r,"f")}:`)}}}},{package:"@metamask/ppom-validator>@metamask/base-controller",file:"node_modules/@metamask/ppom-validator/node_modules/@metamask/base-controller/dist/RestrictedMessenger.cjs"}],[1851,{"./BaseControllerV1.cjs":1847,"./BaseControllerV2.cjs":1848,"./Messenger.cjs":1849,"./RestrictedMessenger.cjs":1850},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.RestrictedMessenger=s.RestrictedControllerMessenger=s.Messenger=s.ControllerMessenger=s.isBaseController=s.getPersistentState=s.getAnonymizedState=s.BaseController=s.isBaseControllerV1=s.BaseControllerV1=void 0;var n=e("./BaseControllerV1.cjs");Object.defineProperty(s,"BaseControllerV1",{enumerable:!0,get:function(){return n.BaseControllerV1}}),Object.defineProperty(s,"isBaseControllerV1",{enumerable:!0,get:function(){return n.isBaseControllerV1}});var i=e("./BaseControllerV2.cjs");Object.defineProperty(s,"BaseController",{enumerable:!0,get:function(){return i.BaseController}}),Object.defineProperty(s,"getAnonymizedState",{enumerable:!0,get:function(){return i.getAnonymizedState}}),Object.defineProperty(s,"getPersistentState",{enumerable:!0,get:function(){return i.getPersistentState}}),Object.defineProperty(s,"isBaseController",{enumerable:!0,get:function(){return i.isBaseController}});var r=e("./Messenger.cjs");Object.defineProperty(s,"ControllerMessenger",{enumerable:!0,get:function(){return r.ControllerMessenger}}),Object.defineProperty(s,"Messenger",{enumerable:!0,get:function(){return r.Messenger}});var a=e("./RestrictedMessenger.cjs");Object.defineProperty(s,"RestrictedControllerMessenger",{enumerable:!0,get:function(){return a.RestrictedControllerMessenger}}),Object.defineProperty(s,"RestrictedMessenger",{enumerable:!0,get:function(){return a.RestrictedMessenger}})}}},{package:"@metamask/ppom-validator>@metamask/base-controller",file:"node_modules/@metamask/ppom-validator/node_modules/@metamask/base-controller/dist/index.cjs"}],[1852,{"./constants.cjs":1853,"@metamask/base-controller":1241,"@metamask/controller-utils":1316},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n,i,r=this&&this.__classPrivateFieldGet||function(e,t,s,n){if("a"===s&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)};Object.defineProperty(s,"__esModule",{value:!0}),s.PreferencesController=s.getDefaultPreferencesState=void 0;const a=e("@metamask/base-controller"),o=e("@metamask/controller-utils"),c=e("./constants.cjs"),l={featureFlags:{persist:!0,anonymous:!0},identities:{persist:!0,anonymous:!1},ipfsGateway:{persist:!0,anonymous:!1},isIpfsGatewayEnabled:{persist:!0,anonymous:!0},isMultiAccountBalancesEnabled:{persist:!0,anonymous:!0},lostIdentities:{persist:!0,anonymous:!1},openSeaEnabled:{persist:!0,anonymous:!0},securityAlertsEnabled:{persist:!0,anonymous:!0},selectedAddress:{persist:!0,anonymous:!1},showTestNetworks:{persist:!0,anonymous:!0},showIncomingTransactions:{persist:!0,anonymous:!0},useNftDetection:{persist:!0,anonymous:!0},useTokenDetection:{persist:!0,anonymous:!0},smartTransactionsOptInStatus:{persist:!0,anonymous:!1},useTransactionSimulations:{persist:!0,anonymous:!0},useMultiRpcMigration:{persist:!0,anonymous:!0},useSafeChainsListValidation:{persist:!0,anonymous:!0},tokenSortConfig:{persist:!0,anonymous:!0},privacyMode:{persist:!0,anonymous:!0}};function u(){return{featureFlags:{},identities:{},ipfsGateway:"https://ipfs.io/ipfs/",isIpfsGatewayEnabled:!0,isMultiAccountBalancesEnabled:!0,lostIdentities:{},openSeaEnabled:!1,securityAlertsEnabled:!1,selectedAddress:"",showIncomingTransactions:{[c.ETHERSCAN_SUPPORTED_CHAIN_IDS.MAINNET]:!0,[c.ETHERSCAN_SUPPORTED_CHAIN_IDS.GOERLI]:!0,[c.ETHERSCAN_SUPPORTED_CHAIN_IDS.BSC]:!0,[c.ETHERSCAN_SUPPORTED_CHAIN_IDS.BSC_TESTNET]:!0,[c.ETHERSCAN_SUPPORTED_CHAIN_IDS.OPTIMISM]:!0,[c.ETHERSCAN_SUPPORTED_CHAIN_IDS.OPTIMISM_SEPOLIA]:!0,[c.ETHERSCAN_SUPPORTED_CHAIN_IDS.POLYGON]:!0,[c.ETHERSCAN_SUPPORTED_CHAIN_IDS.POLYGON_TESTNET]:!0,[c.ETHERSCAN_SUPPORTED_CHAIN_IDS.AVALANCHE]:!0,[c.ETHERSCAN_SUPPORTED_CHAIN_IDS.AVALANCHE_TESTNET]:!0,[c.ETHERSCAN_SUPPORTED_CHAIN_IDS.FANTOM]:!0,[c.ETHERSCAN_SUPPORTED_CHAIN_IDS.FANTOM_TESTNET]:!0,[c.ETHERSCAN_SUPPORTED_CHAIN_IDS.SEPOLIA]:!0,[c.ETHERSCAN_SUPPORTED_CHAIN_IDS.LINEA_GOERLI]:!0,[c.ETHERSCAN_SUPPORTED_CHAIN_IDS.LINEA_SEPOLIA]:!0,[c.ETHERSCAN_SUPPORTED_CHAIN_IDS.LINEA_MAINNET]:!0,[c.ETHERSCAN_SUPPORTED_CHAIN_IDS.MOONBEAM]:!0,[c.ETHERSCAN_SUPPORTED_CHAIN_IDS.MOONBEAM_TESTNET]:!0,[c.ETHERSCAN_SUPPORTED_CHAIN_IDS.MOONRIVER]:!0,[c.ETHERSCAN_SUPPORTED_CHAIN_IDS.GNOSIS]:!0},showTestNetworks:!1,useNftDetection:!1,useTokenDetection:!0,useMultiRpcMigration:!0,smartTransactionsOptInStatus:!0,useTransactionSimulations:!0,useSafeChainsListValidation:!0,tokenSortConfig:{key:"tokenFiatAmount",order:"dsc",sortCallback:"stringNumeric"},privacyMode:!1}}s.getDefaultPreferencesState=u;class h extends a.BaseController{constructor({messenger:e,state:t}){super({name:"PreferencesController",metadata:l,messenger:e,state:{...u(),...t}}),n.add(this),e.subscribe("KeyringController:stateChange",e=>{const t=new Set;for(const s of e.keyrings)for(const e of s.accounts)t.add(e);t.size>0&&r(this,n,"m",i).call(this,Array.from(t))})}addIdentities(e){const t=e.map(e=>(0,o.toChecksumHexAddress)(e));this.update(e=>{const{identities:s}=e;for(const e of t){if(s[e])continue;const t=Object.keys(s).length;s[e]={name:`Account ${t+1}`,address:e,importTime:Date.now()}}})}removeIdentity(e){e=(0,o.toChecksumHexAddress)(e);const{identities:t}=this.state;t[e]&&this.update(t=>{delete t.identities[e],e===t.selectedAddress&&(t.selectedAddress=Object.keys(t.identities)[0])})}setAccountLabel(e,t){e=(0,o.toChecksumHexAddress)(e),this.update(s=>{const n=s.identities[e]||{};n.name=t,s.identities[e]=n})}setFeatureFlag(e,t){this.update(s=>{s.featureFlags[e]=t})}setSelectedAddress(e){this.update(t=>{t.selectedAddress=(0,o.toChecksumHexAddress)(e)})}setIpfsGateway(e){this.update(t=>{t.ipfsGateway=e})}setUseTokenDetection(e){this.update(t=>{t.useTokenDetection=e})}setUseNftDetection(e){if(e&&!this.state.openSeaEnabled)throw new Error("useNftDetection cannot be enabled if openSeaEnabled is false");this.update(t=>{t.useNftDetection=e})}setOpenSeaEnabled(e){this.update(t=>{t.openSeaEnabled=e,e||(t.useNftDetection=!1)})}setSecurityAlertsEnabled(e){this.update(t=>{t.securityAlertsEnabled=e})}setIsMultiAccountBalancesEnabled(e){this.update(t=>{t.isMultiAccountBalancesEnabled=e})}setShowTestNetworks(e){this.update(t=>{t.showTestNetworks=e})}setIsIpfsGatewayEnabled(e){this.update(t=>{t.isIpfsGatewayEnabled=e})}setEnableNetworkIncomingTransactions(e,t){Object.values(c.ETHERSCAN_SUPPORTED_CHAIN_IDS).includes(e)&&this.update(s=>{s.showIncomingTransactions={...this.state.showIncomingTransactions,[e]:t}})}setUseMultiRpcMigration(e){this.update(t=>{t.useMultiRpcMigration=e,e||(t.useMultiRpcMigration=!1)})}setSmartTransactionsOptInStatus(e){this.update(t=>{t.smartTransactionsOptInStatus=e})}setUseTransactionSimulations(e){this.update(t=>{t.useTransactionSimulations=e})}setTokenSortConfig(e){this.update(t=>{t.tokenSortConfig=e})}setUseSafeChainsListValidation(e){this.update(t=>{t.useSafeChainsListValidation=e})}setPrivacyMode(e){this.update(t=>{t.privacyMode=e})}}s.PreferencesController=h,n=new WeakSet,i=function(e){e=e.map(e=>(0,o.toChecksumHexAddress)(e)),this.update(t=>{const{identities:s}=t,n={};for(const[t,i]of Object.entries(s))e.includes(t)||(n[t]=i,delete s[t]);for(const[e,s]of Object.entries(n))t.lostIdentities[e]=s}),this.addIdentities(e),e.includes(this.state.selectedAddress)||this.update(t=>{t.selectedAddress=e[0]})},s.default=h}}},{package:"@metamask/preferences-controller",file:"node_modules/@metamask/preferences-controller/dist/PreferencesController.cjs"}],[1853,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.ETHERSCAN_SUPPORTED_CHAIN_IDS=void 0,s.ETHERSCAN_SUPPORTED_CHAIN_IDS={MAINNET:"0x1",GOERLI:"0x5",BSC:"0x38",BSC_TESTNET:"0x61",OPTIMISM:"0xa",OPTIMISM_SEPOLIA:"0xaa37dc",POLYGON:"0x89",POLYGON_TESTNET:"0x13881",AVALANCHE:"0xa86a",AVALANCHE_TESTNET:"0xa869",FANTOM:"0xfa",FANTOM_TESTNET:"0xfa2",SEPOLIA:"0xaa36a7",LINEA_GOERLI:"0xe704",LINEA_SEPOLIA:"0xe705",LINEA_MAINNET:"0xe708",MOONBEAM:"0x504",MOONBEAM_TESTNET:"0x507",MOONRIVER:"0x505",GNOSIS:"0x64"}}}},{package:"@metamask/preferences-controller",file:"node_modules/@metamask/preferences-controller/dist/constants.cjs"}],[1854,{"./PreferencesController.cjs":1852,"./constants.cjs":1853},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n=this&&this.__createBinding||(Object.create?function(e,t,s,n){n===undefined&&(n=s);var i=Object.getOwnPropertyDescriptor(t,s);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,n,i)}:function(e,t,s,n){n===undefined&&(n=s),e[n]=t[s]}),i=this&&this.__exportStar||function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||n(t,e,s)};Object.defineProperty(s,"__esModule",{value:!0}),s.ETHERSCAN_SUPPORTED_CHAIN_IDS=void 0,i(e("./PreferencesController.cjs"),s);var r=e("./constants.cjs");Object.defineProperty(s,"ETHERSCAN_SUPPORTED_CHAIN_IDS",{enumerable:!0,get:function(){return r.ETHERSCAN_SUPPORTED_CHAIN_IDS}})}}},{package:"@metamask/preferences-controller",file:"node_modules/@metamask/preferences-controller/dist/index.cjs"}],[1855,{"../../sdk/index.cjs":1882,"./auth-snap-requests.cjs":1856,"@metamask/base-controller":1241},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n,i,r,a,o,c,l,u,h,d,m,p,f,g,y=this&&this.__classPrivateFieldGet||function(e,t,s,n){if("a"===s&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)},w=this&&this.__classPrivateFieldSet||function(e,t,s,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,s):i?i.value=s:t.set(e,s),s};Object.defineProperty(s,"__esModule",{value:!0}),s.defaultState=void 0;const S=e("@metamask/base-controller"),v=e("./auth-snap-requests.cjs"),b=e("../../sdk/index.cjs");s.defaultState={isSignedIn:!1};const k={isSignedIn:{persist:!0,anonymous:!0},srpSessionData:{persist:!0,anonymous:!1}};class _ extends S.BaseController{constructor({messenger:e,state:t,config:d,metametrics:p}){if(super({messenger:e,metadata:k,name:"AuthenticationController",state:{...s.defaultState,...t}}),n.add(this),i.set(this,void 0),r.set(this,void 0),a.set(this,{env:b.Env.PRD}),o.set(this,!1),c.set(this,{setupLockedStateSubscriptions:()=>{const{isUnlocked:e}=this.messagingSystem.call("KeyringController:getState");w(this,o,e,"f"),this.messagingSystem.subscribe("KeyringController:unlock",()=>{w(this,o,!0,"f")}),this.messagingSystem.subscribe("KeyringController:lock",()=>{w(this,o,!1,"f")})}}),f.set(this,{}),!p)throw new Error("`metametrics` field is required");w(this,a,{...y(this,a,"f"),...d},"f"),w(this,i,p,"f"),w(this,r,new b.JwtBearerAuth({env:y(this,a,"f").env,platform:p.agent,type:b.AuthType.SRP},{storage:{getLoginResponse:y(this,n,"m",u).bind(this),setLoginResponse:y(this,n,"m",h).bind(this)},signing:{getIdentifier:y(this,n,"m",m).bind(this),signMessage:y(this,n,"m",g).bind(this)},metametrics:y(this,i,"f")}),"f"),y(this,c,"f").setupLockedStateSubscriptions(),y(this,n,"m",l).call(this)}async performSignIn(){y(this,n,"m",d).call(this,"performSignIn");const e=await y(this,n,"m",p).call(this),t=[];for(const[s]of e){const e=await y(this,r,"f").getAccessToken(s);t.push(e)}return t}performSignOut(){this.update(e=>{e.isSignedIn=!1,e.srpSessionData=undefined})}async getBearerToken(e){return y(this,n,"m",d).call(this,"getBearerToken"),await y(this,r,"f").getAccessToken(e)}async getSessionProfile(e){return y(this,n,"m",d).call(this,"getSessionProfile"),await y(this,r,"f").getUserProfile(e)}async getUserProfileMetaMetrics(){return y(this,n,"m",d).call(this,"getUserProfileMetaMetrics"),await y(this,r,"f").getUserProfileMetaMetrics()}isSignedIn(){return this.state.isSignedIn}}i=new WeakMap,r=new WeakMap,a=new WeakMap,o=new WeakMap,c=new WeakMap,f=new WeakMap,n=new WeakSet,l=function(){this.messagingSystem.registerActionHandler("AuthenticationController:getBearerToken",this.getBearerToken.bind(this)),this.messagingSystem.registerActionHandler("AuthenticationController:getSessionProfile",this.getSessionProfile.bind(this)),this.messagingSystem.registerActionHandler("AuthenticationController:isSignedIn",this.isSignedIn.bind(this)),this.messagingSystem.registerActionHandler("AuthenticationController:performSignIn",this.performSignIn.bind(this)),this.messagingSystem.registerActionHandler("AuthenticationController:performSignOut",this.performSignOut.bind(this)),this.messagingSystem.registerActionHandler("AuthenticationController:getUserProfileMetaMetrics",this.getUserProfileMetaMetrics.bind(this))},u=async function(e){if(e)return this.state.srpSessionData?.[e]?this.state.srpSessionData[e]:null;const t=Object.values(this.state.srpSessionData||{})?.[0];return t||null},h=async function(e,t){const s=await y(this,i,"f").getMetaMetricsId();this.update(n=>{t&&(n.isSignedIn=!0,n.srpSessionData||(n.srpSessionData={}),n.srpSessionData[t]={...e,profile:{...e.profile,metaMetricsId:s}})})},d=function(e){if(!y(this,o,"f"))throw new Error(`${e} - unable to proceed, wallet is locked`)},m=async function(e){y(this,n,"m",d).call(this,"#snapGetPublicKey");return await this.messagingSystem.call("SnapController:handleRequest",(0,v.createSnapPublicKeyRequest)(e))},p=async function(){y(this,n,"m",d).call(this,"#snapGetAllPublicKeys");return await this.messagingSystem.call("SnapController:handleRequest",(0,v.createSnapAllPublicKeysRequest)())},g=async function(e,t){if((0,b.assertMessageStartsWithMetamask)(e),y(this,f,"f")[e])return y(this,f,"f")[e];y(this,n,"m",d).call(this,"#snapSignMessage");const s=await this.messagingSystem.call("SnapController:handleRequest",(0,v.createSnapSignMessageRequest)(e,t));return y(this,f,"f")[e]=s,s},s.default=_}}},{package:"@metamask/profile-sync-controller",file:"node_modules/@metamask/profile-sync-controller/dist/controllers/authentication/AuthenticationController.cjs"}],[1857,{"./AuthenticationController.cjs":1855,"./mocks/index.cjs":1858},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n=this&&this.__createBinding||(Object.create?function(e,t,s,n){n===undefined&&(n=s);var i=Object.getOwnPropertyDescriptor(t,s);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,n,i)}:function(e,t,s,n){n===undefined&&(n=s),e[n]=t[s]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__exportStar||function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||n(t,e,s)},a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&n(t,e,s);return i(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(s,"__esModule",{value:!0}),s.Mocks=s.Controller=void 0;const c=o(e("./AuthenticationController.cjs"));s.Controller=c.default;const l=c.default;s.default=l,r(e("./AuthenticationController.cjs"),s),s.Mocks=a(e("./mocks/index.cjs"))}}},{package:"@metamask/profile-sync-controller",file:"node_modules/@metamask/profile-sync-controller/dist/controllers/authentication/index.cjs"}],[1858,{"./mockResponses.cjs":1859},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n=this&&this.__createBinding||(Object.create?function(e,t,s,n){n===undefined&&(n=s);var i=Object.getOwnPropertyDescriptor(t,s);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,n,i)}:function(e,t,s,n){n===undefined&&(n=s),e[n]=t[s]}),i=this&&this.__exportStar||function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||n(t,e,s)};Object.defineProperty(s,"__esModule",{value:!0}),i(e("./mockResponses.cjs"),s)}}},{package:"@metamask/profile-sync-controller",file:"node_modules/@metamask/profile-sync-controller/dist/controllers/authentication/mocks/index.cjs"}],[1859,{"../../../sdk/mocks/auth.cjs":1883},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.getMockAuthAccessTokenResponse=s.MOCK_OATH_TOKEN_RESPONSE=s.getMockAuthLoginResponse=s.MOCK_LOGIN_RESPONSE=s.getMockAuthNonceResponse=s.MOCK_JWT=s.MOCK_NONCE=s.MOCK_NONCE_RESPONSE=void 0;const n=e("../../../sdk/mocks/auth.cjs");s.MOCK_NONCE_RESPONSE=n.MOCK_NONCE_RESPONSE,s.MOCK_NONCE=s.MOCK_NONCE_RESPONSE.nonce,s.MOCK_JWT=n.MOCK_JWT;s.getMockAuthNonceResponse=()=>({url:n.MOCK_NONCE_URL,requestMethod:"GET",response:(e,t,n)=>{const i=t?.split("?identifier=")[1],r=n?.(i??"");return{...s.MOCK_NONCE_RESPONSE,nonce:r??s.MOCK_NONCE_RESPONSE.nonce,identifier:s.MOCK_NONCE_RESPONSE.identifier}}}),s.MOCK_LOGIN_RESPONSE=n.MOCK_SRP_LOGIN_RESPONSE;s.getMockAuthLoginResponse=()=>({url:n.MOCK_SRP_LOGIN_URL,requestMethod:"POST",response:e=>{const t=e?.raw_message.split(":"),n=t?.[t.length-2];return{...s.MOCK_LOGIN_RESPONSE,token:n??s.MOCK_LOGIN_RESPONSE.token,profile:{...s.MOCK_LOGIN_RESPONSE.profile,profile_id:n??s.MOCK_LOGIN_RESPONSE.profile.profile_id,identifier_id:n??s.MOCK_LOGIN_RESPONSE.profile.identifier_id}}}}),s.MOCK_OATH_TOKEN_RESPONSE=n.MOCK_OIDC_TOKEN_RESPONSE;s.getMockAuthAccessTokenResponse=()=>({url:n.MOCK_OIDC_TOKEN_URL,requestMethod:"POST",response:e=>{const t=new URLSearchParams(e).get("assertion");return{...s.MOCK_OATH_TOKEN_RESPONSE,access_token:t??s.MOCK_OATH_TOKEN_RESPONSE.access_token}}})}}},{package:"@metamask/profile-sync-controller",file:"node_modules/@metamask/profile-sync-controller/dist/controllers/authentication/mocks/mockResponses.cjs"}],[186,{"../../../../shared/constants/time":5004,"./analytics":185},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.segment=s.createSegmentMock=void 0;var n,i=e("../../../../shared/constants/time");(n=e("./analytics"))&&n.__esModule;i.SECOND;const r=(e=1)=>{const t={queue:[],flush(){t.queue.forEach(([e,t])=>{t()}),t.queue=[]},track(s,n=()=>undefined){t.queue.push([s,n]),t.queue.length>=e&&t.flush()},page(){},identify(){}};return t};s.createSegmentMock=r;s.segment=r(1)}}},{package:"$root$",file:"app/scripts/lib/segment/index.js"}],[188,{"../../../../shared/lib/trace":5067},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.addPersonalMessage=async function({signatureParams:e,signatureController:t}){return i(e,t,"newUnsignedPersonalMessage")},s.addTypedMessage=async function({signatureParams:e,signatureController:t}){return i(e,t,"newUnsignedTypedMessage")};var n=e("../../../../shared/lib/trace");async function i(e,t,s){const[,i]=e,{id:r}=i,a=null==r?void 0:r.toString();(0,n.endTrace)({name:n.TraceName.Middleware,id:a});const o=await t[s](...e);return(0,n.endTrace)({name:n.TraceName.Signature,id:a}),o}}}},{package:"$root$",file:"app/scripts/lib/signature/util.ts"}],[1883,{"../../shared/env.cjs":1893,"../authentication-jwt-bearer/services.cjs":1878},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.MOCK_USER_PROFILE_METAMETRICS_RESPONSE=s.MOCK_OIDC_TOKEN_RESPONSE=s.MOCK_SRP_LOGIN_RESPONSE=s.MOCK_SIWE_LOGIN_RESPONSE=s.MOCK_NONCE_RESPONSE=s.MOCK_ACCESS_JWT=s.MOCK_JWT=s.MOCK_PROFILE_METAMETRICS_URL=s.MOCK_PAIR_IDENTIFIERS_URL=s.MOCK_SIWE_LOGIN_URL=s.MOCK_OIDC_TOKEN_URL=s.MOCK_SRP_LOGIN_URL=s.MOCK_NONCE_URL=void 0;const n=e("../../shared/env.cjs"),i=e("../authentication-jwt-bearer/services.cjs");s.MOCK_NONCE_URL=(0,i.NONCE_URL)(n.Env.PRD),s.MOCK_SRP_LOGIN_URL=(0,i.SRP_LOGIN_URL)(n.Env.PRD),s.MOCK_OIDC_TOKEN_URL=(0,i.OIDC_TOKEN_URL)(n.Env.PRD),s.MOCK_SIWE_LOGIN_URL=(0,i.SIWE_LOGIN_URL)(n.Env.PRD),s.MOCK_PAIR_IDENTIFIERS_URL=(0,i.PAIR_IDENTIFIERS)(n.Env.PRD),s.MOCK_PROFILE_METAMETRICS_URL=(0,i.PROFILE_METAMETRICS_URL)(n.Env.PRD),s.MOCK_JWT="eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6ImIwNzE2N2U2LWJjNWUtNDgyZC1hNjRhLWU1MjQ0MjY2MGU3NyJ9.eyJzdWIiOiI1MzE0ODc5YWM2NDU1OGI3OTQ5ZmI4NWIzMjg2ZjZjNjUwODAzYmFiMTY0Y2QyOWNmMmM3YzdmMjMzMWMwZTRlIiwiaWF0IjoxNzA2MTEzMDYyLCJleHAiOjE3NjkxODUwNjMsImlzcyI6ImF1dGgubWV0YW1hc2suaW8iLCJhdWQiOiJwb3J0Zm9saW8ubWV0YW1hc2suaW8ifQ.E5UL6oABNweS8t5a6IBTqTf7NLOJbrhJSmEcsr7kwLp4bGvcENJzACwnsHDkA6PlzfDV09ZhAGU_F3hlS0j-erbY0k0AFR-GAtyS7E9N02D8RgUDz5oDR65CKmzM8JilgFA8UvruJ6OJGogroaOSOqzRES_s8MjHpP47RJ9lXrUesajsbOudXbuksXWg5QmWip6LLvjwr8UUzcJzNQilyIhiEpo4WdzWM4R3VtTwr4rHnWEvtYnYCov1jmI2w3YQ48y0M-3Y9IOO0ov_vlITRrOnR7Y7fRUGLUFmU5msD8mNWRywjQFLHfJJ1yNP5aJ8TkuCK3sC6kcUH335IVvukQ",s.MOCK_ACCESS_JWT="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c",s.MOCK_NONCE_RESPONSE={nonce:"xGMm9SoihEKeAEfV",identifier:"0xd8641601Cb79a94FD872fE42d5b4a067A44a7e88",expires_in:300},s.MOCK_SIWE_LOGIN_RESPONSE={token:s.MOCK_JWT,expires_in:3600,profile:{profile_id:"fa2bbf82-bd9a-4e6b-aabc-9ca0d0319b6e",metametrics_id:"de742679-4960-4977-a415-4718b5f8e86c",identifier_id:"ec9a4e9906836497efad2fd4d4290b34d2c6a2c0d93eb174aa3cd88a133adbaf",identifier_type:"SIWE",encrypted_storage_key:"2c6a2c0d93eb174aa3cd88a133adbaf"}},s.MOCK_SRP_LOGIN_RESPONSE={token:s.MOCK_JWT,expires_in:3600,profile:{profile_id:"f88227bd-b615-41a3-b0be-467dd781a4ad",metametrics_id:"561ec651-a844-4b36-a451-04d6eac35740",identifier_id:"da9a9fc7b09edde9cc23cec9b7e11a71fb0ab4d2ddd8af8af905306f3e1456fb",identifier_type:"SRP",encrypted_storage_key:"d2ddd8af8af905306f3e1456fb"}},s.MOCK_OIDC_TOKEN_RESPONSE={access_token:s.MOCK_ACCESS_JWT,expires_in:3600},s.MOCK_USER_PROFILE_METAMETRICS_RESPONSE={profile_id:"f88227bd-b615-41a3-b0be-467dd781a4ad",created_at:"2025-10-01T12:00:00Z",lineage:[{metametrics_id:"561ec651-a844-4b36-a451-04d6eac35740",agent:n.Platform.MOBILE,created_at:"2025-10-01T12:00:00Z",updated_at:"2025-10-01T12:00:00Z",counter:1},{metametrics_id:"de742679-4960-4977-a415-4718b5f8e86c",agent:n.Platform.EXTENSION,created_at:"2025-10-01T12:00:00Z",updated_at:"2025-10-01T12:00:00Z",counter:2}]}}}},{package:"@metamask/profile-sync-controller",file:"node_modules/@metamask/profile-sync-controller/dist/sdk/mocks/auth.cjs"}],[189,{"../../../../shared/constants/app":4973,"../../../../shared/constants/smartTransactions":4998,"../../../../shared/modules/conversion.utils":5079,"../../../../shared/modules/selectors":5095,"../../../../shared/modules/transaction.utils":5101,"../transaction/hooks/delegation-7702-publish":215,"../transaction/util":219,"@metamask/smart-transactions-controller/dist/types":1992,"@metamask/transaction-controller":2314,loglevel:4094},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.publishBatchSmartTransactionHook=function({transactionController:e,smartTransactionsController:t,hookControllerMessenger:s,flatState:n,transactions:i}){const r=i[i.length-1],a=(0,m.getTransactionById)(r.id??"",e);if(!a)throw new Error(`publishBatchSmartTransactionHook: Could not find transaction with id ${r.id}`);const{isSmartTransaction:o,featureFlags:c,isHardwareWalletAccount:l}=Y(n,a.chainId);if(!o)throw new Error("publishBatchSmartTransactionHook: Smart Transaction is required for batch submissions");return J({transactions:i,transactionController:e,smartTransactionsController:t,controllerMessenger:s,isSmartTransaction:o,isHardwareWallet:l,featureFlags:c,transactionMeta:a})},s.publishSmartTransactionHook=async function({flatState:e,initMessenger:t,signedTx:s,smartTransactionsController:n,transactionController:i,transactionMeta:r}){const{isSmartTransaction:a,featureFlags:o,isHardwareWalletAccount:c}=Y(e,r.chainId);if(a){const e=await z({transactionMeta:r,signedTransactionInHex:s,transactionController:i,smartTransactionsController:n,controllerMessenger:t,isSmartTransaction:a,isHardwareWallet:c,featureFlags:o});if(null!=e&&e.transactionHash)return e}const l=new d.Delegation7702PublishHook({isAtomicBatchSupported:i.isAtomicBatchSupported.bind(i),messenger:t}).getHook();return await l(r,s)},s.submitSmartTransactionHook=s.submitBatchSmartTransactionHook=void 0;var n,i=e("@metamask/smart-transactions-controller/dist/types"),r=e("@metamask/transaction-controller"),a=(n=e("loglevel"))&&n.__esModule?n:{default:n},o=e("../../../../shared/modules/conversion.utils"),c=e("../../../../shared/constants/smartTransactions"),l=e("../../../../shared/modules/transaction.utils"),u=e("../../../../shared/constants/app"),h=e("../../../../shared/modules/selectors"),d=e("../transaction/hooks/delegation-7702-publish"),m=e("../transaction/util");function p(e,t,s){f(e,t),t.set(e,s)}function f(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function g(e,t){return e.get(w(e,t))}function y(e,t,s){return e.set(w(e,t),s),s}function w(e,t,s){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:s;throw new TypeError("Private element is not present on this object")}var S=new WeakMap,v=new WeakMap,b=new WeakMap,k=new WeakMap,_=new WeakMap,T=new WeakMap,E=new WeakMap,P=new WeakMap,C=new WeakMap,O=new WeakMap,A=new WeakMap,I=new WeakMap,M=new WeakMap,j=new WeakMap,N=new WeakSet;class R{constructor(e){!function(e,t){f(e,t),t.add(e)}(this,N),p(this,S,void 0),p(this,v,void 0),p(this,b,void 0),p(this,k,void 0),p(this,_,void 0),p(this,T,void 0),p(this,E,void 0),p(this,P,void 0),p(this,C,void 0),p(this,O,void 0),p(this,A,void 0),p(this,I,void 0),p(this,M,void 0),p(this,j,void 0);const{transactionMeta:t,signedTransactionInHex:s,smartTransactionsController:n,transactionController:i,isSmartTransaction:a,controllerMessenger:o,featureFlags:c,transactions:l}=e;y(v,this,""),y(S,this,!1),y(O,this,t),y(A,this,s),y(P,this,n),y(C,this,i),y(E,this,a),y(k,this,o),y(_,this,c),y(T,this,t.origin!==u.ORIGIN_METAMASK),y(b,this,t.chainId),y(M,this,t.txParams),y(I,this,l),y(j,this,Boolean(t.type!==r.TransactionType.bridge||g(I,this)&&g(I,this).length>0))}async submit(){const e=!!g(O,this).type&&[r.TransactionType.swapAndSend,r.TransactionType.swapApproval,r.TransactionType.bridgeApproval].includes(g(O,this).type),t={transactionHash:undefined};if(!g(E,this)||e||(0,l.isLegacyTransaction)(g(O,this)))return t;let s;g(j,this)&&await w(N,this,L).call(this);try{s=await g(P,this).getFees({...g(M,this),chainId:g(b,this)},undefined,{networkClientId:g(O,this).networkClientId})}catch(e){return a.default.error("Error in smart transaction publish hook, falling back to regular transaction submission",e),w(N,this,U).call(this),t}try{var n;const e=await w(N,this,q).call(this,{getFeesResponse:s}),t=null==e?void 0:e.uuid;if(!t)throw new Error("No smart transaction UUID");await w(N,this,F).call(this,t);let i;if(i=(null===(n=g(_,this))||void 0===n||null===(n=n.smartTransactions)||void 0===n?void 0:n.extensionReturnTxHashAsap)&&null!=e&&e.txHash?e.txHash:await w(N,this,W).call(this,{uuid:t}),null===i)throw new Error("Transaction does not have a transaction hash, there was a problem");return{transactionHash:i}}catch(e){throw a.default.error("Error in smart transaction publish hook",e),w(N,this,U).call(this),e}}async submitBatch(){if(!g(E,this))throw new Error("submitBatch: Smart Transaction is required for batch submissions");g(j,this)&&await w(N,this,L).call(this);try{const e=await w(N,this,q).call(this),t=null==e?void 0:e.uuid;if(!t)throw new Error("submitBatch: No smart transaction UUID");await w(N,this,F).call(this,t);if(null===await w(N,this,W).call(this,{uuid:t}))throw new Error("submitBatch: Transaction does not have a transaction hash, there was a problem");let s;return s=null!=e&&e.txHashes?{results:e.txHashes.map(e=>({transactionHash:e}))}:{results:[]},s}catch(e){throw a.default.error("submitBatch: Error in smart transaction publish batch hook",e),w(N,this,U).call(this),e}}}async function x(e){try{await g(k,this).call("ApprovalController:endFlow",{id:e})}catch(e){}}async function D(e){try{await w(N,this,x).call(this,e),await g(k,this).call("ApprovalController:acceptRequest",e),G._=""}catch(e){a.default.error("Error ending existing approval flow",e)}}async function L(){G._&&await w(N,this,D).call(this,G._);const{id:e}=await g(k,this).call("ApprovalController:startFlow");y(v,this,e),G._=e}async function F(e){g(j,this)&&(w(N,this,H).call(this,{uuid:e}),w(N,this,B).call(this,{uuid:e}))}function U(){g(j,this)&&!g(S,this)&&(y(S,this,!0),w(N,this,x).call(this,g(v,this)),G._===g(v,this)&&(G._=""))}function H({uuid:e}){const t=()=>{w(N,this,U).call(this)};g(k,this).call("ApprovalController:addRequest",{id:g(v,this),origin:origin,type:u.SMART_TRANSACTION_CONFIRMATION_TYPES.showSmartTransactionStatusPage,requestState:{smartTransaction:{status:i.SmartTransactionStatuses.PENDING,creationTime:Date.now(),uuid:e},isDapp:g(T,this),txId:g(O,this).id}},!0).then(t,t)}async function $({smartTransaction:e}){return await g(k,this).call("ApprovalController:updateRequestState",{id:g(v,this),requestState:{smartTransaction:e,isDapp:g(T,this),txId:g(O,this).id}})}async function B({uuid:e}){g(k,this).subscribe("SmartTransactionsController:smartTransaction",async t=>{if(t.uuid===e){const{status:e}=t;if(!e||e===i.SmartTransactionStatuses.PENDING)return;g(S,this)||await w(N,this,$).call(this,{smartTransaction:t})}})}function W({uuid:e}){return new Promise(t=>{g(k,this).subscribe("SmartTransactionsController:smartTransaction",async s=>{if(s.uuid===e){const{status:e,statusMetadata:n}=s;if(!e||e===i.SmartTransactionStatuses.PENDING)return;a.default.debug("Smart Transaction: ",s),null!=n&&n.minedHash?(a.default.debug("Smart Transaction - Received tx hash: ",null==n?void 0:n.minedHash),t(n.minedHash)):t(null)}})})}async function q({getFeesResponse:e}={}){let t=[];if(g(I,this)&&Array.isArray(g(I,this))&&g(I,this).length>0)t=g(I,this).filter(e=>null==e?void 0:e.signedTx).map(e=>e.signedTx);else if(g(A,this))t=[g(A,this)];else if(e){var s;t=await w(N,this,V).call(this,(null===(s=e.tradeTxFees)||void 0===s?void 0:s.fees)??[],!1)}return await g(P,this).submitSignedTransactions({signedTransactions:t,signedCanceledTransactions:[],txParams:g(M,this),transactionMeta:g(O,this),networkClientId:g(O,this).networkClientId})}function K(e,t){if(!g(M,this))throw new Error("Transaction params are required");const s={...g(M,this),maxFeePerGas:`0x${(0,o.decimalToHex)(e.maxFeePerGas)}`,maxPriorityFeePerGas:`0x${(0,o.decimalToHex)(e.maxPriorityFeePerGas)}`,gas:t?`0x${(0,o.decimalToHex)(c.CANCEL_GAS_LIMIT_DEC)}`:g(M,this).gas};return t&&(s.to=s.from,s.data="0x"),s}async function V(e,t){if(!g(M,this)||!g(b,this))throw new Error("Transaction params and chainId are required");const s=e.map(e=>w(N,this,K).call(this,e,t)).map(e=>({...e,chainId:e.chainId||g(b,this)}));return await g(C,this).approveTransactionsWithSameNonce(s,{hasNonce:!0})}var G={_:""};const z=e=>new R(e).submit();s.submitSmartTransactionHook=z;const J=e=>new R(e).submitBatch();function Y(e,t){const s=function(e){return{metamask:e}}(e);return{isSmartTransaction:(0,h.getIsSmartTransaction)(s,t),featureFlags:(0,h.getFeatureFlagsByChainId)(s,t),isHardwareWalletAccount:(0,h.isHardwareWallet)(s)}}s.submitBatchSmartTransactionHook=J}}},{package:"$root$",file:"app/scripts/lib/smart-transaction/smart-transactions.ts"}],[19,{"../../../../shared/lib/delegation":5047,"@metamask/delegation-controller":1323,"@metamask/transaction-controller":2314},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.DelegationControllerInit=void 0,s.awaitDeleteDelegationEntry=o;var n=e("@metamask/delegation-controller"),i=e("@metamask/transaction-controller"),r=e("../../../../shared/lib/delegation");const a=e=>(0,r.getDeleGatorEnvironment)(Number(e));async function o(e,t,{hash:s,txMeta:n,entryToStore:r}){let{id:a}=n,o="continue";const c=({transactionMeta:n})=>{if(n.id===a)if(n.status===i.TransactionStatus.dropped&&n.replacedById)a=n.replacedById;else{switch(n.type){case i.TransactionType.contractInteraction:case i.TransactionType.retry:switch(n.status){case i.TransactionStatus.confirmed:o="delete";break;case i.TransactionStatus.dropped:case i.TransactionStatus.failed:case i.TransactionStatus.rejected:o="unsubscribe";break;default:return}break;case i.TransactionType.cancel:o="unsubscribe";break;default:return void console.warn("awaitDeleteDelegationEntry: Unexpected tx type",n.type)}"delete"===o&&(e.delete(s),r&&e.store({entry:r})),"unsubscribe"!==o&&"delete"!==o||t.unsubscribe("TransactionController:transactionStatusUpdated",c)}};t.subscribe("TransactionController:transactionStatusUpdated",c)}s.DelegationControllerInit=({controllerMessenger:e,persistedState:t,initMessenger:s})=>{const i=new n.DelegationController({messenger:e,state:t.DelegationController,hashDelegation:r.getDelegationHashOffchain,getDelegationEnvironment:a});return e.registerActionHandler("DelegationController:signDelegation",i.signDelegation.bind(i)),{controller:i,api:{signDelegation:i.signDelegation.bind(i),storeDelegationEntry:i.store.bind(i),listDelegationEntries:i.list.bind(i),getDelegationEntry:i.retrieve.bind(i),getDelegationEntryChain:i.chain.bind(i),deleteDelegationEntry:i.delete.bind(i),awaitDeleteDelegationEntry:o.bind(null,i,s)}}}}}},{package:"$root$",file:"app/scripts/controller-init/delegation/delegation-controller-init.ts"}],[190,{"./snap-keyring":193,"./utils":194},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"getAccountsBySnapId",{enumerable:!0,get:function(){return i.getAccountsBySnapId}}),Object.defineProperty(s,"snapKeyringBuilder",{enumerable:!0,get:function(){return n.snapKeyringBuilder}});var n=e("./snap-keyring"),i=e("./utils")}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/index.ts"}],[191,{"@metamask/keyring-api":1560,"@metamask/permission-controller":1816},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.isProtocolAllowed=u,s.keyringSnapPermissionsBuilder=function(e,t){return()=>{if("metamask"===t)return a;if(r.includes(t))return c;const s=e.getSubjectMetadata(t);return(null==s?void 0:s.subjectType)===i.SubjectType.Website&&u(t)?o:[]}};var n=e("@metamask/keyring-api"),i=e("@metamask/permission-controller");const r=["https://portfolio.metamask.io"],a=[n.KeyringRpcMethod.ListAccounts,n.KeyringRpcMethod.GetAccount,n.KeyringRpcMethod.FilterAccountChains,n.KeyringRpcMethod.DeleteAccount,n.KeyringRpcMethod.ListRequests,n.KeyringRpcMethod.GetRequest,n.KeyringRpcMethod.SubmitRequest,n.KeyringRpcMethod.RejectRequest],o=[n.KeyringRpcMethod.ListAccounts,n.KeyringRpcMethod.GetAccount,n.KeyringRpcMethod.CreateAccount,n.KeyringRpcMethod.FilterAccountChains,n.KeyringRpcMethod.UpdateAccount,n.KeyringRpcMethod.DeleteAccount,n.KeyringRpcMethod.ExportAccount,n.KeyringRpcMethod.ListRequests,n.KeyringRpcMethod.GetRequest,n.KeyringRpcMethod.ApproveRequest,n.KeyringRpcMethod.RejectRequest],c=[n.KeyringRpcMethod.ListAccounts,n.KeyringRpcMethod.GetAccount,n.KeyringRpcMethod.GetAccountBalances,n.KeyringRpcMethod.SubmitRequest],l=["https:"];function u(e){try{const t=new URL(e);return l.includes(t.protocol)}catch(e){return!1}}}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/keyring-snaps-permissions.ts"}],[192,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.getSnapAndHardwareInfoForMetrics=async function(e,t,s,n){var i,r,a;if(!n)return{};const o=n.call("AccountsController:getSelectedAccount"),c=o.address;let l;var u;null!==(i=o.metadata.snap)&&void 0!==i&&i.id&&(l=n.call("SnapController:get",null===(u=o.metadata.snap)||void 0===u?void 0:u.id));return{account_type:await e(c),device_model:await t(c),account_hardware_type:await s(c),account_snap_type:null===(r=l)||void 0===r?void 0:r.id,account_snap_version:null===(a=l)||void 0===a?void 0:a.version}}}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/metrics.ts"}],[193,{"../../../../shared/constants/app":4973,"../../../../shared/constants/metametrics":4986,"../../../../shared/lib/accounts":5011,"../../../../shared/lib/accounts/snaps":5013,"../../../../shared/lib/snaps/snaps":5062,"../../../../shared/lib/translate":5072,"../../../../ui/components/component-library/icon":5644,"./utils/isBlockedUrl":195,"./utils/showResult":196,"@metamask/eth-snap-keyring":1436,"@metamask/snaps-utils":2242,"webextension-polyfill":4949},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.showAccountCreationDialog=b,s.showAccountNameSuggestionDialog=k,s.snapKeyringBuilder=function(e,t){const s=()=>new i.SnapKeyring({messenger:e,callbacks:new O(e,t)});return s.type=i.SnapKeyring.type,s};var n,i=e("@metamask/eth-snap-keyring"),r=(n=e("webextension-polyfill"))&&n.__esModule?n:{default:n},a=e("@metamask/snaps-utils"),o=e("../../../../shared/constants/metametrics"),c=e("../../../../shared/constants/app"),l=e("../../../../shared/lib/translate"),u=e("../../../../ui/components/component-library/icon"),h=e("../../../../shared/lib/accounts"),d=e("../../../../shared/lib/snaps/snaps"),m=e("../../../../shared/lib/accounts/snaps"),p=e("./utils/isBlockedUrl"),f=e("./utils/showResult");function g(e,t,s){y(e,t),t.set(e,s)}function y(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function w(e,t){return e.get(v(e,t))}function S(e,t,s){return e.set(v(e,t),s),s}function v(e,t,s){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:s;throw new TypeError("Private element is not present on this object")}async function b(e,t){try{return Boolean(await t.call("ApprovalController:addRequest",{origin:e,type:c.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.confirmAccountCreation},!0))}catch(e){throw new Error(`Error occurred while showing account creation dialog.\n${e}`)}}async function k(e,t,s){try{return await t.call("ApprovalController:addRequest",{origin:e,type:c.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.showNameSnapAccount,requestData:{snapSuggestedAccountName:s}},!0)}catch(e){throw new Error(`Error occurred while showing name account dialog.\n${e}`)}}var _=new WeakMap,T=new WeakMap,E=new WeakMap,P=new WeakMap,C=new WeakSet;class O{constructor(e,{trackEvent:t,persistKeyringHelper:s,removeAccountHelper:n}){!function(e,t){y(e,t),t.add(e)}(this,C),g(this,_,void 0),g(this,T,void 0),g(this,E,void 0),g(this,P,void 0),S(_,this,e),S(T,this,t),S(E,this,s),S(P,this,n)}async addressExists(e){return(await w(_,this).call("KeyringController:getAccounts")).includes(e.toLowerCase())}async redirectUser(e,t,s){if(t.length>0||s.length>0){const n=await(0,p.isBlockedUrl)(t,async()=>await w(_,this).call("PhishingController:maybeUpdateState"),e=>w(_,this).call("PhishingController:testOrigin",e)),i=await w(_,this).call("ApprovalController:addRequest",{origin:e,requestData:{url:t,message:s,isBlockedUrl:n},type:c.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.showSnapAccountRedirect},!0);Boolean(i)&&t.length>0?r.default.tabs.create({url:t}):console.log("User refused snap account redirection to:",t)}else console.log("Error occurred when redirecting snap account. url or message must be defined")}async saveState(){await w(E,this).call(this)}async addAccount(e,t,s,n,r="",{displayConfirmation:o,displayAccountNameSuggestion:c,setSelectedAccount:l}=(0,i.getDefaultInternalOptions)()){(0,a.assertIsValidSnapId)(t);const u=(0,d.isSnapPreinstalled)(t)&&!o,h=(0,d.isSnapPreinstalled)(t)&&!c,m=(0,d.isSnapPreinstalled)(t)&&!l,{accountName:p}=await v(C,this,j).call(this,{snapId:t,skipConfirmationDialog:u,skipAccountNameSuggestionDialog:h,accountNameSuggestion:r,handleUserInput:s});v(C,this,N).call(this,{address:e,snapId:t,skipConfirmationDialog:u,skipSetSelectedAccountStep:m,accountName:p,onceSaved:n,defaultAccountNameChosen:Boolean(r)&&p===r})}async removeAccount(e,t,s){(0,a.assertIsValidSnapId)(t);const n=(0,m.getSnapName)(t,w(_,this)),{id:i}=w(_,this).call("ApprovalController:startFlow"),r="https://support.metamask.io/managing-my-wallet/accounts-and-addresses/how-to-remove-an-account-from-your-metamask-wallet/",h=e=>{w(T,this).call(this,{event:e,category:o.MetaMetricsEventCategory.Accounts,properties:{account_type:o.MetaMetricsEventAccountType.Snap,snap_id:t,snap_name:n}})};let d=!1;try{if(d=Boolean(await w(_,this).call("ApprovalController:addRequest",{origin:t,type:c.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.confirmAccountRemoval,requestData:{publicAddress:e}},!0)),!d)throw await s(d),new Error("User denied account removal");try{await w(P,this).call(this,e),await s(d),await w(E,this).call(this),h(o.MetaMetricsEventName.RemoveSnapAccountSuccessViewed),await(0,f.showError)(w(_,this),t,{icon:u.IconName.UserCircleRemove,title:(0,l.t)("snapAccountRemoved")},{message:(0,l.t)("snapAccountRemovedDescription"),learnMoreLink:r}),h(o.MetaMetricsEventName.RemoveSnapAccountSuccessClicked)}catch(e){const s=e.message;throw await(0,f.showError)(w(_,this),t,{icon:u.IconName.UserCircleRemove,title:(0,l.t)("snapAccountRemovalFailed")},{message:(0,l.t)("snapAccountRemovalFailedDescription",n),learnMoreLink:r,error:s}),h(o.MetaMetricsEventName.AccountRemoveFailed),new Error(`Error occurred while removing snap account: ${s}`)}}finally{d&&h(o.MetaMetricsEventName.AccountRemoved),w(_,this).call("ApprovalController:endFlow",{id:i})}}}async function A(e){const{id:t}=w(_,this).call("ApprovalController:startFlow");try{return await e(t)}finally{w(_,this).call("ApprovalController:endFlow",{id:t})}}async function I(e,t){const{success:s,name:n}=await k(e,w(_,this),t);return{success:s,accountName:n}}async function M(e){const t=await w(_,this).call("AccountsController:listMultichainAccounts");return{success:!0,accountName:(0,h.getUniqueAccountName)(t,e)}}async function j({snapId:e,skipConfirmationDialog:t,skipAccountNameSuggestionDialog:s,handleUserInput:n,accountNameSuggestion:i}){return await v(C,this,A).call(this,async r=>{{const s=t||await b(e,w(_,this));if(!s)throw await n(s),new Error("User denied account creation")}{const{success:t,accountName:r}=s?await v(C,this,M).call(this,i):await v(C,this,I).call(this,e,i);if(await n(t),!t)throw new Error("User denied account creation");return{accountName:r}}})}async function N({address:e,snapId:t,skipConfirmationDialog:s,skipSetSelectedAccountStep:n,accountName:i,onceSaved:r,defaultAccountNameChosen:a}){const c="https://support.metamask.io/managing-my-wallet/accounts-and-addresses/how-to-add-accounts-in-your-wallet/",h=(0,m.getSnapName)(t,w(_,this)),d=e=>{w(T,this).call(this,{event:e,category:o.MetaMetricsEventCategory.Accounts,properties:{account_type:o.MetaMetricsEventAccountType.Snap,snap_id:t,snap_name:h,...e===o.MetaMetricsEventName.AccountAdded&&{is_suggested_name:a}}})};await v(C,this,A).call(this,async a=>{try{const a=await r;n||w(_,this).call("AccountsController:setSelectedAccount",a),i&&w(_,this).call("AccountsController:setAccountName",a,i),s||(d(o.MetaMetricsEventName.AddSnapAccountSuccessViewed),await(0,f.showSuccess)(w(_,this),t,{icon:u.IconName.UserCircleAdd,title:(0,l.t)("snapAccountCreated")},{message:(0,l.t)("snapAccountCreatedDescription"),address:e,learnMoreLink:c}),d(o.MetaMetricsEventName.AddSnapAccountSuccessClicked)),d(o.MetaMetricsEventName.AccountAdded)}catch(e){const s=e.message;await(0,f.showError)(w(_,this),t,{icon:u.IconName.UserCircleAdd,title:(0,l.t)("snapAccountCreationFailed")},{message:(0,l.t)("snapAccountCreationFailedDescription",h),learnMoreLink:c,error:s}),console.error("Error occurred while creating snap account:",s)}})}}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/snap-keyring.ts"}],[194,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.getAccountsBySnapId=void 0;s.getAccountsBySnapId=async(e,t)=>{const s=await e();return await s.getAccountsBySnapId(t)}}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/utils.ts"}],[1944,{"@metamask/base-controller":1241,"@metamask/rpc-errors":1955,"@metamask/utils":2359},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.RateLimitController=void 0;const n=e("@metamask/base-controller"),i=e("@metamask/rpc-errors"),r=e("@metamask/utils"),a="RateLimitController",o={requests:{persist:!1,anonymous:!1}};class c extends n.BaseController{constructor({rateLimitTimeout:e=5e3,rateLimitCount:t=1,messenger:s,state:n,implementations:i}){const c={requests:(0,r.getKnownPropertyNames)(i).reduce((e,t)=>({...e,[t]:{}}),{})};super({name:a,metadata:o,messenger:s,state:{...c,...n}}),this.implementations=i,this.rateLimitTimeout=e,this.rateLimitCount=t,this.messagingSystem.registerActionHandler(`${a}:call`,(e,t,...s)=>this.call(e,t,...s))}async call(e,t,...s){if(this.isRateLimited(t,e))throw i.rpcErrors.limitExceeded({message:`"${t.toString()}" is currently rate-limited. Please try again later.`});this.recordRequest(t,e);const n=this.implementations[t].method;if(!n)throw new Error("Invalid api type");return n(...s)}isRateLimited(e,t){const s=this.implementations[e].rateLimitCount??this.rateLimitCount;return this.state.requests[e][t]>=s}recordRequest(e,t){const s=this.implementations[e].rateLimitTimeout??this.rateLimitTimeout,n=this.state.requests[e][t]??0;this.update(i=>{0===n&&setTimeout(()=>this.resetRequestCount(e,t),s),Object.assign(i,{requests:{...i.requests,[e]:{[t]:n+1}}})})}resetRequestCount(e,t){this.update(s=>{Object.assign(s,{requests:{...s.requests,[e]:{[t]:0}}})})}}s.RateLimitController=c}}},{package:"@metamask/rate-limit-controller",file:"node_modules/@metamask/rate-limit-controller/dist/RateLimitController.cjs"}],[1945,{"./RateLimitController.cjs":1944},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.RateLimitController=void 0;var n=e("./RateLimitController.cjs");Object.defineProperty(s,"RateLimitController",{enumerable:!0,get:function(){return n.RateLimitController}})}}},{package:"@metamask/rate-limit-controller",file:"node_modules/@metamask/rate-limit-controller/dist/index.cjs"}],[1946,{"../constants.cjs":1947,"@metamask/controller-utils":1316},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n,i,r,a,o,c=this&&this.__classPrivateFieldSet||function(e,t,s,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,s):i?i.value=s:t.set(e,s),s},l=this&&this.__classPrivateFieldGet||function(e,t,s,n){if("a"===s&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)};Object.defineProperty(s,"__esModule",{value:!0}),s.ClientConfigApiService=void 0;const u=e("@metamask/controller-utils"),h=e("../constants.cjs");s.ClientConfigApiService=class{constructor({fetch:e,retries:t=u.DEFAULT_MAX_RETRIES,maximumConsecutiveFailures:s=u.DEFAULT_MAX_CONSECUTIVE_FAILURES,circuitBreakDuration:h=u.DEFAULT_CIRCUIT_BREAK_DURATION,onBreak:d,onDegraded:m,config:p}){n.set(this,void 0),i.set(this,void 0),r.set(this,void 0),a.set(this,void 0),o.set(this,void 0),c(this,n,e,"f"),c(this,r,p.client,"f"),c(this,a,p.distribution,"f"),c(this,o,p.environment,"f"),c(this,i,(0,u.createServicePolicy)({maxRetries:t,maxConsecutiveFailures:s,circuitBreakDuration:h}),"f"),d&&l(this,i,"f").onBreak(d),m&&l(this,i,"f").onDegraded(m)}onBreak(...e){return l(this,i,"f").onBreak(...e)}onDegraded(...e){return l(this,i,"f").onDegraded(...e)}async fetchRemoteFeatureFlags(){const e=`${h.BASE_URL}/flags?client=${l(this,r,"f")}&distribution=${l(this,a,"f")}&environment=${l(this,o,"f")}`,t=await l(this,i,"f").execute(()=>l(this,n,"f").call(this,e,{cache:"no-cache"}));if(!t.ok)throw new Error("Failed to fetch remote feature flags");const s=await t.json();if(!Array.isArray(s))throw new Error("Feature flags api did not return an array");return{remoteFeatureFlags:this.flattenFeatureFlags(s),cacheTimestamp:Date.now()}}flattenFeatureFlags(e){return e.reduce((e,t)=>({...e,...t}),{})}},n=new WeakMap,i=new WeakMap,r=new WeakMap,a=new WeakMap,o=new WeakMap}}},{package:"@metamask/remote-feature-flag-controller",file:"node_modules/@metamask/remote-feature-flag-controller/dist/client-config-api-service/client-config-api-service.cjs"}],[1947,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.BASE_URL=void 0,s.BASE_URL="https://client-config.api.cx.metamask.io/v1"}}},{package:"@metamask/remote-feature-flag-controller",file:"node_modules/@metamask/remote-feature-flag-controller/dist/constants.cjs"}],[1948,{"./client-config-api-service/client-config-api-service.cjs":1946,"./remote-feature-flag-controller-types.cjs":1949,"./remote-feature-flag-controller.cjs":1950,"./utils/user-segmentation-utils.cjs":1951},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.generateDeterministicRandomNumber=s.ClientConfigApiService=s.EnvironmentType=s.DistributionType=s.ClientType=s.RemoteFeatureFlagController=void 0;var n=e("./remote-feature-flag-controller.cjs");Object.defineProperty(s,"RemoteFeatureFlagController",{enumerable:!0,get:function(){return n.RemoteFeatureFlagController}});var i=e("./remote-feature-flag-controller-types.cjs");Object.defineProperty(s,"ClientType",{enumerable:!0,get:function(){return i.ClientType}}),Object.defineProperty(s,"DistributionType",{enumerable:!0,get:function(){return i.DistributionType}}),Object.defineProperty(s,"EnvironmentType",{enumerable:!0,get:function(){return i.EnvironmentType}});var r=e("./client-config-api-service/client-config-api-service.cjs");Object.defineProperty(s,"ClientConfigApiService",{enumerable:!0,get:function(){return r.ClientConfigApiService}});var a=e("./utils/user-segmentation-utils.cjs");Object.defineProperty(s,"generateDeterministicRandomNumber",{enumerable:!0,get:function(){return a.generateDeterministicRandomNumber}})}}},{package:"@metamask/remote-feature-flag-controller",file:"node_modules/@metamask/remote-feature-flag-controller/dist/index.cjs"}],[1949,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n,i,r;Object.defineProperty(s,"__esModule",{value:!0}),s.EnvironmentType=s.DistributionType=s.ClientType=void 0,function(e){e.Extension="extension",e.Mobile="mobile"}(n||(s.ClientType=n={})),function(e){e.Main="main",e.Flask="flask",e.Beta="beta"}(i||(s.DistributionType=i={})),function(e){e.Production="prod",e.ReleaseCandidate="rc",e.Development="dev"}(r||(s.EnvironmentType=r={}))}}},{package:"@metamask/remote-feature-flag-controller",file:"node_modules/@metamask/remote-feature-flag-controller/dist/remote-feature-flag-controller-types.cjs"}],[195,{"../keyring-snaps-permissions":191},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.isBlockedUrl=void 0;var n=e("../keyring-snaps-permissions");s.isBlockedUrl=async(e,t,s)=>{try{return!(0,n.isProtocolAllowed)(e)||(await t(),s(e).result)}catch(e){return console.error("Invalid URL passed into snap-keyring:",e),!1}}}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/utils/isBlockedUrl.ts"}],[1950,{"./utils/user-segmentation-utils.cjs":1951,"@metamask/base-controller":1241},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n,i,r,a,o,c,l,u,h,d=this&&this.__classPrivateFieldSet||function(e,t,s,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,s):i?i.value=s:t.set(e,s),s},m=this&&this.__classPrivateFieldGet||function(e,t,s,n){if("a"===s&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)};Object.defineProperty(s,"__esModule",{value:!0}),s.RemoteFeatureFlagController=s.getDefaultRemoteFeatureFlagControllerState=s.DEFAULT_CACHE_DURATION=s.controllerName=void 0;const p=e("@metamask/base-controller"),f=e("./utils/user-segmentation-utils.cjs");s.controllerName="RemoteFeatureFlagController",s.DEFAULT_CACHE_DURATION=864e5;const g={remoteFeatureFlags:{persist:!0,anonymous:!0},cacheTimestamp:{persist:!0,anonymous:!0}};function y(){return{remoteFeatureFlags:{},cacheTimestamp:0}}s.getDefaultRemoteFeatureFlagControllerState=y;class w extends p.BaseController{constructor({messenger:e,state:t,clientConfigApiService:l,fetchInterval:u=s.DEFAULT_CACHE_DURATION,disabled:h=!1,getMetaMetricsId:m}){super({name:s.controllerName,metadata:g,messenger:e,state:{remoteFeatureFlags:{},cacheTimestamp:0,...t}}),n.add(this),i.set(this,void 0),r.set(this,void 0),a.set(this,void 0),o.set(this,void 0),c.set(this,void 0),d(this,i,u,"f"),d(this,r,h,"f"),d(this,a,l,"f"),d(this,c,m,"f")}async updateRemoteFeatureFlags(){if(m(this,r,"f")||!m(this,n,"m",l).call(this))return;let e;if(m(this,o,"f"))await m(this,o,"f");else{try{d(this,o,m(this,a,"f").fetchRemoteFeatureFlags(),"f"),e=await m(this,o,"f")}finally{d(this,o,undefined,"f")}await m(this,n,"m",u).call(this,e.remoteFeatureFlags)}}enable(){d(this,r,!1,"f")}disable(){d(this,r,!0,"f")}}s.RemoteFeatureFlagController=w,i=new WeakMap,r=new WeakMap,a=new WeakMap,o=new WeakMap,c=new WeakMap,n=new WeakSet,l=function(){return Date.now()-this.state.cacheTimestamp>m(this,i,"f")},u=async function(e){const t=await m(this,n,"m",h).call(this,e);this.update(()=>({remoteFeatureFlags:t,cacheTimestamp:Date.now()}))},h=async function(e){const t={},s=m(this,c,"f").call(this),n=(0,f.generateDeterministicRandomNumber)(s);for(const[s,i]of Object.entries(e)){let e=i;if(Array.isArray(i)&&n){const t=i.find(e=>!!(0,f.isFeatureFlagWithScopeValue)(e)&&n<=e.scope.value);t&&(e={name:t.name,value:t.value})}t[s]=e}return t}}}},{package:"@metamask/remote-feature-flag-controller",file:"node_modules/@metamask/remote-feature-flag-controller/dist/remote-feature-flag-controller.cjs"}],[1951,{uuid:4916},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.isFeatureFlagWithScopeValue=s.generateDeterministicRandomNumber=void 0;const n=e("uuid");function i(e){return BigInt(`0x${e.replace(/-/gu,"")}`)}const r=i("00000000-0000-4000-8000-000000000000"),a=i("ffffffff-ffff-4fff-bfff-ffffffffffff")-r;s.generateDeterministicRandomNumber=function(e){if(!e)throw new Error("MetaMetrics ID cannot be empty");let t,s;if((0,n.validate)(e)){if(4!==(0,n.version)(e))throw new Error(`Invalid UUID version. Expected v4, got v${(0,n.version)(e)}`);t=i(e)-r,s=a}else{if(!e.startsWith("0x"))throw new Error("Hex ID must start with 0x prefix");const n=e.slice(2),i=64;if(n.length!==i)throw new Error(`Invalid hex ID length. Expected ${i} characters, got ${n.length}`);if(!/^[0-9a-f]+$/iu.test(n))throw new Error("Hex ID contains invalid characters");t=BigInt(`0x${n}`),s=BigInt(`0x${"f".repeat(n.length)}`)}return Number(t*BigInt(1e6)/s)/1e6};s.isFeatureFlagWithScopeValue=e=>"object"==typeof e&&null!==e&&"scope"in e}}},{package:"@metamask/remote-feature-flag-controller",file:"node_modules/@metamask/remote-feature-flag-controller/dist/utils/user-segmentation-utils.cjs"}],[196,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.showSuccess=s.showError=void 0;const n=e=>({name:"SnapAuthorshipHeader",key:"snapHeader",properties:{snapId:e}});s.showError=(e,t,s,i)=>e.call("ApprovalController:showError",{header:[n(t)],title:s.title,icon:s.icon,error:{key:"snapAccountErrorMessage",name:"SnapAccountErrorMessage",properties:i}});s.showSuccess=(e,t,s,i)=>e.call("ApprovalController:showSuccess",{header:[n(t)],title:s.title,icon:s.icon,message:{key:"snapAccountSuccessMessage",name:"SnapAccountSuccessMessage",properties:i}})}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/utils/showResult.ts"}],[197,{loglevel:4094},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.tryPostMessage=function(e,t,s){const n={data:{method:t,params:s}};try{return e.postMessage(n),!0}catch(e){return i.default.error("MetaMask - Failed to message to port",e,n),!1}};var n,i=(n=e("loglevel"))&&n.__esModule?n:{default:n}}}},{package:"$root$",file:"app/scripts/lib/start-up-errors/start-up-errors.ts"}],[1978,{"@metamask/base-controller":1241,"@metamask/swappable-obj-proxy":2273},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n,i,r,a,o,c,l,u,h=this&&this.__classPrivateFieldSet||function(e,t,s,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,s):i?i.value=s:t.set(e,s),s},d=this&&this.__classPrivateFieldGet||function(e,t,s,n){if("a"===s&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)};Object.defineProperty(s,"__esModule",{value:!0}),s.SelectedNetworkController=s.SelectedNetworkControllerEventTypes=s.SelectedNetworkControllerActionTypes=s.METAMASK_DOMAIN=s.controllerName=void 0;const m=e("@metamask/base-controller"),p=e("@metamask/swappable-obj-proxy");s.controllerName="SelectedNetworkController";const f={domains:{persist:!0,anonymous:!1}};s.METAMASK_DOMAIN="metamask",s.SelectedNetworkControllerActionTypes={getState:`${s.controllerName}:getState`,getNetworkClientIdForDomain:`${s.controllerName}:getNetworkClientIdForDomain`,setNetworkClientIdForDomain:`${s.controllerName}:setNetworkClientIdForDomain`},s.SelectedNetworkControllerEventTypes={stateChange:`${s.controllerName}:stateChange`};class g extends m.BaseController{constructor({messenger:e,state:t={domains:{}},useRequestQueuePreference:o,onPreferencesStateChange:l,domainProxyMap:m}){super({name:s.controllerName,metadata:f,messenger:e,state:t}),n.add(this),i.set(this,void 0),r.set(this,void 0),h(this,r,o,"f"),h(this,i,m,"f"),d(this,n,"m",a).call(this),this.messagingSystem.call("PermissionController:getSubjectNames").filter(e=>this.state.domains[e]===undefined).forEach(e=>this.setNetworkClientIdForDomain(e,this.messagingSystem.call("NetworkController:getState").selectedNetworkClientId)),this.messagingSystem.subscribe("PermissionController:stateChange",(e,t)=>{t.forEach(({op:e,path:t})=>{if("subjects"===t[0]&&t[1]!==undefined&&"string"==typeof t[1]){const s=t[1];"add"===e&&this.state.domains[s]===undefined?this.setNetworkClientIdForDomain(s,this.messagingSystem.call("NetworkController:getState").selectedNetworkClientId):"remove"===e&&this.state.domains[s]!==undefined&&d(this,n,"m",c).call(this,s)}})}),this.messagingSystem.subscribe("NetworkController:stateChange",({selectedNetworkClientId:e,networkConfigurationsByChainId:t},s)=>{const n=s.find(({op:e,path:t})=>("replace"===e||"remove"===e)&&"networkConfigurationsByChainId"===t[0]);if(n){const s=Object.values(t).reduce((e,t)=>(t.rpcEndpoints.forEach(({networkClientId:s})=>e[s]=t.chainId),e),{});Object.entries(this.state.domains).forEach(([i,r])=>{const a=s[r];if("remove"!==n.op||a){if("replace"===n.op){const e=n.path[1];if(!a||a===e){const s=t[e],{networkClientId:n}=s.rpcEndpoints[s.defaultRpcEndpointIndex];r!==n&&this.setNetworkClientIdForDomain(i,n)}}}else this.setNetworkClientIdForDomain(i,e)})}}),l(({useRequestQueue:e})=>{d(this,r,"f")!==e&&(e?d(this,n,"m",u).call(this):Object.keys(this.state.domains).forEach(e=>{d(this,n,"m",c).call(this,e)}),h(this,r,e,"f"))})}setNetworkClientIdForDomain(e,t){if(d(this,r,"f")){if(e===s.METAMASK_DOMAIN)throw new Error(`NetworkClientId for domain "${s.METAMASK_DOMAIN}" cannot be set on the SelectedNetworkController`);if(!d(this,n,"m",l).call(this,e))throw new Error("NetworkClientId for domain cannot be called with a domain that has not yet been granted permissions");d(this,n,"m",o).call(this,e,t)}}getNetworkClientIdForDomain(e){const{selectedNetworkClientId:t}=this.messagingSystem.call("NetworkController:getState");return d(this,r,"f")?this.state.domains[e]??t:t}getProviderAndBlockTracker(e){if(e===s.METAMASK_DOMAIN){const e=this.messagingSystem.call("NetworkController:getSelectedNetworkClient");if(e===undefined)throw new Error("Selected network not initialized");return e}let t=d(this,i,"f").get(e);if(t===undefined){let s;if(d(this,r,"f")&&d(this,n,"m",l).call(this,e)){const t=this.getNetworkClientIdForDomain(e);s=this.messagingSystem.call("NetworkController:getNetworkClientById",t)}else if(s=this.messagingSystem.call("NetworkController:getSelectedNetworkClient"),s===undefined)throw new Error("Selected network not initialized");t={provider:(0,p.createEventEmitterProxy)(s.provider),blockTracker:(0,p.createEventEmitterProxy)(s.blockTracker,{eventFilter:"skipInternal"})},d(this,i,"f").set(e,t)}return t}}s.SelectedNetworkController=g,i=new WeakMap,r=new WeakMap,n=new WeakSet,a=function(){this.messagingSystem.registerActionHandler(s.SelectedNetworkControllerActionTypes.getNetworkClientIdForDomain,this.getNetworkClientIdForDomain.bind(this)),this.messagingSystem.registerActionHandler(s.SelectedNetworkControllerActionTypes.setNetworkClientIdForDomain,this.setNetworkClientIdForDomain.bind(this))},o=function(e,t){const s=this.messagingSystem.call("NetworkController:getNetworkClientById",t);this.update(s=>{s.domains[e]=t});const n=this.getProviderAndBlockTracker(e);n.provider.setTarget(s.provider),n.blockTracker.setTarget(s.blockTracker)},c=function(e){const t=this.messagingSystem.call("NetworkController:getSelectedNetworkClient"),s=d(this,i,"f").get(e);s&&t?(s.provider.setTarget(t.provider),s.blockTracker.setTarget(t.blockTracker)):s&&d(this,i,"f").delete(e),this.update(t=>{delete t.domains[e]})},l=function(e){return this.messagingSystem.call("PermissionController:hasPermissions",e)},u=function(){d(this,i,"f").forEach((e,t)=>{const{selectedNetworkClientId:s}=this.messagingSystem.call("NetworkController:getState");d(this,n,"m",l).call(this,t)&&d(this,n,"m",o).call(this,t,s)})}}}},{package:"@metamask/selected-network-controller",file:"node_modules/@metamask/selected-network-controller/dist/SelectedNetworkController.cjs"}],[1979,{"./SelectedNetworkController.cjs":1978},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.createSelectedNetworkMiddleware=void 0;const n=e("./SelectedNetworkController.cjs");s.createSelectedNetworkMiddleware=e=>(t,s,i)=>{if(!t.origin)throw new Error("Request object is lacking an 'origin'");return t.networkClientId=(t=>e.call(n.SelectedNetworkControllerActionTypes.getNetworkClientIdForDomain,t))(t.origin),i()}}}},{package:"@metamask/selected-network-controller",file:"node_modules/@metamask/selected-network-controller/dist/SelectedNetworkMiddleware.cjs"}],[198,{"../../../../shared/constants/start-up-errors":5e3,"../../../../shared/constants/state-corruption":5001,"../start-up-errors/start-up-errors":197,"@metamask/utils":2359},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.CorruptionHandler=void 0,s.hasVault=c;var n=e("@metamask/utils"),i=e("../../../../shared/constants/state-corruption"),r=e("../start-up-errors/start-up-errors"),a=e("../../../../shared/constants/start-up-errors");function o(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var n=s.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function c(e){if((0,n.isObject)(e)&&(0,n.hasProperty)(e,"KeyringController")){const t=e.KeyringController;if((0,n.isObject)(t)&&(0,n.hasProperty)(t,"vault"))return Boolean(t.vault)}return!1}s.CorruptionHandler=class{constructor(){o(this,"connectedPorts",new Set)}async handleStateCorruptionError({port:e,error:t,database:s,repairCallback:o}){const{connectedPorts:l}=this,u=await async function(e,t){let s=(0,n.isObject)(e)&&(0,n.hasProperty)(e,"backup")&&null!==e.backup?e.backup:null;if(!s)try{s=await t.getBackup()??null}catch{s=null}return s}(t,s),h=function(e){if((0,n.isObject)(e)&&(0,n.hasProperty)(e,"PreferencesController")){const t=e.PreferencesController;if((0,n.isObject)(t)&&(0,n.hasProperty)(t,"currentLocale")&&"string"==typeof t.currentLocale)return t.currentLocale}return null}(u),d=Boolean(c(u));return(0,r.tryPostMessage)(e,i.METHOD_DISPLAY_STATE_CORRUPTION_ERROR,{error:{message:t.message,name:t.name,stack:t.stack},currentLocale:h,hasBackup:d})?new Promise((t,s)=>{l.add(e),e.onDisconnect.addListener(function(){l.delete(e),t()}),e.onMessage.addListener(async function e(n){var c;if((null==n||null===(c=n.data)||void 0===c?void 0:c.method)===i.METHOD_REPAIR_DATABASE){l.forEach(t=>t.onMessage.removeListener(e));try{await async function(e){return await navigator.locks.request("repairDatabase",{ifAvailable:!0},async function(t){return null!==t&&(await e(),!0)})}(async function(){try{await o(u)}finally{l.forEach(e=>{(0,r.tryPostMessage)(e,a.RELOAD_WINDOW)})}}),t()}catch(e){s(e)}}})}):Promise.resolve()}}}}},{package:"$root$",file:"app/scripts/lib/state-corruption/state-corruption-recovery.ts"}],[1980,{"./SelectedNetworkController.cjs":1978,"./SelectedNetworkMiddleware.cjs":1979},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.createSelectedNetworkMiddleware=s.METAMASK_DOMAIN=s.SelectedNetworkController=s.SelectedNetworkControllerEventTypes=s.SelectedNetworkControllerActionTypes=void 0;var n=e("./SelectedNetworkController.cjs");Object.defineProperty(s,"SelectedNetworkControllerActionTypes",{enumerable:!0,get:function(){return n.SelectedNetworkControllerActionTypes}}),Object.defineProperty(s,"SelectedNetworkControllerEventTypes",{enumerable:!0,get:function(){return n.SelectedNetworkControllerEventTypes}}),Object.defineProperty(s,"SelectedNetworkController",{enumerable:!0,get:function(){return n.SelectedNetworkController}}),Object.defineProperty(s,"METAMASK_DOMAIN",{enumerable:!0,get:function(){return n.METAMASK_DOMAIN}});var i=e("./SelectedNetworkMiddleware.cjs");Object.defineProperty(s,"createSelectedNetworkMiddleware",{enumerable:!0,get:function(){return i.createSelectedNetworkMiddleware}})}}},{package:"@metamask/selected-network-controller",file:"node_modules/@metamask/selected-network-controller/dist/index.cjs"}],[1989,{"./constants":1990,"./types":1992,"./utils":1993,"@ethersproject/bytes":572,"@metamask/controller-utils":1316,"@metamask/eth-query":1405,"@metamask/polling-controller":1997,"@metamask/transaction-controller":2314,"bignumber.js":2002,"lodash/cloneDeep":4062},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n,i,r,a,o,c,l,u,h,d,m,p,f,g,y,w,S,v,b,k,_,T,E,P,C,O,A,I=this&&this.__classPrivateFieldSet||function(e,t,s,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,s):i?i.value=s:t.set(e,s),s},M=this&&this.__classPrivateFieldGet||function(e,t,s,n){if("a"===s&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)},j=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(s,"__esModule",{value:!0}),s.getDefaultSmartTransactionsControllerState=s.DEFAULT_INTERVAL=void 0;const N=e("@ethersproject/bytes"),R=e("@metamask/controller-utils"),x=j(e("@metamask/eth-query")),D=e("@metamask/polling-controller"),L=e("@metamask/transaction-controller"),F=e("bignumber.js"),U=j(e("lodash/cloneDeep")),H=e("./constants"),$=e("./types"),B=e("./utils");s.DEFAULT_INTERVAL=5e3;const W="`ethQuery` is not defined on SmartTransactionsController",q="SmartTransactionsController",K={smartTransactionsState:{persist:!0,anonymous:!0}};function V(){return{smartTransactionsState:{smartTransactions:{},userOptIn:null,userOptInV2:null,fees:{approvalTxFees:null,tradeTxFees:null},liveness:!0,livenessByChainId:{[R.ChainId.mainnet]:!0,[R.ChainId.sepolia]:!0},feesByChainId:{[R.ChainId.mainnet]:{approvalTxFees:null,tradeTxFees:null},[R.ChainId.sepolia]:{approvalTxFees:null,tradeTxFees:null}}}}}s.getDefaultSmartTransactionsControllerState=V;class G extends((0,D.StaticIntervalPollingController)()){constructor({interval:e=s.DEFAULT_INTERVAL,clientId:t,chainId:y=R.ChainId.mainnet,supportedChainIds:w=[R.ChainId.mainnet,R.ChainId.sepolia],getNonceLock:S,confirmExternalTransaction:v,trackMetaMetricsEvent:b,state:k={},messenger:_,getTransactions:T,getMetaMetricsProps:E,getFeatureFlags:P,updateTransaction:C,trace:O}){super({name:q,metadata:K,messenger:_,state:Object.assign(Object.assign({},V()),k)}),n.add(this),i.set(this,void 0),r.set(this,void 0),a.set(this,void 0),o.set(this,void 0),c.set(this,void 0),l.set(this,void 0),u.set(this,void 0),h.set(this,void 0),d.set(this,void 0),m.set(this,void 0),p.set(this,void 0),f.set(this,void 0),g.set(this,void 0),I(this,i,e,"f"),I(this,r,t,"f"),I(this,a,y,"f"),I(this,o,w,"f"),this.setIntervalLength(e),I(this,c,S,"f"),I(this,l,undefined,"f"),I(this,u,v,"f"),I(this,h,T,"f"),I(this,d,b,"f"),I(this,m,E,"f"),I(this,p,P,"f"),I(this,f,C,"f"),I(this,g,null!=O?O:(e,t)=>null==t?void 0:t(),"f"),this.initializeSmartTransactionsForChainId(),this.messagingSystem.subscribe("NetworkController:stateChange",({selectedNetworkClientId:e})=>{const{configuration:{chainId:t},provider:s}=this.messagingSystem.call("NetworkController:getNetworkClientById",e);I(this,a,t,"f"),I(this,l,new x.default(s),"f"),this.initializeSmartTransactionsForChainId(),this.checkPoll(this.state)}),this.messagingSystem.subscribe(`${q}:stateChange`,e=>this.checkPoll(e))}async _executePoll({chainIds:e}){const t=(null!=e?e:[]).filter(e=>M(this,o,"f").includes(e));return 0===t.length?Promise.resolve():this.updateSmartTransactions({chainIds:t})}checkPoll({smartTransactionsState:{smartTransactions:e}}){const t=Object.values(e).flat(),s=null==t?void 0:t.filter(B.isSmartTransactionPending);!this.timeoutHandle&&(null==s?void 0:s.length)>0?this.poll():this.timeoutHandle&&0===(null==s?void 0:s.length)&&this.stop()}initializeSmartTransactionsForChainId(){M(this,o,"f").includes(M(this,a,"f"))&&this.update(e=>{var t;e.smartTransactionsState.smartTransactions[M(this,a,"f")]=null!==(t=e.smartTransactionsState.smartTransactions[M(this,a,"f")])&&void 0!==t?t:[]})}async poll(e){e&&I(this,i,e,"f"),this.timeoutHandle&&clearInterval(this.timeoutHandle),M(this,o,"f").includes(M(this,a,"f"))&&(this.timeoutHandle=setInterval(()=>{(0,R.safelyExecute)(async()=>this.updateSmartTransactions())},M(this,i,"f")),await(0,R.safelyExecute)(async()=>this.updateSmartTransactions()))}async stop(){this.timeoutHandle&&clearInterval(this.timeoutHandle),this.timeoutHandle=undefined}setOptInState(e){this.update(t=>{t.smartTransactionsState.userOptInV2=e})}trackStxStatusChange(e,t){let s=(0,U.default)(e);s=Object.assign(Object.assign({},(0,U.default)(t)),s),s.status!==(null==t?void 0:t.status)&&M(this,d,"f").call(this,{event:H.MetaMetricsEventName.StxStatusUpdated,category:H.MetaMetricsEventCategory.Transactions,properties:(0,B.getSmartTransactionMetricsProperties)(s),sensitiveProperties:(0,B.getSmartTransactionMetricsSensitiveProperties)(s)})}isNewSmartTransaction(e,t){const{smartTransactionsState:{smartTransactions:s}}=this.state,n=s[null!=t?t:M(this,a,"f")],i=null==n?void 0:n.findIndex(t=>t.uuid===e);return-1===i||i===undefined}updateSmartTransaction(e,{networkClientId:t}={}){let s=M(this,l,"f"),i=M(this,a,"f");if(t){const{configuration:e,provider:n}=this.messagingSystem.call("NetworkController:getNetworkClientById",t);i=e.chainId,s=new x.default(n)}M(this,n,"m",v).call(this,e,{chainId:i,ethQuery:s})}async updateSmartTransactions({chainIds:e}={chainIds:M(this,n,"m",E).call(this)}){const{smartTransactionsState:{smartTransactions:t}}=this.state;for(const[s,i]of Object.entries(t)){if(e&&!e.includes(s))continue;const t=i.filter(B.isSmartTransactionPending).map(e=>{const t=M(this,n,"m",P).call(this,{chainId:s});return{uuid:e.uuid,networkClientId:t,chainId:e.chainId}});t.length>0&&await this.fetchSmartTransactionsStatus(t)}}async fetchSmartTransactionsStatus(e){const{chainId:t}=e[0],s=e.map(e=>e.uuid),i=new URLSearchParams({uuids:s.join(",")}),r=M(this,n,"m",C).call(this,{networkClientId:e[0].networkClientId}),a=`${(0,B.getAPIRequestURL)($.APIType.BATCH_STATUS,t)}?${i.toString()}`,o=await M(this,n,"m",y).call(this,a);for(const[s,i]of Object.entries(o)){const a=e.find(e=>e.uuid===s);if(!a){console.error(`No matching transaction found for uuid: ${s}`);continue}const o={statusMetadata:i,status:(0,B.calculateStatus)(i),cancellable:(0,B.isSmartTransactionCancellable)(i),uuid:s,networkClientId:a.networkClientId};await M(this,n,"m",v).call(this,o,{chainId:t,ethQuery:r})}return o}clearFees(){const e={approvalTxFees:null,tradeTxFees:null};return this.update(t=>{t.smartTransactionsState.fees=e}),e}async getFees(e,t,{networkClientId:s}={}){const i=null!=s?s:this.messagingSystem.call("NetworkController:getState").selectedNetworkClientId,r=M(this,n,"m",T).call(this,{networkClientId:i}),o=[];let c;if(t){const s=await M(this,n,"m",_).call(this,t,i);o.push(s),c=Object.assign(Object.assign({},e),{nonce:(0,B.incrementNonceInHex)(s.nonce)})}else c=e.nonce?e:await M(this,n,"m",_).call(this,e,i);o.push(c);const l=await M(this,g,"f").call(this,{name:H.SmartTransactionsTraceName.GetFees},async()=>await M(this,n,"m",y).call(this,(0,B.getAPIRequestURL)($.APIType.GET_FEES,r),{method:"POST",body:JSON.stringify({txs:o})}));let u,h;return t?(u=null==l?void 0:l.txs[0],h=null==l?void 0:l.txs[1]):(u=null,h=null==l?void 0:l.txs[0]),this.update(e=>{r===M(this,a,"f")&&(e.smartTransactionsState.fees={approvalTxFees:u,tradeTxFees:h}),e.smartTransactionsState.feesByChainId[r]={approvalTxFees:u,tradeTxFees:h}}),{approvalTxFees:u,tradeTxFees:h}}async submitSignedTransactions({transactionMeta:e,txParams:t,signedTransactions:s,signedCanceledTransactions:i=[],networkClientId:r}){var a,o;const l=null!=r?r:this.messagingSystem.call("NetworkController:getState").selectedNetworkClientId,u=M(this,n,"m",T).call(this,{networkClientId:l}),h=M(this,n,"m",C).call(this,{networkClientId:l}),d=await M(this,g,"f").call(this,{name:H.SmartTransactionsTraceName.SubmitTransactions},async()=>await M(this,n,"m",y).call(this,(0,B.getAPIRequestURL)($.APIType.SUBMIT_TRANSACTIONS,u),{method:"POST",body:JSON.stringify({rawTxs:s,rawCancelTxs:i})})),m=Date.now();let p;try{if(null==t?void 0:t.from){const e=await(0,R.query)(h,"getBalance",[t.from]);p=new F.BigNumber(e).toString(16)}}catch(e){console.error("ethQuery.getBalance error:",e)}let f,w,S={};if(t&&!t.nonce)try{w=await M(this,c,"f").call(this,t.from,l),f=(0,N.hexlify)(w.nextNonce),S=w.nonceDetails,null!==(a=t.nonce)&&void 0!==a||(t.nonce=f)}catch(e){throw console.error("Failed to acquire nonce lock:",e),e}const b=s.map(e=>(0,B.getTxHash)(e)),k=Object.assign(Object.assign({},d),{txHash:b[b.length-1],txHashes:b});try{await M(this,n,"m",v).call(this,{chainId:u,nonceDetails:S,preTxBalance:p,status:$.SmartTransactionStatuses.PENDING,time:m,txParams:t,uuid:k.uuid,txHash:k.txHash,cancellable:!0,type:null!==(o=null==e?void 0:e.type)&&void 0!==o?o:"swap",transactionId:null==e?void 0:e.id,networkClientId:l,txHashes:b},{chainId:u,ethQuery:h})}catch(e){throw console.error("Failed to create a smart transaction:",e),e}finally{w&&w.releaseLock()}return k}async cancelSmartTransaction(e,{networkClientId:t}={}){const s=M(this,n,"m",T).call(this,{networkClientId:t});await M(this,g,"f").call(this,{name:H.SmartTransactionsTraceName.CancelTransaction},async()=>await M(this,n,"m",y).call(this,(0,B.getAPIRequestURL)($.APIType.CANCEL,s),{method:"POST",body:JSON.stringify({uuid:e})}))}async fetchLiveness({networkClientId:e}={}){const t=M(this,n,"m",T).call(this,{networkClientId:e});let s=!1;try{const e=await M(this,g,"f").call(this,{name:H.SmartTransactionsTraceName.FetchLiveness},async()=>await M(this,n,"m",y).call(this,(0,B.getAPIRequestURL)($.APIType.LIVENESS,t)));s=Boolean(e.smartTransactions)}catch(e){console.log('"fetchLiveness" API call failed')}return this.update(e=>{t===M(this,a,"f")&&(e.smartTransactionsState.liveness=s),e.smartTransactionsState.livenessByChainId[t]=s}),s}async setStatusRefreshInterval(e){e!==M(this,i,"f")&&I(this,i,e,"f")}getTransactions({addressFrom:e,status:t}){return M(this,n,"m",O).call(this).filter(s=>{var n;return s.status===t&&(null===(n=s.txParams)||void 0===n?void 0:n.from)===e})}getSmartTransactionByMinedTxHash(e){if(!e)return undefined;return M(this,n,"m",O).call(this).find(t=>{var s,n;return(null===(n=null===(s=t.statusMetadata)||void 0===s?void 0:s.minedHash)||void 0===n?void 0:n.toLowerCase())===e.toLowerCase()})}wipeSmartTransactions({address:e,ignoreNetwork:t}){if(!e)return;const s=e.toLowerCase();if(t){const{smartTransactionsState:{smartTransactions:e}}=this.state;Object.keys(e).forEach(e=>{M(this,n,"m",A).call(this,{chainId:e,addressLowerCase:s})})}else M(this,n,"m",A).call(this,{chainId:M(this,a,"f"),addressLowerCase:s})}}s.default=G,i=new WeakMap,r=new WeakMap,a=new WeakMap,o=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,h=new WeakMap,d=new WeakMap,m=new WeakMap,p=new WeakMap,f=new WeakMap,g=new WeakMap,n=new WeakSet,y=async function(e,t){const s=Object.assign(Object.assign({},t),{headers:Object.assign({"Content-Type":"application/json"},M(this,r,"f")&&{"X-Client-Id":M(this,r,"f")})});return(0,B.handleFetch)(e,s)},w=function(e,{chainId:t=M(this,a,"f")}){var s;const{smartTransactionsState:{smartTransactions:n}}=this.state,i=null!==(s=n[t])&&void 0!==s?s:[],r=null==i?void 0:i.findIndex(t=>t.uuid===e.uuid);-1!==r&&(0,R.isSafeDynamicKey)(t)&&this.update(s=>{s.smartTransactionsState.smartTransactions[t][r]=Object.assign(Object.assign({},s.smartTransactionsState.smartTransactions[t][r]),e)})},S=async function(e){const t=await M(this,m,"f").call(this);e.accountHardwareType=null==t?void 0:t.accountHardwareType,e.accountType=null==t?void 0:t.accountType,e.deviceModel=null==t?void 0:t.deviceModel},v=async function(e,{chainId:t=M(this,a,"f"),ethQuery:s=M(this,l,"f")}){var i;const{smartTransactionsState:{smartTransactions:o}}=this.state,c=null!==(i=o[t])&&void 0!==i?i:[],u=null==c?void 0:c.findIndex(t=>t.uuid===e.uuid),d=this.isNewSmartTransaction(e.uuid,t);if(s===undefined)throw new Error(W);if(d)try{await M(this,n,"m",S).call(this,e)}catch(e){console.error("Failed to add metrics props to smart transaction:",e)}if(this.trackStxStatusChange(e,d?undefined:c[u]),d){const s=null==c?void 0:c.findIndex(t=>{var s,n,i;return(null===(s=t.txParams)||void 0===s?void 0:s.nonce)===(null===(n=e.txParams)||void 0===n?void 0:n.nonce)&&(null===(i=t.status)||void 0===i?void 0:i.startsWith("cancelled"))}),n=[(0,U.default)(e)],i=Object.assign(Object.assign({},e),{history:n}),r=s>-1?c.slice(0,s).concat(c.slice(s+1)).concat(i):c.concat(i);return void this.update(e=>{e.smartTransactionsState.smartTransactions[t]=r})}const m=c[u],g=Object.assign(Object.assign({},m),e);this.messagingSystem.publish("SmartTransactionsController:smartTransaction",g),(0,B.shouldMarkRegularTransactionAsFailed)({smartTransaction:g,clientId:M(this,r,"f"),getFeatureFlags:M(this,p,"f")})&&(0,B.markRegularTransactionAsFailed)({smartTransaction:g,getRegularTransactions:M(this,h,"f"),updateTransaction:M(this,f,"f")}),e.status!==$.SmartTransactionStatuses.SUCCESS&&e.status!==$.SmartTransactionStatuses.REVERTED||e.confirmed?M(this,n,"m",w).call(this,e,{chainId:t}):await M(this,n,"m",k).call(this,g,{chainId:t,ethQuery:s})},b=function(e){if(!e)return!0;const t=M(this,h,"f").call(this),s=null==t?void 0:t.find(t=>{var s;return(null===(s=t.hash)||void 0===s?void 0:s.toLowerCase())===e.toLowerCase()});return!s||![L.TransactionStatus.confirmed,L.TransactionStatus.submitted].includes(s.status)},k=async function(e,{chainId:t=M(this,a,"f"),ethQuery:s=M(this,l,"f")}){var i;if(s===undefined)throw new Error(W);const r=null===(i=e.statusMetadata)||void 0===i?void 0:i.minedHash;try{const i=await(0,R.query)(s,"getTransactionReceipt",[r]),a=await(0,R.query)(s,"getTransactionByHash",[r]),o=null==a?void 0:a.maxFeePerGas,c=null==a?void 0:a.maxPriorityFeePerGas;if(null==i?void 0:i.blockNumber){const a=await(0,R.query)(s,"getBlockByNumber",[null==i?void 0:i.blockNumber,!1]),l=null==a?void 0:a.baseFeePerGas,h=Object.assign(Object.assign({},e.txParams),{maxFeePerGas:o,maxPriorityFeePerGas:c}),m=Object.assign(Object.assign({},e),{id:e.uuid,status:L.TransactionStatus.confirmed,hash:r,txParams:h}),p=(0,B.snapshotFromTxMeta)(m),f=(0,B.replayHistory)(m.history),g=(0,B.generateHistoryEntry)(f,p,"txStateManager: setting status to confirmed"),y=g.length>0?Object.assign(Object.assign({},m),{history:m.history.concat(g)}):m;M(this,n,"m",b).call(this,r)&&M(this,u,"f").call(this,y,i,l),M(this,d,"f").call(this,{event:H.MetaMetricsEventName.StxConfirmed,category:H.MetaMetricsEventCategory.Transactions,properties:(0,B.getSmartTransactionMetricsProperties)(e),sensitiveProperties:(0,B.getSmartTransactionMetricsSensitiveProperties)(e)}),M(this,n,"m",w).call(this,Object.assign(Object.assign({},e),{confirmed:!0}),{chainId:t})}}catch(e){M(this,d,"f").call(this,{event:H.MetaMetricsEventName.StxConfirmationFailed,category:H.MetaMetricsEventCategory.Transactions}),console.error("confirm error",e)}finally{this.messagingSystem.publish("SmartTransactionsController:smartTransactionConfirmationDone",e)}},_=async function(e,t){const s=await M(this,c,"f").call(this,e.from,t),n=s.nextNonce;return s.releaseLock(),Object.assign(Object.assign({},e),{nonce:`0x${n.toString(16)}`})},T=function({networkClientId:e}={}){return e?this.messagingSystem.call("NetworkController:getNetworkClientById",e).configuration.chainId:M(this,a,"f")},E=function(){const{networkConfigurationsByChainId:e}=this.messagingSystem.call("NetworkController:getState");return Object.keys(e).filter(e=>M(this,o,"f").includes(e))},P=function({chainId:e}){const{networkConfigurationsByChainId:t}=this.messagingSystem.call("NetworkController:getState");return t[e].rpcEndpoints[t[e].defaultRpcEndpointIndex].networkClientId},C=function({networkClientId:e}={}){if(e){const{provider:t}=this.messagingSystem.call("NetworkController:getNetworkClientById",e);return new x.default(t)}if(M(this,l,"f")===undefined)throw new Error(W);return M(this,l,"f")},O=function(){const{smartTransactionsState:{smartTransactions:e}}=this.state,t=Object.values(e).flat();return t&&0!==t.length?t:[]},A=function({chainId:e,addressLowerCase:t}){const{smartTransactionsState:{smartTransactions:s}}=this.state,n=null==s?void 0:s[e];if(!n||0===n.length)return;const i=n.filter(e=>{var s;return(null===(s=e.txParams)||void 0===s?void 0:s.from)!==t});this.update(t=>{t.smartTransactionsState.smartTransactions[e]=i})}}}},{package:"@metamask/smart-transactions-controller",file:"node_modules/@metamask/smart-transactions-controller/dist/SmartTransactionsController.js"}],[199,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.sanitizeUIState=function(e){const t={...e};for(const e of n)delete t[e];return function(e){const t=e.snaps;if(!t)return;e.snaps=Object.values(t).reduce((e,t)=>(e[t.id]=function(e){const t={...e};return delete t.sourceCode,delete t.auxiliaryFiles,t}(t),e),{})}(t),function(e){const t=e.srpSessionData;if(!t)return;e.srpSessionData=Object.entries(t).reduce((e,[t,s])=>{const n={...s.token};return delete n.accessToken,e[t]={...s,token:n},e},{})}(t),function(e){const t=["vault","vaultEncryptionKey","vaultEncryptionSalt","encryptedSeedlessEncryptionKey","encryptedKeyringEncryptionKey","accessToken","metadataAccessToken","refreshToken","revokeToken"];for(const s of t)delete e[s];const s=e.nodeAuthTokens;s&&(e.nodeAuthTokens=s.map(e=>{const t={...e};return delete t.authToken,t}));e.socialLoginEmail&&(e.socialLoginEmail="********");const n=e.socialBackupsMetadata;n&&(e.socialBackupsMetadata=n.map(e=>{const t={...e};return delete t.hash,t}))}(t),t};const n=["snapStates","unencryptedSnapStates","phishingLists","whitelist","hotlistLastFetched","stalelistLastFetched","c2DomainBlocklistLastFetched","vault","encryptionKey","encryptionSalt"]}}},{package:"$root$",file:"app/scripts/lib/state-utils.ts"}],[1990,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.SmartTransactionsTraceName=s.MetaMetricsEventCategory=s.MetaMetricsEventName=s.SENTINEL_API_BASE_URL_MAP=s.API_BASE_URL=void 0,s.API_BASE_URL="https://transaction.api.cx.metamask.io",s.SENTINEL_API_BASE_URL_MAP={1:"https://tx-sentinel-ethereum-mainnet.api.cx.metamask.io",56:"https://tx-sentinel-bsc-mainnet.api.cx.metamask.io",8453:"https://tx-sentinel-base-mainnet.api.cx.metamask.io",42161:"https://tx-sentinel-arbitrum-mainnet.api.cx.metamask.io",11155111:"https://tx-sentinel-ethereum-sepolia.api.cx.metamask.io"},function(e){e.StxStatusUpdated="STX Status Updated",e.StxConfirmed="STX Confirmed",e.StxConfirmationFailed="STX Confirmation Failed",e.ReceiveRequest="Receive Request"}(s.MetaMetricsEventName||(s.MetaMetricsEventName={})),function(e){e.Transactions="Transactions",e.Navigation="Navigation"}(s.MetaMetricsEventCategory||(s.MetaMetricsEventCategory={})),function(e){e.GetFees="Smart Transactions: Get Fees",e.SubmitTransactions="Smart Transactions: Submit Transactions",e.CancelTransaction="Smart Transactions: Cancel Transaction",e.FetchLiveness="Smart Transactions: Fetch Liveness"}(s.SmartTransactionsTraceName||(s.SmartTransactionsTraceName={}))}}},{package:"@metamask/smart-transactions-controller",file:"node_modules/@metamask/smart-transactions-controller/dist/constants.js"}],[1991,{"./SmartTransactionsController":1989},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var i=e("./SmartTransactionsController");Object.defineProperty(s,"default",{enumerable:!0,get:function(){return n(i).default}})}}},{package:"@metamask/smart-transactions-controller",file:"node_modules/@metamask/smart-transactions-controller/dist/index.js"}],[1993,{"../package.json":2003,"./constants":1990,"./types":1992,"@ethersproject/bytes":572,"@ethersproject/keccak256":598,"@ethersproject/transactions":648,"@metamask/transaction-controller":2314,"bignumber.js":2002,"fast-json-patch":3663,lodash:4086},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(s,"__esModule",{value:!0}),s.markRegularTransactionAsFailed=s.shouldMarkRegularTransactionAsFailed=s.getReturnTxHashAsap=s.getSmartTransactionMetricsSensitiveProperties=s.getSmartTransactionMetricsProperties=s.getTxHash=s.incrementNonceInHex=s.isSmartTransactionCancellable=s.handleFetch=s.mapKeysToCamel=s.getStxProcessingTime=s.snapshotFromTxMeta=s.replayHistory=s.generateHistoryEntry=s.calculateStatus=s.getAPIRequestURL=s.isSmartTransactionStatusResolved=s.isSmartTransactionPending=void 0;const i=e("@ethersproject/bytes"),r=e("@ethersproject/keccak256"),a=e("@ethersproject/transactions"),o=e("@metamask/transaction-controller"),c=e("bignumber.js"),l=n(e("fast-json-patch")),u=n(e("lodash")),h=n(e("../package.json")),d=e("./constants"),m=e("./types");s.isSmartTransactionPending=function(e){return e.status===m.SmartTransactionStatuses.PENDING};s.isSmartTransactionStatusResolved=e=>"uuid_not_found"===e,s.getAPIRequestURL=function(e,t){const s=parseInt(t,16);switch(e){case m.APIType.GET_FEES:return`${d.API_BASE_URL}/networks/${s}/getFees`;case m.APIType.ESTIMATE_GAS:return`${d.API_BASE_URL}/networks/${s}/estimateGas`;case m.APIType.SUBMIT_TRANSACTIONS:return`${d.API_BASE_URL}/networks/${s}/submitTransactions?stxControllerVersion=${h.default.version}`;case m.APIType.CANCEL:return`${d.API_BASE_URL}/networks/${s}/cancel`;case m.APIType.BATCH_STATUS:return`${d.API_BASE_URL}/networks/${s}/batchStatus`;case m.APIType.LIVENESS:return`${d.SENTINEL_API_BASE_URL_MAP[s]}/network`;default:throw new Error("Invalid APIType")}};s.calculateStatus=e=>{if((0,s.isSmartTransactionStatusResolved)(e))return m.SmartTransactionStatuses.RESOLVED;const t=[m.SmartTransactionCancellationReason.WOULD_REVERT,m.SmartTransactionCancellationReason.TOO_CHEAP,m.SmartTransactionCancellationReason.DEADLINE_MISSED,m.SmartTransactionCancellationReason.INVALID_NONCE,m.SmartTransactionCancellationReason.USER_CANCELLED];if((null==e?void 0:e.minedTx)===m.SmartTransactionMinedTx.NOT_MINED){if(e.cancellationReason===m.SmartTransactionCancellationReason.NOT_CANCELLED)return m.SmartTransactionStatuses.PENDING;const s=t.findIndex(t=>t===e.cancellationReason)>-1;if(e.cancellationReason&&s)return e.isSettled?m.cancellationReasonToStatusMap[e.cancellationReason]:m.SmartTransactionStatuses.PENDING}else{if((null==e?void 0:e.minedTx)===m.SmartTransactionMinedTx.SUCCESS)return m.SmartTransactionStatuses.SUCCESS;if((null==e?void 0:e.minedTx)===m.SmartTransactionMinedTx.CANCELLED)return m.SmartTransactionStatuses.CANCELLED;if((null==e?void 0:e.minedTx)===m.SmartTransactionMinedTx.REVERTED)return m.SmartTransactionStatuses.REVERTED;if((null==e?void 0:e.minedTx)===m.SmartTransactionMinedTx.UNKNOWN)return m.SmartTransactionStatuses.UNKNOWN}return m.SmartTransactionStatuses.UNKNOWN},s.generateHistoryEntry=function(e,t,s){const n=l.default.compare(e,t);return n[0]&&(s&&(n[0].note=s),n[0].timestamp=Date.now()),n},s.replayHistory=function(e){return u.default.cloneDeep(e).reduce((e,t)=>l.default.applyPatch(e,t).newDocument)},s.snapshotFromTxMeta=function(e){const t=Object.assign({},e);return delete t.history,u.default.cloneDeep(t)};s.getStxProcessingTime=e=>e?Math.round((Date.now()-e)/1e3):undefined;s.mapKeysToCamel=e=>{if(!u.default.isObject(e))return e;const t=u.default.mapValues(e,e=>u.default.isArray(e)?e.map(s.mapKeysToCamel):u.default.isObject(e)?(0,s.mapKeysToCamel)(e):e);return u.default.mapKeys(t,(e,t)=>u.default.camelCase(t))},s.handleFetch=async function(e,t){const n=await fetch(e,t),i=await n.json();if(!n.ok)throw console.log("response",n),new Error(`Fetch error:${JSON.stringify(Object.assign({status:n.status},(0,s.mapKeysToCamel)(i)))}`);return i};s.isSmartTransactionCancellable=e=>e.minedTx===m.SmartTransactionMinedTx.NOT_MINED&&(!e.cancellationReason||e.cancellationReason===m.SmartTransactionCancellationReason.NOT_CANCELLED);s.incrementNonceInHex=e=>{const t=new c.BigNumber(e,16).toString(10);return(0,i.hexlify)(Number(t)+1)};s.getTxHash=e=>{var t;if(!e)return"";try{const s=(0,a.parse)(e);return null!==(t=null==s?void 0:s.hash)&&void 0!==t?t:""}catch(t){if((e=>"string"==typeof e&&e.startsWith("0x04"))(e))return(0,i.hexlify)((0,r.keccak256)((0,i.arrayify)(e)));throw t}};s.getSmartTransactionMetricsProperties=e=>{if(!e)return{};const t=e.statusMetadata;return{stx_status:e.status,type:e.type,processing_time:(0,s.getStxProcessingTime)(e.time),is_smart_transaction:!0,stx_enabled:!0,current_stx_enabled:!0,stx_user_opt_in:!0,stx_duplicated:null==t?void 0:t.duplicated,stx_timed_out:null==t?void 0:t.timedOut,stx_proxied:null==t?void 0:t.proxied}};s.getSmartTransactionMetricsSensitiveProperties=e=>e?{token_from_symbol:e.sourceTokenSymbol,token_to_symbol:e.destinationTokenSymbol,account_hardware_type:e.accountHardwareType,account_type:e.accountType,device_model:e.deviceModel}:{};s.getReturnTxHashAsap=(e,t)=>e===m.ClientId.Extension?null==t?void 0:t.extensionReturnTxHashAsap:null==t?void 0:t.mobileReturnTxHashAsap;s.shouldMarkRegularTransactionAsFailed=({smartTransaction:e,clientId:t,getFeatureFlags:n})=>{var i;const{status:r,transactionId:a}=e,o=[m.SmartTransactionStatuses.CANCELLED,m.SmartTransactionStatuses.CANCELLED_USER_CANCELLED,m.SmartTransactionStatuses.UNKNOWN,m.SmartTransactionStatuses.RESOLVED];if(!r||!o.includes(r))return!1;const{smartTransactions:c}=null!==(i=n())&&void 0!==i?i:{},l=(0,s.getReturnTxHashAsap)(t,c);return Boolean(l&&a)};s.markRegularTransactionAsFailed=({smartTransaction:e,getRegularTransactions:t,updateTransaction:s})=>{const{transactionId:n,status:i}=e,r=t().find(e=>e.id===n);if(!r)throw new Error("Cannot find regular transaction to mark it as failed");if(r.status===o.TransactionStatus.failed)return;s(Object.assign(Object.assign({},r),{status:o.TransactionStatus.failed,error:{name:"SmartTransactionFailed",message:`Smart transaction failed with status: ${i}`}}),`Smart transaction status: ${i}`)}}}},{package:"@metamask/smart-transactions-controller",file:"node_modules/@metamask/smart-transactions-controller/dist/utils.js"}],[1994,{"fast-json-stable-stringify":3664,uuid:4916},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n=this&&this.__classPrivateFieldGet||function(e,t,s,n){if("a"===s&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(s,"__esModule",{value:!0}),s.AbstractPollingControllerBaseMixin=s.getKey=void 0;const r=i(e("fast-json-stable-stringify")),a=e("uuid");s.getKey=e=>(0,r.default)(e),s.AbstractPollingControllerBaseMixin=function(e){var t,i;return t=new WeakMap,i=new WeakMap,class extends e{constructor(){super(...arguments),t.set(this,new Map),i.set(this,new Map)}startPolling(e){const i=(0,a.v4)(),r=(0,s.getKey)(e),o=n(this,t,"f").get(r)??new Set;return o.add(i),n(this,t,"f").set(r,o),1===o.size&&this._startPolling(e),i}stopAllPolling(){n(this,t,"f").forEach((e,t)=>{e.forEach(e=>{this.stopPollingByPollingToken(e)})})}stopPollingByPollingToken(e){if(!e)throw new Error("pollingToken required");let s=null;for(const[i,r]of n(this,t,"f"))if(r.delete(e)){0===r.size&&(s=i);break}if(s){this._stopPollingByPollingTokenSetId(s),n(this,t,"f").delete(s);const e=n(this,i,"f").get(s);if(e){for(const t of e)t(JSON.parse(s));e.clear()}}}onPollingComplete(e,t){const r=(0,s.getKey)(e),a=n(this,i,"f").get(r)??new Set;a.add(t),n(this,i,"f").set(r,a)}}}}}},{package:"@metamask/smart-transactions-controller>@metamask/polling-controller",file:"node_modules/@metamask/smart-transactions-controller/node_modules/@metamask/polling-controller/dist/AbstractPollingController.cjs"}],[1995,{"./AbstractPollingController.cjs":1994,"@metamask/base-controller":2001},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n=this&&this.__classPrivateFieldGet||function(e,t,s,n){if("a"===s&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)};Object.defineProperty(s,"__esModule",{value:!0}),s.BlockTrackerPollingController=s.BlockTrackerPollingControllerOnly=void 0;const i=e("@metamask/base-controller"),r=e("./AbstractPollingController.cjs");function a(e){var t;class s extends((0,r.AbstractPollingControllerBaseMixin)(e)){constructor(){super(...arguments),t.set(this,{})}_startPolling(e){const s=(0,r.getKey)(e);if(n(this,t,"f")[s])return;const i=this._getNetworkClientById(e.networkClientId);if(!i)throw new Error(`Unable to retrieve blockTracker for networkClientId ${e.networkClientId}`);{const r=this._executePoll.bind(this,e);i.blockTracker.addListener("latest",r),n(this,t,"f")[s]=r}}_stopPollingByPollingTokenSetId(e){const{networkClientId:s}=JSON.parse(e),i=this._getNetworkClientById(s);if(i&&n(this,t,"f")[e]){const s=n(this,t,"f")[e];s&&(i.blockTracker.removeListener("latest",s),delete n(this,t,"f")[e])}}}return t=new WeakMap,s}class o{}s.BlockTrackerPollingControllerOnly=()=>a(o);s.BlockTrackerPollingController=()=>a(i.BaseController)}}},{package:"@metamask/smart-transactions-controller>@metamask/polling-controller",file:"node_modules/@metamask/smart-transactions-controller/node_modules/@metamask/polling-controller/dist/BlockTrackerPollingController.cjs"}],[1996,{"./AbstractPollingController.cjs":1994,"@metamask/base-controller":2001},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n=this&&this.__classPrivateFieldSet||function(e,t,s,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,s):i?i.value=s:t.set(e,s),s},i=this&&this.__classPrivateFieldGet||function(e,t,s,n){if("a"===s&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)};Object.defineProperty(s,"__esModule",{value:!0}),s.StaticIntervalPollingController=s.StaticIntervalPollingControllerOnly=void 0;const r=e("@metamask/base-controller"),a=e("./AbstractPollingController.cjs");function o(e){var t,s;class r extends((0,a.AbstractPollingControllerBaseMixin)(e)){constructor(){super(...arguments),t.set(this,{}),s.set(this,1e3)}setIntervalLength(e){n(this,s,e,"f")}getIntervalLength(){return i(this,s,"f")}_startPolling(e){if(!i(this,s,"f"))throw new Error("intervalLength must be defined and greater than 0");const n=(0,a.getKey)(e),r=i(this,t,"f")[n];this._stopPollingByPollingTokenSetId(n);const o=i(this,t,"f")[n]=setTimeout(async()=>{try{await this._executePoll(e)}catch(e){console.error(e)}o===i(this,t,"f")[n]&&this._startPolling(e)},r?i(this,s,"f"):0)}_stopPollingByPollingTokenSetId(e){const s=i(this,t,"f")[e];s&&(clearTimeout(s),delete i(this,t,"f")[e])}}return t=new WeakMap,s=new WeakMap,r}class c{}s.StaticIntervalPollingControllerOnly=()=>o(c);s.StaticIntervalPollingController=()=>o(r.BaseController)}}},{package:"@metamask/smart-transactions-controller>@metamask/polling-controller",file:"node_modules/@metamask/smart-transactions-controller/node_modules/@metamask/polling-controller/dist/StaticIntervalPollingController.cjs"}],[1997,{"./BlockTrackerPollingController.cjs":1995,"./StaticIntervalPollingController.cjs":1996},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.StaticIntervalPollingController=s.StaticIntervalPollingControllerOnly=s.BlockTrackerPollingController=s.BlockTrackerPollingControllerOnly=void 0;var n=e("./BlockTrackerPollingController.cjs");Object.defineProperty(s,"BlockTrackerPollingControllerOnly",{enumerable:!0,get:function(){return n.BlockTrackerPollingControllerOnly}}),Object.defineProperty(s,"BlockTrackerPollingController",{enumerable:!0,get:function(){return n.BlockTrackerPollingController}});var i=e("./StaticIntervalPollingController.cjs");Object.defineProperty(s,"StaticIntervalPollingControllerOnly",{enumerable:!0,get:function(){return i.StaticIntervalPollingControllerOnly}}),Object.defineProperty(s,"StaticIntervalPollingController",{enumerable:!0,get:function(){return i.StaticIntervalPollingController}})}}},{package:"@metamask/smart-transactions-controller>@metamask/polling-controller",file:"node_modules/@metamask/smart-transactions-controller/node_modules/@metamask/polling-controller/dist/index.cjs"}],[1998,{immer:3881},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n,i=this&&this.__classPrivateFieldSet||function(e,t,s,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,s):i?i.value=s:t.set(e,s),s},r=this&&this.__classPrivateFieldGet||function(e,t,s,n){if("a"===s&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)};Object.defineProperty(s,"__esModule",{value:!0}),s.getPersistentState=s.getAnonymizedState=s.BaseController=s.isBaseController=void 0;const a=e("immer");(0,a.enablePatches)(),s.isBaseController=function(e){return"object"==typeof e&&null!==e&&"name"in e&&"string"==typeof e.name&&"state"in e&&"object"==typeof e.state&&"metadata"in e&&"object"==typeof e.metadata};function o(e,t,s){return Object.keys(e).reduce((n,i)=>{try{const r=t[i];if(!r)throw new Error(`No metadata found for '${String(i)}'`);const a=r[s],o=e[i];return"function"==typeof a?n[i]=a(o):a&&(n[i]=o),n}catch(e){return setTimeout(()=>{throw e}),n}},{})}s.BaseController=class{constructor({messenger:e,metadata:t,name:s,state:r}){n.set(this,void 0),this.messagingSystem=e,this.name=s,i(this,n,(0,a.freeze)(r,!0),"f"),this.metadata=t,this.messagingSystem.registerActionHandler(`${s}:getState`,()=>this.state),this.messagingSystem.registerInitialEventPayload({eventType:`${s}:stateChange`,getPayload:()=>[this.state,[]]})}get state(){return r(this,n,"f")}set state(e){throw new Error("Controller state cannot be directly mutated; use 'update' method instead.")}update(e){const[t,s,o]=a.produceWithPatches(r(this,n,"f"),e);return s.length>0&&(i(this,n,t,"f"),this.messagingSystem.publish(`${this.name}:stateChange`,t,s)),{nextState:t,patches:s,inversePatches:o}}applyPatches(e){const t=(0,a.applyPatches)(r(this,n,"f"),e);i(this,n,t,"f"),this.messagingSystem.publish(`${this.name}:stateChange`,t,e)}destroy(){this.messagingSystem.clearEventSubscriptions(`${this.name}:stateChange`)}},n=new WeakMap,s.getAnonymizedState=function(e,t){return o(e,t,"anonymous")},s.getPersistentState=function(e,t){return o(e,t,"persist")}}}},{package:"@metamask/smart-transactions-controller>@metamask/polling-controller>@metamask/base-controller",file:"node_modules/@metamask/smart-transactions-controller/node_modules/@metamask/polling-controller/node_modules/@metamask/base-controller/dist/BaseController.cjs"}],[1999,{"./RestrictedMessenger.cjs":2e3},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n,i,r,a,o=this&&this.__classPrivateFieldGet||function(e,t,s,n){if("a"===s&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)};Object.defineProperty(s,"__esModule",{value:!0}),s.Messenger=void 0;const c=e("./RestrictedMessenger.cjs");s.Messenger=class{constructor(){n.set(this,new Map),i.set(this,new Map),r.set(this,new Map),a.set(this,new Map)}registerActionHandler(e,t){if(o(this,n,"f").has(e))throw new Error(`A handler for ${e} has already been registered`);o(this,n,"f").set(e,t)}registerMethodActionHandlers(e,t){for(const s of t){const t=e[s];if("function"==typeof t){const n=`${e.name}:${s}`;this.registerActionHandler(n,t.bind(e))}}}unregisterActionHandler(e){o(this,n,"f").delete(e)}clearActions(){o(this,n,"f").clear()}call(e,...t){const s=o(this,n,"f").get(e);if(!s)throw new Error(`A handler for ${e} has not been registered`);return s(...t)}registerInitialEventPayload({eventType:e,getPayload:t}){o(this,r,"f").set(e,t)}publish(e,...t){const s=o(this,i,"f").get(e);if(s)for(const[e,n]of s.entries())try{if(n){const s=o(this,a,"f").get(e),i=n(...t);i!==s&&(o(this,a,"f").set(e,i),e(i,s))}else e(...t)}catch(e){setTimeout(()=>{throw e})}}subscribe(e,t,s){let n=o(this,i,"f").get(e);n||(n=new Map,o(this,i,"f").set(e,n));const c=t;if(n.set(c,s),s){const t=o(this,r,"f").get(e);if(t){const e=s(...t());o(this,a,"f").set(c,e)}}}unsubscribe(e,t){const s=o(this,i,"f").get(e),n=t;if(!s||!s.has(n))throw new Error(`Subscription not found for event: ${e}`);s.get(n)&&o(this,a,"f").delete(n),s.delete(n)}clearEventSubscriptions(e){o(this,i,"f").delete(e)}clearSubscriptions(){o(this,i,"f").clear()}getRestricted({name:e,allowedActions:t,allowedEvents:s}){return new c.RestrictedMessenger({messenger:this,name:e,allowedActions:t,allowedEvents:s})}},n=new WeakMap,i=new WeakMap,r=new WeakMap,a=new WeakMap}}},{package:"@metamask/smart-transactions-controller>@metamask/polling-controller>@metamask/base-controller",file:"node_modules/@metamask/smart-transactions-controller/node_modules/@metamask/polling-controller/node_modules/@metamask/base-controller/dist/Messenger.cjs"}],[20,{"@metamask/profile-sync-controller/auth":1857,"@metamask/profile-sync-controller/sdk":1882},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.AuthenticationControllerInit=void 0;var n=e("@metamask/profile-sync-controller/auth"),i=e("@metamask/profile-sync-controller/sdk");s.AuthenticationControllerInit=({controllerMessenger:e,persistedState:t,getMetaMetricsId:s})=>({controller:new n.Controller({messenger:e,state:t.AuthenticationController,metametrics:{getMetaMetricsId:s,agent:i.Platform.EXTENSION}})})}}},{package:"$root$",file:"app/scripts/controller-init/identity/authentication-controller-init.ts"}],[2e3,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n,i,r,a,o,c,l,u,h=this&&this.__classPrivateFieldSet||function(e,t,s,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,s):i?i.value=s:t.set(e,s),s},d=this&&this.__classPrivateFieldGet||function(e,t,s,n){if("a"===s&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)};Object.defineProperty(s,"__esModule",{value:!0}),s.RestrictedMessenger=void 0;s.RestrictedMessenger=class{constructor({messenger:e,name:t,allowedActions:s,allowedEvents:c}){if(n.add(this),i.set(this,void 0),r.set(this,void 0),a.set(this,void 0),o.set(this,void 0),!e)throw new Error("Messenger not provided");h(this,i,e,"f"),h(this,r,t,"f"),h(this,a,s,"f"),h(this,o,c,"f")}registerActionHandler(e,t){if(!d(this,n,"m",u).call(this,e))throw new Error(`Only allowed registering action handlers prefixed by '${d(this,r,"f")}:'`);d(this,i,"f").registerActionHandler(e,t)}registerMethodActionHandlers(e,t){d(this,i,"f").registerMethodActionHandlers(e,t)}unregisterActionHandler(e){if(!d(this,n,"m",u).call(this,e))throw new Error(`Only allowed unregistering action handlers prefixed by '${d(this,r,"f")}:'`);d(this,i,"f").unregisterActionHandler(e)}call(e,...t){if(!d(this,n,"m",l).call(this,e))throw new Error(`Action missing from allow list: ${e}`);return d(this,i,"f").call(e,...t)}registerInitialEventPayload({eventType:e,getPayload:t}){if(!d(this,n,"m",u).call(this,e))throw new Error(`Only allowed publishing events prefixed by '${d(this,r,"f")}:'`);d(this,i,"f").registerInitialEventPayload({eventType:e,getPayload:t})}publish(e,...t){if(!d(this,n,"m",u).call(this,e))throw new Error(`Only allowed publishing events prefixed by '${d(this,r,"f")}:'`);d(this,i,"f").publish(e,...t)}subscribe(e,t,s){if(!d(this,n,"m",c).call(this,e))throw new Error(`Event missing from allow list: ${e}`);return s?d(this,i,"f").subscribe(e,t,s):d(this,i,"f").subscribe(e,t)}unsubscribe(e,t){if(!d(this,n,"m",c).call(this,e))throw new Error(`Event missing from allow list: ${e}`);d(this,i,"f").unsubscribe(e,t)}clearEventSubscriptions(e){if(!d(this,n,"m",u).call(this,e))throw new Error(`Only allowed clearing events prefixed by '${d(this,r,"f")}:'`);d(this,i,"f").clearEventSubscriptions(e)}},i=new WeakMap,r=new WeakMap,a=new WeakMap,o=new WeakMap,n=new WeakSet,c=function(e){const t=d(this,o,"f");return d(this,n,"m",u).call(this,e)||null!==t&&t.includes(e)},l=function(e){const t=d(this,a,"f");return d(this,n,"m",u).call(this,e)||null!==t&&t.includes(e)},u=function(e){return e.startsWith(`${d(this,r,"f")}:`)}}}},{package:"@metamask/smart-transactions-controller>@metamask/polling-controller>@metamask/base-controller",file:"node_modules/@metamask/smart-transactions-controller/node_modules/@metamask/polling-controller/node_modules/@metamask/base-controller/dist/RestrictedMessenger.cjs"}],[2001,{"./BaseController.cjs":1998,"./Messenger.cjs":1999,"./RestrictedMessenger.cjs":2e3},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.RestrictedMessenger=s.Messenger=s.isBaseController=s.getPersistentState=s.getAnonymizedState=s.BaseController=void 0;var n=e("./BaseController.cjs");Object.defineProperty(s,"BaseController",{enumerable:!0,get:function(){return n.BaseController}}),Object.defineProperty(s,"getAnonymizedState",{enumerable:!0,get:function(){return n.getAnonymizedState}}),Object.defineProperty(s,"getPersistentState",{enumerable:!0,get:function(){return n.getPersistentState}}),Object.defineProperty(s,"isBaseController",{enumerable:!0,get:function(){return n.isBaseController}});var i=e("./Messenger.cjs");Object.defineProperty(s,"Messenger",{enumerable:!0,get:function(){return i.Messenger}});var r=e("./RestrictedMessenger.cjs");Object.defineProperty(s,"RestrictedMessenger",{enumerable:!0,get:function(){return r.RestrictedMessenger}})}}},{package:"@metamask/smart-transactions-controller>@metamask/polling-controller>@metamask/base-controller",file:"node_modules/@metamask/smart-transactions-controller/node_modules/@metamask/polling-controller/node_modules/@metamask/base-controller/dist/index.cjs"}],[2002,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){!function(e){var s,n=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,i=Math.ceil,r=Math.floor,a="[BigNumber Error] ",o=a+"Number primitive has more than 15 significant digits: ",c=1e14,l=14,u=9007199254740991,h=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],d=1e7,m=1e9;function p(e){var t=0|e;return e>0||e===t?t:t-1}function f(e){for(var t,s,n=1,i=e.length,r=e[0]+"";n<i;){for(t=e[n++]+"",s=l-t.length;s--;t="0"+t);r+=t}for(i=r.length;48===r.charCodeAt(--i););return r.slice(0,i+1||1)}function g(e,t){var s,n,i=e.c,r=t.c,a=e.s,o=t.s,c=e.e,l=t.e;if(!a||!o)return null;if(s=i&&!i[0],n=r&&!r[0],s||n)return s?n?0:-o:a;if(a!=o)return a;if(s=a<0,n=c==l,!i||!r)return n?0:!i^s?1:-1;if(!n)return c>l^s?1:-1;for(o=(c=i.length)<(l=r.length)?c:l,a=0;a<o;a++)if(i[a]!=r[a])return i[a]>r[a]^s?1:-1;return c==l?0:c>l^s?1:-1}function y(e,t,s,n){if(e<t||e>s||e!==r(e))throw Error(a+(n||"Argument")+("number"==typeof e?e<t||e>s?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function w(e){var t=e.c.length-1;return p(e.e/l)==t&&e.c[t]%2!=0}function S(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function v(e,t,s){var n,i;if(t<0){for(i=s+".";++t;i+=s);e=i+e}else if(++t>(n=e.length)){for(i=s,t-=n;--t;i+=s);e+=i}else t<n&&(e=e.slice(0,t)+"."+e.slice(t));return e}s=function e(t){var s,b,k,_,T,E,P,C,O,A,I=q.prototype={constructor:q,toString:null,valueOf:null},M=new q(1),j=20,N=4,R=-7,x=21,D=-1e7,L=1e7,F=!1,U=1,H=0,$={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:" ",suffix:""},B="0123456789abcdefghijklmnopqrstuvwxyz",W=!0;function q(e,t){var s,i,a,c,h,d,m,p,f=this;if(!(f instanceof q))return new q(e,t);if(null==t){if(e&&!0===e._isBigNumber)return f.s=e.s,void(!e.c||e.e>L?f.c=f.e=null:e.e<D?f.c=[f.e=0]:(f.e=e.e,f.c=e.c.slice()));if((d="number"==typeof e)&&0*e==0){if(f.s=1/e<0?(e=-e,-1):1,e===~~e){for(c=0,h=e;h>=10;h/=10,c++);return void(c>L?f.c=f.e=null:(f.e=c,f.c=[e]))}p=String(e)}else{if(!n.test(p=String(e)))return k(f,p,d);f.s=45==p.charCodeAt(0)?(p=p.slice(1),-1):1}(c=p.indexOf("."))>-1&&(p=p.replace(".","")),(h=p.search(/e/i))>0?(c<0&&(c=h),c+=+p.slice(h+1),p=p.substring(0,h)):c<0&&(c=p.length)}else{if(y(t,2,B.length,"Base"),10==t&&W)return z(f=new q(e),j+f.e+1,N);if(p=String(e),d="number"==typeof e){if(0*e!=0)return k(f,p,d,t);if(f.s=1/e<0?(p=p.slice(1),-1):1,q.DEBUG&&p.replace(/^0\.0*|\./,"").length>15)throw Error(o+e)}else f.s=45===p.charCodeAt(0)?(p=p.slice(1),-1):1;for(s=B.slice(0,t),c=h=0,m=p.length;h<m;h++)if(s.indexOf(i=p.charAt(h))<0){if("."==i){if(h>c){c=m;continue}}else if(!a&&(p==p.toUpperCase()&&(p=p.toLowerCase())||p==p.toLowerCase()&&(p=p.toUpperCase()))){a=!0,h=-1,c=0;continue}return k(f,String(e),d,t)}d=!1,(c=(p=b(p,t,10,f.s)).indexOf("."))>-1?p=p.replace(".",""):c=p.length}for(h=0;48===p.charCodeAt(h);h++);for(m=p.length;48===p.charCodeAt(--m););if(p=p.slice(h,++m)){if(m-=h,d&&q.DEBUG&&m>15&&(e>u||e!==r(e)))throw Error(o+f.s*e);if((c=c-h-1)>L)f.c=f.e=null;else if(c<D)f.c=[f.e=0];else{if(f.e=c,f.c=[],h=(c+1)%l,c<0&&(h+=l),h<m){for(h&&f.c.push(+p.slice(0,h)),m-=l;h<m;)f.c.push(+p.slice(h,h+=l));h=l-(p=p.slice(h)).length}else h-=m;for(;h--;p+="0");f.c.push(+p)}}else f.c=[f.e=0]}function K(e,t,s,n){var i,r,a,o,c;if(null==s?s=N:y(s,0,8),!e.c)return e.toString();if(i=e.c[0],a=e.e,null==t)c=f(e.c),c=1==n||2==n&&(a<=R||a>=x)?S(c,a):v(c,a,"0");else if(r=(e=z(new q(e),t,s)).e,o=(c=f(e.c)).length,1==n||2==n&&(t<=r||r<=R)){for(;o<t;c+="0",o++);c=S(c,r)}else if(t-=a,c=v(c,r,"0"),r+1>o){if(--t>0)for(c+=".";t--;c+="0");}else if((t+=r-o)>0)for(r+1==o&&(c+=".");t--;c+="0");return e.s<0&&i?"-"+c:c}function V(e,t){for(var s,n,i=1,r=new q(e[0]);i<e.length;i++)(!(n=new q(e[i])).s||(s=g(r,n))===t||0===s&&r.s===t)&&(r=n);return r}function G(e,t,s){for(var n=1,i=t.length;!t[--i];t.pop());for(i=t[0];i>=10;i/=10,n++);return(s=n+s*l-1)>L?e.c=e.e=null:s<D?e.c=[e.e=0]:(e.e=s,e.c=t),e}function z(e,t,s,n){var a,o,u,d,m,p,f,g=e.c,y=h;if(g){e:{for(a=1,d=g[0];d>=10;d/=10,a++);if((o=t-a)<0)o+=l,u=t,m=g[p=0],f=r(m/y[a-u-1]%10);else if((p=i((o+1)/l))>=g.length){if(!n)break e;for(;g.length<=p;g.push(0));m=f=0,a=1,u=(o%=l)-l+1}else{for(m=d=g[p],a=1;d>=10;d/=10,a++);f=(u=(o%=l)-l+a)<0?0:r(m/y[a-u-1]%10)}if(n=n||t<0||null!=g[p+1]||(u<0?m:m%y[a-u-1]),n=s<4?(f||n)&&(0==s||s==(e.s<0?3:2)):f>5||5==f&&(4==s||n||6==s&&(o>0?u>0?m/y[a-u]:0:g[p-1])%10&1||s==(e.s<0?8:7)),t<1||!g[0])return g.length=0,n?(t-=e.e+1,g[0]=y[(l-t%l)%l],e.e=-t||0):g[0]=e.e=0,e;if(0==o?(g.length=p,d=1,p--):(g.length=p+1,d=y[l-o],g[p]=u>0?r(m/y[a-u]%y[u])*d:0),n)for(;;){if(0==p){for(o=1,u=g[0];u>=10;u/=10,o++);for(u=g[0]+=d,d=1;u>=10;u/=10,d++);o!=d&&(e.e++,g[0]==c&&(g[0]=1));break}if(g[p]+=d,g[p]!=c)break;g[p--]=0,d=1}for(o=g.length;0===g[--o];g.pop());}e.e>L?e.c=e.e=null:e.e<D&&(e.c=[e.e=0])}return e}function J(e){var t,s=e.e;return null===s?e.toString():(t=f(e.c),t=s<=R||s>=x?S(t,s):v(t,s,"0"),e.s<0?"-"+t:t)}return q.clone=e,q.ROUND_UP=0,q.ROUND_DOWN=1,q.ROUND_CEIL=2,q.ROUND_FLOOR=3,q.ROUND_HALF_UP=4,q.ROUND_HALF_DOWN=5,q.ROUND_HALF_EVEN=6,q.ROUND_HALF_CEIL=7,q.ROUND_HALF_FLOOR=8,q.EUCLID=9,q.config=q.set=function(e){var t,s;if(null!=e){if("object"!=typeof e)throw Error(a+"Object expected: "+e);if(e.hasOwnProperty(t="DECIMAL_PLACES")&&(y(s=e[t],0,m,t),j=s),e.hasOwnProperty(t="ROUNDING_MODE")&&(y(s=e[t],0,8,t),N=s),e.hasOwnProperty(t="EXPONENTIAL_AT")&&((s=e[t])&&s.pop?(y(s[0],-m,0,t),y(s[1],0,m,t),R=s[0],x=s[1]):(y(s,-m,m,t),R=-(x=s<0?-s:s))),e.hasOwnProperty(t="RANGE"))if((s=e[t])&&s.pop)y(s[0],-m,-1,t),y(s[1],1,m,t),D=s[0],L=s[1];else{if(y(s,-m,m,t),!s)throw Error(a+t+" cannot be zero: "+s);D=-(L=s<0?-s:s)}if(e.hasOwnProperty(t="CRYPTO")){if((s=e[t])!==!!s)throw Error(a+t+" not true or false: "+s);if(s){if("undefined"==typeof crypto||!crypto||!crypto.getRandomValues&&!crypto.randomBytes)throw F=!s,Error(a+"crypto unavailable");F=s}else F=s}if(e.hasOwnProperty(t="MODULO_MODE")&&(y(s=e[t],0,9,t),U=s),e.hasOwnProperty(t="POW_PRECISION")&&(y(s=e[t],0,m,t),H=s),e.hasOwnProperty(t="FORMAT")){if("object"!=typeof(s=e[t]))throw Error(a+t+" not an object: "+s);$=s}if(e.hasOwnProperty(t="ALPHABET")){if("string"!=typeof(s=e[t])||/^.?$|[+\-.\s]|(.).*\1/.test(s))throw Error(a+t+" invalid: "+s);W="0123456789"==s.slice(0,10),B=s}}return{DECIMAL_PLACES:j,ROUNDING_MODE:N,EXPONENTIAL_AT:[R,x],RANGE:[D,L],CRYPTO:F,MODULO_MODE:U,POW_PRECISION:H,FORMAT:$,ALPHABET:B}},q.isBigNumber=function(e){if(!e||!0!==e._isBigNumber)return!1;if(!q.DEBUG)return!0;var t,s,n=e.c,i=e.e,o=e.s;e:if("[object Array]"=={}.toString.call(n)){if((1===o||-1===o)&&i>=-m&&i<=m&&i===r(i)){if(0===n[0]){if(0===i&&1===n.length)return!0;break e}if((t=(i+1)%l)<1&&(t+=l),String(n[0]).length==t){for(t=0;t<n.length;t++)if((s=n[t])<0||s>=c||s!==r(s))break e;if(0!==s)return!0}}}else if(null===n&&null===i&&(null===o||1===o||-1===o))return!0;throw Error(a+"Invalid BigNumber: "+e)},q.maximum=q.max=function(){return V(arguments,-1)},q.minimum=q.min=function(){return V(arguments,1)},q.random=(_=9007199254740992,T=Math.random()*_&2097151?function(){return r(Math.random()*_)}:function(){return 8388608*(1073741824*Math.random()|0)+(8388608*Math.random()|0)},function(e){var t,s,n,o,c,u=0,d=[],p=new q(M);if(null==e?e=j:y(e,0,m),o=i(e/l),F)if(crypto.getRandomValues){for(t=crypto.getRandomValues(new Uint32Array(o*=2));u<o;)(c=131072*t[u]+(t[u+1]>>>11))>=9e15?(s=crypto.getRandomValues(new Uint32Array(2)),t[u]=s[0],t[u+1]=s[1]):(d.push(c%1e14),u+=2);u=o/2}else{if(!crypto.randomBytes)throw F=!1,Error(a+"crypto unavailable");for(t=crypto.randomBytes(o*=7);u<o;)(c=281474976710656*(31&t[u])+1099511627776*t[u+1]+4294967296*t[u+2]+16777216*t[u+3]+(t[u+4]<<16)+(t[u+5]<<8)+t[u+6])>=9e15?crypto.randomBytes(7).copy(t,u):(d.push(c%1e14),u+=7);u=o/7}if(!F)for(;u<o;)(c=T())<9e15&&(d[u++]=c%1e14);for(o=d[--u],e%=l,o&&e&&(c=h[l-e],d[u]=r(o/c)*c);0===d[u];d.pop(),u--);if(u<0)d=[n=0];else{for(n=-1;0===d[0];d.splice(0,1),n-=l);for(u=1,c=d[0];c>=10;c/=10,u++);u<l&&(n-=l-u)}return p.e=n,p.c=d,p}),q.sum=function(){for(var e=1,t=arguments,s=new q(t[0]);e<t.length;)s=s.plus(t[e++]);return s},b=function(){var e="0123456789";function t(e,t,s,n){for(var i,r,a=[0],o=0,c=e.length;o<c;){for(r=a.length;r--;a[r]*=t);for(a[0]+=n.indexOf(e.charAt(o++)),i=0;i<a.length;i++)a[i]>s-1&&(null==a[i+1]&&(a[i+1]=0),a[i+1]+=a[i]/s|0,a[i]%=s)}return a.reverse()}return function(n,i,r,a,o){var c,l,u,h,d,m,p,g,y=n.indexOf("."),w=j,S=N;for(y>=0&&(h=H,H=0,n=n.replace(".",""),m=(g=new q(i)).pow(n.length-y),H=h,g.c=t(v(f(m.c),m.e,"0"),10,r,e),g.e=g.c.length),u=h=(p=t(n,i,r,o?(c=B,e):(c=e,B))).length;0==p[--h];p.pop());if(!p[0])return c.charAt(0);if(y<0?--u:(m.c=p,m.e=u,m.s=a,p=(m=s(m,g,w,S,r)).c,d=m.r,u=m.e),y=p[l=u+w+1],h=r/2,d=d||l<0||null!=p[l+1],d=S<4?(null!=y||d)&&(0==S||S==(m.s<0?3:2)):y>h||y==h&&(4==S||d||6==S&&1&p[l-1]||S==(m.s<0?8:7)),l<1||!p[0])n=d?v(c.charAt(1),-w,c.charAt(0)):c.charAt(0);else{if(p.length=l,d)for(--r;++p[--l]>r;)p[l]=0,l||(++u,p=[1].concat(p));for(h=p.length;!p[--h];);for(y=0,n="";y<=h;n+=c.charAt(p[y++]));n=v(n,u,c.charAt(0))}return n}}(),s=function(){function e(e,t,s){var n,i,r,a,o=0,c=e.length,l=t%d,u=t/d|0;for(e=e.slice();c--;)o=((i=l*(r=e[c]%d)+(n=u*r+(a=e[c]/d|0)*l)%d*d+o)/s|0)+(n/d|0)+u*a,e[c]=i%s;return o&&(e=[o].concat(e)),e}function t(e,t,s,n){var i,r;if(s!=n)r=s>n?1:-1;else for(i=r=0;i<s;i++)if(e[i]!=t[i]){r=e[i]>t[i]?1:-1;break}return r}function s(e,t,s,n){for(var i=0;s--;)e[s]-=i,i=e[s]<t[s]?1:0,e[s]=i*n+e[s]-t[s];for(;!e[0]&&e.length>1;e.splice(0,1));}return function(n,i,a,o,u){var h,d,m,f,g,y,w,S,v,b,k,_,T,E,P,C,O,A=n.s==i.s?1:-1,I=n.c,M=i.c;if(!(I&&I[0]&&M&&M[0]))return new q(n.s&&i.s&&(I?!M||I[0]!=M[0]:M)?I&&0==I[0]||!M?0*A:A/0:NaN);for(v=(S=new q(A)).c=[],A=a+(d=n.e-i.e)+1,u||(u=c,d=p(n.e/l)-p(i.e/l),A=A/l|0),m=0;M[m]==(I[m]||0);m++);if(M[m]>(I[m]||0)&&d--,A<0)v.push(1),f=!0;else{for(E=I.length,C=M.length,m=0,A+=2,(g=r(u/(M[0]+1)))>1&&(M=e(M,g,u),I=e(I,g,u),C=M.length,E=I.length),T=C,k=(b=I.slice(0,C)).length;k<C;b[k++]=0);O=M.slice(),O=[0].concat(O),P=M[0],M[1]>=u/2&&P++;do{if(g=0,(h=t(M,b,C,k))<0){if(_=b[0],C!=k&&(_=_*u+(b[1]||0)),(g=r(_/P))>1)for(g>=u&&(g=u-1),w=(y=e(M,g,u)).length,k=b.length;1==t(y,b,w,k);)g--,s(y,C<w?O:M,w,u),w=y.length,h=1;else 0==g&&(h=g=1),w=(y=M.slice()).length;if(w<k&&(y=[0].concat(y)),s(b,y,k,u),k=b.length,-1==h)for(;t(M,b,C,k)<1;)g++,s(b,C<k?O:M,k,u),k=b.length}else 0===h&&(g++,b=[0]);v[m++]=g,b[0]?b[k++]=I[T]||0:(b=[I[T]],k=1)}while((T++<E||null!=b[0])&&A--);f=null!=b[0],v[0]||v.splice(0,1)}if(u==c){for(m=1,A=v[0];A>=10;A/=10,m++);z(S,a+(S.e=m+d*l-1)+1,o,f)}else S.e=d,S.r=+f;return S}}(),E=/^(-?)0([xbo])(?=\w[\w.]*$)/i,P=/^([^.]+)\.$/,C=/^\.([^.]+)$/,O=/^-?(Infinity|NaN)$/,A=/^\s*\+(?=[\w.])|^\s+|\s+$/g,k=function(e,t,s,n){var i,r=s?t:t.replace(A,"");if(O.test(r))e.s=isNaN(r)?null:r<0?-1:1;else{if(!s&&(r=r.replace(E,function(e,t,s){return i="x"==(s=s.toLowerCase())?16:"b"==s?2:8,n&&n!=i?e:t}),n&&(i=n,r=r.replace(P,"$1").replace(C,"0.$1")),t!=r))return new q(r,i);if(q.DEBUG)throw Error(a+"Not a"+(n?" base "+n:"")+" number: "+t);e.s=null}e.c=e.e=null},I.absoluteValue=I.abs=function(){var e=new q(this);return e.s<0&&(e.s=1),e},I.comparedTo=function(e,t){return g(this,new q(e,t))},I.decimalPlaces=I.dp=function(e,t){var s,n,i,r=this;if(null!=e)return y(e,0,m),null==t?t=N:y(t,0,8),z(new q(r),e+r.e+1,t);if(!(s=r.c))return null;if(n=((i=s.length-1)-p(this.e/l))*l,i=s[i])for(;i%10==0;i/=10,n--);return n<0&&(n=0),n},I.dividedBy=I.div=function(e,t){return s(this,new q(e,t),j,N)},I.dividedToIntegerBy=I.idiv=function(e,t){return s(this,new q(e,t),0,1)},I.exponentiatedBy=I.pow=function(e,t){var s,n,o,c,u,h,d,m,p=this;if((e=new q(e)).c&&!e.isInteger())throw Error(a+"Exponent not an integer: "+J(e));if(null!=t&&(t=new q(t)),u=e.e>14,!p.c||!p.c[0]||1==p.c[0]&&!p.e&&1==p.c.length||!e.c||!e.c[0])return m=new q(Math.pow(+J(p),u?e.s*(2-w(e)):+J(e))),t?m.mod(t):m;if(h=e.s<0,t){if(t.c?!t.c[0]:!t.s)return new q(NaN);(n=!h&&p.isInteger()&&t.isInteger())&&(p=p.mod(t))}else{if(e.e>9&&(p.e>0||p.e<-1||(0==p.e?p.c[0]>1||u&&p.c[1]>=24e7:p.c[0]<8e13||u&&p.c[0]<=9999975e7)))return c=p.s<0&&w(e)?-0:0,p.e>-1&&(c=1/c),new q(h?1/c:c);H&&(c=i(H/l+2))}for(u?(s=new q(.5),h&&(e.s=1),d=w(e)):d=(o=Math.abs(+J(e)))%2,m=new q(M);;){if(d){if(!(m=m.times(p)).c)break;c?m.c.length>c&&(m.c.length=c):n&&(m=m.mod(t))}if(o){if(0===(o=r(o/2)))break;d=o%2}else if(z(e=e.times(s),e.e+1,1),e.e>14)d=w(e);else{if(0===(o=+J(e)))break;d=o%2}p=p.times(p),c?p.c&&p.c.length>c&&(p.c.length=c):n&&(p=p.mod(t))}return n?m:(h&&(m=M.div(m)),t?m.mod(t):c?z(m,H,N,undefined):m)},I.integerValue=function(e){var t=new q(this);return null==e?e=N:y(e,0,8),z(t,t.e+1,e)},I.isEqualTo=I.eq=function(e,t){return 0===g(this,new q(e,t))},I.isFinite=function(){return!!this.c},I.isGreaterThan=I.gt=function(e,t){return g(this,new q(e,t))>0},I.isGreaterThanOrEqualTo=I.gte=function(e,t){return 1===(t=g(this,new q(e,t)))||0===t},I.isInteger=function(){return!!this.c&&p(this.e/l)>this.c.length-2},I.isLessThan=I.lt=function(e,t){return g(this,new q(e,t))<0},I.isLessThanOrEqualTo=I.lte=function(e,t){return-1===(t=g(this,new q(e,t)))||0===t},I.isNaN=function(){return!this.s},I.isNegative=function(){return this.s<0},I.isPositive=function(){return this.s>0},I.isZero=function(){return!!this.c&&0==this.c[0]},I.minus=function(e,t){var s,n,i,r,a=this,o=a.s;if(t=(e=new q(e,t)).s,!o||!t)return new q(NaN);if(o!=t)return e.s=-t,a.plus(e);var u=a.e/l,h=e.e/l,d=a.c,m=e.c;if(!u||!h){if(!d||!m)return d?(e.s=-t,e):new q(m?a:NaN);if(!d[0]||!m[0])return m[0]?(e.s=-t,e):new q(d[0]?a:3==N?-0:0)}if(u=p(u),h=p(h),d=d.slice(),o=u-h){for((r=o<0)?(o=-o,i=d):(h=u,i=m),i.reverse(),t=o;t--;i.push(0));i.reverse()}else for(n=(r=(o=d.length)<(t=m.length))?o:t,o=t=0;t<n;t++)if(d[t]!=m[t]){r=d[t]<m[t];break}if(r&&(i=d,d=m,m=i,e.s=-e.s),(t=(n=m.length)-(s=d.length))>0)for(;t--;d[s++]=0);for(t=c-1;n>o;){if(d[--n]<m[n]){for(s=n;s&&!d[--s];d[s]=t);--d[s],d[n]+=c}d[n]-=m[n]}for(;0==d[0];d.splice(0,1),--h);return d[0]?G(e,d,h):(e.s=3==N?-1:1,e.c=[e.e=0],e)},I.modulo=I.mod=function(e,t){var n,i,r=this;return e=new q(e,t),!r.c||!e.s||e.c&&!e.c[0]?new q(NaN):!e.c||r.c&&!r.c[0]?new q(r):(9==U?(i=e.s,e.s=1,n=s(r,e,0,3),e.s=i,n.s*=i):n=s(r,e,0,U),(e=r.minus(n.times(e))).c[0]||1!=U||(e.s=r.s),e)},I.multipliedBy=I.times=function(e,t){var s,n,i,r,a,o,u,h,m,f,g,y,w,S,v,b=this,k=b.c,_=(e=new q(e,t)).c;if(!(k&&_&&k[0]&&_[0]))return!b.s||!e.s||k&&!k[0]&&!_||_&&!_[0]&&!k?e.c=e.e=e.s=null:(e.s*=b.s,k&&_?(e.c=[0],e.e=0):e.c=e.e=null),e;for(n=p(b.e/l)+p(e.e/l),e.s*=b.s,(u=k.length)<(f=_.length)&&(w=k,k=_,_=w,i=u,u=f,f=i),i=u+f,w=[];i--;w.push(0));for(S=c,v=d,i=f;--i>=0;){for(s=0,g=_[i]%v,y=_[i]/v|0,r=i+(a=u);r>i;)s=((h=g*(h=k[--a]%v)+(o=y*h+(m=k[a]/v|0)*g)%v*v+w[r]+s)/S|0)+(o/v|0)+y*m,w[r--]=h%S;w[r]=s}return s?++n:w.splice(0,1),G(e,w,n)},I.negated=function(){var e=new q(this);return e.s=-e.s||null,e},I.plus=function(e,t){var s,n=this,i=n.s;if(t=(e=new q(e,t)).s,!i||!t)return new q(NaN);if(i!=t)return e.s=-t,n.minus(e);var r=n.e/l,a=e.e/l,o=n.c,u=e.c;if(!r||!a){if(!o||!u)return new q(i/0);if(!o[0]||!u[0])return u[0]?e:new q(o[0]?n:0*i)}if(r=p(r),a=p(a),o=o.slice(),i=r-a){for(i>0?(a=r,s=u):(i=-i,s=o),s.reverse();i--;s.push(0));s.reverse()}for((i=o.length)-(t=u.length)<0&&(s=u,u=o,o=s,t=i),i=0;t;)i=(o[--t]=o[t]+u[t]+i)/c|0,o[t]=c===o[t]?0:o[t]%c;return i&&(o=[i].concat(o),++a),G(e,o,a)},I.precision=I.sd=function(e,t){var s,n,i,r=this;if(null!=e&&e!==!!e)return y(e,1,m),null==t?t=N:y(t,0,8),z(new q(r),e,t);if(!(s=r.c))return null;if(n=(i=s.length-1)*l+1,i=s[i]){for(;i%10==0;i/=10,n--);for(i=s[0];i>=10;i/=10,n++);}return e&&r.e+1>n&&(n=r.e+1),n},I.shiftedBy=function(e){return y(e,-9007199254740991,u),this.times("1e"+e)},I.squareRoot=I.sqrt=function(){var e,t,n,i,r,a=this,o=a.c,c=a.s,l=a.e,u=j+4,h=new q("0.5");if(1!==c||!o||!o[0])return new q(!c||c<0&&(!o||o[0])?NaN:o?a:1/0);if(0==(c=Math.sqrt(+J(a)))||c==1/0?(((t=f(o)).length+l)%2==0&&(t+="0"),c=Math.sqrt(+t),l=p((l+1)/2)-(l<0||l%2),n=new q(t=c==1/0?"5e"+l:(t=c.toExponential()).slice(0,t.indexOf("e")+1)+l)):n=new q(c+""),n.c[0])for((c=(l=n.e)+u)<3&&(c=0);;)if(r=n,n=h.times(r.plus(s(a,r,u,1))),f(r.c).slice(0,c)===(t=f(n.c)).slice(0,c)){if(n.e<l&&--c,"9999"!=(t=t.slice(c-3,c+1))&&(i||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(z(n,n.e+j+2,1),e=!n.times(n).eq(a));break}if(!i&&(z(r,r.e+j+2,0),r.times(r).eq(a))){n=r;break}u+=4,c+=4,i=1}return z(n,n.e+j+1,N,e)},I.toExponential=function(e,t){return null!=e&&(y(e,0,m),e++),K(this,e,t,1)},I.toFixed=function(e,t){return null!=e&&(y(e,0,m),e=e+this.e+1),K(this,e,t)},I.toFormat=function(e,t,s){var n,i=this;if(null==s)null!=e&&t&&"object"==typeof t?(s=t,t=null):e&&"object"==typeof e?(s=e,e=t=null):s=$;else if("object"!=typeof s)throw Error(a+"Argument not an object: "+s);if(n=i.toFixed(e,t),i.c){var r,o=n.split("."),c=+s.groupSize,l=+s.secondaryGroupSize,u=s.groupSeparator||"",h=o[0],d=o[1],m=i.s<0,p=m?h.slice(1):h,f=p.length;if(l&&(r=c,c=l,l=r,f-=r),c>0&&f>0){for(r=f%c||c,h=p.substr(0,r);r<f;r+=c)h+=u+p.substr(r,c);l>0&&(h+=u+p.slice(r)),m&&(h="-"+h)}n=d?h+(s.decimalSeparator||"")+((l=+s.fractionGroupSize)?d.replace(new RegExp("\\d{"+l+"}\\B","g"),"$&"+(s.fractionGroupSeparator||"")):d):h}return(s.prefix||"")+n+(s.suffix||"")},I.toFraction=function(e){var t,n,i,r,o,c,u,d,m,p,g,y,w=this,S=w.c;if(null!=e&&(!(u=new q(e)).isInteger()&&(u.c||1!==u.s)||u.lt(M)))throw Error(a+"Argument "+(u.isInteger()?"out of range: ":"not an integer: ")+J(u));if(!S)return new q(w);for(t=new q(M),m=n=new q(M),i=d=new q(M),y=f(S),o=t.e=y.length-w.e-1,t.c[0]=h[(c=o%l)<0?l+c:c],e=!e||u.comparedTo(t)>0?o>0?t:m:u,c=L,L=1/0,u=new q(y),d.c[0]=0;p=s(u,t,0,1),1!=(r=n.plus(p.times(i))).comparedTo(e);)n=i,i=r,m=d.plus(p.times(r=m)),d=r,t=u.minus(p.times(r=t)),u=r;return r=s(e.minus(n),i,0,1),d=d.plus(r.times(m)),n=n.plus(r.times(i)),d.s=m.s=w.s,g=s(m,i,o*=2,N).minus(w).abs().comparedTo(s(d,n,o,N).minus(w).abs())<1?[m,i]:[d,n],L=c,g},I.toNumber=function(){return+J(this)},I.toPrecision=function(e,t){return null!=e&&y(e,1,m),K(this,e,t,2)},I.toString=function(e){var t,s=this,n=s.s,i=s.e;return null===i?n?(t="Infinity",n<0&&(t="-"+t)):t="NaN":(null==e?t=i<=R||i>=x?S(f(s.c),i):v(f(s.c),i,"0"):10===e&&W?t=v(f((s=z(new q(s),j+i+1,N)).c),s.e,"0"):(y(e,2,B.length,"Base"),t=b(v(f(s.c),i,"0"),10,e,n,!0)),n<0&&s.c[0]&&(t="-"+t)),t},I.valueOf=I.toJSON=function(){return J(this)},I._isBigNumber=!0,null!=t&&q.set(t),q}(),s.default=s.BigNumber=s,"function"==typeof define&&define.amd?define(function(){return s}):void 0!==t&&t.exports?t.exports=s:(e||(e="undefined"!=typeof self&&self?self:window),e.BigNumber=s)}(this)}}},{package:"@metamask/smart-transactions-controller>bignumber.js",file:"node_modules/@metamask/smart-transactions-controller/node_modules/bignumber.js/bignumber.js"}],[2003,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){t.exports={name:"@metamask/smart-transactions-controller",version:"17.0.0",description:"Improves success rates for swaps by trialing transactions privately and finding minimum fees",repository:{type:"git",url:"https://github.com/MetaMask/smart-transactions-controller.git"},license:"SEE LICENSE IN LICENSE",main:"dist/index.js",types:"dist/index.d.ts",files:["dist/"],scripts:{build:"tsc --project tsconfig.build.json","build:clean":"rm -rf dist && yarn build","build:link":"yarn build && cd dist && yarn link && rm -rf node_modules && cd ..",lint:"yarn lint:eslint && yarn lint:misc --check && yarn lint:changelog","lint:changelog":"auto-changelog validate --prettier","lint:eslint":"eslint . --cache --ext js,ts","lint:fix":"yarn lint:eslint --fix && yarn lint:misc --write && yarn lint:changelog","lint:misc":"prettier '**/*.json' '**/*.md' '**/*.yml' '!.yarnrc.yml' --ignore-path .gitignore --no-error-on-unmatched-pattern",prepack:"./scripts/prepack.sh",test:"jest","test:watch":"jest --watchAll"},dependencies:{"@babel/runtime":"^7.24.1","@ethereumjs/tx":"^5.2.1","@ethereumjs/util":"^9.0.2","@ethersproject/bytes":"^5.7.0","@ethersproject/keccak256":"^5.8.0","@ethersproject/transactions":"^5.7.0","@metamask/base-controller":"^7.0.1","@metamask/controller-utils":"^11.0.0","@metamask/eth-json-rpc-provider":"^4.1.6","@metamask/eth-query":"^4.0.0","@metamask/polling-controller":"^12.0.0","bignumber.js":"^9.0.1","fast-json-patch":"^3.1.0",lodash:"^4.17.21"},devDependencies:{"@lavamoat/allow-scripts":"^3.2.1","@lavamoat/preinstall-always-fail":"^2.1.0","@metamask/auto-changelog":"^3.1.0","@metamask/eslint-config":"^12.2.0","@metamask/eslint-config-jest":"^12.1.0","@metamask/eslint-config-nodejs":"^12.1.0","@metamask/eslint-config-typescript":"^12.1.0","@metamask/gas-fee-controller":"^22.0.0","@metamask/json-rpc-engine":"^10.0.1","@metamask/network-controller":"^24.0.0","@metamask/transaction-controller":"^42.0.0","@types/jest":"^26.0.24","@types/lodash":"^4.14.194","@types/node":"^18.19.17","@types/sinon":"^9.0.10","@typescript-eslint/eslint-plugin":"^5.33.0","@typescript-eslint/parser":"^5.33.0",eslint:"^8.48.0","eslint-config-prettier":"^8.8.0","eslint-plugin-import":"~2.26.0","eslint-plugin-jest":"^27.1.5","eslint-plugin-jsdoc":"^39.2.9","eslint-plugin-n":"^15.7.0","eslint-plugin-prettier":"^4.2.1","eslint-plugin-promise":"^6.1.1","isomorphic-fetch":"^3.0.0",jest:"^29.7.0",nock:"^14.0.0-beta.7",prettier:"^2.8.8","prettier-plugin-packagejson":"^2.4.3",sinon:"^9.2.4","ts-jest":"^29.1.4",typescript:"~4.8.4"},peerDependencies:{"@metamask/network-controller":"^24.0.0","@metamask/transaction-controller":"^42.0.0"},peerDependenciesMeta:{"@metamask/accounts-controller":{optional:!0},"@metamask/approval-controller":{optional:!0}},packageManager:"yarn@3.2.1",engines:{node:"^18.18 || >=20"},publishConfig:{access:"public",registry:"https://registry.npmjs.org/"},lavamoat:{allowScripts:{"@lavamoat/preinstall-always-fail":!1,"@metamask/controller-utils>ethereumjs-util>ethereum-cryptography>keccak":!1,"@metamask/controller-utils>ethereumjs-util>ethereum-cryptography>secp256k1":!1,"@metamask/controller-utils>babel-runtime>core-js":!1,"@metamask/transaction-controller>@metamask/accounts-controller>@metamask/keyring-controller>ethereumjs-wallet>ethereum-cryptography>keccak":!1,"@metamask/transaction-controller>@metamask/accounts-controller>@metamask/keyring-controller>ethereumjs-wallet>ethereum-cryptography>secp256k1":!1}}}}}},{package:"@metamask/smart-transactions-controller",file:"node_modules/@metamask/smart-transactions-controller/package.json"}],[2004,{"../snaps/Timer.cjs":2026,"../snaps/constants.cjs":2027,"./utils.cjs":2006,"@metamask/base-controller":1241,"@metamask/snaps-rpc-methods":2072,"@metamask/snaps-utils":2242,"@metamask/utils":2359,immer:3881,luxon:4097,nanoid:4196},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){function n(e,t,s){i(e,t),t.set(e,s)}function i(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function r(e,t){return e.get(o(e,t))}function a(e,t,s){return e.set(o(e,t),s),s}function o(e,t,s){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:s;throw new TypeError("Private element is not present on this object")}Object.defineProperty(s,"__esModule",{value:!0}),s.CronjobController=s.DAILY_TIMEOUT=void 0;const c=e("@metamask/base-controller"),l=e("@metamask/snaps-rpc-methods"),u=e("@metamask/snaps-utils"),h=e("@metamask/utils"),d=e("immer"),m=e("luxon"),p=e("nanoid"),f=e("./utils.cjs"),g=e("../snaps/constants.cjs"),y=e("../snaps/Timer.cjs");s.DAILY_TIMEOUT=(0,h.inMilliseconds)(24,h.Duration.Hour);const w="CronjobController";var S=new WeakMap,v=new WeakMap,b=new WeakMap,k=new WeakSet,_=new WeakMap,T=new WeakMap,E=new WeakMap,P=new WeakMap,C=new WeakMap;class O extends c.BaseController{constructor({messenger:e,state:t,stateManager:c}){var l,u;super({messenger:e,metadata:{events:{persist:!1,anonymous:!1}},name:w,state:{events:{},...t,...c.getInitialState()}}),i(l=this,u=k),u.add(l),n(this,S,void 0),n(this,v,void 0),n(this,b,new y.Timer(s.DAILY_TIMEOUT)),n(this,_,e=>{this.unregister(e.id),this.register(e.id)}),n(this,T,e=>{const t=this.get(e.id);o(k,this,D).call(this,t),this.register(e.id)}),n(this,E,e=>{this.unregister(e.id)}),n(this,P,e=>{this.unregister(e.id)}),n(this,C,e=>{this.unregister(e.id),this.register(e.id)}),a(S,this,new Map),a(v,this,c),this.messagingSystem.subscribe("SnapController:snapInstalled",r(_,this)),this.messagingSystem.subscribe("SnapController:snapUninstalled",r(E,this)),this.messagingSystem.subscribe("SnapController:snapEnabled",r(T,this)),this.messagingSystem.subscribe("SnapController:snapDisabled",r(P,this)),this.messagingSystem.subscribe("SnapController:snapUpdated",r(C,this)),this.messagingSystem.registerActionHandler(`${w}:init`,(...e)=>this.init(...e)),this.messagingSystem.registerActionHandler(`${w}:schedule`,(...e)=>this.schedule(...e)),this.messagingSystem.registerActionHandler(`${w}:cancel`,(...e)=>this.cancel(...e)),this.messagingSystem.registerActionHandler(`${w}:get`,(...e)=>this.get(...e))}init(){o(k,this,A).call(this),o(k,this,L).call(this),o(k,this,D).call(this)}schedule(e){return o(k,this,I).call(this,{...e,recurring:!1})}cancel(e,t){(0,h.assert)(this.state.events[t],`A background event with the id of "${t}" does not exist.`),(0,h.assert)(this.state.events[t].snapId===e,"Only the origin that scheduled this event can cancel it."),o(k,this,R).call(this,t)}get(e){return Object.values(this.state.events).filter(t=>t.snapId===e&&!t.recurring).map(e=>({...e,date:(0,u.toCensoredISO8601String)(e.date),scheduledAt:(0,u.toCensoredISO8601String)(e.scheduledAt)}))}register(e){const t=o(k,this,x).call(this,e);null==t||t.forEach(e=>o(k,this,I).call(this,e))}unregister(e){for(const[t,s]of Object.entries(this.state.events))s.snapId===e&&o(k,this,R).call(this,t)}destroy(){super.destroy(),this.messagingSystem.unsubscribe("SnapController:snapInstalled",r(_,this)),this.messagingSystem.unsubscribe("SnapController:snapUninstalled",r(E,this)),this.messagingSystem.unsubscribe("SnapController:snapEnabled",r(T,this)),this.messagingSystem.unsubscribe("SnapController:snapDisabled",r(P,this)),this.messagingSystem.unsubscribe("SnapController:snapUpdated",r(C,this)),r(S,this).forEach(e=>e.cancel()),r(S,this).clear(),"running"===r(b,this).status&&r(b,this).cancel()}}function A(){a(b,this,new y.Timer(s.DAILY_TIMEOUT)),r(b,this).start(()=>{o(k,this,D).call(this),o(k,this,A).call(this)})}function I(e){const t=e.id??(0,p.nanoid)(),s={...e,id:t,date:(0,f.getExecutionDate)(e.schedule),scheduledAt:(new Date).toISOString()},{nextState:n}=this.update(e=>{e.events[s.id]=(0,d.castDraft)(s)});return r(v,this).set(n),o(k,this,M).call(this,s),t}function M(e){const t=(0,f.getExecutionDate)(e.schedule),{nextState:s}=this.update(s=>{s.events[e.id].date=t});r(v,this).set(s),o(k,this,j).call(this,{...e,date:t})}function j(e){const t=m.DateTime.fromISO(e.date,{setZone:!0}).toMillis()-Date.now();if(t>s.DAILY_TIMEOUT)return;if(t<=0)return void o(k,this,N).call(this,e);const n=new y.Timer(t);n.start(()=>{o(k,this,N).call(this,e)}),r(S,this).set(e.id,n)}function N(e){if(this.messagingSystem.call("SnapController:handleRequest",{snapId:e.snapId,origin:g.METAMASK_ORIGIN,handler:u.HandlerType.OnCronjob,request:e.request}).catch(t=>{(0,u.logError)(`An error occurred while executing an event for Snap "${e.snapId}":`,t)}),r(S,this).delete(e.id),!e.recurring){const{nextState:t}=this.update(t=>{delete t.events[e.id]});return void r(v,this).set(t)}o(k,this,M).call(this,e)}function R(e){const t=r(S,this).get(e);null==t||t.cancel(),r(S,this).delete(e);const{nextState:s}=this.update(t=>{delete t.events[e]});r(v,this).set(s)}function x(e){const t=this.messagingSystem.call("PermissionController:getPermissions",e),s=null==t?void 0:t[l.SnapEndowments.Cronjob],n=(0,l.getCronjobCaveatJobs)(s);return n?n.map((t,s)=>({snapId:e,id:`cronjob-${e}-${s}`,request:t.request,schedule:(0,f.getCronjobSpecificationSchedule)(t),recurring:!0})):[]}function D(e=Object.values(this.state.events)){const t=Date.now();for(const s of e){if(r(S,this).has(s.id))continue;const e=m.DateTime.fromISO(s.date,{setZone:!0}).toUTC().toMillis();s.recurring&&e<=t&&o(k,this,N).call(this,s),o(k,this,M).call(this,s)}}function L(){const e=Date.now();for(const t of Object.values(this.state.events)){const s=m.DateTime.fromISO(t.date,{setZone:!0}).toUTC().toMillis();!t.recurring&&s<e&&o(k,this,R).call(this,t.id)}}s.CronjobController=O}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/cronjob/CronjobController.cjs"}],[2005,{"./CronjobController.cjs":2004},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n=Object.create?function(e,t,s,n){n===undefined&&(n=s);var i=Object.getOwnPropertyDescriptor(t,s);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,n,i)}:function(e,t,s,n){n===undefined&&(n=s),e[n]=t[s]},i=function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||n(t,e,s)};Object.defineProperty(s,"__esModule",{value:!0}),i(e("./CronjobController.cjs"),s)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/cronjob/index.cjs"}],[2006,{"@metamask/utils":2359,"cron-parser":3422,luxon:4097},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.getExecutionDate=s.getCronjobSpecificationSchedule=void 0;const n=e("@metamask/utils"),i=e("cron-parser"),r=e("luxon");s.getCronjobSpecificationSchedule=function(e){return(0,n.hasProperty)(e,"duration")?e.duration:e.expression},s.getExecutionDate=function(e){const t=r.DateTime.fromISO(e,{setZone:!0});if(t.isValid){const e=Date.now(),s=t.toUTC().startOf("second");if(s.toMillis()<e)throw new Error("Cannot schedule an event in the past.");return s.toISO({suppressMilliseconds:!0})}const s=r.Duration.fromISO(e);if(s.isValid){const e=function(e){return e.as("seconds")<1?r.Duration.fromObject({seconds:1}):e}(s);return r.DateTime.now().toUTC().plus(e).toISO()}try{const t=(0,i.parseExpression)(e,{utc:!0}).next(),s=r.DateTime.fromJSDate(t.toDate());return(0,n.assert)(s.isValid),s.toUTC().toISO()}catch{throw new Error(`Unable to parse "${e}" as ISO 8601 date, ISO 8601 duration, or cron expression.`)}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/cronjob/utils.cjs"}],[2007,{"@metamask/utils":2359,"@xstate/fsm":2827},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.forceStrict=s.validateMachine=void 0;const n=e("@metamask/utils"),i=e("@xstate/fsm");s.validateMachine=function(e){(0,n.assert)("_options"in e,"The machine is not an @xstate/fsm machine");const t=e,s=new Set,i=e=>{return(t=e,Array.isArray(t)?t:t===undefined||null===t?[]:[t]).flatMap(e=>"string"==typeof e?[e]:((0,n.assert)("function"==typeof e),[])).forEach(s.add.bind(s));var t};for(const e of Object.values(t.config.states)){i(e.entry),i(e.exit);for(const t of Object.values(e.on??{}))i(t.actions)}s.forEach(e=>(0,n.assert)(t._options.actions!==undefined&&e in t._options.actions,`Action "${e}" doesn't have an implementation`))},s.forceStrict=function(e){let t=!1;e.subscribe(e=>{(0,n.assert)(!t||e.changed,"Invalid state transition"),t=!0});const s=e.send.bind(e);e.send=(...t)=>((0,n.assert)(e.status===i.InterpreterStatus.Running,"Interpreter is stopped"),s(...t))}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/fsm.cjs"}],[2008,{"./cronjob/index.cjs":2005,"./insights/index.cjs":2010,"./interface/index.cjs":2012,"./multichain/index.cjs":2016,"./services/index.cjs":2021,"./snaps/index.cjs":2028,"./utils.cjs":2038,"./websocket/index.cjs":2040},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n=Object.create?function(e,t,s,n){n===undefined&&(n=s);var i=Object.getOwnPropertyDescriptor(t,s);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,n,i)}:function(e,t,s,n){n===undefined&&(n=s),e[n]=t[s]},i=function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||n(t,e,s)};Object.defineProperty(s,"__esModule",{value:!0}),i(e("./services/index.cjs"),s),i(e("./snaps/index.cjs"),s),i(e("./utils.cjs"),s),i(e("./cronjob/index.cjs"),s),i(e("./interface/index.cjs"),s),i(e("./insights/index.cjs"),s),i(e("./multichain/index.cjs"),s),i(e("./websocket/index.cjs"),s)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/index.cjs"}],[2009,{"../snaps/index.cjs":2028,"@metamask/base-controller":1241,"@metamask/snaps-rpc-methods":2072,"@metamask/snaps-utils":2242,"@metamask/utils":2359},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){function n(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.add(e)}function i(e,t,s){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:s;throw new TypeError("Private element is not present on this object")}Object.defineProperty(s,"__esModule",{value:!0}),s.SnapInsightsController=void 0;const r=e("@metamask/base-controller"),a=e("@metamask/snaps-rpc-methods"),o=e("@metamask/snaps-utils"),c=e("@metamask/utils"),l=e("../snaps/index.cjs");var u=new WeakSet;class h extends r.BaseController{constructor({messenger:e,state:t}){super({messenger:e,metadata:{insights:{persist:!1,anonymous:!1}},name:"SnapInsightsController",state:{insights:{},...t}}),n(this,u),this.messagingSystem.subscribe("TransactionController:unapprovedTransactionAdded",i(u,this,p).bind(this)),this.messagingSystem.subscribe("TransactionController:transactionStatusUpdated",i(u,this,y).bind(this)),this.messagingSystem.subscribe("SignatureController:stateChange",i(u,this,f).bind(this))}}function d(e){return(0,c.hasProperty)(this.state.insights,e)}function m(e){const t=this.messagingSystem.call("SnapController:getAll");return(0,l.getRunnableSnaps)(t).reduce((t,s)=>{const n=this.messagingSystem.call("PermissionController:getPermissions",s.id);return n&&(0,c.hasProperty)(n,e)&&t.push({snapId:s.id,permission:n[e]}),t},[])}function p(e){const{id:t,txParams:s,chainId:n,origin:r}=e,l=`eip155:${(0,c.hexToBigInt)(n).toString(10)}`;i(u,this,m).call(this,a.SnapEndowments.TransactionInsight).forEach(({snapId:e,permission:n})=>{const c=(0,a.getTransactionOriginCaveat)(n)&&r?r:null;this.update(s=>{var n;(n=s.insights)[t]??(n[t]={}),s.insights[t][e]={snapId:e,loading:!0}}),i(u,this,S).call(this,{snapId:e,handler:o.HandlerType.OnTransaction,params:{transaction:s,chainId:l,transactionOrigin:c}}).then(s=>i(u,this,v).call(this,{id:t,snapId:e,response:s})).catch(s=>i(u,this,v).call(this,{id:t,snapId:e,error:s}))})}function f(e){for(const t of Object.keys(this.state.insights))(0,c.hasProperty)(e.unapprovedTypedMessages,t)||(0,c.hasProperty)(e.unapprovedPersonalMsgs,t)||i(u,this,w).call(this,t);if(e.unapprovedPersonalMsgCount>0||e.unapprovedTypedMessagesCount>0){const t=i(u,this,m).call(this,a.SnapEndowments.SignatureInsight);for(const s of Object.values(e.unapprovedPersonalMsgs))i(u,this,g).call(this,t,s);for(const s of Object.values(e.unapprovedTypedMessages))i(u,this,g).call(this,t,s)}}function g(e,t){const{id:s,msgParams:n}=t;if(i(u,this,d).call(this,s))return;const{from:r,data:c,signatureMethod:l,origin:h}=n,m={from:r,data:"eth_signTypedData_v3"===l||"eth_signTypedData_v4"===l?JSON.parse(c):c,signatureMethod:l};e.forEach(({snapId:e,permission:t})=>{const n=(0,a.getSignatureOriginCaveat)(t),r=h&&n?h:null;this.update(t=>{var n;(n=t.insights)[s]??(n[s]={}),t.insights[s][e]={snapId:e,loading:!0}}),i(u,this,S).call(this,{snapId:e,handler:o.HandlerType.OnSignature,params:{signature:m,signatureOrigin:r}}).then(t=>i(u,this,v).call(this,{id:s,snapId:e,response:t})).catch(t=>i(u,this,v).call(this,{id:s,snapId:e,error:t}))})}function y({transactionMeta:e}){"unapproved"!==e.status&&i(u,this,w).call(this,e.id)}function w(e){i(u,this,d).call(this,e)&&(Object.values(this.state.insights[e]).filter(e=>e.interfaceId).forEach(e=>{this.messagingSystem.call("SnapInterfaceController:deleteInterface",e.interfaceId)}),this.update(t=>{delete t.insights[e]}))}async function S({snapId:e,handler:t,params:s}){return this.messagingSystem.call("SnapController:handleRequest",{snapId:e,origin:"metamask",handler:t,request:{method:"",params:s}})}function v({id:e,snapId:t,response:s,error:n}){i(u,this,d).call(this,e)&&this.update(i=>{i.insights[e][t].loading=!1,i.insights[e][t].interfaceId=null==s?void 0:s.id,i.insights[e][t].severity=null==s?void 0:s.severity,i.insights[e][t].error=null==n?void 0:n.message})}s.SnapInsightsController=h}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/insights/SnapInsightsController.cjs"}],[2010,{"./SnapInsightsController.cjs":2009},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n=Object.create?function(e,t,s,n){n===undefined&&(n=s);var i=Object.getOwnPropertyDescriptor(t,s);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,n,i)}:function(e,t,s,n){n===undefined&&(n=s),e[n]=t[s]},i=function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||n(t,e,s)};Object.defineProperty(s,"__esModule",{value:!0}),i(e("./SnapInsightsController.cjs"),s)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/insights/index.cjs"}],[2011,{"./utils.cjs":2013,"@metamask/base-controller":1241,"@metamask/snaps-sdk":2128,"@metamask/snaps-utils":2242,"@metamask/utils":2359,immer:3881,nanoid:4196},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){function n(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.add(e)}function i(e,t,s){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:s;throw new TypeError("Private element is not present on this object")}Object.defineProperty(s,"__esModule",{value:!0}),s.SnapInterfaceController=void 0;const r=e("@metamask/base-controller"),a=e("@metamask/snaps-sdk"),o=e("@metamask/snaps-utils"),c=e("@metamask/utils"),l=e("immer"),u=e("nanoid"),h=e("./utils.cjs"),d=1e7,m="SnapInterfaceController";var p=new WeakSet;class f extends r.BaseController{constructor({messenger:e,state:t}){super({messenger:e,metadata:{interfaces:{persist:e=>Object.entries(e).reduce((e,[t,s])=>s.contentType===a.ContentType.Notification?(e[t]=s,e):e,{}),anonymous:!1}},name:m,state:{interfaces:{},...t}}),n(this,p),this.messagingSystem.subscribe("NotificationServicesController:notificationsListUpdated",i(p,this,O).bind(this)),i(p,this,g).call(this)}async createInterface(e,t,s,n){const r=(0,h.getJsxInterface)(t);await i(p,this,C).call(this,r),(0,h.validateInterfaceContext)(s);const a=(0,u.nanoid)(),c=(0,h.constructState)({},r,{getAssetsState:i(p,this,E).bind(this),getAccountByAddress:i(p,this,T).bind(this),getSelectedAccount:i(p,this,k).bind(this),listAccounts:i(p,this,_).bind(this),snapOwnsAccount:t=>(0,o.snapOwnsAccount)(e,t)});return this.update(t=>{t.interfaces[a]={snapId:e,content:(0,l.castDraft)(r),state:c,context:s??null,contentType:n??null}}),a}getInterface(e,t){return i(p,this,y).call(this,e,t),this.state.interfaces[t]}async updateInterface(e,t,s,n){i(p,this,y).call(this,e,t);const r=(0,h.getJsxInterface)(s);await i(p,this,C).call(this,r),(0,h.validateInterfaceContext)(n);const a=this.state.interfaces[t].state,c=(0,h.constructState)(a,r,{getAssetsState:i(p,this,E).bind(this),getAccountByAddress:i(p,this,T).bind(this),getSelectedAccount:i(p,this,k).bind(this),listAccounts:i(p,this,_).bind(this),snapOwnsAccount:t=>(0,o.snapOwnsAccount)(e,t)});this.update(e=>{e.interfaces[t].state=c,e.interfaces[t].content=(0,l.castDraft)(r),n&&(e.interfaces[t].context=n)})}deleteInterface(e){this.update(t=>{delete t.interfaces[e]})}updateInterfaceState(e,t){this.update(s=>{s.interfaces[e].state=t})}async resolveInterface(e,t,s){i(p,this,y).call(this,e,t),i(p,this,w).call(this,t),await i(p,this,b).call(this,t,s),this.deleteInterface(t)}}function g(){this.messagingSystem.registerActionHandler(`${m}:createInterface`,this.createInterface.bind(this)),this.messagingSystem.registerActionHandler(`${m}:getInterface`,this.getInterface.bind(this)),this.messagingSystem.registerActionHandler(`${m}:updateInterface`,this.updateInterface.bind(this)),this.messagingSystem.registerActionHandler(`${m}:deleteInterface`,this.deleteInterface.bind(this)),this.messagingSystem.registerActionHandler(`${m}:updateInterfaceState`,this.updateInterfaceState.bind(this)),this.messagingSystem.registerActionHandler(`${m}:resolveInterface`,this.resolveInterface.bind(this))}function y(e,t){const s=this.state.interfaces[t];(0,c.assert)(s!==undefined,`Interface with id '${t}' not found.`),(0,c.assert)(s.snapId===e,`Interface not created by ${e}.`)}function w(e){(0,c.assert)(i(p,this,v).call(this,e),`Approval request with id '${e}' not found.`)}function S(e){return this.messagingSystem.call("PhishingController:testOrigin",e).result}function v(e){return this.messagingSystem.call("ApprovalController:hasRequest",{id:e})}async function b(e,t){await this.messagingSystem.call("ApprovalController:acceptRequest",e,t)}function k(){return this.messagingSystem.call("AccountsController:getSelectedMultichainAccount")}function _(e){const t=this.messagingSystem.call("AccountsController:listMultichainAccounts");return e&&0!==e.length?t.filter(t=>t.scopes.some(t=>(0,h.isMatchingChainId)(t,e))):t}function T(e){const{address:t}=(0,c.parseCaipAccountId)(e);return this.messagingSystem.call("AccountsController:getAccountByAddress",t)}function E(){return this.messagingSystem.call("MultichainAssetsController:getState")}function P(e){return this.messagingSystem.call("SnapController:get",e)}async function C(e){const t=(0,o.getJsonSizeUnsafe)(e);(0,c.assert)(t<=d,"A Snap UI may not be larger than 10 MB."),(0,o.validateJsxElements)(e,{isOnPhishingList:i(p,this,S).bind(this),getSnap:i(p,this,P).bind(this),getAccountByAddress:i(p,this,T).bind(this)})}function O(e){const t=e.filter(e=>"snap"===e.type&&(0,c.hasProperty)(e.data,"detailedView")),s=new Set(t.map(e=>e.data.detailedView.interfaceId));this.update(e=>{Object.entries(e.interfaces).forEach(([t,n])=>{n.contentType!==a.ContentType.Notification||s.has(t)||delete e.interfaces[t]})})}s.SnapInterfaceController=f}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/interface/SnapInterfaceController.cjs"}],[2012,{"./SnapInterfaceController.cjs":2011},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n=Object.create?function(e,t,s,n){n===undefined&&(n=s);var i=Object.getOwnPropertyDescriptor(t,s);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,n,i)}:function(e,t,s,n){n===undefined&&(n=s),e[n]=t[s]},i=function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||n(t,e,s)};Object.defineProperty(s,"__esModule",{value:!0}),i(e("./SnapInterfaceController.cjs"),s)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/interface/index.cjs"}],[2013,{"@metamask/snaps-sdk":2128,"@metamask/snaps-sdk/jsx":2212,"@metamask/snaps-utils":2242,"@metamask/utils":2359},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.validateInterfaceContext=s.constructState=s.getAccountSelectorStateValue=s.getAssetSelectorStateValue=s.getAccountSelectorDefaultStateValue=s.getDefaultAsset=s.formatAccountSelectorStateValue=s.isMatchingChainId=s.assertNameIsUnique=s.getJsxInterface=s.isStatefulComponent=void 0;const n=e("@metamask/snaps-sdk"),i=e("@metamask/snaps-sdk/jsx"),r=e("@metamask/snaps-utils"),a=e("@metamask/utils"),o=["Input","Dropdown","RadioGroup","FileInput","Checkbox","Selector","AssetSelector","AddressInput","AccountSelector"];function c(e){return o.includes(e.type)}function l(e,t){(0,n.assert)(e[t]===undefined,`Duplicate component names are not allowed, found multiple instances of: "${t}".`)}function u(e,t){return"eip155:0"===e?t.some(e=>{const{namespace:t}=(0,a.parseCaipChainId)(e);return t===a.KnownCaipNamespace.Eip155}):t.includes(e)}function h(e,t){const{id:s,address:n,scopes:i}=e,a=(0,r.createChainIdList)(i,t);return{accountId:s,addresses:(0,r.createAccountList)(n,a)}}function d(e,t,{getAccountByAddress:s,getAssetsState:i}){var r;const{assetsMetadata:o,accountsAssets:c}=i(),l=e.map(e=>(0,a.parseCaipAccountId)(e)).map(({chainId:e})=>e),u=t&&t.length>0?l.filter(e=>t.includes(e)):l,h=null===(r=s(e[0]))||void 0===r?void 0:r.id;(0,n.assert)(h,`Account not found for address: ${e[0]}.`);const d=c[h];if(0===d.length)return null;const m=d.find(e=>{const{chainId:t,assetNamespace:s}=(0,a.parseCaipAssetType)(e);return u.includes(t)&&"slip44"===s});return m?{asset:m,name:o[m].name,symbol:o[m].symbol}:{asset:d[0],name:o[d[0]].name,symbol:o[d[0]].symbol}}function m(e,{getSelectedAccount:t,listAccounts:s,snapOwnsAccount:n}){const{chainIds:i,hideExternalAccounts:r}=e.props,a=t();if((!i||0===i.length||a.scopes.some(e=>u(e,i)))&&(!r||r&&n(a)))return h(a,i);const o=s(i),c=r?o.filter(e=>n(e)):o;return 0===c.length?null:h(c[0],i)}function p(e,t){if(!e)return null;const{assetsMetadata:s}=t(),n=s[e];return n?{asset:e,name:n.name??n.symbol??"Unknown",symbol:n.symbol??"Unknown"}:null}function f(e,{getAccountByAddress:t,snapOwnsAccount:s}){const{value:n,hideExternalAccounts:i}=e.props;if(!n)return null;const r=t(n);return r?i&&!s(r)?null:h(r,e.props.chainIds):null}function g(e,t,s,n){const i=n?e[n]:e,o=null==i?void 0:i[t.props.name];return"FileInput"===t.type?o??null:function(e,t){switch(e.type){case"Checkbox":return e.props.checked;case"AssetSelector":return p(e.props.value,t.getAssetsState);case"AddressInput":{if(!e.props.value)return null;const{namespace:t,reference:s}=(0,a.parseCaipChainId)(e.props.chainId);return(0,a.toCaipAccountId)(t,s,e.props.value)}case"AccountSelector":return f(e,t);default:return e.props.value}}(t,s)??o??function(e,t){switch(e.type){case"Dropdown":var s;return null===(s=(0,r.getJsxChildren)(e)[0])||void 0===s?void 0:s.props.value;case"RadioGroup":var n;return null===(n=(0,r.getJsxChildren)(e)[0])||void 0===n?void 0:n.props.value;case"Selector":var i;return null===(i=(0,r.getJsxChildren)(e)[0])||void 0===i?void 0:i.props.value;case"AccountSelector":return m(e,t);case"Checkbox":return!1;case"AssetSelector":return d(e.props.addresses,e.props.chainIds,t);default:return null}}(t,s)??null}s.isStatefulComponent=c,s.getJsxInterface=function(e){return(0,i.isJSXElementUnsafe)(e)?e:(0,r.getJsxElementFromComponent)(e)},s.assertNameIsUnique=l,s.isMatchingChainId=u,s.formatAccountSelectorStateValue=h,s.getDefaultAsset=d,s.getAccountSelectorDefaultStateValue=m,s.getAssetSelectorStateValue=p,s.getAccountSelectorStateValue=f,s.constructState=function(e,t,s){const n={},i=[];return(0,r.walkJsx)(t,(t,r)=>{let a=i[i.length-1];if(a&&r<=a.depth&&(i.pop(),a=i[i.length-1]),"Form"===t.type)return l(n,t.props.name),i.push({name:t.props.name,depth:r}),void(n[t.props.name]={});if(a&&c(t)){const i=n[a.name];return l(i,t.props.name),void(i[t.props.name]=g(e,t,s,a.name))}c(t)&&(l(n,t.props.name),n[t.props.name]=g(e,t,s))}),n};const y=5e6;s.validateInterfaceContext=function(e){if(!e)return;const t=(0,r.getJsonSizeUnsafe)(e);(0,n.assert)(t<=y,"A Snap interface context may not be larger than 5 MB.")}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/interface/utils.cjs"}],[2014,{"@metamask/snaps-utils":2242,"@metamask/utils":2359},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.log=void 0;const n=e("@metamask/snaps-utils"),i=e("@metamask/utils");s.log=(0,i.createModuleLogger)(n.snapsLogger,"snaps-controllers")}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/logging.cjs"}],[2015,{"../snaps/index.cjs":2028,"@metamask/rpc-errors":1955,"@metamask/snaps-rpc-methods":2072,"@metamask/snaps-utils":2242,"@metamask/utils":2359,nanoid:4196},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){function n(e,t,s){i(e,t),t.set(e,s)}function i(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function r(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var n=s.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function a(e,t){return e.get(c(e,t))}function o(e,t,s){return e.set(c(e,t),s),s}function c(e,t,s){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:s;throw new TypeError("Private element is not present on this object")}Object.defineProperty(s,"__esModule",{value:!0}),s.MultichainRouter=void 0;const l=e("@metamask/rpc-errors"),u=e("@metamask/snaps-rpc-methods"),h=e("@metamask/snaps-utils"),d=e("@metamask/utils"),m=e("nanoid"),p=e("../snaps/index.cjs"),f="MultichainRouter";var g=new WeakMap,y=new WeakMap,w=new WeakSet;async function S(e,t,s){try{const n=await a(y,this).call(this,async({keyring:n})=>n.resolveAccountAddress(e,t,s)),i=null==n?void 0:n.address;return i?(0,d.parseCaipAccountId)(i).address:null}catch{throw l.rpcErrors.internal()}}async function v(e,t,s){const n=a(g,this).call("AccountsController:listMultichainAccounts",t).filter(e=>{var t;return Boolean(null===(t=e.metadata.snap)||void 0===t?void 0:t.enabled)&&e.methods.includes(s.method)});if(0===n.length)return null;const i=n[0].metadata.snap.id,r=await c(w,this,S).call(this,i,t,s),o=e.map(e=>(0,d.parseCaipAccountId)(e).address),u=n.find(e=>o.includes(e.address)&&(!r||e.address===r));if(!u)throw l.rpcErrors.invalidParams({message:"No available account found for request."});return u.id}function b(e){const t=a(g,this).call("SnapController:getAll");return(0,p.getRunnableSnaps)(t).reduce((t,s)=>{const n=a(g,this).call("PermissionController:getPermissions",s.id);if(n&&(0,d.hasProperty)(n,u.SnapEndowments.Protocol)){const i=n[u.SnapEndowments.Protocol],r=(0,u.getProtocolCaveatScopes)(i);r&&(0,d.hasProperty)(r,e)&&t.push({snapId:s.id,methods:r[e].methods})}return t},[])}function k(e){return a(g,this).call("AccountsController:listMultichainAccounts",e).filter(e=>{var t;return null===(t=e.metadata.snap)||void 0===t?void 0:t.enabled})}s.MultichainRouter=class{constructor({messenger:e,withSnapKeyring:t}){var s,c;i(s=this,c=w),c.add(s),r(this,"name",f),r(this,"state",null),n(this,g,void 0),n(this,y,void 0),o(g,this,e),o(y,this,t),a(g,this).registerActionHandler(`${f}:handleRequest`,async(...e)=>this.handleRequest(...e)),a(g,this).registerActionHandler(`${f}:getSupportedMethods`,(...e)=>this.getSupportedMethods(...e)),a(g,this).registerActionHandler(`${f}:getSupportedAccounts`,(...e)=>this.getSupportedAccounts(...e)),a(g,this).registerActionHandler(`${f}:isSupportedScope`,(...e)=>this.isSupportedScope(...e))}async handleRequest({connectedAddresses:e,origin:t,scope:s,request:n}){(0,d.assert)(!s.startsWith(d.KnownCaipNamespace.Eip155)&&!s.startsWith("wallet:eip155"));const i={jsonrpc:"2.0",id:n.id??(0,m.nanoid)(),method:n.method,...n.params?{params:n.params}:{}},{method:r,params:o}=i,u=await c(w,this,v).call(this,e,s,i);if(u)return a(y,this).call(this,async({keyring:e})=>e.submitRequest({origin:t,account:u,scope:s,method:r,params:o}));const p=c(w,this,b).call(this,s).find(e=>e.methods.includes(r));if(p)return a(g,this).call("SnapController:handleRequest",{snapId:p.snapId,origin:t,request:{method:"",params:{request:i,scope:s}},handler:h.HandlerType.OnProtocolRequest});throw l.rpcErrors.methodNotFound()}getSupportedMethods(e){const t=c(w,this,k).call(this,e).flatMap(e=>e.methods),s=c(w,this,b).call(this,e).flatMap(e=>e.methods);return Array.from(new Set([...t,...s]))}getSupportedAccounts(e){return c(w,this,k).call(this,e).map(t=>`${e}:${t.address}`)}isSupportedScope(e){return a(g,this).call("AccountsController:listMultichainAccounts",e).some(e=>{var t;return null===(t=e.metadata.snap)||void 0===t?void 0:t.enabled})||c(w,this,b).call(this,e).length>0}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/multichain/MultichainRouter.cjs"}],[2016,{"./MultichainRouter.cjs":2015},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n=Object.create?function(e,t,s,n){n===undefined&&(n=s);var i=Object.getOwnPropertyDescriptor(t,s);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,n,i)}:function(e,t,s,n){n===undefined&&(n=s),e[n]=t[s]},i=function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||n(t,e,s)};Object.defineProperty(s,"__esModule",{value:!0}),i(e("./MultichainRouter.cjs"),s)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/multichain/index.cjs"}],[2017,{"../logging.cjs":2014,"../snaps/Timer.cjs":2026,"../utils.cjs":2038,"@metamask/json-rpc-engine":1509,"@metamask/json-rpc-middleware-stream":1513,"@metamask/object-multiplex":1804,"@metamask/rpc-errors":1955,"@metamask/snaps-utils":2242,"@metamask/utils":2359,nanoid:4196,"readable-stream":4452},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){function n(e,t,s){i(e,t),t.set(e,s)}function i(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function r(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var n=s.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function a(e,t){return e.get(c(e,t))}function o(e,t,s){return e.set(c(e,t),s),s}function c(e,t,s){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:s;throw new TypeError("Private element is not present on this object")}var l=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(s,"__esModule",{value:!0}),s.setupMultiplex=s.AbstractExecutionService=void 0;const u=e("@metamask/json-rpc-engine"),h=e("@metamask/json-rpc-middleware-stream"),d=l(e("@metamask/object-multiplex")),m=e("@metamask/rpc-errors"),p=e("@metamask/snaps-utils"),f=e("@metamask/utils"),g=e("nanoid"),y=e("readable-stream"),w=e("../logging.cjs"),S=e("../snaps/Timer.cjs"),v=e("../utils.cjs"),b="ExecutionService";var k=new WeakMap,_=new WeakMap,T=new WeakMap,E=new WeakMap,P=new WeakMap,C=new WeakMap,O=new WeakMap,A=new WeakMap,I=new WeakSet;function M(){a(E,this).registerActionHandler(`${b}:handleRpcRequest`,async(e,t)=>this.handleRpcRequest(e,t)),a(E,this).registerActionHandler(`${b}:executeSnap`,async e=>this.executeSnap(e)),a(E,this).registerActionHandler(`${b}:terminateSnap`,async e=>this.terminateSnap(e)),a(E,this).registerActionHandler(`${b}:terminateAllSnaps`,async()=>this.terminateAllSnaps())}async function j(e,t){const{streams:s,worker:n}=await c(I,this,N).call(this,e,t),i=new u.JsonRpcEngine,r=(0,h.createStreamMiddleware)();(0,y.pipeline)(r.stream,s.command,r.stream,e=>{e&&(0,p.logError)("Command stream failure.",e)}),i.push(r.middleware);const o={id:e,streams:s,rpcEngine:i,worker:n};return a(k,this).set(e,o),o}async function N(e,t){const s=await(0,v.withTimeout)(this.initEnvStream(e),t);if(s===v.hasTimedOut){this.terminateJob({id:e});if("created"===a(_,this).get(e))throw new Error(`The executor for "${e}" couldn't start initialization. The offscreen document may not exist.`);throw new Error(`The executor for "${e}" failed to initialize. The iframe/webview/worker failed to load.`)}const{worker:n,stream:i}=s,r=x(i,`Snap: "${e}"`),o=r.createStream(p.SNAP_STREAM_NAMES.COMMAND),c=t=>{(0,f.hasProperty)(t,"id")||("OutboundRequest"===t.method?a(E,this).publish("ExecutionService:outboundRequest",e):"OutboundResponse"===t.method?a(E,this).publish("ExecutionService:outboundResponse",e):"UnhandledError"===t.method?(a(E,this).publish("ExecutionService:unhandledError",e,t.params.error),o.removeListener("data",c)):(0,p.logError)(new Error(`Received unexpected command stream notification "${t.method}".`)))};o.on("data",c);const l=r.createStream(p.SNAP_STREAM_NAMES.JSON_RPC);return{streams:{command:o,rpc:l,_connection:i},worker:n}}async function R(e,t){const s=a(k,this).get(e);if(!s)throw new Error(`"${e}" is not currently running.`);(0,w.log)("Parent: Sending Command",t);const n=await s.rpcEngine.handle(t);if((0,f.isJsonRpcFailure)(n))throw new m.JsonRpcError(n.error.code,n.error.message,n.error.data);return n.result}function x(e,t){const s=new d.default;return(0,y.pipeline)(e,s,e,e=>{e&&(0,p.logError)(`"${t}" stream failure.`,e)}),s}s.AbstractExecutionService=class{constructor({setupSnapProvider:e,messenger:t,initTimeout:s=(0,f.inMilliseconds)(60,f.Duration.Second),pingTimeout:a=(0,f.inMilliseconds)(2,f.Duration.Second),terminationTimeout:l=(0,f.inMilliseconds)(1,f.Duration.Second),usePing:u=!0}){var h,d;i(h=this,d=I),d.add(h),r(this,"name",b),r(this,"state",null),n(this,k,void 0),n(this,_,void 0),n(this,T,void 0),n(this,E,void 0),n(this,P,void 0),n(this,C,void 0),n(this,O,void 0),n(this,A,void 0),o(k,this,new Map),o(_,this,new Map),o(T,this,e),o(E,this,t),o(P,this,s),o(C,this,a),o(O,this,l),o(A,this,u),c(I,this,M).call(this)}async terminateSnap(e){const t=a(k,this).get(e);if(!t)throw new Error(`"${e}" is not currently running.`);try{const t=await(0,v.withTimeout)(c(I,this,R).call(this,e,{jsonrpc:"2.0",method:"terminate",params:[],id:(0,g.nanoid)()}),a(O,this));t!==v.hasTimedOut&&"OK"===t||(0,p.logError)(`Snap "${e}" failed to terminate gracefully.`,t)}catch{}Object.values(t.streams).forEach(e=>{try{!e.destroyed&&e.destroy(),e.removeAllListeners()}catch(e){(0,p.logError)("Error while destroying stream",e)}}),this.terminateJob(t),a(k,this).delete(e),a(_,this).delete(e),(0,w.log)(`Snap "${e}" terminated.`)}setSnapStatus(e,t){a(_,this).set(e,t)}async terminateAllSnaps(){await Promise.all([...a(k,this).keys()].map(async e=>this.terminateSnap(e)))}async executeSnap({snapId:e,sourceCode:t,endowments:s}){if(a(k,this).has(e))throw new Error(`"${e}" is already running.`);this.setSnapStatus(e,"created");const n=new S.Timer(a(P,this)),i=await c(I,this,j).call(this,e,n);if(a(A,this)){if(await(0,v.withTimeout)(c(I,this,R).call(this,i.id,{jsonrpc:"2.0",method:"ping",id:(0,g.nanoid)()}),a(C,this))===v.hasTimedOut)throw new Error(`The executor for "${e}" was unreachable. The executor did not respond in time.`)}const r=i.streams.rpc;a(T,this).call(this,e,r);const o=Math.max(n.remaining,a(P,this)/2);this.setSnapStatus(e,"initialized");const l={jsonrpc:"2.0",method:"executeSnap",params:{snapId:e,sourceCode:t,endowments:s},id:(0,g.nanoid)()};(0,f.assertIsJsonRpcRequest)(l),this.setSnapStatus(e,"executing");const u=await(0,v.withTimeout)(c(I,this,R).call(this,i.id,l),o);if(u===v.hasTimedOut)throw new Error(`${e} failed to start.`);return"OK"===u&&this.setSnapStatus(e,"running"),u}async handleRpcRequest(e,t){const{handler:s,request:n,origin:i}=t;return await c(I,this,R).call(this,e,{id:(0,g.nanoid)(),jsonrpc:"2.0",method:"snapRpc",params:{origin:i,handler:s,request:n,target:e}})}},s.setupMultiplex=x}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/AbstractExecutionService.cjs"}],[2018,{"@metamask/post-message-stream":1837},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){function n(e,t,s){i(e,t),t.set(e,s)}function i(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function r(e,t){return e.get(o(e,t))}function a(e,t,s){return e.set(o(e,t),s),s}function o(e,t,s){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:s;throw new TypeError("Private element is not present on this object")}Object.defineProperty(s,"__esModule",{value:!0}),s.ProxyPostMessageStream=void 0;const c=e("@metamask/post-message-stream");var l=new WeakMap,u=new WeakMap,h=new WeakSet;class d extends c.BasePostMessageStream{constructor({stream:e,jobId:t}){var s,c;super(),i(s=this,c=h),c.add(s),n(this,l,void 0),n(this,u,void 0),a(l,this,e),a(u,this,t),r(l,this).on("data",o(h,this,m).bind(this))}_postMessage(e){r(l,this).write({jobId:r(u,this),data:e})}}function m(e){e.jobId===r(u,this)&&this.push(e.data)}s.ProxyPostMessageStream=d}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/ProxyPostMessageStream.cjs"}],[2019,{"../AbstractExecutionService.cjs":2017,"@metamask/post-message-stream":1837,"@metamask/snaps-utils":2242},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){function n(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var n=s.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}Object.defineProperty(s,"__esModule",{value:!0}),s.IframeExecutionService=void 0;const i=e("@metamask/post-message-stream"),r=e("@metamask/snaps-utils"),a=e("../AbstractExecutionService.cjs");class o extends a.AbstractExecutionService{constructor({iframeUrl:e,messenger:t,setupSnapProvider:s,...i}){super({...i,messenger:t,setupSnapProvider:s}),n(this,"iframeUrl",void 0),this.iframeUrl=e}terminateJob(e){var t;null===(t=document.getElementById(e.id))||void 0===t||t.remove()}async initEnvStream(e){this.setSnapStatus(e,"initializing");const t=await(0,r.createWindow)({uri:this.iframeUrl.toString(),id:e});return{worker:t,stream:new i.WindowPostMessageStream({name:"parent",target:"child",targetWindow:t,targetOrigin:"*"})}}}s.IframeExecutionService=o}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/iframe/IframeExecutionService.cjs"}],[2020,{"./IframeExecutionService.cjs":2019},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n=Object.create?function(e,t,s,n){n===undefined&&(n=s);var i=Object.getOwnPropertyDescriptor(t,s);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,n,i)}:function(e,t,s,n){n===undefined&&(n=s),e[n]=t[s]},i=function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||n(t,e,s)};Object.defineProperty(s,"__esModule",{value:!0}),i(e("./IframeExecutionService.cjs"),s)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/iframe/index.cjs"}],[2021,{"./AbstractExecutionService.cjs":2017,"./ProxyPostMessageStream.cjs":2018,"./iframe/index.cjs":2020,"./offscreen/index.cjs":2023},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n=Object.create?function(e,t,s,n){n===undefined&&(n=s);var i=Object.getOwnPropertyDescriptor(t,s);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,n,i)}:function(e,t,s,n){n===undefined&&(n=s),e[n]=t[s]},i=function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||n(t,e,s)};Object.defineProperty(s,"__esModule",{value:!0}),i(e("./AbstractExecutionService.cjs"),s),i(e("./ProxyPostMessageStream.cjs"),s),i(e("./iframe/index.cjs"),s),i(e("./offscreen/index.cjs"),s)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/index.cjs"}],[2022,{"../proxy/ProxyExecutionService.cjs":2024,"@metamask/post-message-stream":1837},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){function n(e,t,s){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,s)}function i(e,t,s){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:s;throw new TypeError("Private element is not present on this object")}Object.defineProperty(s,"__esModule",{value:!0}),s.OffscreenExecutionService=void 0;const r=e("@metamask/post-message-stream"),a=e("../proxy/ProxyExecutionService.cjs");var o=new WeakMap;class c extends a.ProxyExecutionService{constructor({messenger:e,setupSnapProvider:t,offscreenPromise:s,...a}){var c,l,u;super({...a,messenger:e,setupSnapProvider:t,stream:new r.BrowserRuntimePostMessageStream({name:"parent",target:"child"})}),n(this,o,void 0),l=this,u=s,(c=o).set(i(c,l),u)}async initEnvStream(e){var t,s;return await(t=o,s=this,t.get(i(t,s))),await super.initEnvStream(e)}}s.OffscreenExecutionService=c}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/offscreen/OffscreenExecutionService.cjs"}],[2023,{"./OffscreenExecutionService.cjs":2022},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n=Object.create?function(e,t,s,n){n===undefined&&(n=s);var i=Object.getOwnPropertyDescriptor(t,s);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,n,i)}:function(e,t,s,n){n===undefined&&(n=s),e[n]=t[s]},i=function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||n(t,e,s)};Object.defineProperty(s,"__esModule",{value:!0}),i(e("./OffscreenExecutionService.cjs"),s)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/offscreen/index.cjs"}],[2024,{"../AbstractExecutionService.cjs":2017,"../ProxyPostMessageStream.cjs":2018,nanoid:4196},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){function n(e,t,s){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,s)}function i(e,t){return e.get(r(e,t))}function r(e,t,s){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:s;throw new TypeError("Private element is not present on this object")}Object.defineProperty(s,"__esModule",{value:!0}),s.ProxyExecutionService=void 0;const a=e("nanoid"),o=e("../AbstractExecutionService.cjs"),c=e("../ProxyPostMessageStream.cjs");var l=new WeakMap;class u extends o.AbstractExecutionService{constructor({stream:e,messenger:t,setupSnapProvider:s,...i}){var a,o,c;super({...i,messenger:t,setupSnapProvider:s,usePing:!1}),n(this,l,void 0),o=this,c=e,(a=l).set(r(a,o),c)}async terminateJob(e){i(l,this).write({jobId:e.id,data:{jsonrpc:"2.0",method:"terminateJob",id:(0,a.nanoid)()}})}async initEnvStream(e){this.setSnapStatus(e,"initializing");const t=new c.ProxyPostMessageStream({stream:i(l,this),jobId:e});return await new Promise(e=>{t.once("data",e),t.write({name:"command",data:{jsonrpc:"2.0",method:"ping",id:(0,a.nanoid)()}})}),{worker:e,stream:t}}}s.ProxyExecutionService=u}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/proxy/ProxyExecutionService.cjs"}],[2025,{"../fsm.cjs":2007,"../logging.cjs":2014,"../utils.cjs":2038,"./Timer.cjs":2026,"./constants.cjs":2027,"./location/index.cjs":2030,"./registry/index.cjs":2034,"./selectors.cjs":2037,"@metamask/base-controller":1241,"@metamask/permission-controller":1816,"@metamask/rpc-errors":1955,"@metamask/snaps-rpc-methods":2072,"@metamask/snaps-sdk":2128,"@metamask/snaps-utils":2242,"@metamask/utils":2359,"@xstate/fsm":2827,"async-mutex":3142,nanoid:4196,semver:4802},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){function n(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var n=s.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function i(e,t,s){r(e,t),t.set(e,s)}function r(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function a(e,t){return e.get(c(e,t))}function o(e,t,s){return e.set(c(e,t),s),s}function c(e,t,s){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:s;throw new TypeError("Private element is not present on this object")}Object.defineProperty(s,"__esModule",{value:!0}),s.SnapController=s.SNAP_APPROVAL_RESULT=s.SNAP_APPROVAL_UPDATE=s.SNAP_APPROVAL_INSTALL=s.controllerName=void 0;const l=e("@metamask/base-controller"),u=e("@metamask/permission-controller"),h=e("@metamask/rpc-errors"),d=e("@metamask/snaps-rpc-methods"),m=e("@metamask/snaps-sdk"),p=e("@metamask/snaps-utils"),f=e("@metamask/utils"),g=e("@xstate/fsm"),y=e("async-mutex"),w=e("nanoid"),S=e("semver"),v=e("./constants.cjs"),b=e("./location/index.cjs"),k=e("./registry/index.cjs"),_=e("./selectors.cjs"),T=e("./Timer.cjs"),E=e("../fsm.cjs"),P=e("../logging.cjs"),C=e("../utils.cjs");s.controllerName="SnapController",s.SNAP_APPROVAL_INSTALL="wallet_installSnap",s.SNAP_APPROVAL_UPDATE="wallet_updateSnap",s.SNAP_APPROVAL_RESULT="wallet_installSnapResult";const O=new Set(["initialPermissions","id","version","enabled","blocked"]),A={snaps:{},snapStates:{},unencryptedSnapStates:{}};function I(e){return Object.keys(e).reduce((t,s)=>(O.has(s)&&(t[s]=e[s]),t),{})}var M=new WeakMap,j=new WeakMap,N=new WeakMap,R=new WeakMap,x=new WeakMap,D=new WeakMap,L=new WeakMap,F=new WeakMap,U=new WeakMap,H=new WeakMap,$=new WeakMap,B=new WeakMap,W=new WeakMap,q=new WeakMap,K=new WeakMap,V=new WeakMap,G=new WeakMap,z=new WeakMap,J=new WeakMap,Y=new WeakMap,Q=new WeakSet,Z=new WeakMap;class X extends l.BaseController{constructor({closeAllConnections:e,messenger:t,state:l,dynamicPermissions:u=["eth_accounts"],environmentEndowmentPermissions:h=[],excludedPermissions:d={},idleTimeCheckInterval:g=(0,f.inMilliseconds)(5,f.Duration.Second),maxIdleTime:y=(0,f.inMilliseconds)(30,f.Duration.Second),maxRequestTime:w=(0,f.inMilliseconds)(60,f.Duration.Second),fetchFunction:S=globalThis.fetch.bind(undefined),featureFlags:k={},detectSnapLocation:_=b.detectSnapLocation,preinstalledSnaps:T=null,encryptor:E,getMnemonicSeed:P,getFeatureFlags:O=()=>({}),clientCryptography:I,trackEvent:X}){var ie,re,ae;super({messenger:t,metadata:{snapStates:{persist:!0,anonymous:!1},unencryptedSnapStates:{persist:!0,anonymous:!1},snaps:{persist:e=>Object.values(e).filter(e=>e.status!==p.SnapStatus.Installing).map(e=>({...e,status:p.SnapStatus.Stopped})).reduce((e,t)=>(e[t.id]=t,e),{}),anonymous:!1}},name:s.controllerName,state:{...A,...l}}),r(re=this,ae=Q),ae.add(re),i(this,M,void 0),i(this,j,void 0),i(this,N,void 0),i(this,R,void 0),i(this,x,void 0),i(this,D,void 0),i(this,L,void 0),i(this,F,void 0),n(this,"maxRequestTime",void 0),i(this,U,void 0),i(this,H,void 0),i(this,$,void 0),i(this,B,void 0),i(this,W,void 0),i(this,q,void 0),i(this,K,void 0),i(this,V,void 0),i(this,G,void 0),i(this,z,void 0),i(this,J,void 0),i(this,Y,void 0),i(this,Z,(0,C.debouncePersistState)((e,t,s)=>{c(Q,this,Ve).call(this,e).stateMutex.runExclusive(async()=>{const n=await c(Q,this,ge).call(this,e,t,s);return s?this.update(t=>{t.snapStates[e]=n}):this.update(t=>{t.unencryptedSnapStates[e]=n})}).catch(p.logError)},v.STATE_DEBOUNCE_TIMEOUT)),o(M,this,e),o(j,this,u),o(N,this,h),o(R,this,d),o(x,this,k),o(D,this,S),o(L,this,g),o(F,this,y),this.maxRequestTime=w,o(W,this,_),o(U,this,E),o(H,this,P),o($,this,O),o(B,this,I),o(z,this,T),this._onUnhandledSnapError=this._onUnhandledSnapError.bind(this),this._onOutboundRequest=this._onOutboundRequest.bind(this),this._onOutboundResponse=this._onOutboundResponse.bind(this),o(K,this,new Map),o(q,this,new Map),o(J,this,X),c(Q,this,ne).call(this),this.messagingSystem.subscribe("ExecutionService:unhandledError",this._onUnhandledSnapError),this.messagingSystem.subscribe("ExecutionService:outboundRequest",this._onOutboundRequest),this.messagingSystem.subscribe("ExecutionService:outboundResponse",this._onOutboundResponse),this.messagingSystem.subscribe("SnapController:snapInstalled",({id:e},t)=>{c(Q,this,tt).call(this,t,e,p.HandlerType.OnInstall).catch(t=>{(0,p.logError)(`Error when calling \`onInstall\` lifecycle hook for snap "${e}": ${(0,m.getErrorMessage)(t)}`)})}),this.messagingSystem.subscribe("SnapController:snapUpdated",({id:e},t,s)=>{c(Q,this,tt).call(this,s,e,p.HandlerType.OnUpdate).catch(t=>{(0,p.logError)(`Error when calling \`onUpdate\` lifecycle hook for snap "${e}": ${(0,m.getErrorMessage)(t)}`)})}),this.messagingSystem.subscribe("KeyringController:lock",c(Q,this,st).bind(this)),c(Q,this,ee).call(this),c(Q,this,te).call(this),Object.values((null===(ie=this.state)||void 0===ie?void 0:ie.snaps)??{}).forEach(e=>c(Q,this,Ge).call(this,e.id)),a(z,this)&&c(Q,this,se).call(this,a(z,this)),o(Y,this,(0,C.throttleTracking)((e,t,s,n)=>{const i=this.messagingSystem.call("SnapsRegistry:getMetadata",e);a(J,this).call(this,{event:"Snap Export Used",category:"Snaps",properties:{snap_id:e,export:t,snap_category:null==i?void 0:i.category,success:s,origin:n}})}))}init(){c(Q,this,et).call(this,v.METAMASK_ORIGIN,p.HandlerType.OnStart)}async updateBlockedSnaps(){c(Q,this,ce).call(this),await this.messagingSystem.call("SnapsRegistry:update");const e=await this.messagingSystem.call("SnapsRegistry:get",Object.values(this.state.snaps).reduce((e,t)=>(e[t.id]={version:t.version,checksum:t.manifest.source.shasum},e),{}));await Promise.all(Object.entries(e).map(async([e,{status:t,reason:s}])=>t===k.SnapsRegistryStatus.Blocked?c(Q,this,ie).call(this,e,s):c(Q,this,re).call(this,e)))}_onUnhandledSnapError(e,t){(0,p.logError)(`Unhandled error from "${e}":`,t),this.stopSnap(e,p.SnapStatusEvents.Crash).catch(e=>{(0,p.logError)(e)})}_onOutboundRequest(e){const t=c(Q,this,Ve).call(this,e);t.pendingInboundRequests.filter(e=>"running"===e.timer.status).forEach(e=>e.timer.pause()),t.pendingOutboundRequests+=1}_onOutboundResponse(e){const t=c(Q,this,Ve).call(this,e);t.pendingOutboundRequests-=1,0===t.pendingOutboundRequests&&t.pendingInboundRequests.filter(e=>"paused"===e.timer.status).forEach(e=>e.timer.resume())}async startSnap(e){c(Q,this,ce).call(this);const t=this.state.snaps[e];if(!t.enabled)throw new Error(`Snap "${e}" is disabled.`);await c(Q,this,Ee).call(this,{snapId:e,sourceCode:t.sourceCode})}enableSnap(e){if(this.getExpect(e),this.state.snaps[e].blocked)throw new Error(`Snap "${e}" is blocked and cannot be enabled.`);this.update(t=>{t.snaps[e].enabled=!0}),this.messagingSystem.publish("SnapController:snapEnabled",this.getTruncatedExpect(e))}async disableSnap(e){if(!this.has(e))throw new Error(`Snap "${e}" not found.`);this.update(t=>{t.snaps[e].enabled=!1}),this.isRunning(e)&&await this.stopSnap(e,p.SnapStatusEvents.Stop),this.messagingSystem.publish("SnapController:snapDisabled",this.getTruncatedExpect(e))}async stopSnap(e,t=p.SnapStatusEvents.Stop){const s=c(Q,this,Ke).call(this,e);if(!s)throw new Error(`The snap "${e}" is not running.`);if(s.stopPromise)return void await s.stopPromise;const{promise:n,resolve:i}=(0,f.createDeferredPromise)();s.stopPromise=n;try{var r;if(this.isRunning(e))null===(r=a(M,this))||void 0===r||r.call(this,e),await c(Q,this,he).call(this,e)}finally{s.lastRequest=null,s.pendingInboundRequests=[],s.pendingOutboundRequests=0,s.stopPromise=null,this.isRunning(e)&&c(Q,this,ue).call(this,e,t),i()}}async stopAllSnaps(e=p.SnapStatusEvents.Stop){const t=Object.values(this.state.snaps).filter(e=>this.isRunning(e.id)).map(async t=>this.stopSnap(t.id,e));await Promise.allSettled(t)}isRunning(e){return"running"===this.getExpect(e).status}has(e){return Boolean(this.get(e))}get(e){return this.state.snaps[e]}getExpect(e){const t=this.get(e);return(0,f.assert)(t!==undefined,new Error(`Snap "${e}" not found.`)),t}getTruncated(e){const t=this.get(e);return t?I(t):null}getTruncatedExpect(e){return I(this.getExpect(e))}async updateSnapState(e,t,s){const n=c(Q,this,Ve).call(this,e);s?n.state=t:n.unencryptedState=t,a(Z,this).call(this,e,t,s)}clearSnapState(e,t){const s=c(Q,this,Ve).call(this,e);t?s.state=null:s.unencryptedState=null,a(Z,this).call(this,e,null,t)}async getSnapState(e,t){const s=c(Q,this,Ve).call(this,e);return await s.getStateMutex.runExclusive(async()=>{const n=t?s.state:s.unencryptedState;if(n!==undefined)return n;const i=t?this.state.snapStates[e]:this.state.unencryptedSnapStates[e];if(null===i||i===undefined)return null;if(!t){const e=JSON.parse(i);return s.unencryptedState=e,e}const r=await c(Q,this,pe).call(this,e,i);return s.state=r,r})}async getSnapFile(e,t,s=m.AuxiliaryFileEncoding.Base64){var n;const i=this.getExpect(e),r=(0,p.normalizeRelative)(t),a=null===(n=i.auxiliaryFiles)||void 0===n||null===(n=n.find(e=>e.path===r))||void 0===n?void 0:n.value;if(!a)return null;const o=await(0,p.encodeAuxiliaryFile)(a,s);return(0,f.assert)(o.length<p.MAX_FILE_SIZE,`Failed to encode static file to "${s}": Static files must be less than 64 MB when encoded.`),o}isMinimumPlatformVersion(e,t){const s=this.getExpect(e),{platformVersion:n}=s.manifest;return!!n&&(0,S.gte)(n,t)}async clearState(){const e=Object.keys(this.state.snaps);a(M,this)&&e.forEach(e=>{var t;null===(t=a(M,this))||void 0===t||t.call(this,e)}),await this.messagingSystem.call("ExecutionService:terminateAllSnaps"),e.forEach(e=>c(Q,this,ve).call(this,e)),this.update(e=>{e.snaps={},e.snapStates={},e.unencryptedSnapStates={}}),a(q,this).clear(),a(K,this).clear(),a(z,this)&&c(Q,this,se).call(this,a(z,this))}async removeSnap(e){return this.removeSnaps([e])}async removeSnaps(e){if(!Array.isArray(e))throw new Error("Expected array of snap ids.");e.forEach(e=>{const t=this.getExpect(e);(0,f.assert)(!1!==t.removable,`${e} is not removable.`)}),await Promise.all(e.map(async e=>{const t=this.getExpect(e),s=this.getTruncatedExpect(e);await this.disableSnap(e),c(Q,this,ve).call(this,e),c(Q,this,Se).call(this,e),a(q,this).delete(e),this.update(t=>{delete t.snaps[e],delete t.snapStates[e],delete t.unencryptedSnapStates[e]}),t.status!==p.SnapStatus.Installing&&this.messagingSystem.publish("SnapController:snapUninstalled",s)}))}removeSnapFromSubject(e,t){var s,n;const i=this.messagingSystem.call("PermissionController:getPermissions",e),r=null==i||null===(s=i[d.WALLET_SNAP_PERMISSION_KEY])||void 0===s||null===(s=s.caveats)||void 0===s?void 0:s.find(e=>e.type===p.SnapCaveatType.SnapIds);if(!r)return;if(Boolean(null===(n=r.value)||void 0===n?void 0:n[t])){const s={...r.value};delete s[t],Object.keys(s).length>0?this.messagingSystem.call("PermissionController:updateCaveat",e,d.WALLET_SNAP_PERMISSION_KEY,p.SnapCaveatType.SnapIds,s):this.messagingSystem.call("PermissionController:revokePermissions",{[e]:[d.WALLET_SNAP_PERMISSION_KEY]})}}revokeDynamicSnapPermissions(e,t){(0,f.assert)(t.every(e=>a(j,this).includes(e)),"Non-dynamic permissions cannot be revoked"),this.messagingSystem.call("PermissionController:revokePermissions",{[e]:t})}incrementActiveReferences(e){c(Q,this,Ve).call(this,e).activeReferences+=1}decrementActiveReferences(e){const t=c(Q,this,Ve).call(this,e);(0,f.assert)(t.activeReferences>0,"SnapController reference management is in an invalid state."),t.activeReferences-=1}getAllSnaps(){return Object.values(this.state.snaps).map(I)}getRunnableSnaps(){return(0,_.getRunnableSnaps)(this.getAllSnaps())}getPermittedSnaps(e){var t;const s=(null===(t=(this.messagingSystem.call("PermissionController:getPermissions",e)??{})[d.WALLET_SNAP_PERMISSION_KEY])||void 0===t||null===(t=t.caveats)||void 0===t||null===(t=t.find(e=>e.type===p.SnapCaveatType.SnapIds))||void 0===t?void 0:t.value)??{};return Object.keys(s).reduce((e,t)=>{const s=this.get(t),n=this.getTruncated(t);return n&&(null==s?void 0:s.status)!==p.SnapStatus.Installing&&(e[t]=n),e},{})}async installSnaps(e,t){c(Q,this,ce).call(this);const s={},n=Object.keys(t),i=[],r=[];try{for(const[n,{version:o}]of Object.entries(t)){(0,p.assertIsValidSnapId)(n);const[t,l]=(0,p.resolveVersionRange)(o);if(t)throw h.rpcErrors.invalidParams(`The "version" field must be a valid SemVer version range if specified. Received: "${o}".`);const u=a(W,this).call(this,n,{versionRange:l,fetch:a(D,this),allowLocal:a(x,this).allowLocalSnaps,resolveVersion:async e=>a(x,this).requireAllowlist?await c(Q,this,_e).call(this,n,e):e}),d=this.has(n)&&!u.shouldAlwaysReload;if(d&&c(Q,this,Xe).call(this,n,l)){const e=this.getExpect(n);i.push({snapId:n,oldVersion:e.version});let t=c(Q,this,$e).call(this,n);if(t!==undefined)throw new Error("This snap is already being updated.");t=c(Q,this,Be).call(this,n),t.newVersion=l}else d||r.push(n);s[n]=await this.processRequestedSnap(e,n,u,l)}r.forEach(t=>this.messagingSystem.publish("SnapController:snapInstalled",this.getTruncatedExpect(t),e,!1)),i.forEach(({snapId:t,oldVersion:s})=>this.messagingSystem.publish("SnapController:snapUpdated",this.getTruncatedExpect(t),s,e,!1)),n.forEach(e=>a(K,this).delete(e))}catch(e){const t=r.filter(e=>this.has(e));await this.removeSnaps(t);const s=[...a(K,this).keys()],n=i.map(({snapId:e})=>e).filter(e=>s.includes(e));throw await c(Q,this,qe).call(this,n),e}return s}async processRequestedSnap(e,t,n,i){const r=this.getTruncated(t);if(r&&!n.shouldAlwaysReload)return(0,f.satisfiesVersionRange)(r.version,i)?r:await this.updateSnap(e,t,n,i,!1);c(Q,this,oe).call(this);let a=c(Q,this,be).call(this,{origin:e,snapId:t,type:s.SNAP_APPROVAL_INSTALL});this.messagingSystem.publish("SnapController:snapInstallStarted",t,e,!1),r&&this.isRunning(t)&&await this.stopSnap(t,p.SnapStatusEvents.Stop),r&&n.shouldAlwaysReload&&c(Q,this,ve).call(this,t);try{const{sourceCode:r}=await c(Q,this,Te).call(this,{origin:e,id:t,location:n,versionRange:i});await this.authorize(t,a),a=c(Q,this,be).call(this,{origin:e,snapId:t,type:s.SNAP_APPROVAL_RESULT}),await c(Q,this,Ee).call(this,{snapId:t,sourceCode:r});const o=this.getTruncatedExpect(t);return c(Q,this,ke).call(this,a.id,{loading:!1,type:s.SNAP_APPROVAL_INSTALL}),o}catch(n){(0,p.logError)(`Error when adding ${t}.`,n);const i=n instanceof Error?n.message:n.toString();throw c(Q,this,ke).call(this,a.id,{loading:!1,type:s.SNAP_APPROVAL_INSTALL,error:i}),this.messagingSystem.publish("SnapController:snapInstallFailed",t,e,!1,i),n}}async updateSnap(e,t,n,i=p.DEFAULT_REQUESTED_SNAP_VERSION,r=!0){c(Q,this,oe).call(this),c(Q,this,ce).call(this);const a=this.getExpect(t);if(a.preinstalled)throw new Error("Preinstalled Snaps cannot be manually updated.");if(!(0,f.isValidSemVerRange)(i))throw new Error(`Received invalid snap version range: "${i}".`);let o=c(Q,this,be).call(this,{origin:e,snapId:t,type:s.SNAP_APPROVAL_UPDATE});try{this.messagingSystem.publish("SnapController:snapInstallStarted",t,e,!0);const l=a.manifest,u=await(0,C.fetchSnap)(t,n),{sourceCode:m,manifest:g}=u,y=g.result,w=y.version;if(!(0,f.gtVersion)(w,a.version))throw h.rpcErrors.invalidParams(`Snap "${t}@${a.version}" is already installed. Couldn't update to a version inside requested "${i}" range.`);if(!(0,f.satisfiesVersionRange)(w,i))throw new Error(`Version mismatch. Manifest for "${t}" specifies version "${w}" which doesn't satisfy requested version range "${i}".`);await c(Q,this,ae).call(this,t,{version:w,checksum:y.source.shasum,permissions:y.initialPermissions,platformVersion:y.platformVersion});const S=(0,d.processSnapPermissions)(y.initialPermissions);c(Q,this,Oe).call(this,S);const{newPermissions:v,unusedPermissions:b,approvedPermissions:k}=c(Q,this,ze).call(this,t,S),{newConnections:_,unusedConnections:T,approvedConnections:E}=c(Q,this,Ye).call(this,t,l.initialConnections??{},y.initialConnections??{});c(Q,this,ke).call(this,o.id,{permissions:v,newVersion:y.version,newPermissions:v,approvedPermissions:k,unusedPermissions:b,newConnections:_,unusedConnections:T,approvedConnections:E,loading:!1});const{permissions:P,...O}=await o.promise;o=c(Q,this,be).call(this,{origin:e,snapId:t,type:s.SNAP_APPROVAL_RESULT}),this.isRunning(t)&&await this.stopSnap(t,p.SnapStatusEvents.Stop),c(Q,this,ue).call(this,t,p.SnapStatusEvents.Update),c(Q,this,Ce).call(this,{origin:e,id:t,files:u,isUpdate:!0}),c(Q,this,Ze).call(this,{snapId:t,unusedPermissions:b,newPermissions:P,requestData:O}),y.initialConnections&&c(Q,this,ye).call(this,t,l.initialConnections??null,y.initialConnections);const A=c(Q,this,$e).call(this,t);A!==undefined&&(A.permissions.revoked=b,A.permissions.granted=P,A.permissions.requestData=O);const I=m.toString();(0,f.assert)("string"==typeof I&&I.length>0,`Invalid source code for snap "${t}".`);try{await c(Q,this,Ee).call(this,{snapId:t,sourceCode:I})}catch{throw new Error(`Snap ${t} crashed with updated source code.`)}const M=this.getTruncatedExpect(t);return r&&this.messagingSystem.publish("SnapController:snapUpdated",M,a.version,e,!1),c(Q,this,ke).call(this,o.id,{loading:!1,type:s.SNAP_APPROVAL_UPDATE}),M}catch(n){(0,p.logError)(`Error when updating ${t},`,n);const i=n instanceof Error?n.message:n.toString();throw c(Q,this,ke).call(this,o.id,{loading:!1,error:i,type:s.SNAP_APPROVAL_UPDATE}),this.messagingSystem.publish("SnapController:snapInstallFailed",t,e,!0,i),n}}async authorize(e,t){(0,P.log)(`Authorizing snap: ${e}`);const s=this.state.snaps[e],{initialPermissions:n,initialConnections:i}=s;try{const r=(0,d.processSnapPermissions)(n);c(Q,this,Oe).call(this,r),c(Q,this,ke).call(this,t.id,{loading:!1,connections:i??{},permissions:r});const{permissions:a,...o}=await t.promise;c(Q,this,Ze).call(this,{snapId:e,newPermissions:a,requestData:o}),s.manifest.initialConnections&&c(Q,this,ye).call(this,e,null,s.manifest.initialConnections)}finally{c(Q,this,Ve).call(this,e).installPromise=null}}destroy(){super.destroy(),a(V,this)&&clearTimeout(a(V,this)),this.messagingSystem.unsubscribe("ExecutionService:unhandledError",this._onUnhandledSnapError),this.messagingSystem.unsubscribe("ExecutionService:outboundRequest",this._onOutboundRequest),this.messagingSystem.unsubscribe("ExecutionService:outboundResponse",this._onOutboundResponse),this.messagingSystem.clearEventSubscriptions("SnapController:snapInstalled"),this.messagingSystem.clearEventSubscriptions("SnapController:snapUpdated")}async handleRequest({snapId:e,origin:t,handler:s,request:n}){c(Q,this,ce).call(this),(0,f.assert)(t===v.METAMASK_ORIGIN||(0,p.isValidUrl)(t),"'origin' must be a valid URL or 'metamask'.");const i={jsonrpc:"2.0",id:(0,w.nanoid)(),...n};(0,f.assertIsJsonRpcRequest)(i);const r=d.handlerEndowments[s];(0,f.assert)("string"==typeof r||null===r,"'permissionName' must be either a string or null.");const a=this.messagingSystem.call("PermissionController:getPermissions",e);if(!(null===r||a&&(0,f.hasProperty)(a,r)))throw new Error(`Snap "${e}" is not permitted to use "${r}".`);const o=r?a[r]:undefined;if(r===d.SnapEndowments.Rpc||r===d.SnapEndowments.Keyring){(0,f.assert)(o);const s=this.messagingSystem.call("SubjectMetadataController:getSubjectMetadata",t),n=r===d.SnapEndowments.Rpc?(0,d.getRpcCaveatOrigins)(o):(0,d.getKeyringCaveatOrigins)(o);if((0,f.assert)(n),!(0,p.isOriginAllowed)(n,(null==s?void 0:s.subjectType)??u.SubjectType.Website,t))throw new Error(`Snap "${e}" is not permitted to handle requests from "${t}".`)}if(t!==v.METAMASK_ORIGIN&&v.CLIENT_ONLY_HANDLERS.includes(s))throw new Error(`"${s}" can only be invoked by MetaMask.`);if(!this.state.snaps[e].enabled)throw new Error(`Snap "${e}" is disabled.`);if(this.state.snaps[e].status===p.SnapStatus.Installing)throw new Error(`Snap "${e}" is currently being installed. Please try again later.`);const l=c(Q,this,Ie).call(this,o),h=c(Q,this,Ve).call(this,e);if(h.stopPromise&&await h.stopPromise,!this.isRunning(e)){h.startPromise||(h.startPromise=this.startSnap(e));try{await h.startPromise}finally{h.startPromise=null}}const m=c(Q,this,Le).call(this,e,s,i),g=new T.Timer(l);c(Q,this,Ue).call(this,e,m.id,g);const y=this.messagingSystem.call("ExecutionService:handleRpcRequest",e,{origin:t,handler:s,request:m});try{const n=await(0,C.withTimeout)(y,g);if(n===C.hasTimedOut){const t=null!==h.stopPromise||!this.isRunning(e);throw new Error(t?`${e} was stopped and the request was cancelled. This is likely because the Snap crashed.`:`${e} failed to respond to the request in time.`)}await c(Q,this,Fe).call(this,e,s,n);const i=await c(Q,this,Ne).call(this,e,s,m,n);return c(Q,this,He).call(this,e,m.id,s,t,!0),i}catch(n){c(Q,this,He).call(this,e,m.id,s,t,!1);const[i,r]=(0,p.unwrapError)(n);throw r||((0,p.logError)(`"${e}" crashed due to an unhandled error:`,i),await this.stopSnap(e,p.SnapStatusEvents.Crash)),i}}setClientActive(e){e?c(Q,this,et).call(this,v.METAMASK_ORIGIN,p.HandlerType.OnActive):c(Q,this,et).call(this,v.METAMASK_ORIGIN,p.HandlerType.OnInactive)}}function ee(){const e=({snapId:e})=>this.getExpect(e).enabled,t={initial:p.SnapStatus.Installing,states:{[p.SnapStatus.Installing]:{on:{[p.SnapStatusEvents.Start]:{target:p.SnapStatus.Running,cond:e}}},[p.SnapStatus.Updating]:{on:{[p.SnapStatusEvents.Start]:{target:p.SnapStatus.Running,cond:e},[p.SnapStatusEvents.Stop]:p.SnapStatus.Stopped}},[p.SnapStatus.Running]:{on:{[p.SnapStatusEvents.Stop]:p.SnapStatus.Stopped,[p.SnapStatusEvents.Crash]:p.SnapStatus.Crashed}},[p.SnapStatus.Stopped]:{on:{[p.SnapStatusEvents.Start]:{target:p.SnapStatus.Running,cond:e},[p.SnapStatusEvents.Update]:p.SnapStatus.Updating}},[p.SnapStatus.Crashed]:{on:{[p.SnapStatusEvents.Start]:{target:p.SnapStatus.Running,cond:e},[p.SnapStatusEvents.Update]:p.SnapStatus.Updating}}}};o(G,this,(0,g.createMachine)(t)),(0,E.validateMachine)(a(G,this))}function te(){this.messagingSystem.registerActionHandler(`${s.controllerName}:init`,(...e)=>this.init(...e)),this.messagingSystem.registerActionHandler(`${s.controllerName}:clearSnapState`,(...e)=>this.clearSnapState(...e)),this.messagingSystem.registerActionHandler(`${s.controllerName}:get`,(...e)=>this.get(...e)),this.messagingSystem.registerActionHandler(`${s.controllerName}:getSnapState`,async(...e)=>this.getSnapState(...e)),this.messagingSystem.registerActionHandler(`${s.controllerName}:handleRequest`,async(...e)=>this.handleRequest(...e)),this.messagingSystem.registerActionHandler(`${s.controllerName}:has`,(...e)=>this.has(...e)),this.messagingSystem.registerActionHandler(`${s.controllerName}:updateBlockedSnaps`,async()=>this.updateBlockedSnaps()),this.messagingSystem.registerActionHandler(`${s.controllerName}:updateSnapState`,async(...e)=>this.updateSnapState(...e)),this.messagingSystem.registerActionHandler(`${s.controllerName}:enable`,(...e)=>this.enableSnap(...e)),this.messagingSystem.registerActionHandler(`${s.controllerName}:disable`,async(...e)=>this.disableSnap(...e)),this.messagingSystem.registerActionHandler(`${s.controllerName}:remove`,async(...e)=>this.removeSnap(...e)),this.messagingSystem.registerActionHandler(`${s.controllerName}:getPermitted`,(...e)=>this.getPermittedSnaps(...e)),this.messagingSystem.registerActionHandler(`${s.controllerName}:install`,async(...e)=>this.installSnaps(...e)),this.messagingSystem.registerActionHandler(`${s.controllerName}:getAll`,(...e)=>this.getAllSnaps(...e)),this.messagingSystem.registerActionHandler(`${s.controllerName}:getRunnableSnaps`,(...e)=>this.getRunnableSnaps(...e)),this.messagingSystem.registerActionHandler(`${s.controllerName}:incrementActiveReferences`,(...e)=>this.incrementActiveReferences(...e)),this.messagingSystem.registerActionHandler(`${s.controllerName}:decrementActiveReferences`,(...e)=>this.decrementActiveReferences(...e)),this.messagingSystem.registerActionHandler(`${s.controllerName}:disconnectOrigin`,(...e)=>this.removeSnapFromSubject(...e)),this.messagingSystem.registerActionHandler(`${s.controllerName}:revokeDynamicPermissions`,(...e)=>this.revokeDynamicSnapPermissions(...e)),this.messagingSystem.registerActionHandler(`${s.controllerName}:getFile`,async(...e)=>this.getSnapFile(...e)),this.messagingSystem.registerActionHandler(`${s.controllerName}:stopAllSnaps`,async(...e)=>this.stopAllSnaps(...e)),this.messagingSystem.registerActionHandler(`${s.controllerName}:isMinimumPlatformVersion`,(...e)=>this.isMinimumPlatformVersion(...e)),this.messagingSystem.registerActionHandler(`${s.controllerName}:setClientActive`,(...e)=>this.setClientActive(...e))}function se(e){for(const{snapId:s,manifest:n,files:i,removable:r,hidden:a,hideSnapBranding:o}of e){var t;const e=this.get(s),l=e!==undefined,u=l&&(0,f.gtVersion)(n.version,e.version);if(l&&(!u||!0!==e.preinstalled))continue;const h=new p.VirtualFile({path:p.NpmSnapFileNames.Manifest,value:JSON.stringify(n),result:n}),m=i.map(({path:e,value:t})=>new p.VirtualFile({value:t,path:e})),{filePath:g,iconPath:y}=n.source.location.npm,w=m.find(e=>e.path===g),S=y?m.find(e=>e.path===y):undefined;(0,f.assert)(w,"Source code not provided for preinstalled snap."),(0,f.assert)(!y||y&&S,"Icon not provided for preinstalled snap."),(0,f.assert)(n.source.files===undefined,"Auxiliary files are not currently supported for preinstalled snaps.");const b=(null===(t=n.source.locales)||void 0===t?void 0:t.map(e=>m.find(t=>t.path===e)))??[],k=(0,p.getValidatedLocalizationFiles)(b.filter(Boolean));(0,f.assert)(b.length===k.length,"Missing localization files for preinstalled snap.");const _={manifest:h,sourceCode:w,svgIcon:S,auxiliaryFiles:[],localizationFiles:k};c(Q,this,Ce).call(this,{id:s,origin:v.METAMASK_ORIGIN,files:_,removable:r,hidden:a,hideSnapBranding:o,preinstalled:!0});const T=(0,d.processSnapPermissions)(n.initialPermissions);c(Q,this,Oe).call(this,T);const{newPermissions:E,unusedPermissions:P}=c(Q,this,ze).call(this,s,T);c(Q,this,Ze).call(this,{snapId:s,newPermissions:E,unusedPermissions:P}),n.initialConnections&&c(Q,this,ye).call(this,s,(null==e?void 0:e.initialConnections)??null,n.initialConnections),this.update(e=>{e.snaps[s].status=p.SnapStatus.Stopped}),c(Q,this,Ge).call(this,s),u?this.messagingSystem.publish("SnapController:snapUpdated",this.getTruncatedExpect(s),e.version,v.METAMASK_ORIGIN,!0):this.messagingSystem.publish("SnapController:snapInstalled",this.getTruncatedExpect(s),v.METAMASK_ORIGIN,!0)}}function ne(){o(V,this,setTimeout(()=>{c(Q,this,le).call(this).catch(e=>{(0,p.logError)(e)}),c(Q,this,ne).call(this)},a(L,this)))}async function ie(e,t){if(this.has(e)){try{this.update(s=>{s.snaps[e].blocked=!0,s.snaps[e].blockInformation=t}),await this.disableSnap(e)}catch(t){(0,p.logError)(`Encountered error when stopping blocked snap "${e}".`,t)}this.messagingSystem.publish(`${s.controllerName}:snapBlocked`,e,t)}}function re(e){this.has(e)&&this.state.snaps[e].blocked&&(this.update(t=>{t.snaps[e].blocked=!1,delete t.snaps[e].blockInformation}),this.messagingSystem.publish(`${s.controllerName}:snapUnblocked`,e))}async function ae(e,{platformVersion:t,...s}){const n=(await this.messagingSystem.call("SnapsRegistry:get",{[e]:s}))[e];var i;if(n.status===k.SnapsRegistryStatus.Blocked)throw new Error(`Cannot install version "${s.version}" of snap "${e}": The version is blocked. ${(null===(i=n.reason)||void 0===i?void 0:i.explanation)??""}`);const r=Object.keys(s.permissions).some(e=>!v.ALLOWED_PERMISSIONS.includes(e));if(a(x,this).requireAllowlist&&r&&n.status!==k.SnapsRegistryStatus.Verified)throw new Error(`Cannot install version "${s.version}" of snap "${e}": ${n.status===k.SnapsRegistryStatus.Unavailable?"The registry is temporarily unavailable.":"The snap is not on the allowlist."}`);c(Q,this,Ae).call(this,e,t)}function oe(){(0,f.assert)(!0!==a(x,this).disableSnapInstallation,"Installing Snaps is currently disabled in this version of MetaMask.")}function ce(){const e=a($,this).call(this);(0,f.assert)(!0!==e.disableSnaps,"The Snaps platform requires basic functionality to be used. Enable basic functionality in the settings to use the Snaps platform.")}async function le(){const e=[...a(q,this).entries()];return Promise.all(e.filter(([e,t])=>0===t.activeReferences&&0===t.pendingInboundRequests.length&&t.lastRequest&&a(F,this)&&(0,f.timeSince)(t.lastRequest)>a(F,this)).map(async([e])=>this.stopSnap(e,p.SnapStatusEvents.Stop)))}function ue(e,t){const{interpreter:s}=c(Q,this,Ve).call(this,e);s.send(t),this.update(t=>{t.snaps[e].status=s.state.value})}async function he(e){await this.messagingSystem.call("ExecutionService:terminateSnap",e),await new Promise(e=>setTimeout(e,1));c(Q,this,Ve).call(this,e).pendingInboundRequests.filter(e=>"finished"!==e.timer.status).forEach(e=>e.timer.finish()),await new Promise(e=>setTimeout(e,1)),this.messagingSystem.publish("SnapController:snapTerminated",this.getTruncatedExpect(e))}function de(e,t=c(Q,this,Ve).call(this,e)){return null!==t.encryptionKey&&null!==t.encryptionSalt}async function me({snapId:e,salt:t,useCache:s,keyMetadata:n}){const i=c(Q,this,Ve).call(this,e);if(c(Q,this,de).call(this,e,i)&&s)return{key:await a(U,this).importKey(i.encryptionKey),salt:i.encryptionSalt};const r=t??a(U,this).generateSalt(),o=await a(H,this).call(this),l=await(0,d.getEncryptionEntropy)({snapId:e,seed:o,cryptographicFunctions:a(B,this)}),u=await a(U,this).keyFromPassword(l,r,!0,n),h=await a(U,this).exportKey(u);return s&&(i.encryptionKey=h,i.encryptionSalt=r),{key:u,salt:r}}async function pe(e,t){try{const s=JSON.parse(t),{salt:n,keyMetadata:i}=s,r=c(Q,this,de).call(this,e)||a(U,this).isVaultUpdated(t),{key:o}=await c(Q,this,me).call(this,{snapId:e,salt:n,useCache:r,keyMetadata:i??v.LEGACY_ENCRYPTION_KEY_DERIVATION_OPTIONS});return await a(U,this).decryptWithKey(o,s)}catch{throw h.rpcErrors.internal({message:"Failed to decrypt snap state, the state must be corrupted."})}}async function fe(e,t){const{key:s,salt:n}=await c(Q,this,me).call(this,{snapId:e,useCache:!0}),i=await a(U,this).encryptWithKey(s,t);return i.salt=n,JSON.stringify(i)}async function ge(e,t,s){return null===t?null:s?await c(Q,this,fe).call(this,e,t):JSON.stringify(t)}function ye(e,t,s){if(t){const n=(0,C.setDiff)(t,s);for(const t of Object.keys(n))this.removeSnapFromSubject(t,e)}for(const t of Object.keys(s))c(Q,this,we).call(this,t,e)}function we(e,t){var s,n;const i=this.messagingSystem.call("PermissionController:getPermissions",e),r=null==i||null===(s=i[d.WALLET_SNAP_PERMISSION_KEY])||void 0===s||null===(s=s.caveats)||void 0===s?void 0:s.find(e=>e.type===p.SnapCaveatType.SnapIds);if(Boolean(null==r||null===(n=r.value)||void 0===n?void 0:n[t]))return;if(r)return void this.messagingSystem.call("PermissionController:updateCaveat",e,d.WALLET_SNAP_PERMISSION_KEY,p.SnapCaveatType.SnapIds,{...r.value,[t]:{}});const a={[d.WALLET_SNAP_PERMISSION_KEY]:{caveats:[{type:p.SnapCaveatType.SnapIds,value:{[t]:{}}}]}};this.messagingSystem.call("PermissionController:grantPermissions",{approvedPermissions:a,subject:{origin:e}})}function Se(e){const t=this.messagingSystem.call("PermissionController:getSubjectNames");for(const s of t)this.removeSnapFromSubject(s,e)}function ve(e){this.messagingSystem.call("PermissionController:hasPermissions",e)&&this.messagingSystem.call("PermissionController:revokeAllPermissions",e)}function be({origin:e,snapId:t,type:s}){const n=(0,w.nanoid)();return{id:n,promise:this.messagingSystem.call("ApprovalController:addRequest",{origin:e,id:n,type:s,requestData:{metadata:{id:n,origin:t,dappOrigin:e},snapId:t},requestState:{loading:!0}},!0)}}function ke(e,t){try{this.messagingSystem.call("ApprovalController:updateRequestState",{id:e,requestState:t})}catch{}}async function _e(e,t){return await this.messagingSystem.call("SnapsRegistry:resolveVersion",e,t)}async function Te(e){const{id:t,location:s,versionRange:n}=e;c(Q,this,Ge).call(this,t);const i=c(Q,this,Ve).call(this,t);i.installPromise||((0,P.log)(`Adding snap: ${t}`),i.installPromise=(async()=>{const i=await(0,C.fetchSnap)(t,s),r=i.manifest.result;if(!(0,f.satisfiesVersionRange)(r.version,n))throw new Error(`Version mismatch. Manifest for "${t}" specifies version "${r.version}" which doesn't satisfy requested version range "${n}".`);await c(Q,this,ae).call(this,t,{version:r.version,checksum:r.source.shasum,permissions:r.initialPermissions,platformVersion:r.platformVersion});const o=a(x,this).forcePreinstalledSnaps&&(0,C.isLocalSnapId)(t)?{preinstalled:!0,hideSnapBranding:!0,hidden:!1}:{};return c(Q,this,Ce).call(this,{...e,files:i,id:t,...o})})());try{return await i.installPromise}catch(e){throw i.installPromise=null,e}}async function Ee(e){const{snapId:t}=e;if(this.isRunning(t))throw new Error(`Snap "${t}" is already started.`);try{const s=c(Q,this,Ve).call(this,t),n=await this.messagingSystem.call("ExecutionService:executeSnap",{...e,endowments:await c(Q,this,Pe).call(this,t)});return c(Q,this,ue).call(this,t,p.SnapStatusEvents.Start),s.lastRequest=Date.now(),n}catch(e){throw await c(Q,this,he).call(this,t),e}}async function Pe(e){let t=[];for(const s of a(N,this))if(this.messagingSystem.call("PermissionController:hasPermission",e,s)){const n=await this.messagingSystem.call("PermissionController:getEndowments",e,s);if(n){if(!Array.isArray(n)||n.some(e=>"string"!=typeof e))throw new Error("Expected an array of string endowment names.");t=t.concat(n)}}const s=[...new Set([...p.DEFAULT_ENDOWMENTS,...t])];return s.length<p.DEFAULT_ENDOWMENTS.length+t.length&&(0,p.logError)(`Duplicate endowments found for ${e}. Default endowments should not be requested.`,t),s}function Ce(e){const{id:t,origin:s,files:n,isUpdate:i=!1,removable:r,preinstalled:o,hidden:l,hideSnapBranding:h}=e,{manifest:d,sourceCode:m,svgIcon:g,auxiliaryFiles:y,localizationFiles:w}=n;(0,p.assertIsSnapManifest)(d.result);const{version:S}=d.result,v=m.toString();(0,f.assert)("string"==typeof v&&v.length>0,`Invalid source code for snap "${t}".`);const b=y.map(e=>((0,f.assert)("string"==typeof e.data.base64),{path:e.path,value:e.data.base64})),k=this.state.snaps[t],_=[...(null==k?void 0:k.versionHistory)??[],{version:S,date:Date.now(),origin:s}],T=w.map(e=>e.result),E={...k,blocked:!1,enabled:!0,removable:r,preinstalled:o,hidden:l,hideSnapBranding:h,id:t,initialConnections:d.result.initialConnections,initialPermissions:d.result.initialPermissions,manifest:d.result,status:a(G,this).config.initial,sourceCode:v,version:S,versionHistory:_,auxiliaryFiles:b,localizationFiles:T};delete E.blockInformation;const{inversePatches:P}=this.update(e=>{e.snaps[t]=E});if(i){const e=c(Q,this,$e).call(this,t);e!==undefined&&(e.statePatches=P)}const{proposedName:C}=(0,p.getLocalizedSnapManifest)(d.result,"en",T);return this.messagingSystem.call("SubjectMetadataController:addSubjectMetadata",{subjectType:u.SubjectType.Snap,name:C,origin:E.id,version:S,svgIcon:(null==g?void 0:g.toString())??null}),{...E,sourceCode:v}}function Oe(e){const t=Object.keys(e),s=Array.from(new Set(Object.values(d.handlerEndowments)));(0,f.assert)(t.some(e=>s.includes(e)),`A snap must request at least one of the following permissions: ${s.filter(e=>null!==e).join(", ")}.`);const n=t.reduce((e,t)=>((0,f.hasProperty)(a(R,this),t)&&e.push(a(R,this)[t]),e),[]);(0,f.assert)(0===n.length,`One or more permissions are not allowed:\n${n.join("\n")}`)}function Ae(e,t){if(t!==undefined&&(0,S.gt)(t,(0,p.getPlatformVersion)())){const s=`The Snap "${e}" requires platform version "${t}" which is greater than the current platform version "${(0,p.getPlatformVersion)()}".`;if(a(x,this).rejectInvalidPlatformVersion)throw new Error(s);(0,p.logWarning)(s)}}function Ie(e){return(0,d.getMaxRequestTimeCaveat)(e)??this.maxRequestTime}async function Me(e,t,s){return this.messagingSystem.call("SnapInterfaceController:createInterface",e,t,undefined,s)}function je(e,t){(0,f.assert)(this.messagingSystem.call("SnapInterfaceController:getInterface",e,t))}async function Ne(e,t,s,n){switch(t){case p.HandlerType.OnTransaction:case p.HandlerType.OnSignature:case p.HandlerType.OnHomePage:case p.HandlerType.OnSettingsPage:{const t=n;if(t&&(0,f.hasProperty)(t,"content")){const{content:s,...n}=t;return{...n,id:await c(Q,this,Me).call(this,e,s)}}return n}case p.HandlerType.OnAssetsLookup:return c(Q,this,Re).call(this,e,s,n);case p.HandlerType.OnAssetsConversion:return c(Q,this,xe).call(this,s,n);case p.HandlerType.OnAssetsMarketData:return c(Q,this,De).call(this,s,n);default:return n}}function Re(e,{params:t},{assets:s}){const n=this.messagingSystem.call("PermissionController:getPermissions",e);(0,f.assert)(n);const i=n[d.SnapEndowments.Assets],r=(0,d.getChainIdsCaveat)(i);(0,f.assert)(r);const{assets:a}=t;return{assets:Object.keys(s).reduce((e,t)=>{const n=t;return r.some(e=>n.startsWith(e))&&a.includes(n)&&(e[n]=s[n]),e},{})}}function xe({params:e},{conversionRates:t}){const{conversions:s}=e;return{conversionRates:s.reduce((e,s)=>{var n;const i=null===(n=t[s.from])||void 0===n?void 0:n[s.to];var r;i&&(e[r=s.from]??(e[r]={}),e[s.from][s.to]=i);return e},{})}}function De({params:e},{marketData:t}){const{assets:s}=e;return{marketData:s.reduce((e,s)=>{var n;const i=null===(n=t[s.asset])||void 0===n?void 0:n[s.unit];var r;i&&(e[r=s.asset]??(e[r]={}),e[s.asset][s.unit]=i);return e},{})}}function Le(e,t,s){if(t===p.HandlerType.OnUserInput){(0,f.assert)(s.params&&(0,f.hasProperty)(s.params,"id"));const t=s.params.id,{context:n}=this.messagingSystem.call("SnapInterfaceController:getInterface",e,t);return{...s,params:{...s.params,context:n}}}return s}async function Fe(e,t,s){switch(t){case p.HandlerType.OnTransaction:(0,f.assertStruct)(s,p.OnTransactionResponseStruct),s&&(0,f.hasProperty)(s,"id")&&c(Q,this,je).call(this,e,s.id);break;case p.HandlerType.OnSignature:(0,f.assertStruct)(s,p.OnSignatureResponseStruct),s&&(0,f.hasProperty)(s,"id")&&c(Q,this,je).call(this,e,s.id);break;case p.HandlerType.OnHomePage:(0,f.assertStruct)(s,p.OnHomePageResponseStruct),s&&(0,f.hasProperty)(s,"id")&&c(Q,this,je).call(this,e,s.id);break;case p.HandlerType.OnSettingsPage:(0,f.assertStruct)(s,p.OnSettingsPageResponseStruct),s&&(0,f.hasProperty)(s,"id")&&c(Q,this,je).call(this,e,s.id);break;case p.HandlerType.OnNameLookup:(0,f.assertStruct)(s,p.OnNameLookupResponseStruct);break;case p.HandlerType.OnAssetsLookup:(0,f.assertStruct)(s,m.OnAssetsLookupResponseStruct);break;case p.HandlerType.OnAssetsConversion:(0,f.assertStruct)(s,p.OnAssetsConversionResponseStruct);break;case p.HandlerType.OnAssetHistoricalPrice:(0,f.assertStruct)(s,p.OnAssetHistoricalPriceResponseStruct);break;case p.HandlerType.OnAssetsMarketData:(0,f.assertStruct)(s,p.OnAssetsMarketDataResponseStruct)}}function Ue(e,t,s){const n=c(Q,this,Ve).call(this,e);n.pendingInboundRequests.push({requestId:t,timer:s}),n.lastRequest=null}function He(e,t,s,n,i){const r=c(Q,this,Ve).call(this,e);r.pendingInboundRequests=r.pendingInboundRequests.filter(e=>e.requestId!==t),0===r.pendingInboundRequests.length&&(r.lastRequest=Date.now());const o=this.get(e);if((0,C.isTrackableHandler)(s)&&(null==o||!o.preinstalled))try{a(Y,this).call(this,e,s,i,n)}catch(e){(0,p.logError)(`Error when calling MetaMetrics hook for snap "${null==o?void 0:o.id}": ${(0,m.getErrorMessage)(e)}`)}}function $e(e){return a(K,this).get(e)}function Be(e){(0,f.assert)(a(K,this).get(e)===undefined,new Error(`Snap "${e}" rollback snapshot already exists.`)),a(K,this).set(e,{statePatches:[],permissions:{},newVersion:""});const t=a(K,this).get(e);return(0,f.assert)(t!==undefined,new Error(`Snapshot creation failed for ${e}.`)),t}async function We(e){var t,s;const n=c(Q,this,$e).call(this,e);if(!n)throw new Error("A snapshot does not exist for this snap.");await this.stopSnap(e,p.SnapStatusEvents.Stop),(null===(t=this.get(e))||void 0===t?void 0:t.status)!==p.SnapStatus.Stopped&&c(Q,this,ue).call(this,e,p.SnapStatusEvents.Stop);const{statePatches:i,permissions:r}=n;null!=i&&i.length&&this.applyPatches(i),(null===(s=this.get(e))||void 0===s?void 0:s.status)!==p.SnapStatus.Stopped&&this.update(t=>{t.snaps[e].status=p.SnapStatus.Stopped}),c(Q,this,Ze).call(this,{snapId:e,unusedPermissions:r.granted,newPermissions:r.revoked,requestData:r.requestData});const o=this.getTruncatedExpect(e);this.messagingSystem.publish("SnapController:snapRolledback",o,n.newVersion),a(K,this).delete(e)}async function qe(e){for(const t of e)await c(Q,this,We).call(this,t)}function Ke(e){return a(q,this).get(e)}function Ve(e){const t=c(Q,this,Ke).call(this,e);return(0,f.assert)(t!==undefined,new Error(`Snap "${e}" runtime data not found`)),t}function Ge(e){if(a(q,this).has(e))return;const t=this.get(e),s=(0,g.interpret)(a(G,this));s.start({context:{snapId:e},value:(null==t?void 0:t.status)??a(G,this).config.initial}),(0,E.forceStrict)(s),a(q,this).set(e,{lastRequest:null,startPromise:null,stopPromise:null,installPromise:null,encryptionKey:null,encryptionSalt:null,activeReferences:0,pendingInboundRequests:[],pendingOutboundRequests:0,interpreter:s,stateMutex:new y.Mutex,getStateMutex:new y.Mutex})}function ze(e,t){const s=this.messagingSystem.call("PermissionController:getPermissions",e)??{},n=(0,C.permissionsDiff)(t,s),i=(0,C.permissionsDiff)(s,t);return{newPermissions:n,unusedPermissions:i,approvedPermissions:(0,C.permissionsDiff)(s,i)}}function Je(e,t){var s,n;const i=this.messagingSystem.call("PermissionController:getPermissions",t),r=null==i||null===(s=i[d.WALLET_SNAP_PERMISSION_KEY])||void 0===s||null===(s=s.caveats)||void 0===s?void 0:s.find(e=>e.type===p.SnapCaveatType.SnapIds);return Boolean(null==r||null===(n=r.value)||void 0===n?void 0:n[e])}function Ye(e,t,s){const n=Object.keys(t).filter(t=>c(Q,this,Je).call(this,e,t)).reduce((e,s)=>(e[s]=t[s],e),{}),i=(0,C.setDiff)(s,n),r=(0,C.setDiff)(n,s);return{newConnections:i,unusedConnections:r,approvedConnections:(0,C.setDiff)(n,r)}}function Qe(e,t){if(a(x,this).useCaip25Permission&&Object.keys(t).includes(d.SnapEndowments.EthereumProvider)){const s=this.messagingSystem.call("SelectedNetworkController:getNetworkClientIdForDomain",e),{configuration:n}=this.messagingSystem.call("NetworkController:getNetworkClientById",s),i=(0,f.hexToNumber)(n.chainId);return{...t,"endowment:caip25":{caveats:[{type:"authorizedScopes",value:{requiredScopes:{},optionalScopes:{[`eip155:${i}`]:{accounts:[]}},sessionProperties:{},isMultichainOrigin:!1}}]}}}return t}function Ze({snapId:e,unusedPermissions:t={},newPermissions:s={},requestData:n}){const i=Object.keys(t);if((0,f.isNonEmptyArray)(i)&&this.messagingSystem.call("PermissionController:revokePermissions",{[e]:i}),(0,f.isNonEmptyArray)(Object.keys(s))){const t=c(Q,this,Qe).call(this,e,s);this.messagingSystem.call("PermissionController:grantPermissions",{approvedPermissions:t,subject:{origin:e},requestData:n})}}function Xe(e,t){const s=this.getExpect(e);return!(0,f.satisfiesVersionRange)(s.version,t)&&!(0,f.gtRange)(s.version,t)}function et(e,t){const s=this.getRunnableSnaps();for(const{id:n}of s){this.messagingSystem.call("PermissionController:hasPermission",n,d.SnapEndowments.LifecycleHooks)&&c(Q,this,tt).call(this,e,n,t).catch(e=>{(0,p.logError)(`Error calling lifecycle hook "${t}" for Snap "${n}": ${(0,m.getErrorMessage)(e)}`)})}}async function tt(e,t,s){const n=d.handlerEndowments[s];(0,f.assert)(n,"Lifecycle hook must have an endowment.");this.messagingSystem.call("PermissionController:hasPermission",t,n)&&await this.handleRequest({snapId:t,handler:s,origin:e,request:{jsonrpc:"2.0",method:s}})}function st(){for(const e of a(q,this).values())e.encryptionKey=null,e.encryptionSalt=null,e.state=undefined}s.SnapController=X}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/SnapController.cjs"}],[2026,{"@metamask/utils":2359},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){function n(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var n=s.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}Object.defineProperty(s,"__esModule",{value:!0}),s.Timer=void 0;const i=e("@metamask/utils");s.Timer=class{constructor(e){n(this,"state",void 0),(0,i.assert)(!Number.isNaN(e),new TypeError("Can't start a timer with NaN time")),(0,i.assert)(e>=0,new TypeError("Can't start a timer with negative time")),this.state={value:"stopped",remaining:e}}get status(){return this.state.value}get remaining(){return this.state.remaining}cancel(){(0,i.assert)("paused"===this.status||"running"===this.status,new Error("Tried to cancel a not running Timer")),this.onFinish(!1)}finish(){(0,i.assert)("finished"!==this.status,new Error("Tried to finish a finished Timer.")),this.onFinish(!0)}pause(){(0,i.assert)("running"===this.state.value,new Error("Tried to pause a not running Timer"));const{callback:e,start:t,timeout:s,remaining:n}=this.state;s!==undefined&&clearTimeout(s),this.state={value:"paused",callback:e,remaining:n-(Date.now()-t)}}start(e){(0,i.assert)("stopped"===this.state.value,new Error("Tried to start an already running Timer"));const{remaining:t}=this.state;this.state={value:"paused",remaining:t,callback:e},this.resume()}resume(){(0,i.assert)("paused"===this.state.value,new Error("Tried to resume not paused Timer"));const{remaining:e,callback:t}=this.state,s=Date.now();let n;e!==Number.POSITIVE_INFINITY&&(n=setTimeout(()=>this.onFinish(!0),e)),this.state={value:"running",callback:t,remaining:e,start:s,timeout:n}}onFinish(e){(0,i.assert)("running"===this.state.value||"paused"===this.state.value),"running"===this.state.value&&this.state.timeout!==undefined&&clearTimeout(this.state.timeout);const{callback:t,remaining:s}=this.state;this.state={value:"finished",remaining:"running"===this.state.value?s-(Date.now()-this.state.start):s},e&&t()}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/Timer.cjs"}],[2027,{"@metamask/snaps-rpc-methods":2072,"@metamask/snaps-utils":2242},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.CLIENT_ONLY_HANDLERS=s.METAMASK_ORIGIN=s.STATE_DEBOUNCE_TIMEOUT=s.LEGACY_ENCRYPTION_KEY_DERIVATION_OPTIONS=s.ALLOWED_PERMISSIONS=void 0;const n=e("@metamask/snaps-rpc-methods"),i=e("@metamask/snaps-utils");s.ALLOWED_PERMISSIONS=Object.freeze(["snap_dialog","snap_manageState","snap_notify","snap_getLocale",n.SnapEndowments.Cronjob,n.SnapEndowments.HomePage,n.SnapEndowments.LifecycleHooks,n.SnapEndowments.EthereumProvider,n.SnapEndowments.TransactionInsight,n.SnapEndowments.SignatureInsight]),s.LEGACY_ENCRYPTION_KEY_DERIVATION_OPTIONS={algorithm:"PBKDF2",params:{iterations:1e4}},s.STATE_DEBOUNCE_TIMEOUT=500,s.METAMASK_ORIGIN="metamask",s.CLIENT_ONLY_HANDLERS=Object.freeze([i.HandlerType.OnClientRequest,i.HandlerType.OnSignature,i.HandlerType.OnTransaction,i.HandlerType.OnCronjob,i.HandlerType.OnNameLookup,i.HandlerType.OnHomePage,i.HandlerType.OnSettingsPage,i.HandlerType.OnUserInput,i.HandlerType.OnAssetsLookup,i.HandlerType.OnAssetsConversion,i.HandlerType.OnAssetHistoricalPrice,i.HandlerType.OnAssetsMarketData,i.HandlerType.OnWebSocketEvent])}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/constants.cjs"}],[2028,{"./SnapController.cjs":2025,"./constants.cjs":2027,"./location/index.cjs":2030,"./registry/index.cjs":2034,"./selectors.cjs":2037},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n=Object.create?function(e,t,s,n){n===undefined&&(n=s);var i=Object.getOwnPropertyDescriptor(t,s);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,n,i)}:function(e,t,s,n){n===undefined&&(n=s),e[n]=t[s]},i=function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||n(t,e,s)};Object.defineProperty(s,"__esModule",{value:!0}),i(e("./constants.cjs"),s),i(e("./location/index.cjs"),s),i(e("./SnapController.cjs"),s),i(e("./selectors.cjs"),s),i(e("./registry/index.cjs"),s)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/index.cjs"}],[2029,{"@metamask/snaps-utils":2242,"@metamask/utils":2359},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){function n(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var n=s.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}Object.defineProperty(s,"__esModule",{value:!0}),s.HttpLocation=void 0;const i=e("@metamask/snaps-utils"),r=e("@metamask/utils");s.HttpLocation=class{constructor(e,t={}){n(this,"cache",new Map),n(this,"validatedManifest",void 0),n(this,"url",void 0),n(this,"fetchFn",void 0),n(this,"fetchOptions",void 0),(0,r.assertStruct)(e.toString(),i.HttpSnapIdStruct,"Invalid Snap Id: "),this.fetchFn=t.fetch??globalThis.fetch.bind(undefined),this.fetchOptions=t.fetchOptions,this.url=e}async manifest(){if(this.validatedManifest)return this.validatedManifest.clone();const e=new URL(i.NpmSnapFileNames.Manifest,this.url).toString(),t=await this.fetchFn(e,this.fetchOptions);if(!t.ok)throw new Error(`Failed to fetch "${e}". Status code: ${t.status}.`);const s=await t.text(),n=(0,i.parseJson)(s),r=new i.VirtualFile({value:s,result:(0,i.createSnapManifest)(n),path:i.NpmSnapFileNames.Manifest,data:{canonicalPath:e}});return this.validatedManifest=r,this.manifest()}async fetch(e){const t=(0,i.normalizeRelative)(e),s=this.cache.get(t);if(s!==undefined)return s.clone();const n=this.toCanonical(t).toString(),a=await this.fetchFn(n,this.fetchOptions);if(!a.ok)throw new Error(`Failed to fetch "${n}". Status code: ${a.status}.`);const o=await a.arrayBuffer(),c=new i.VirtualFile({value:new Uint8Array(o),path:t,data:{canonicalPath:n}});return(0,r.assert)(!this.cache.has(t),"Corrupted cache, multiple files with same path."),this.cache.set(t,c),this.fetch(t)}get root(){return new URL(this.url)}toCanonical(e){return(0,r.assert)(!e.startsWith("/"),"Tried to parse absolute path."),new URL(e,this.url)}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/location/http.cjs"}],[2030,{"./http.cjs":2029,"./local.cjs":2031,"./location.cjs":2032,"./npm.cjs":2033},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n=Object.create?function(e,t,s,n){n===undefined&&(n=s);var i=Object.getOwnPropertyDescriptor(t,s);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,n,i)}:function(e,t,s,n){n===undefined&&(n=s),e[n]=t[s]},i=function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||n(t,e,s)};Object.defineProperty(s,"__esModule",{value:!0}),i(e("./location.cjs"),s),i(e("./npm.cjs"),s),i(e("./local.cjs"),s),i(e("./http.cjs"),s)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/location/index.cjs"}],[2031,{"./http.cjs":2029,"@metamask/snaps-utils":2242,"@metamask/utils":2359},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){function n(e,t,s){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,s)}function i(e,t){return e.get(r(e,t))}function r(e,t,s){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:s;throw new TypeError("Private element is not present on this object")}Object.defineProperty(s,"__esModule",{value:!0}),s.LocalLocation=void 0;const a=e("@metamask/snaps-utils"),o=e("@metamask/utils"),c=e("./http.cjs");var l=new WeakMap;function u(e){return(0,o.assert)(e.data.canonicalPath!==undefined),e.data.canonicalPath=`local:${e.data.canonicalPath}`,e}s.LocalLocation=class{constructor(e,t={}){var s,i,u;n(this,l,void 0),(0,o.assertStruct)(e.toString(),a.LocalSnapIdStruct,"Invalid Snap Id"),(0,o.assert)(t.fetchOptions===undefined,"Currently adding fetch options to local: is unsupported."),s=l,i=this,u=new c.HttpLocation(new URL(e.toString().slice(a.SnapIdPrefixes.local.length)),{...t,fetchOptions:{cache:"no-cache"}}),s.set(r(s,i),u)}async manifest(){return u(await i(l,this).manifest())}async fetch(e){return u(await i(l,this).fetch(e))}get shouldAlwaysReload(){return!0}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/location/local.cjs"}],[2032,{"./http.cjs":2029,"./local.cjs":2031,"./npm.cjs":2033,"@metamask/utils":2359},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.detectSnapLocation=void 0;const n=e("@metamask/utils"),i=e("./http.cjs"),r=e("./local.cjs"),a=e("./npm.cjs");s.detectSnapLocation=function(e,t){const s=(null==t?void 0:t.allowHttp)??!1,o=(null==t?void 0:t.allowLocal)??!1,c=new URL(e);switch(c.protocol){case"npm:":return new a.NpmLocation(c,t);case"local:":return(0,n.assert)(o,new TypeError("Fetching local snaps is disabled.")),new r.LocalLocation(c,t);case"http:":case"https:":return(0,n.assert)(s,new TypeError("Fetching snaps through http/https is disabled.")),new i.HttpLocation(c,t);default:throw new TypeError(`Unrecognized "${c.protocol}" snap location protocol.`)}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/location/location.cjs"}],[2033,{"@metamask/snaps-utils":2242,"@metamask/utils":2359,"concat-stream":2041,"get-npm-tarball-url":3710,"readable-stream":4452,"readable-web-to-node-stream":4453,"tar-stream":2045},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){function n(e,t,s){i(e,t),t.set(e,s)}function i(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function r(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var n=s.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function a(e,t,s){return e.set(c(e,t),s),s}function o(e,t){return e.get(c(e,t))}function c(e,t,s){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:s;throw new TypeError("Private element is not present on this object")}var l=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(s,"__esModule",{value:!0}),s.getNpmCanonicalBasePath=s.fetchNpmMetadata=s.NpmLocation=s.TARBALL_SIZE_SAFETY_LIMIT=s.BaseNpmLocation=s.DEFAULT_NPM_REGISTRY=void 0;const u=e("@metamask/snaps-utils"),h=e("@metamask/utils"),d=l(e("concat-stream")),m=l(e("get-npm-tarball-url")),p=e("readable-stream"),f=e("readable-web-to-node-stream"),g=e("tar-stream");s.DEFAULT_NPM_REGISTRY=new URL("https://registry.npmjs.org");var y=new WeakMap,w=new WeakMap,S=new WeakSet;class v{constructor(e,t={}){var a,o;i(a=this,o=S),o.add(a),r(this,"meta",void 0),n(this,y,void 0),n(this,w,void 0);const c=t.allowCustomRegistries??!1,l=t.fetch??globalThis.fetch.bind(undefined),d=t.versionRange??u.DEFAULT_REQUESTED_SNAP_VERSION,m=t.resolveVersion??(async e=>e);let p;(0,h.assertStruct)(e.toString(),u.NpmSnapIdStruct,"Invalid Snap Id: "),""===e.host&&""===e.port&&""===e.username&&""===e.password?p=s.DEFAULT_NPM_REGISTRY:(p="https://",e.username&&(p+=e.username,e.password&&(p+=`:${e.password}`),p+="@"),p+=e.host,p=new URL(p),(0,h.assert)(c,new TypeError(`Custom NPM registries are disabled, tried to use "${p.toString()}".`))),(0,h.assert)("/"===p.pathname&&""===p.search&&""===p.hash),(0,h.assert)(""!==e.pathname&&"/"!==e.pathname,new TypeError("The package name in NPM location is empty."));let f=e.pathname;f.startsWith("/")&&(f=f.slice(1)),this.meta={requestedRange:d,registry:p,packageName:f,fetch:l,resolveVersion:m}}async manifest(){if(o(y,this))return o(y,this).clone();const e=await this.fetch("snap.manifest.json"),t=(0,u.parseJson)(e.toString());return e.result=(0,u.createSnapManifest)(t),a(y,this,e),this.manifest()}async fetch(e){const t=(0,u.normalizeRelative)(e);o(w,this)||(await c(S,this,b).call(this),(0,h.assert)(o(w,this)!==undefined));const s=o(w,this).get(t);return(0,h.assert)(s!==undefined,new TypeError(`File "${e}" not found in package.`)),s.clone()}get packageName(){return this.meta.packageName}get version(){return(0,h.assert)(this.meta.version!==undefined,"Tried to access version without first fetching NPM package."),this.meta.version}get registry(){return this.meta.registry}get versionRange(){return this.meta.requestedRange}}async function b(){(0,h.assert)(o(w,this)===undefined);const e=await this.meta.resolveVersion(this.meta.requestedRange),{tarballURL:t,targetVersion:s}=await async function(e,t,s,n){var i;if(T(s)&&(0,h.isValidSemVerVersion)(t))return{tarballURL:(0,m.default)(e,t),targetVersion:t};const r=await k(e,s,n),a=Object.keys((null==r?void 0:r.versions)??{}).map(e=>((0,h.assertIsSemVerVersion)(e),e)),o=(0,u.getTargetVersion)(a,t);if(null===o)throw new Error(`Failed to find a matching version in npm metadata for package "${e}" and requested semver range "${t}".`);const c=null==r||null===(i=r.versions)||void 0===i||null===(i=i[o])||void 0===i||null===(i=i.dist)||void 0===i?void 0:i.tarball;return{tarballURL:c,targetVersion:o}}(this.meta.packageName,e,this.meta.registry,this.meta.fetch);if(!(0,u.isValidUrl)(t)||!t.toString().endsWith(".tgz"))throw new Error(`Failed to find valid tarball URL in NPM metadata for package "${this.meta.packageName}".`);const n=new URL(t);n.hostname=this.meta.registry.hostname,n.protocol=this.meta.registry.protocol;const i=await this.fetchNpmTarball(n);a(w,this,i),this.meta.version=s}s.BaseNpmLocation=v,s.TARBALL_SIZE_SAFETY_LIMIT=262144e3;async function k(e,t,s){const n=await s(new URL(e,t).toString(),{headers:{accept:T(t)?"application/vnd.npm.install-v1+json; q=1.0, application/json; q=0.8, */*":"application/json"}});if(!n.ok)throw new Error(`Failed to fetch NPM registry entry. Status code: ${n.status}.`);const i=await n.json();if(!(0,h.isObject)(i))throw new Error(`Failed to fetch package "${e}" metadata from npm.`);return i}function _(e,t){let s="npm://";return""!==e.username&&(s+=e.username,""!==e.password&&(s+=`:${e.password}`),s+="@"),`${s}${e.host}/${t}/`}function T(e){return e.toString()===s.DEFAULT_NPM_REGISTRY.toString()}s.NpmLocation=class extends v{async fetchNpmTarball(e){const t=await this.meta.fetch(e.toString());if(!t.ok||!t.body)throw new Error(`Failed to fetch tarball for package "${this.meta.packageName}".`);const n=t.headers.get("content-length");(0,h.assert)(n,"Snap tarball has invalid content-length");const i=parseInt(n,10);return(0,h.assert)(i<=s.TARBALL_SIZE_SAFETY_LIMIT,"Snap tarball exceeds size limit"),new Promise((e,n)=>{const i=new Map,r=function(e,t){(0,h.assert)(e.endsWith("/"),"Base needs to end with '/' for relative paths to be added as children instead of siblings."),(0,h.assert)(e.startsWith("npm:"),'Protocol mismatch, expected "npm:".');const n=(0,g.extract)();let i=0;return n.on("entry",(r,a,o)=>{const{name:c,type:l}=r;if("file"===l){const r=c.replace(E,"");return a.pipe((0,d.default)({encoding:"uint8array"},a=>{try{i+=a.byteLength,(0,h.assert)(i<s.TARBALL_SIZE_SAFETY_LIMIT,`Snap tarball exceeds limit of ${s.TARBALL_SIZE_SAFETY_LIMIT} bytes.`);const n=new u.VirtualFile({value:a,path:r,data:{canonicalPath:new URL(r,e).toString()}});return(0,h.assert)(!t.has(r),"Malformed tarball, multiple files with the same path."),t.set(r,n),o()}catch(e){return n.destroy(e)}}))}return a.on("end",()=>o()),a.resume()}),n}(_(this.meta.registry,this.meta.packageName),i),a=t.body,o=new DecompressionStream("gzip"),c=a.pipeThrough(o);(0,p.pipeline)(function(e){if("function"!=typeof e.getReader)return e;return new f.ReadableWebToNodeStream(e)}(c),r,t=>{t?n(t):e(i)})})}},s.fetchNpmMetadata=k,s.getNpmCanonicalBasePath=_;const E=/^package\//u}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/location/npm.cjs"}],[2034,{"./json.cjs":2035,"./registry.cjs":2036},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n=Object.create?function(e,t,s,n){n===undefined&&(n=s);var i=Object.getOwnPropertyDescriptor(t,s);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,n,i)}:function(e,t,s,n){n===undefined&&(n=s),e[n]=t[s]},i=function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||n(t,e,s)};Object.defineProperty(s,"__esModule",{value:!0}),i(e("./registry.cjs"),s),i(e("./json.cjs"),s)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/registry/index.cjs"}],[2035,{"./registry.cjs":2036,"@metamask/base-controller":1241,"@metamask/snaps-registry":2051,"@metamask/snaps-utils":2242,"@metamask/utils":2359},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){function n(e,t,s){i(e,t),t.set(e,s)}function i(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function r(e,t){return e.get(o(e,t))}function a(e,t,s){return e.set(o(e,t),s),s}function o(e,t,s){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:s;throw new TypeError("Private element is not present on this object")}Object.defineProperty(s,"__esModule",{value:!0}),s.JsonSnapsRegistry=void 0;const c=e("@metamask/base-controller"),l=e("@metamask/snaps-registry"),u=e("@metamask/snaps-utils"),h=e("@metamask/utils"),d=e("./registry.cjs"),m={database:null,lastUpdated:null,databaseUnavailable:!1};var p=new WeakMap,f=new WeakMap,g=new WeakMap,y=new WeakMap,w=new WeakMap,S=new WeakMap,v=new WeakSet;class b extends c.BaseController{constructor({messenger:e,state:t,url:s={registry:"https://acl.execution.metamask.io/latest/registry.json",signature:"https://acl.execution.metamask.io/latest/signature.json"},publicKey:r="0x025b65308f0f0fb8bc7f7ff87bfc296e0330eee5d3c1d1ee4a048b2fd6a86fa0a6",fetchFunction:c=globalThis.fetch.bind(undefined),recentFetchThreshold:l=(0,h.inMilliseconds)(5,h.Duration.Minute),refetchOnAllowlistMiss:u=!0}){var d,b;super({messenger:e,metadata:{database:{persist:!0,anonymous:!1},lastUpdated:{persist:!0,anonymous:!1},databaseUnavailable:{persist:!0,anonymous:!1}},name:"SnapsRegistry",state:{...m,...t}}),i(d=this,b=v),b.add(d),n(this,p,void 0),n(this,f,void 0),n(this,g,void 0),n(this,y,void 0),n(this,w,void 0),n(this,S,void 0),a(p,this,s),a(f,this,r),a(g,this,c),a(y,this,l),a(w,this,u),a(S,this,null),this.messagingSystem.registerActionHandler("SnapsRegistry:get",async(...e)=>o(v,this,C).call(this,...e)),this.messagingSystem.registerActionHandler("SnapsRegistry:getMetadata",(...e)=>o(v,this,A).call(this,...e)),this.messagingSystem.registerActionHandler("SnapsRegistry:resolveVersion",async(...e)=>o(v,this,O).call(this,...e)),this.messagingSystem.registerActionHandler("SnapsRegistry:update",async()=>o(v,this,_).call(this))}}function k(){return this.state.lastUpdated&&Date.now()-this.state.lastUpdated<r(y,this)}async function _(){r(S,this)?await r(S,this):(null===r(S,this)&&a(S,this,o(v,this,T).call(this)),await r(S,this),a(S,this,null))}async function T(){if(!o(v,this,k).call(this))try{const[e,t]=await Promise.all([o(v,this,M).call(this,r(p,this).registry),o(v,this,M).call(this,r(p,this).signature)]);o(v,this,I).call(this,e,t),this.update(t=>{t.database=JSON.parse(e),t.lastUpdated=Date.now(),t.databaseUnavailable=!1})}catch{this.update(e=>{e.databaseUnavailable=!0})}}async function E(){return null===this.state.database&&await o(v,this,_).call(this),this.state.database}async function P(e,t,s=!1){var n;const i=await o(v,this,E).call(this),a=null==i?void 0:i.blockedSnaps.find(s=>"id"in s?s.id===e&&(0,h.satisfiesVersionRange)(t.version,s.versionRange):s.checksum===t.checksum);if(a)return{status:d.SnapsRegistryStatus.Blocked,reason:a.reason};const c=null==i?void 0:i.verifiedSnaps[e],l=null==c||null===(n=c.versions)||void 0===n?void 0:n[t.version];return l&&l.checksum===t.checksum?{status:d.SnapsRegistryStatus.Verified}:r(w,this)&&!s?(await o(v,this,_).call(this),o(v,this,P).call(this,e,t,!0)):{status:this.state.databaseUnavailable?d.SnapsRegistryStatus.Unavailable:d.SnapsRegistryStatus.Unverified}}async function C(e){return Object.entries(e).reduce(async(e,[t,s])=>{const n=await o(v,this,P).call(this,t,s),i=await e;return i[t]=n,i},Promise.resolve({}))}async function O(e,t,s=!1){var n;const i=await o(v,this,E).call(this),a=(null==i||null===(n=i.verifiedSnaps[e])||void 0===n?void 0:n.versions)??null;if(!a&&r(w,this)&&!s)return await o(v,this,_).call(this),o(v,this,O).call(this,e,t,!0);if(!a)return t;const c=(0,u.getTargetVersion)(Object.keys(a),t);return c||!r(w,this)||s?c?((0,h.assertIsSemVerRange)(c),c):t:(await o(v,this,_).call(this),o(v,this,O).call(this,e,t,!0))}function A(e){var t;return(null===(t=this.state)||void 0===t||null===(t=t.database)||void 0===t||null===(t=t.verifiedSnaps[e])||void 0===t?void 0:t.metadata)??null}function I(e,t){(0,h.assert)(r(f,this),"No public key provided.");const s=(0,l.verify)({registry:e,signature:JSON.parse(t),publicKey:r(f,this)});(0,h.assert)(s,"Invalid registry signature.")}async function M(e){const t=await r(g,this).call(this,e);if(!t.ok)throw new Error(`Failed to fetch ${e}.`);return await t.text()}s.JsonSnapsRegistry=b}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/registry/json.cjs"}],[2036,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n;Object.defineProperty(s,"__esModule",{value:!0}),s.SnapsRegistryStatus=void 0,function(e){e[e.Unverified=0]="Unverified",e[e.Blocked=1]="Blocked",e[e.Verified=2]="Verified",e[e.Unavailable=3]="Unavailable"}(n||(s.SnapsRegistryStatus=n={}))}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/registry/registry.cjs"}],[2037,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.getRunnableSnaps=void 0;s.getRunnableSnaps=e=>e.filter(e=>e.enabled&&!e.blocked)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/selectors.cjs"}],[2038,{"./snaps/Timer.cjs":2026,"@metamask/snaps-sdk":2128,"@metamask/snaps-utils":2242,"fast-deep-equal":3657},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(s,"__esModule",{value:!0}),s.isLocalSnapId=s.isTrackableHandler=s.throttleTracking=s.TRACKABLE_HANDLERS=s.debouncePersistState=s.fetchSnap=s.getSnapFiles=s.withTimeout=s.hasTimedOut=s.delayWithTimer=s.delay=s.permissionsDiff=s.setDiff=void 0;const i=e("@metamask/snaps-sdk"),r=e("@metamask/snaps-utils"),a=n(e("fast-deep-equal")),o=e("./snaps/Timer.cjs");function c(e,t){let s;const n=new Promise((n,i)=>{e.start(()=>{t===undefined?n():n(t)}),s=i});return n.cancel=()=>{"finished"!==e.status&&(e.cancel(),s(new Error("The delay has been canceled.")))},n}async function l(e,t){return t&&0!==t.length?await Promise.all(t.map(async t=>e.fetch(t))):[]}s.setDiff=function(e,t){return Object.entries(e).reduce((e,[s,n])=>(s in t||(e[s]=n),e),{})},s.permissionsDiff=function(e,t){return Object.entries(e).reduce((e,[s,n])=>{const i=s in t;return(!i||i&&!(0,a.default)(n.caveats??[],t[s].caveats??[]))&&(e[s]=n),e},{})},s.delay=function(e,t){return c(new o.Timer(e),t)},s.delayWithTimer=c,s.hasTimedOut=Symbol("Used to check if the requested promise has timeout (see withTimeout)"),s.withTimeout=async function(e,t){const n=c("number"==typeof t?new o.Timer(t):t,s.hasTimedOut);try{return await Promise.race([e,n])}finally{n.cancel()}},s.getSnapFiles=l,s.fetchSnap=async function(e,t){try{const e=await t.manifest(),s=await t.fetch(e.result.source.location.npm.filePath);(0,i.assert)(s.size<r.MAX_FILE_SIZE,"Snap source code must be smaller than 64 MB.");const{iconPath:n}=e.result.source.location.npm,a=n?await t.fetch(n):undefined,o=await l(t,e.result.source.files);(0,r.validateAuxiliaryFiles)(o),await Promise.all(o.map(async e=>{e.data.base64=await(0,r.encodeBase64)(e)}));const c=await l(t,e.result.source.locales),u={manifest:e,sourceCode:s,svgIcon:a,auxiliaryFiles:o,localizationFiles:(0,r.getValidatedLocalizationFiles)(c)};return await(0,r.validateFetchedSnap)(u),u}catch(t){throw new Error(`Failed to fetch snap "${e}": ${(0,i.getErrorMessage)(t)}.`)}},s.debouncePersistState=function(e,t=1e3){const s=new Map;return(n,i,r)=>{const a=`${n}-${r}`;s.has(a)&&clearTimeout(s.get(a)),s.set(a,setTimeout(()=>{e(n,i,r),s.delete(a)},t))}},s.TRACKABLE_HANDLERS=Object.freeze([r.HandlerType.OnHomePage,r.HandlerType.OnInstall,r.HandlerType.OnNameLookup,r.HandlerType.OnRpcRequest,r.HandlerType.OnSignature,r.HandlerType.OnTransaction,r.HandlerType.OnUpdate]),s.throttleTracking=function(e,t=6e4){const s=new Map,n=new Map;return(i,r,a,o)=>{const c=`${i}${r}${a}${o}`,l=Date.now(),u=s.get(c)??0,h=[i,r,a,o];if(l-u>=t)return s.set(c,l),void e(...h);const d=n.get(c);null!=d&&d.timer&&clearTimeout(d.timer),s.set(c,l),n.set(c,{args:h,timer:setTimeout(()=>{e(...h),n.delete(c)},t)})}},s.isTrackableHandler=function(e){return s.TRACKABLE_HANDLERS.includes(e)},s.isLocalSnapId=function(e){return e.startsWith("local:")}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/utils.cjs"}],[2039,{"../snaps/index.cjs":2028,"@metamask/rpc-errors":1955,"@metamask/snaps-utils":2242,"@metamask/utils":2359,nanoid:4196},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){function n(e,t,s){i(e,t),t.set(e,s)}function i(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function r(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var n=s.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function a(e,t){return e.get(c(e,t))}function o(e,t,s){return e.set(c(e,t),s),s}function c(e,t,s){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:s;throw new TypeError("Private element is not present on this object")}Object.defineProperty(s,"__esModule",{value:!0}),s.WebSocketService=void 0;const l=e("@metamask/rpc-errors"),u=e("@metamask/snaps-utils"),h=e("@metamask/utils"),d=e("nanoid"),m=e("../snaps/index.cjs"),p="WebSocketService";var f=new WeakMap,g=new WeakMap,y=new WeakSet;function w(e,t){const s=a(g,this).get(t);return(0,h.assert)(s&&s.snapId===e,`Socket with ID "${t}" not found.`),s}function S(e,t,s){return c(y,this,E).call(this,e).some(e=>e.url===t&&(0,u.isEqual)(e.protocols,s))}function v(e,t){a(f,this).call("SnapController:handleRequest",{origin:m.METAMASK_ORIGIN,snapId:e,handler:u.HandlerType.OnWebSocketEvent,request:{method:"",params:{event:t}}}).catch(t=>{(0,u.logError)(`An error occurred while handling a WebSocket message for Snap "${e}":`,t)})}async function b(e,t,s=[]){(0,h.assert)(!c(y,this,S).call(this,e,t,s),`An open WebSocket connection to ${t} already exists.`);const n=new URL(t),{origin:i}=n,r=(0,d.nanoid)(),o=new WebSocket(t,s);o.binaryType="arraybuffer";const{promise:u,resolve:m,reject:p}=(0,h.createDeferredPromise)();o.addEventListener("open",()=>{m(),c(y,this,v).call(this,e,{type:"open",id:r,origin:i})}),o.addEventListener("close",t=>{a(g,this).delete(r),c(y,this,v).call(this,e,{type:"close",id:r,origin:i,code:t.code,reason:t.reason,wasClean:t.wasClean??null})});const f=()=>{p(l.rpcErrors.resourceUnavailable("An error occurred while opening the WebSocket."))};return o.addEventListener("error",f),o.addEventListener("message",t=>{const s="string"==typeof t.data?{type:"text",message:t.data}:{type:"binary",message:Array.from(new Uint8Array(t.data))};c(y,this,v).call(this,e,{type:"message",id:r,origin:i,data:s})}),a(g,this).set(r,{id:r,snapId:e,url:t,protocols:s,socket:o,openPromise:u}),await u,o.removeEventListener("error",f),r}function k(e,t){const{socket:s}=c(y,this,w).call(this,e,t);s.close()}function _(e){for(const t of c(y,this,E).call(this,e))c(y,this,k).call(this,e,t.id)}async function T(e,t,s){const{socket:n,openPromise:i}=c(y,this,w).call(this,e,t);await i;const r=Array.isArray(s)?new Uint8Array(s):s;n.send(r)}function E(e){return[...a(g,this).values()].filter(t=>t.snapId===e).map(e=>({id:e.id,url:e.url,protocols:e.protocols}))}s.WebSocketService=class{constructor({messenger:e}){var t,s;i(t=this,s=y),s.add(t),r(this,"name",p),r(this,"state",null),n(this,f,void 0),n(this,g,void 0),o(f,this,e),o(g,this,new Map),a(f,this).registerActionHandler(`${p}:open`,async(...e)=>c(y,this,b).call(this,...e)),a(f,this).registerActionHandler(`${p}:close`,(...e)=>c(y,this,k).call(this,...e)),a(f,this).registerActionHandler(`${p}:sendMessage`,async(...e)=>c(y,this,T).call(this,...e)),a(f,this).registerActionHandler(`${p}:getAll`,(...e)=>c(y,this,E).call(this,...e)),a(f,this).subscribe("SnapController:snapUpdated",e=>{c(y,this,_).call(this,e.id)}),a(f,this).subscribe("SnapController:snapUninstalled",e=>{c(y,this,_).call(this,e.id)}),a(f,this).subscribe("SnapController:snapInstalled",e=>{c(y,this,_).call(this,e.id)})}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/websocket/WebSocketService.cjs"}],[2040,{"./WebSocketService.cjs":2039},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n=Object.create?function(e,t,s,n){n===undefined&&(n=s);var i=Object.getOwnPropertyDescriptor(t,s);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,n,i)}:function(e,t,s,n){n===undefined&&(n=s),e[n]=t[s]},i=function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||n(t,e,s)};Object.defineProperty(s,"__esModule",{value:!0}),i(e("./WebSocketService.cjs"),s)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/websocket/index.cjs"}],[2041,{buffer:3316,"buffer-from":3322,inherits:3882,"readable-stream":4452,typedarray:4872},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){(function(s){(function(){var n=e("readable-stream").Writable,i=e("inherits"),r=e("buffer-from");if("undefined"==typeof Uint8Array)var a=e("typedarray").Uint8Array;else a=Uint8Array;function o(e,t){if(!(this instanceof o))return new o(e,t);"function"==typeof e&&(t=e,e={}),e||(e={});var s=e.encoding,i=!1;s?"u8"!==(s=String(s).toLowerCase())&&"uint8"!==s||(s="uint8array"):i=!0,n.call(this,{objectMode:!0}),this.encoding=s,this.shouldInferEncoding=i,t&&this.on("finish",function(){t(this.getBody())}),this.body=[]}t.exports=o,i(o,n),o.prototype._write=function(e,t,s){this.body.push(e),s()},o.prototype.inferEncoding=function(e){var t=e===undefined?this.body[0]:e;return s.isBuffer(t)?"buffer":"undefined"!=typeof Uint8Array&&t instanceof Uint8Array?"uint8array":Array.isArray(t)?"array":"string"==typeof t?"string":"[object Object]"===Object.prototype.toString.call(t)?"object":"buffer"},o.prototype.getBody=function(){return this.encoding||0!==this.body.length?(this.shouldInferEncoding&&(this.encoding=this.inferEncoding()),"array"===this.encoding?function(e){for(var t=[],s=0;s<e.length;s++)t.push.apply(t,e[s]);return t}(this.body):"string"===this.encoding?function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];"string"==typeof i||s.isBuffer(i)?t.push(i):c(i)?t.push(r(i)):t.push(r(String(i)))}t=s.isBuffer(e[0])?(t=s.concat(t)).toString("utf8"):t.join("");return t}(this.body):"buffer"===this.encoding?function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];s.isBuffer(i)?t.push(i):c(i)?t.push(r(i)):t.push(r(String(i)))}return s.concat(t)}(this.body):"uint8array"===this.encoding?function(e){for(var t=0,s=0;s<e.length;s++)"string"==typeof e[s]&&(e[s]=r(e[s])),t+=e[s].length;for(var n=new a(t),i=(s=0,0);s<e.length;s++)for(var o=e[s],c=0;c<o.length;c++)n[i++]=o[c];return n}(this.body):this.body):[]};Array.isArray;function c(e){return"string"==typeof e||(t=e,/Array\]$/.test(Object.prototype.toString.call(t)))||e&&"function"==typeof e.subarray;var t}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/snaps-controllers>concat-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/concat-stream/index.js"}],[2042,{fs:3268},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){const n={S_IFMT:61440,S_IFDIR:16384,S_IFCHR:8192,S_IFBLK:24576,S_IFIFO:4096,S_IFLNK:40960};try{t.exports=e("fs").constants||n}catch{t.exports=n}}}},{package:"@metamask/snaps-controllers>tar-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/tar-stream/constants.js"}],[2043,{"./headers":2044,b4a:3197,"fast-fifo":3659,streamx:4851},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){const{Writable:n,Readable:i,getStreamError:r}=e("streamx"),a=e("fast-fifo"),o=e("b4a"),c=e("./headers"),l=o.alloc(0);class u{constructor(){this.buffered=0,this.shifted=0,this.queue=new a,this._offset=0}push(e){this.buffered+=e.byteLength,this.queue.push(e)}shiftFirst(e){return 0===this._buffered?null:this._next(e)}shift(e){if(e>this.buffered)return null;if(0===e)return l;let t=this._next(e);if(e===t.byteLength)return t;const s=[t];for(;(e-=t.byteLength)>0;)t=this._next(e),s.push(t);return o.concat(s)}_next(e){const t=this.queue.peek(),s=t.byteLength-this._offset;if(e>=s){const e=this._offset?t.subarray(this._offset,t.byteLength):t;return this.queue.shift(),this._offset=0,this.buffered-=s,this.shifted+=s,e}return this.buffered-=e,this.shifted+=e,t.subarray(this._offset,this._offset+=e)}}class h extends i{constructor(e,t,s){super(),this.header=t,this.offset=s,this._parent=e}_read(e){0===this.header.size&&this.push(null),this._parent._stream===this&&this._parent._update(),e(null)}_predestroy(){this._parent.destroy(r(this))}_detach(){this._parent._stream===this&&(this._parent._stream=null,this._parent._missing=p(this.header.size),this._parent._update())}_destroy(e){this._detach(),e(null)}}class d extends n{constructor(e){super(e),e||(e={}),this._buffer=new u,this._offset=0,this._header=null,this._stream=null,this._missing=0,this._longHeader=!1,this._callback=m,this._locked=!1,this._finished=!1,this._pax=null,this._paxGlobal=null,this._gnuLongPath=null,this._gnuLongLinkPath=null,this._filenameEncoding=e.filenameEncoding||"utf-8",this._allowUnknownFormat=!!e.allowUnknownFormat,this._unlockBound=this._unlock.bind(this)}_unlock(e){if(this._locked=!1,e)return this.destroy(e),void this._continueWrite(e);this._update()}_consumeHeader(){if(this._locked)return!1;this._offset=this._buffer.shifted;try{this._header=c.decode(this._buffer.shift(512),this._filenameEncoding,this._allowUnknownFormat)}catch(e){return this._continueWrite(e),!1}if(!this._header)return!0;switch(this._header.type){case"gnu-long-path":case"gnu-long-link-path":case"pax-global-header":case"pax-header":return this._longHeader=!0,this._missing=this._header.size,!0}return this._locked=!0,this._applyLongHeaders(),0===this._header.size||"directory"===this._header.type?(this.emit("entry",this._header,this._createStream(),this._unlockBound),!0):(this._stream=this._createStream(),this._missing=this._header.size,this.emit("entry",this._header,this._stream,this._unlockBound),!0)}_applyLongHeaders(){this._gnuLongPath&&(this._header.name=this._gnuLongPath,this._gnuLongPath=null),this._gnuLongLinkPath&&(this._header.linkname=this._gnuLongLinkPath,this._gnuLongLinkPath=null),this._pax&&(this._pax.path&&(this._header.name=this._pax.path),this._pax.linkpath&&(this._header.linkname=this._pax.linkpath),this._pax.size&&(this._header.size=parseInt(this._pax.size,10)),this._header.pax=this._pax,this._pax=null)}_decodeLongHeader(e){switch(this._header.type){case"gnu-long-path":this._gnuLongPath=c.decodeLongPath(e,this._filenameEncoding);break;case"gnu-long-link-path":this._gnuLongLinkPath=c.decodeLongPath(e,this._filenameEncoding);break;case"pax-global-header":this._paxGlobal=c.decodePax(e);break;case"pax-header":this._pax=null===this._paxGlobal?c.decodePax(e):Object.assign({},this._paxGlobal,c.decodePax(e))}}_consumeLongHeader(){this._longHeader=!1,this._missing=p(this._header.size);const e=this._buffer.shift(this._header.size);try{this._decodeLongHeader(e)}catch(e){return this._continueWrite(e),!1}return!0}_consumeStream(){const e=this._buffer.shiftFirst(this._missing);if(null===e)return!1;this._missing-=e.byteLength;const t=this._stream.push(e);return 0===this._missing?(this._stream.push(null),t&&this._stream._detach(),t&&!1===this._locked):t}_createStream(){return new h(this,this._header,this._offset)}_update(){for(;this._buffer.buffered>0&&!this.destroying;){if(this._missing>0){if(null!==this._stream){if(!1===this._consumeStream())return;continue}if(!0===this._longHeader){if(this._missing>this._buffer.buffered)break;if(!1===this._consumeLongHeader())return!1;continue}const e=this._buffer.shiftFirst(this._missing);null!==e&&(this._missing-=e.byteLength);continue}if(this._buffer.buffered<512)break;if(null!==this._stream||!1===this._consumeHeader())return}this._continueWrite(null)}_continueWrite(e){const t=this._callback;this._callback=m,t(e)}_write(e,t){this._callback=t,this._buffer.push(e),this._update()}_final(e){this._finished=0===this._missing&&0===this._buffer.buffered,e(this._finished?null:new Error("Unexpected end of data"))}_predestroy(){this._continueWrite(null)}_destroy(e){this._stream&&this._stream.destroy(r(this)),e(null)}[Symbol.asyncIterator](){let e=null,t=null,s=null,n=null,i=null;const r=this;return this.on("entry",function(e,r,a){i=a,r.on("error",m),t?(t({value:r,done:!1}),t=s=null):n=r}),this.on("error",t=>{e=t}),this.on("close",function(){if(a(e),!t)return;e?s(e):t({value:undefined,done:!0});t=s=null}),{[Symbol.asyncIterator](){return this},next:()=>new Promise(o),return:()=>c(null),throw:e=>c(e)};function a(e){if(!i)return;const t=i;i=null,t(e)}function o(i,o){return e?o(e):n?(i({value:n,done:!1}),void(n=null)):(t=i,s=o,a(null),void(r._finished&&t&&(t({value:undefined,done:!0}),t=s=null)))}function c(e){return r.destroy(e),a(e),new Promise((t,s)=>{if(r.destroyed)return t({value:undefined,done:!0});r.once("close",function(){e?s(e):t({value:undefined,done:!0})})})}}}function m(){}function p(e){return(e&=511)&&512-e}t.exports=function(e){return new d(e)}}}},{package:"@metamask/snaps-controllers>tar-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/tar-stream/extract.js"}],[2044,{b4a:3197},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){const n=e("b4a"),i="0".charCodeAt(0),r=n.from([117,115,116,97,114,0]),a=n.from([i,i]),o=n.from([117,115,116,97,114,32]),c=n.from([32,0]),l=257,u=263;function h(e,t,s,n){for(;s<n;s++)if(e[s]===t)return s;return n}function d(e){let t=256;for(let s=0;s<148;s++)t+=e[s];for(let s=156;s<512;s++)t+=e[s];return t}function m(e,t){return(e=e.toString(8)).length>t?"7777777777777777777".slice(0,t)+" ":"0000000000000000000".slice(0,t-e.length)+e+" "}function p(e,t,s){if(128&(e=e.subarray(t,t+s))[t=0])return function(e){let t;if(128===e[0])t=!0;else{if(255!==e[0])return null;t=!1}const s=[];let n;for(n=e.length-1;n>0;n--){const i=e[n];t?s.push(i):s.push(255-i)}let i=0;const r=s.length;for(n=0;n<r;n++)i+=s[n]*Math.pow(256,n);return t?i:-1*i}(e);{for(;t<e.length&&32===e[t];)t++;const s=(i=h(e,32,t,e.length),r=e.length,a=e.length,"number"!=typeof i?a:(i=~~i)>=r?r:i>=0||(i+=r)>=0?i:0);for(;t<s&&0===e[t];)t++;return s===t?0:parseInt(n.toString(e.subarray(t,s)),8)}var i,r,a}function f(e,t,s,i){return n.toString(e.subarray(t,h(e,0,t,t+s)),i)}function g(e){const t=n.byteLength(e);let s=Math.floor(Math.log(t)/Math.log(10))+1;return t+s>=Math.pow(10,s)&&s++,t+s+e}s.decodeLongPath=function(e,t){return f(e,0,e.length,t)},s.encodePax=function(e){let t="";e.name&&(t+=g(" path="+e.name+"\n")),e.linkname&&(t+=g(" linkpath="+e.linkname+"\n"));const s=e.pax;if(s)for(const e in s)t+=g(" "+e+"="+s[e]+"\n");return n.from(t)},s.decodePax=function(e){const t={};for(;e.length;){let s=0;for(;s<e.length&&32!==e[s];)s++;const i=parseInt(n.toString(e.subarray(0,s)),10);if(!i)return t;const r=n.toString(e.subarray(s+1,i-1)),a=r.indexOf("=");if(-1===a)return t;t[r.slice(0,a)]=r.slice(a+1),e=e.subarray(i)}return t},s.encode=function(e){const t=n.alloc(512);let s=e.name,o="";if(5===e.typeflag&&"/"!==s[s.length-1]&&(s+="/"),n.byteLength(s)!==s.length)return null;for(;n.byteLength(s)>100;){const e=s.indexOf("/");if(-1===e)return null;o+=o?"/"+s.slice(0,e):s.slice(0,e),s=s.slice(e+1)}return n.byteLength(s)>100||n.byteLength(o)>155||e.linkname&&n.byteLength(e.linkname)>100?null:(n.write(t,s),n.write(t,m(4095&e.mode,6),100),n.write(t,m(e.uid,6),108),n.write(t,m(e.gid,6),116),function(e,t,s){e.toString(8).length>11?function(e,t,s){t[s]=128;for(let n=11;n>0;n--)t[s+n]=255&e,e=Math.floor(e/256)}(e,t,s):n.write(t,m(e,11),s)}(e.size,t,124),n.write(t,m(e.mtime.getTime()/1e3|0,11),136),t[156]=i+function(e){switch(e){case"file":return 0;case"link":return 1;case"symlink":return 2;case"character-device":return 3;case"block-device":return 4;case"directory":return 5;case"fifo":return 6;case"contiguous-file":return 7;case"pax-header":return 72}return 0}(e.type),e.linkname&&n.write(t,e.linkname,157),n.copy(r,t,l),n.copy(a,t,263),e.uname&&n.write(t,e.uname,265),e.gname&&n.write(t,e.gname,297),n.write(t,m(e.devmajor||0,6),329),n.write(t,m(e.devminor||0,6),337),o&&n.write(t,o,345),n.write(t,m(d(t),6),148),t)},s.decode=function(e,t,s){let a=0===e[156]?0:e[156]-i,h=f(e,0,100,t);const m=p(e,100,8),g=p(e,108,8),y=p(e,116,8),w=p(e,124,12),S=p(e,136,12),v=function(e){switch(e){case 0:return"file";case 1:return"link";case 2:return"symlink";case 3:return"character-device";case 4:return"block-device";case 5:return"directory";case 6:return"fifo";case 7:return"contiguous-file";case 72:return"pax-header";case 55:return"pax-global-header";case 27:return"gnu-long-link-path";case 28:case 30:return"gnu-long-path"}return null}(a),b=0===e[157]?null:f(e,157,100,t),k=f(e,265,32),_=f(e,297,32),T=p(e,329,8),E=p(e,337,8),P=d(e);if(256===P)return null;if(P!==p(e,148,8))throw new Error("Invalid tar header. Maybe the tar is corrupted or it needs to be gunzipped?");if(function(e){return n.equals(r,e.subarray(l,263))}(e))e[345]&&(h=f(e,345,155,t)+"/"+h);else if(function(e){return n.equals(o,e.subarray(l,263))&&n.equals(c,e.subarray(u,265))}(e));else if(!s)throw new Error("Invalid tar header: unknown format.");return 0===a&&h&&"/"===h[h.length-1]&&(a=5),{name:h,mode:m,uid:g,gid:y,size:w,mtime:new Date(1e3*S),type:v,linkname:b,uname:k,gname:_,devmajor:T,devminor:E,pax:null}}}}},{package:"@metamask/snaps-controllers>tar-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/tar-stream/headers.js"}],[2045,{"./extract":2043,"./pack":2046},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){s.extract=e("./extract"),s.pack=e("./pack")}}},{package:"@metamask/snaps-controllers>tar-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/tar-stream/index.js"}],[2046,{"./constants":2042,"./headers":2044,b4a:3197,streamx:4851},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){const{Readable:n,Writable:i,getStreamError:r}=e("streamx"),a=e("b4a"),o=e("./constants"),c=e("./headers"),l=a.alloc(1024);class u extends i{constructor(e,t,s){super({mapWritable:p,eagerOpen:!0}),this.written=0,this.header=t,this._callback=s,this._linkname=null,this._isLinkname="symlink"===t.type&&!t.linkname,this._isVoid="file"!==t.type&&"contiguous-file"!==t.type,this._finished=!1,this._pack=e,this._openCallback=null,null===this._pack._stream?this._pack._stream=this:this._pack._pending.push(this)}_open(e){this._openCallback=e,this._pack._stream===this&&this._continueOpen()}_continuePack(e){if(null===this._callback)return;const t=this._callback;this._callback=null,t(e)}_continueOpen(){null===this._pack._stream&&(this._pack._stream=this);const e=this._openCallback;if(this._openCallback=null,null!==e){if(this._pack.destroying)return e(new Error("pack stream destroyed"));if(this._pack._finalized)return e(new Error("pack stream is already finalized"));this._pack._stream=this,this._isLinkname||this._pack._encode(this.header),this._isVoid&&(this._finish(),this._continuePack(null)),e(null)}}_write(e,t){return this._isLinkname?(this._linkname=this._linkname?a.concat([this._linkname,e]):e,t(null)):this._isVoid?e.byteLength>0?t(new Error("No body allowed for this entry")):t():(this.written+=e.byteLength,this._pack.push(e)?t():void(this._pack._drain=t))}_finish(){this._finished||(this._finished=!0,this._isLinkname&&(this.header.linkname=this._linkname?a.toString(this._linkname,"utf-8"):"",this._pack._encode(this.header)),m(this._pack,this.header.size),this._pack._done(this))}_final(e){if(this.written!==this.header.size)return e(new Error("Size mismatch"));this._finish(),e(null)}_getError(){return r(this)||new Error("tar entry destroyed")}_predestroy(){this._pack.destroy(this._getError())}_destroy(e){this._pack._done(this),this._continuePack(this._finished?null:this._getError()),e()}}class h extends n{constructor(e){super(e),this._drain=d,this._finalized=!1,this._finalizing=!1,this._pending=[],this._stream=null}entry(e,t,s){if(this._finalized||this.destroying)throw new Error("already finalized or destroyed");"function"==typeof t&&(s=t,t=null),s||(s=d),e.size&&"symlink"!==e.type||(e.size=0),e.type||(e.type=function(e){switch(e&o.S_IFMT){case o.S_IFBLK:return"block-device";case o.S_IFCHR:return"character-device";case o.S_IFDIR:return"directory";case o.S_IFIFO:return"fifo";case o.S_IFLNK:return"symlink"}return"file"}(e.mode)),e.mode||(e.mode="directory"===e.type?493:420),e.uid||(e.uid=0),e.gid||(e.gid=0),e.mtime||(e.mtime=new Date),"string"==typeof t&&(t=a.from(t));const n=new u(this,e,s);return a.isBuffer(t)?(e.size=t.byteLength,n.write(t),n.end(),n):(n._isVoid,n)}finalize(){this._stream||this._pending.length>0?this._finalizing=!0:this._finalized||(this._finalized=!0,this.push(l),this.push(null))}_done(e){e===this._stream&&(this._stream=null,this._finalizing&&this.finalize(),this._pending.length&&this._pending.shift()._continueOpen())}_encode(e){if(!e.pax){const t=c.encode(e);if(t)return void this.push(t)}this._encodePax(e)}_encodePax(e){const t=c.encodePax({name:e.name,linkname:e.linkname,pax:e.pax}),s={name:"PaxHeader",mode:e.mode,uid:e.uid,gid:e.gid,size:t.byteLength,mtime:e.mtime,type:"pax-header",linkname:e.linkname&&"PaxHeader",uname:e.uname,gname:e.gname,devmajor:e.devmajor,devminor:e.devminor};this.push(c.encode(s)),this.push(t),m(this,t.byteLength),s.size=e.size,s.type=e.type,this.push(c.encode(s))}_doDrain(){const e=this._drain;this._drain=d,e()}_predestroy(){const e=r(this);for(this._stream&&this._stream.destroy(e);this._pending.length;){const t=this._pending.shift();t.destroy(e),t._continueOpen()}this._doDrain()}_read(e){this._doDrain(),e()}}function d(){}function m(e,t){(t&=511)&&e.push(l.subarray(0,512-t))}function p(e){return a.isBuffer(e)?e:a.from(e)}t.exports=function(e){return new h(e)}}}},{package:"@metamask/snaps-controllers>tar-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/tar-stream/pack.js"}],[205,{"../../../../../shared/lib/delegation":5047,"../../../../../shared/lib/delegation/delegation":5044,"@metamask/transaction-controller":2314,"@metamask/utils":2359,"bignumber.js":3207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.enforceSimulations=async function({messenger:e,transactionMeta:t,useRealSignature:s=!1}){c("Enforcing simulations",{transactionMeta:t,useRealSignature:s});const{chainId:r,simulationData:h={tokenBalanceChanges:[]},txParams:d}=t,m=d.from,p=(0,i.hexToNumber)(r),f=(0,a.getDeleGatorEnvironment)(p),g=f.DelegationManager,y=function(e,t){const s=e.call("AppStateController:getState"),n=s.enforcedSimulationsSlippage;return s.enforcedSimulationsSlippageForTransactions[t]??n}(e,t.id),w=function({accountAddress:e,environment:t,simulationData:s,slippage:i}){const r=function(e,t,s,i){const r=(0,a.createCaveatBuilder)(t),{nativeBalanceChange:o,tokenBalanceChanges:l=[]}=s;if(o){const{difference:t,isDecrease:s}=o,n=u(t,i,s);c("Caveat - Native Balance Change",{enforceDecrease:s,recipient:e,delta:BigInt(t),slippage:i,deltaWithSlippage:n}),r.addCaveat("nativeBalanceChange",s,e,n)}for(const t of l){const{difference:s,isDecrease:a,address:o,standard:l,id:h}=t,d=BigInt(s),m=u(s,i,a),p=h?BigInt(h):0n;switch(c("Caveat - Token Balance Change",{enforceDecrease:a,token:o,recipient:e,delta:d,slippage:i,deltaWithSlippage:m}),l){case n.SimulationTokenStandard.erc20:r.addCaveat("erc20BalanceChange",a,o,e,m);break;case n.SimulationTokenStandard.erc721:r.addCaveat("erc721BalanceChange",a,o,e,d);break;case n.SimulationTokenStandard.erc1155:r.addCaveat("erc1155BalanceChange",a,o,e,p,d);break;default:c("Unsupported token standard",l)}}return r.build()}(e,t,s,i);c("Caveats",r);const o=(0,a.createDelegation)({from:e,to:e,caveats:r});return o}({accountAddress:m,environment:f,simulationData:h,slippage:y});c("Delegation",w);let S=l;s&&(c("Signing delegation"),S=await e.call("DelegationController:signDelegation",{chainId:r,delegation:w}));c("Delegation signature",S);const v=function({transaction:e,delegation:t}){const s=[[t]],n=[a.SINGLE_DEFAULT_MODE],i=[[{target:e.to,callData:e.data??"0x",value:e.value?BigInt(e.value):0n}]];return(0,o.encodeRedeemDelegations)({delegations:s,modes:n,executions:i})}({transaction:d,delegation:{...w,signature:S}});return c("Data",v),{updateTransaction:e=>{e.txParams.data=v,e.txParams.to=g,e.txParams.value="0x0"}}};var n=e("@metamask/transaction-controller"),i=e("@metamask/utils"),r=e("bignumber.js"),a=e("../../../../../shared/lib/delegation"),o=e("../../../../../shared/lib/delegation/delegation");const c=(0,i.createProjectLogger)("enforced-simulations"),l="0x2261a7810ed3e9cde160895909e138e2f68adb2da86fcf98ea0840701df107721fb369ab9b52550ea98832c09f8185284aca4c94bd345e867a4f4461868dd7751b";function u(e,t,s){const n=new r.BigNumber(e),i=(100+(s?t:-t))/100;return BigInt(n.mul(i).toFixed(0))}}}},{package:"$root$",file:"app/scripts/lib/transaction/containers/enforced-simulations.ts"}],[2051,{"./verify":2052,"@metamask/superstruct":2264,"@metamask/utils":2359},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var n=this&&this.__createBinding||(Object.create?function(e,t,s,n){n===undefined&&(n=s);var i=Object.getOwnPropertyDescriptor(t,s);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,n,i)}:function(e,t,s,n){n===undefined&&(n=s),e[n]=t[s]}),i=this&&this.__exportStar||function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||n(t,e,s)};Object.defineProperty(s,"__esModule",{value:!0}),s.SnapsRegistryDatabaseStruct=s.BlockedSnapStruct=s.BlockReasonStruct=s.VerifiedSnapStruct=s.ImagePathStruct=s.AdditionalSourceCodeStruct=s.SupportStruct=s.AuditStruct=s.AuthorStruct=void 0;const r=e("@metamask/superstruct"),a=e("@metamask/utils"),o=(0,r.refine)((0,r.string)(),"Npm ID",e=>e.startsWith("npm:")),c=(0,r.object)({checksum:a.ChecksumStruct});s.AuthorStruct=(0,r.object)({name:(0,r.string)(),website:(0,r.string)()}),s.AuditStruct=(0,r.object)({auditor:(0,r.string)(),report:(0,r.string)()}),s.SupportStruct=(0,r.object)({knowledgeBase:(0,r.optional)((0,r.string)()),faq:(0,r.optional)((0,r.string)()),contact:(0,r.optional)((0,r.string)()),keyRecovery:(0,r.optional)((0,r.string)())}),s.AdditionalSourceCodeStruct=(0,r.object)({name:(0,r.string)(),url:(0,r.string)()}),s.ImagePathStruct=(0,r.pattern)((0,r.string)(),/\.\/images\/.*\/\d+\.(?:png|jpe?g)$/u),s.VerifiedSnapStruct=(0,r.object)({id:o,metadata:(0,r.object)({name:(0,r.string)(),type:(0,r.optional)((0,r.enums)(["account"])),author:(0,r.optional)(s.AuthorStruct),website:(0,r.optional)((0,r.string)()),onboard:(0,r.optional)((0,r.boolean)()),summary:(0,r.optional)((0,r.string)()),description:(0,r.optional)((0,r.string)()),audits:(0,r.optional)((0,r.array)(s.AuditStruct)),category:(0,r.optional)((0,r.enums)(["interoperability","notifications","transaction insights","account management","name resolution"])),tags:(0,r.optional)((0,r.array)((0,r.string)())),support:(0,r.optional)(s.SupportStruct),sourceCode:(0,r.optional)((0,r.string)()),hidden:(0,r.optional)((0,r.boolean)()),privateCode:(0,r.optional)((0,r.boolean)()),privacyPolicy:(0,r.optional)((0,r.string)()),termsOfUse:(0,r.optional)((0,r.string)()),additionalSourceCode:(0,r.optional)((0,r.array)(s.AdditionalSourceCodeStruct)),screenshots:(0,r.optional)((0,r.size)((0,r.array)(s.ImagePathStruct),3,3))}),versions:(0,r.record)(a.VersionStruct,c)}),s.BlockReasonStruct=(0,r.object)({explanation:(0,r.optional)((0,r.string)()),url:(0,r.optional)((0,r.string)())}),s.BlockedSnapStruct=(0,r.union)([(0,r.object)({id:o,versionRange:a.VersionRangeStruct,reason:(0,r.optional)(s.BlockReasonStruct)}),(0,r.object)({checksum:a.ChecksumStruct,reason:(0,r.optional)(s.BlockReasonStruct)})]),s.SnapsRegistryDatabaseStruct=(0,r.object)({verifiedSnaps:(0,r.record)(o,s.VerifiedSnapStruct),blockedSnaps:(0,r.array)(s.BlockedSnapStruct)}),i(e("./verify"),s)}}},{package:"@metamask/snaps-utils>@metamask/snaps-registry",file:"node_modules/@metamask/snaps-registry/dist/index.js"}],[2052,{"@metamask/superstruct":2264,"@metamask/utils":2359,"@noble/curves/secp256k1":2400,"@noble/hashes/sha256":2412},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.verify=s.SignatureStruct=void 0;const n=e("@metamask/superstruct"),i=e("@metamask/utils"),r=e("@noble/curves/secp256k1"),a=e("@noble/hashes/sha256");s.SignatureStruct=(0,n.object)({signature:i.StrictHexStruct,curve:(0,n.literal)("secp256k1"),format:(0,n.literal)("DER")}),s.verify=function({registry:e,signature:t,publicKey:n}){(0,i.assertStruct)(t,s.SignatureStruct,"Invalid signature object");const o=(0,i.hexToBytes)(n);return r.secp256k1.verify((0,i.remove0x)(t.signature),(0,a.sha256)((0,i.stringToBytes)(e)),o)}}}},{package:"@metamask/snaps-utils>@metamask/snaps-registry",file:"node_modules/@metamask/snaps-registry/dist/verify.js"}]],[],{});