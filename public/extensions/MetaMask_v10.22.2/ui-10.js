LavaPack.loadBundle([[219,{"../../shared/constants/app":4120,"../../shared/lib/error-utils":4145,"../../shared/lib/ui-utils":4153,"../../shared/modules/browser-runtime.utils":4155,"../../shared/modules/mv3.utils":4167,"../../ui":5001,"./lib/metaRPCClientFactory":55,"./lib/setup-initial-state-hooks":81,"./lib/stream-utils":88,"./lib/util":92,"./platforms/extension":216,"@metamask/eth-query":1149,"@metamask/ethjs":1228,"extension-port-stream":2939,loglevel:3483,"react-devtools":2629,"web3-stream-provider":4098,"webextension-polyfill":4102},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){e("./lib/setup-initial-state-hooks"),e("react-devtools");var r=y(e("extension-port-stream")),o=y(e("webextension-polyfill")),i=y(e("@metamask/ethjs")),a=y(e("@metamask/eth-query")),s=y(e("web3-stream-provider")),l=y(e("loglevel")),u=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=v(t);if(n&&n.has(e))return n.get(e);var r={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var a=o?Object.getOwnPropertyDescriptor(e,i):null;a&&(a.get||a.set)?Object.defineProperty(r,i,a):r[i]=e[i]}return r.default=e,n&&n.set(e,r),r}(e("../../ui")),c=e("../../shared/constants/app"),d=e("../../shared/modules/mv3.utils"),f=e("../../shared/modules/browser-runtime.utils"),p=e("../../shared/lib/ui-utils"),m=e("../../shared/lib/error-utils"),g=y(e("./platforms/extension")),h=e("./lib/stream-utils"),w=e("./lib/util"),b=y(e("./lib/metaRPCClientFactory"));function v(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(v=function(e){return e?n:t})(e)}function y(e){return e&&e.__esModule?e:{default:e}}const P=document.getElementById("app-content"),k="phishing-warning-sw-registered";let L;async function E(e,t,n){const r=await(0,m.getErrorHtml)(e,p.SUPPORT_LINK,n);P.innerHTML=r;const i=document.getElementById("critical-error-button");throw null==i||i.addEventListener("click",(e=>{o.default.runtime.reload()})),l.default.error(t.stack),t}function M(e,t){const n=(0,h.setupMultiplex)(e);!function(e,t){const n=(0,b.default)(e);t(null,n)}(n.createStream("controller"),t),function(e){const t=new s.default;t.pipe(e).pipe(t),e.on("error",console.error.bind(console)),t.on("error",console.error.bind(console)),global.ethereumProvider=t,global.ethQuery=new a.default(t),global.eth=new i.default(t)}(n.createStream("provider"))}(async function(){global.platform=new g.default;const e=(0,w.getEnvironmentType)();let t=!1;L=o.default.runtime.connect({name:e});let n=new r.default(L);const i=await async function(e){if(e!==c.ENVIRONMENT_TYPE_POPUP)return{};const t=await o.default.tabs.query({active:!0,currentWindow:!0}).catch((e=>{(0,f.checkForLastErrorAndLog)()||l.default.error(e)})),[n]=t,{id:r,title:i,url:a}=n,{origin:s,protocol:u}=a?new URL(a):{};if(!s||"null"===s)return{};return{id:r,title:i,origin:s,protocol:u,url:a}}(e);let a;if(d.isManifestV3){const l=async e=>{var r;"startUISync"===(null==e||null===(r=e.data)||void 0===r?void 0:r.method)&&(t?M(n,((e,t)=>{e?E("troubleStarting",e):(0,u.updateBackgroundConnection)(t)})):s(i),await a())};class d extends Error{constructor(){super("Timeout failed")}}a=async function(){if((await o.default.storage.session.get(k))[k])return;const e=(0,w.getPlatform)();let t;try{const n=new URL("https://metamask.github.io/phishing-warning/v3.0.3/");let r,i;n.hash="#extensionStartup",t=window.document.createElement("iframe"),t.setAttribute("src",n.href),t.setAttribute("sandbox","allow-scripts allow-same-origin");const a=new Promise(((e,t)=>{r=e,i=t}));t.addEventListener("load",r),window.document.body.appendChild(t),setTimeout((()=>i(new d)),1e3),await a,e===c.PLATFORM_FIREFOX?console.error("Firefox does not support required MV3 APIs: Phishing warning page iframe and service worker will reload each page refresh"):o.default.storage.session.set({[k]:!0})}catch(e){e instanceof d?console.warn("Phishing warning page timeout; page not guaranteed to work offline."):console.error("Failed to initialize phishing warning page",e)}finally{t&&t.remove()}};const f=()=>{L.onMessage.removeListener(l),L.onDisconnect.removeListener(f),L=o.default.runtime.connect({name:e}),n=new r.default(L),L.onMessage.addListener(l),L.onDisconnect.addListener(f)};L.onMessage.addListener(l),L.onDisconnect.addListener(f)}else{const e=async t=>{var n;"startUISync"===(null==t||null===(n=t.data)||void 0===n?void 0:n.method)&&(s(i),L.onMessage.removeListener(e))};L.onMessage.addListener(e)}function s(r){!function(e,t,n){M(t,((t,r)=>{t?n(t,null):(0,u.default)({activeTab:e,container:P,backgroundConnection:r},n)}))}(r,n,((n,r)=>{if(n)return void E("troubleStarting",n,r);t=!0;const o=r.getState(),{metamask:{completedOnboarding:i}={}}=o;i||e===c.ENVIRONMENT_TYPE_FULLSCREEN||global.platform.openExtensionInBrowser()}))}})().catch(l.default.error)}}},{package:"$root$",file:"app/scripts/ui.js"}]],[219],{});