LavaPack.loadBundle([[62,{loglevel:4268,"webextension-polyfill":4889},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function({location:e,registerOnboarding:t}){return async function(n,i,s,o){try{if("wallet_registerOnboarding"!==n.method)return void s();n.tabId&&n.tabId!==a.default.tabs.TAB_ID_NONE?await t(e,n.tabId):r.default.debug(`'wallet_registerOnboarding' message from ${e} ignored due to missing tabId`),i.result=!0,o()}catch(e){o(e)}}};var r=i(e("loglevel")),a=i(e("webextension-polyfill"));function i(e){return e&&e.__esModule?e:{default:e}}}}},{package:"$root$",file:"app/scripts/lib/createOnboardingMiddleware.js"}],[63,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){return function(t,n,r){t.origin=e.origin,r()}}}}},{package:"$root$",file:"app/scripts/lib/createOriginMiddleware.js"}],[64,{"../../../shared/constants/app":4911,"../../../shared/constants/metametrics":4923,"../../../shared/constants/security-provider":4933,"../../../shared/constants/signatures":4934,"../../../shared/constants/transaction":4941,"../../../shared/modules/error":4963,"../../../shared/modules/transaction.utils":4983,"../../../ui/helpers/utils/metrics":5939,"../../../ui/pages/confirmations/utils/confirm":6378,"./snap-keyring/metrics":114,"@metamask/controller-utils":1143,"@metamask/rpc-errors":2032,"ethereumjs-util":3760},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function({getMetricsState:e,rateLimitTimeout:t=3e5,rateLimitSamplePercent:n=.001,globalRateLimitTimeout:w=3e5,globalRateLimitMaxAmount:S=10,getAccountType:A,getDeviceModel:M,isConfirmationRedesignEnabled:P,snapAndHardwareMessenger:C,appStateController:I,metaMetricsController:N}){return async function(O,R,k){const{origin:D,method:j,params:L}=O,x=E[j];let G;switch(x){case y.TIMEOUT:G=void 0!==T[j];break;case y.NON_RATE_LIMITED:G=!1;break;case y.BLOCKED:G=!0;break;default:case y.RANDOM_SAMPLE:G=Math.random()>=n}const U=S>0&&v>=S,$=!0===e().participateInMetaMetrics,Y=_[j],H={};let F;const V=D!==s.ORIGIN_METAMASK&&!G&&!U&&!0===$;if(V){const e=Y?Y.REQUESTED:o.MetaMetricsEventName.ProviderMethodCalled;if(e===o.MetaMetricsEventName.SignatureRequested){var B,K,W,q,z;let e;var J,Q;if(H.signature_type=j,(0,i.isValidAddress)(null==O||null===(B=O.params)||void 0===B?void 0:B[1]))e=null==O||null===(J=O.params)||void 0===J?void 0:J[0];else e=null==O||null===(Q=O.params)||void 0===Q?void 0:Q[1];null!==(K=O.securityAlertResponse)&&void 0!==K&&K.providerRequestsCount&&Object.keys(O.securityAlertResponse.providerRequestsCount).forEach((e=>{H[`ppom_${e}_count`]=O.securityAlertResponse.providerRequestsCount[e]})),H.security_alert_response=(null===(W=O.securityAlertResponse)||void 0===W?void 0:W.result_type)??u.BlockaidResultType.NotApplicable,H.security_alert_reason=(null===(q=O.securityAlertResponse)||void 0===q?void 0:q.reason)??u.BlockaidReason.notApplicable,null!==(z=O.securityAlertResponse)&&void 0!==z&&z.description&&(H.security_alert_description=O.securityAlertResponse.description);P()&&f.REDESIGN_APPROVAL_TYPES.find((e=>e===g[j]))&&(H.ui_customizations=[...H.ui_customizations||[],o.MetaMetricsEventUiCustomization.RedesignedConfirmation]);const t=await(0,h.getSnapAndHardwareInfoForMetrics)(A,M,C);Object.assign(H,t);try{if(j===s.MESSAGE_TYPE.PERSONAL_SIGN){const{isSIWEMessage:t}=(0,r.detectSIWE)({data:e});t&&(H.ui_customizations=[...H.ui_customizations||[],o.MetaMetricsEventUiCustomization.Siwe])}else if(j===s.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V4){const t=(0,c.parseTypedDataMessage)(e);F={},H.eip712_primary_type=t.primaryType,F.eip712_verifyingContract=t.domain.verifyingContract,F.eip712_domain_version=t.domain.version,F.eip712_domain_name=t.domain.name,l.PRIMARY_TYPES_PERMIT.includes(t.primaryType)?H.ui_customizations=[...H.ui_customizations||[],o.MetaMetricsEventUiCustomization.Permit]:l.PRIMARY_TYPES_ORDER.includes(t.primaryType)&&(H.ui_customizations=[...H.ui_customizations||[],o.MetaMetricsEventUiCustomization.Order])}}catch(e){console.warn(`createRPCMethodTrackingMiddleware: Errored - ${e}`)}}else H.method=j;const n=b[j];if(n&&(H.params=n(L)),e===o.MetaMetricsEventName.SignatureRequested){!function(e,t,n){e.createEventFragment({category:o.MetaMetricsEventCategory.InpageProvider,initialEvent:o.MetaMetricsEventName.SignatureRequested,successEvent:o.MetaMetricsEventName.SignatureApproved,failureEvent:o.MetaMetricsEventName.SignatureRejected,uniqueIdentifier:(0,m.generateSignatureUniqueId)(t.id),persist:!0,referrer:{url:t.origin},...n})}(N,O,{properties:H,sensitiveProperties:F})}else N.trackEvent({event:e,category:o.MetaMetricsEventCategory.InpageProvider,referrer:{url:D},properties:H});x===y.TIMEOUT&&(T[j]=setTimeout((()=>{delete T[j]}),t)),v+=1,setTimeout((()=>{v-=1}),w)}k((async e=>{var t,n,r;if(!1===V||void 0===Y)return e();const i=null===(t=R.error)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.location;let s;const c=(0,p.getErrorMessage)(R.error);(null===(n=R.error)||void 0===n?void 0:n.code)===a.errorCodes.provider.userRejectedRequest?s=Y.REJECTED:(null===(r=R.error)||void 0===r?void 0:r.code)===a.errorCodes.rpc.internal&&[c,R.error.message].includes("Request rejected by user or snap.")?(s=Y.REJECTED,H.status=c):s=Y.APPROVED;let u={};if(d.SIGNING_METHODS.includes(j)){var l;const e=I.getSignatureSecurityAlertResponse(null===(l=O.securityAlertResponse)||void 0===l?void 0:l.securityAlertId);u=(0,m.getBlockaidMetricsProps)({securityAlertResponse:e})}const f={...H,...u,location:i};if(s===o.MetaMetricsEventName.SignatureRejected||s===o.MetaMetricsEventName.SignatureApproved){const e={abandoned:s===Y.REJECTED};!function(e,t,n,r){const a=(0,m.generateSignatureUniqueId)(t.id);e.updateEventFragment(a,r),e.finalizeEventFragment(a,n)}(N,O,e,{properties:f,sensitiveProperties:F})}else N.trackEvent({event:s,category:o.MetaMetricsEventCategory.InpageProvider,referrer:{url:D},properties:f});return e()}))}};var r=e("@metamask/controller-utils"),a=e("@metamask/rpc-errors"),i=e("ethereumjs-util"),s=e("../../../shared/constants/app"),o=e("../../../shared/constants/metametrics"),c=e("../../../shared/modules/transaction.utils"),u=e("../../../shared/constants/security-provider"),l=e("../../../shared/constants/signatures"),d=e("../../../shared/constants/transaction"),p=e("../../../shared/modules/error"),m=e("../../../ui/helpers/utils/metrics"),f=e("../../../ui/pages/confirmations/utils/confirm"),h=e("./snap-keyring/metrics");const y={TIMEOUT:"timeout",BLOCKED:"blocked",NON_RATE_LIMITED:"non_rate_limited",RANDOM_SAMPLE:"random_sample"},E={[s.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA]:y.NON_RATE_LIMITED,[s.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V3]:y.NON_RATE_LIMITED,[s.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V4]:y.NON_RATE_LIMITED,[s.MESSAGE_TYPE.PERSONAL_SIGN]:y.NON_RATE_LIMITED,[s.MESSAGE_TYPE.ETH_DECRYPT]:y.NON_RATE_LIMITED,[s.MESSAGE_TYPE.ETH_GET_ENCRYPTION_PUBLIC_KEY]:y.NON_RATE_LIMITED,[s.MESSAGE_TYPE.ADD_ETHEREUM_CHAIN]:y.NON_RATE_LIMITED,[s.MESSAGE_TYPE.SWITCH_ETHEREUM_CHAIN]:y.NON_RATE_LIMITED,[s.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS]:y.TIMEOUT,[s.MESSAGE_TYPE.WALLET_REQUEST_PERMISSIONS]:y.TIMEOUT,[s.MESSAGE_TYPE.SEND_METADATA]:y.BLOCKED,[s.MESSAGE_TYPE.ETH_CHAIN_ID]:y.BLOCKED,[s.MESSAGE_TYPE.ETH_ACCOUNTS]:y.BLOCKED,[s.MESSAGE_TYPE.LOG_WEB3_SHIM_USAGE]:y.BLOCKED,[s.MESSAGE_TYPE.GET_PROVIDER_STATE]:y.BLOCKED},g={[s.MESSAGE_TYPE.PERSONAL_SIGN]:r.ApprovalType.PersonalSign,[s.MESSAGE_TYPE.SIGN]:r.ApprovalType.SignTransaction,[s.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA]:r.ApprovalType.EthSignTypedData,[s.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V1]:r.ApprovalType.EthSignTypedData,[s.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V3]:r.ApprovalType.EthSignTypedData,[s.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V4]:r.ApprovalType.EthSignTypedData},_={[s.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA]:{APPROVED:o.MetaMetricsEventName.SignatureApproved,REJECTED:o.MetaMetricsEventName.SignatureRejected,REQUESTED:o.MetaMetricsEventName.SignatureRequested},[s.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V3]:{APPROVED:o.MetaMetricsEventName.SignatureApproved,REJECTED:o.MetaMetricsEventName.SignatureRejected,REQUESTED:o.MetaMetricsEventName.SignatureRequested},[s.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V4]:{APPROVED:o.MetaMetricsEventName.SignatureApproved,REJECTED:o.MetaMetricsEventName.SignatureRejected,REQUESTED:o.MetaMetricsEventName.SignatureRequested},[s.MESSAGE_TYPE.PERSONAL_SIGN]:{APPROVED:o.MetaMetricsEventName.SignatureApproved,REJECTED:o.MetaMetricsEventName.SignatureRejected,REQUESTED:o.MetaMetricsEventName.SignatureRequested},[s.MESSAGE_TYPE.ETH_DECRYPT]:{APPROVED:o.MetaMetricsEventName.DecryptionApproved,REJECTED:o.MetaMetricsEventName.DecryptionRejected,REQUESTED:o.MetaMetricsEventName.DecryptionRequested},[s.MESSAGE_TYPE.ETH_GET_ENCRYPTION_PUBLIC_KEY]:{APPROVED:o.MetaMetricsEventName.EncryptionPublicKeyApproved,REJECTED:o.MetaMetricsEventName.EncryptionPublicKeyRejected,REQUESTED:o.MetaMetricsEventName.EncryptionPublicKeyRequested},[s.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS]:{APPROVED:o.MetaMetricsEventName.PermissionsApproved,REJECTED:o.MetaMetricsEventName.PermissionsRejected,REQUESTED:o.MetaMetricsEventName.PermissionsRequested},[s.MESSAGE_TYPE.WALLET_REQUEST_PERMISSIONS]:{APPROVED:o.MetaMetricsEventName.PermissionsApproved,REJECTED:o.MetaMetricsEventName.PermissionsRejected,REQUESTED:o.MetaMetricsEventName.PermissionsRequested}},b={[s.MESSAGE_TYPE.WATCH_ASSET]:({type:e})=>({type:e}),[s.MESSAGE_TYPE.ADD_ETHEREUM_CHAIN]:([{chainId:e}])=>({chainId:e}),[s.MESSAGE_TYPE.SWITCH_ETHEREUM_CHAIN]:([{chainId:e}])=>({chainId:e})},T={};let v=0}}},{package:"$root$",file:"app/scripts/lib/createRPCMethodTrackingMiddleware.js"}],[65,{"promise-to-callback":4405,"readable-stream":4672},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,t){return new s(e,t)};var r,a=e("readable-stream"),i=(r=e("promise-to-callback"))&&r.__esModule?r:{default:r};class s extends a.Writable{constructor(e,t){super({objectMode:!0,...t}),this._asyncWriteFn=e}_write(e,t,n){(0,i.default)(this._asyncWriteFn(e,t))(n)}}}}},{package:"$root$",file:"app/scripts/lib/createStreamSink.js"}],[66,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){return function(t,n,r){t.tabId=e.tabId,r()}}}}},{package:"$root$",file:"app/scripts/lib/createTabIdMiddleware.js"}],[67,{"../../../shared/constants/app":4911,"../../../shared/lib/trace":4953},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(){return async function(e,t,n){const{id:r,method:o}=e,c=i[o];c&&(e.traceContext=await(0,a.trace)({name:c,id:r,tags:s[o]}),await(0,a.trace)({name:a.TraceName.Middleware,id:r,parentContext:e.traceContext})),n()}};var r=e("../../../shared/constants/app"),a=e("../../../shared/lib/trace");const i={[r.MESSAGE_TYPE.ETH_SEND_TRANSACTION]:a.TraceName.Transaction,[r.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA]:a.TraceName.Signature,[r.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V1]:a.TraceName.Signature,[r.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V3]:a.TraceName.Signature,[r.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V4]:a.TraceName.Signature,[r.MESSAGE_TYPE.PERSONAL_SIGN]:a.TraceName.Signature},s={[r.MESSAGE_TYPE.ETH_SEND_TRANSACTION]:{source:"dapp"}}}}},{package:"$root$",file:"app/scripts/lib/createTracingMiddleware.ts"}],[68,{"@metamask/browser-passworder":1118},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.encryptorFactory=void 0;var r=e("@metamask/browser-passworder");const a=e=>async(t,n,a,i)=>(0,r.encrypt)(t,n,a,i,{algorithm:"PBKDF2",params:{iterations:e}}),i=e=>async(t,n,a)=>(0,r.encryptWithDetail)(t,n,a,{algorithm:"PBKDF2",params:{iterations:e}}),s=e=>async(t,n,a,i)=>(0,r.keyFromPassword)(t,n,a,i??{algorithm:"PBKDF2",params:{iterations:e}}),o=e=>t=>(0,r.isVaultUpdated)(t,{algorithm:"PBKDF2",params:{iterations:e}});n.encryptorFactory=e=>({encrypt:a(e),encryptWithKey:r.encryptWithKey,encryptWithDetail:i(e),decrypt:r.decrypt,decryptWithKey:r.decryptWithKey,decryptWithDetail:r.decryptWithDetail,keyFromPassword:s(e),isVaultUpdated:o(e),importKey:r.importKey,exportKey:r.exportKey,generateSalt:r.generateSalt})}}},{package:"$root$",file:"app/scripts/lib/encryptor-factory.ts"}],[69,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default=[{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"resolver",outputs:[{name:"",type:"address"}],payable:!1,type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"owner",outputs:[{name:"",type:"address"}],payable:!1,type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"label",type:"bytes32"},{name:"owner",type:"address"}],name:"setSubnodeOwner",outputs:[],payable:!1,type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"ttl",type:"uint64"}],name:"setTTL",outputs:[],payable:!1,type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"ttl",outputs:[{name:"",type:"uint64"}],payable:!1,type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"resolver",type:"address"}],name:"setResolver",outputs:[],payable:!1,type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"owner",type:"address"}],name:"setOwner",outputs:[],payable:!1,type:"function"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"owner",type:"address"}],name:"Transfer",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!0,name:"label",type:"bytes32"},{indexed:!1,name:"owner",type:"address"}],name:"NewOwner",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"resolver",type:"address"}],name:"NewResolver",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"ttl",type:"uint64"}],name:"NewTTL",type:"event"}]}}},{package:"$root$",file:"app/scripts/lib/ens-ipfs/contracts/registry.js"}],[70,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default=[{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"hash",type:"bytes32"}],name:"setContent",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"content",outputs:[{name:"",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"interfaceID",type:"bytes4"}],name:"supportsInterface",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"pure",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"key",type:"string"},{name:"value",type:"string"}],name:"setText",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"},{name:"contentTypes",type:"uint256"}],name:"ABI",outputs:[{name:"contentType",type:"uint256"},{name:"data",type:"bytes"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"x",type:"bytes32"},{name:"y",type:"bytes32"}],name:"setPubkey",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"hash",type:"bytes"}],name:"setContenthash",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"addr",outputs:[{name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"},{name:"key",type:"string"}],name:"text",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"contentType",type:"uint256"},{name:"data",type:"bytes"}],name:"setABI",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"name",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"name",type:"string"}],name:"setName",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"contenthash",outputs:[{name:"",type:"bytes"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"pubkey",outputs:[{name:"x",type:"bytes32"},{name:"y",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"addr",type:"address"}],name:"setAddr",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[{name:"ensAddr",type:"address"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"a",type:"address"}],name:"AddrChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"name",type:"string"}],name:"NameChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!0,name:"contentType",type:"uint256"}],name:"ABIChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"x",type:"bytes32"},{indexed:!1,name:"y",type:"bytes32"}],name:"PubkeyChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"indexedKey",type:"string"},{indexed:!1,name:"key",type:"string"}],name:"TextChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"hash",type:"bytes"}],name:"ContenthashChanged",type:"event"}]}}},{package:"$root$",file:"app/scripts/lib/ens-ipfs/contracts/resolver.js"}],[71,{"./contracts/registry":69,"./contracts/resolver":70,"@ensdomains/content-hash":335,"@metamask/ethjs-contract":1423,"@metamask/ethjs-query":1427,"eth-ens-namehash":3734},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=async function({provider:e,name:t}){const n=new a.default(e),u=r.default.hash(t),d=new i.default(n),p=Number.parseInt(await n.net_version(),10),m=function(e){switch(e){case 1:case 3:case 4:case 5:case 6:return"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e";default:return null}}(p);if(!m)throw new Error(`EnsIpfsResolver - no known ens-ipfs registry for chainId "${p}"`);const f=d(o.default).at(m),h=(await f.resolver(u))[0];if(l(h))throw new Error(`EnsIpfsResolver - no resolver found for name "${t}"`);const y=d(c.default).at(h),E=await y.supportsInterface("0xbc1c58d1"),g=await y.supportsInterface("0xd8389dc5");if(E[0]){const e=(await y.contenthash(u))[0];let t=s.default.decode(e);const n=s.default.getCodec(e);return"ipfs-ns"!==n&&"ipns-ns"!==n||(t=s.default.helpers.cidV0ToV1Base32(t)),{type:n,hash:t}}if(g[0]){const e=(await y.content(u))[0];if(l(e))throw new Error(`EnsIpfsResolver - no content ID found for name "${t}"`);return{type:"swarm-ns",hash:e.slice(2)}}throw new Error(`EnsIpfsResolver - the resolver for name "${t}" is not standard, it should either supports contenthash() or content()`)};var r=u(e("eth-ens-namehash")),a=u(e("@metamask/ethjs-query")),i=u(e("@metamask/ethjs-contract")),s=u(e("@ensdomains/content-hash")),o=u(e("./contracts/registry")),c=u(e("./contracts/resolver"));function u(e){return e&&e.__esModule?e:{default:e}}function l(e){return[undefined,null,"0x","0x0","0x0000000000000000000000000000000000000000000000000000000000000000"].includes(e)}}}},{package:"$root$",file:"app/scripts/lib/ens-ipfs/resolver.js"}],[72,{"../../../../shared/modules/fetch-with-timeout":4965,"./resolver":71,"base32-encode":3490,"base64-js":3491,"webextension-polyfill":4889},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function({provider:e,getCurrentChainId:t,getIpfsGateway:n,getUseAddressBarEnsResolution:r}){i.map((e=>`*://*.${e}/*`))};a(e("base32-encode")),a(e("base64-js")),a(e("webextension-polyfill"));var r=a(e("../../../../shared/modules/fetch-with-timeout"));a(e("./resolver"));function a(e){return e&&e.__esModule?e:{default:e}}(0,r.default)();const i=["eth"]}}},{package:"$root$",file:"app/scripts/lib/ens-ipfs/setup.js"}],[75,{lodash:4262},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){return a((0,r.cloneDeep)(e),(e=>null===e?"null":typeof e))};var r=e("lodash");function a(e={},t){return Object.entries(e).forEach((([n,r])=>{e[n]="object"==typeof r&&null!==r?a(r,t):t(r)})),e}}}},{package:"$root$",file:"app/scripts/lib/getObjStructure.js"}],[76,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.hardwareKeyringBuilderFactory=function(e,t){const n=()=>new e({bridge:new t});return n.type=e.type,n}}}},{package:"$root$",file:"app/scripts/lib/hardware-keyring-builder-factory.ts"}],[8,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.PHISHING_WARNING_PAGE=n.PHISHING_STREAM=n.PHISHING_SAFELIST=n.METAMASK_PROVIDER=n.METAMASK_INPAGE=n.METAMASK_COOKIE_HANDLER=n.LEGACY_PUBLIC_CONFIG=n.LEGACY_PROVIDER=n.LEGACY_INPAGE=n.LEGACY_CONTENT_SCRIPT=n.CONTENT_SCRIPT=void 0;n.CONTENT_SCRIPT="metamask-contentscript",n.METAMASK_INPAGE="metamask-inpage",n.PHISHING_WARNING_PAGE="metamask-phishing-warning-page",n.METAMASK_COOKIE_HANDLER="metamask-cookie-handler",n.METAMASK_PROVIDER="metamask-provider",n.PHISHING_SAFELIST="metamask-phishing-safelist",n.PHISHING_STREAM="phishing",n.LEGACY_CONTENT_SCRIPT="contentscript",n.LEGACY_INPAGE="inpage",n.LEGACY_PROVIDER="provider",n.LEGACY_PUBLIC_CONFIG="publicConfig"}}},{package:"$root$",file:"app/scripts/constants/stream.ts"}],[80,{"../util":130,"@metamask/json-rpc-engine":1454},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createPendingNonceMiddleware=function({getPendingNonce:e}){return(0,r.createAsyncMiddleware)((async(t,n,r)=>{const{method:a,params:i}=t;if("eth_getTransactionCount"!==a)return void r();const[s,o]=i;"pending"===o?n.result=await e(s,t.networkClientId):r()}))},n.createPendingTxMiddleware=function({getPendingTransactionByHash:e}){return(0,r.createAsyncMiddleware)((async(t,n,r)=>{const{method:i,params:s}=t;if("eth_getTransactionByHash"!==i)return void r();const[o]=s,c=e(o);c?n.result=(0,a.formatTxMetaForRpcResult)(c):r()}))};var r=e("@metamask/json-rpc-engine"),a=e("../util")}}},{package:"$root$",file:"app/scripts/lib/middleware/pending.js"}],[81,{events:3830,loglevel:4268},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=i(e("events")),a=i(e("loglevel"));function i(e){return e&&e.__esModule?e:{default:e}}class s extends r.default{constructor(e={}){super();const t=e.migrations||[];this.migrations=t.sort(((e,t)=>e.version-t.version));const n=this.migrations.slice(-1)[0];this.defaultVersion=e.defaultVersion||n&&n.version||0}async migrateData(e=this.generateInitialState()){const t=this.migrations.filter((function(t){return t.version>e.meta.version}));for(const n of t)try{a.default.info(`Running migration ${n.version}...`);const t=await n.migrate(e);if(!t.data)throw new Error("Migrator - migration returned empty data");if(t.version!==undefined&&t.meta.version!==n.version)throw new Error("Migrator - Migration did not update version number correctly");e=t,a.default.info(`Migration ${n.version} complete`)}catch(t){const r=t.message;return t.message=`MetaMask Migration Error #${n.version}: ${r}`,this.emit("error",t),e}return e}generateInitialState(e){return{meta:{version:this.defaultVersion},data:e}}}n.default=s}}},{package:"$root$",file:"app/scripts/lib/migrator/index.js"}],[84,{"../../../shared/constants/notifications":4928,"../platforms/extension":281,"@metamask/safe-event-emitter":2055},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.NOTIFICATION_MANAGER_EVENTS=void 0;var r=s(e("@metamask/safe-event-emitter")),a=s(e("../platforms/extension")),i=e("../../../shared/constants/notifications");function s(e){return e&&e.__esModule?e:{default:e}}const o=n.NOTIFICATION_MANAGER_EVENTS={POPUP_CLOSED:"onPopupClosed"};class c extends r.default{constructor(){super(),this.platform=new a.default,this.platform.addOnRemovedListener(this._onWindowClosed.bind(this))}markAsAutomaticallyClosed(){this._popupAutomaticallyClosed=!0}async showPopup(e,t){this._popupId=t,this._setCurrentPopupId=e;const n=await this._getPopup(t);if(n)await this.platform.focusWindow(n.id);else{let e=0,t=0;try{const n=await this.platform.getLastFocusedWindow();t=n.top,e=Math.max(n.left+(n.width-i.NOTIFICATION_WIDTH),0)}catch(n){const{screenX:r,screenY:a,outerWidth:s}=window;t=Math.max(a,0),e=Math.max(r+(s-i.NOTIFICATION_WIDTH),0)}const n=await this.platform.openWindow({url:"notification.html",type:"popup",width:i.NOTIFICATION_WIDTH,height:i.NOTIFICATION_HEIGHT,left:e,top:t});n.left!==e&&"fullscreen"!==n.state&&await this.platform.updateWindowPosition(n.id,e,t),this._setCurrentPopupId(n.id),this._popupId=n.id}}_onWindowClosed(e){e===this._popupId&&(this._setCurrentPopupId(undefined),this._popupId=undefined,this.emit(o.POPUP_CLOSED,{automaticallyClosed:this._popupAutomaticallyClosed}),this._popupAutomaticallyClosed=undefined)}async _getPopup(){const e=await this.platform.getAllWindows();return this._getPopupIn(e)}_getPopupIn(e){return e?e.find((e=>e&&"popup"===e.type&&e.id===this._popupId)):null}}n.default=c}}},{package:"$root$",file:"app/scripts/lib/notification-manager.js"}],[85,{"../../../../shared/constants/offscreen-communication":4929,"eth-lattice-keyring":3735},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.LatticeKeyringOffscreen=void 0;var r,a=(r=e("eth-lattice-keyring"))&&r.__esModule?r:{default:r},i=e("../../../../shared/constants/offscreen-communication");class s extends a.default{constructor(e={}){super(e)}async _getCreds(){try{const e=this.appName?this.appName:"Unknown",t=`${i.KnownOrigins.lattice}?keyring=${e}&forceLogin=true`;return await new Promise(((e,n)=>{chrome.runtime.sendMessage({target:i.OffscreenCommunicationTarget.latticeOffscreen,params:{url:t}},(t=>{t.error&&n(t.error),e(t.result)}))}))}catch(e){throw new Error(e)}}}n.LatticeKeyringOffscreen=s,function(e,t,n){(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(s,"type",void 0),s.type=a.default.type}}},{package:"$root$",file:"app/scripts/lib/offscreen-bridge/lattice-offscreen-keyring.ts"}],[86,{"../../../../shared/constants/offscreen-communication":4929},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.LedgerOffscreenBridge=void 0;var r=e("../../../../shared/constants/offscreen-communication");function a(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.LedgerOffscreenBridge=class{constructor(){a(this,"isDeviceConnected",!1)}init(){return chrome.runtime.onMessage.addListener((e=>{e.target===r.OffscreenCommunicationTarget.extension&&e.event===r.OffscreenCommunicationEvents.ledgerDeviceConnect&&(this.isDeviceConnected=!0)})),Promise.resolve()}destroy(){return Promise.resolve()}getOptions(){return Promise.resolve({})}setOptions(){return Promise.resolve()}attemptMakeApp(){return new Promise(((e,t)=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.ledgerOffscreen,action:r.LedgerAction.makeApp},(n=>{n.success?e(!0):n.error?t(n.error):t(new Error("Unknown error occurred"))}))}))}updateTransportMethod(e){return new Promise(((t,n)=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.ledgerOffscreen,action:r.LedgerAction.updateTransport,params:{transportType:e}},(e=>{e.success?t(!0):n(new Error("Ledger transport could not be updated"))}))}))}getPublicKey(e){return new Promise(((t,n)=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.ledgerOffscreen,action:r.LedgerAction.getPublicKey,params:e},(e=>{e.success?t(e.payload):n(e.payload.error)}))}))}deviceSignTransaction(e){return new Promise(((t,n)=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.ledgerOffscreen,action:r.LedgerAction.signTransaction,params:e},(e=>{e.success?t(e.payload):n(e.payload.error)}))}))}deviceSignMessage(e){return new Promise(((t,n)=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.ledgerOffscreen,action:r.LedgerAction.signPersonalMessage,params:e},(e=>{e.success?t(e.payload):n(e.payload.error)}))}))}deviceSignTypedData(e){return new Promise(((t,n)=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.ledgerOffscreen,action:r.LedgerAction.signTypedData,params:e},(e=>{e.success?t(e.payload):n(e.payload.error)}))}))}}}}},{package:"$root$",file:"app/scripts/lib/offscreen-bridge/ledger-offscreen-bridge.ts"}],[87,{"../../../../shared/constants/offscreen-communication":4929},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.TrezorOffscreenBridge=void 0;var r=e("../../../../shared/constants/offscreen-communication");function a(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.TrezorOffscreenBridge=class{constructor(){a(this,"model",void 0),a(this,"minorVersion",void 0)}init(e){return chrome.runtime.onMessage.addListener((e=>{e.target===r.OffscreenCommunicationTarget.extension&&e.event===r.OffscreenCommunicationEvents.trezorDeviceConnect&&(this.model=e.payload.model,this.minorVersion=e.payload.minorVersion)})),new Promise((t=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.trezorOffscreen,action:r.TrezorAction.init,params:e},(()=>{t()}))}))}dispose(){return new Promise((e=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.trezorOffscreen,action:r.TrezorAction.dispose},(()=>{e()}))}))}getPublicKey(e){return new Promise((t=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.trezorOffscreen,action:r.TrezorAction.getPublicKey,params:e},(e=>{t(e)}))}))}ethereumSignTransaction(e){return new Promise((t=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.trezorOffscreen,action:r.TrezorAction.signTransaction,params:e},(e=>{t(e)}))}))}ethereumSignMessage(e){return new Promise((t=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.trezorOffscreen,action:r.TrezorAction.signMessage,params:e},(e=>{t(e)}))}))}ethereumSignTypedData(e){return new Promise((t=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.trezorOffscreen,action:r.TrezorAction.signTypedData,params:e},(e=>{t(e)}))}))}}}}},{package:"$root$",file:"app/scripts/lib/offscreen-bridge/trezor-offscreen-bridge.ts"}],[88,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function r(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.add(e)}function a(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(n,"__esModule",{value:!0}),n.IndexedDBPPOMStorage=void 0;const i=async(e,t,n)=>{const r=await crypto.subtle.digest("SHA-256",t);if(Array.from(new Uint8Array(r)).map((e=>e.toString(16).padStart(2,"0"))).join("")!==n)throw new Error(`Checksum mismatch for key ${e}`)};var s=new WeakSet;function o(e){return new Promise(((t,n)=>{const r=indexedDB.open(this.storeName,this.dbVersion);r.onerror=e=>{var t;n(new Error(`Failed to open database ${this.storeName}: ${null===(t=e.target)||void 0===t?void 0:t.error}`))},r.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(this.storeName)||t.createObjectStore(this.storeName,{keyPath:["name","chainId"]})},r.onsuccess=n=>{const r=n.target.result.transaction([this.storeName],e).objectStore(this.storeName);t(r)}}))}n.IndexedDBPPOMStorage=class{constructor(e,t){r(this,s),a(this,"storeName",void 0),a(this,"dbVersion",void 0),this.storeName=e,this.dbVersion=t}async objectStoreAction(e,t,n="readonly"){return new Promise(((r,a)=>{(function(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")})(s,this,o).call(this,n).then((n=>{const i=n[e](t);i.onsuccess=async e=>{r(e)},i.onerror=t=>{var n;a(new Error(`Error in indexDB operation ${e}: ${null===(n=t.target)||void 0===n?void 0:n.error}`))}})).catch((e=>{a(e)}))}))}async read(e,t){var n;const r=null===(n=(await this.objectStoreAction("get",[e.name,e.chainId])).target)||void 0===n||null===(n=n.result)||void 0===n?void 0:n.data;return await i(e,r,t),r}async write(e,t,n){await i(e,t,n),await this.objectStoreAction("put",{...e,data:t},"readwrite")}async delete(e){await this.objectStoreAction("delete",[e.name,e.chainId],"readwrite")}async dir(){var e;return null===(e=(await this.objectStoreAction("getAllKeys")).target)||void 0===e?void 0:e.result.map((([e,t])=>({name:e,chainId:t})))}}}}},{package:"$root$",file:"app/scripts/lib/ppom/indexed-db-backend.ts"}],[89,{"../../../../shared/constants/app":4911,"../../../../shared/constants/security-provider":4933,"../../../../shared/constants/transaction":4941,"../../../../shared/lib/trace":4953,"../../../../ui/ducks/metamask/metamask":5892,"./ppom-util":90,"@metamask/controller-utils":1143},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createPPOMMiddleware=function(e,t,n,d,p,m){return async(f,h,y)=>{try{const{securityAlertsEnabled:h}=t.state,{chainId:y}=(0,o.getProviderConfig)({metamask:n.state})??{};if(!y)return;if(!h||!l.includes(f.method))return;const E=f.params[0];if("string"==typeof E){const{isSIWEMessage:e}=(0,r.detectSIWE)({data:E});if(e)return}else if(f.method===a.MESSAGE_TYPE.ETH_SEND_TRANSACTION){const{to:e}=E??{},t=p.listAccounts();if(t.some((({address:t})=>(null==t?void 0:t.toLowerCase())===(null==e?void 0:e.toLowerCase()))))return}const g=(0,u.generateSecurityAlertId)();(0,c.trace)({name:c.TraceName.PPOMValidation,parentContext:f.traceContext},(()=>(0,u.validateRequestWithPPOM)({ppomController:e,request:f,securityAlertId:g,chainId:y,updateSecurityAlertResponse:m})));const _={...s.SECURITY_ALERT_RESPONSE_CHECKING_CHAIN,securityAlertId:g};i.SIGNING_METHODS.includes(f.method)&&d.addSignatureSecurityAlertResponse(_),f.securityAlertResponse=_}catch(e){f.securityAlertResponse=(0,u.handlePPOMError)(e,"Error createPPOMMiddleware: ")}finally{y()}}};var r=e("@metamask/controller-utils"),a=e("../../../../shared/constants/app"),i=e("../../../../shared/constants/transaction"),s=e("../../../../shared/constants/security-provider"),o=e("../../../../ui/ducks/metamask/metamask"),c=e("../../../../shared/lib/trace"),u=e("./ppom-util");const l=Object.freeze(["eth_sendRawTransaction","eth_sendTransaction",...i.SIGNING_METHODS])}}},{package:"$root$",file:"app/scripts/lib/ppom/ppom-middleware.ts"}],[9,{"@metamask/base-controller":1117},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.AccountOrderController=void 0;var r=e("@metamask/base-controller");const a={pinnedAccountList:[],hiddenAccountList:[]},i={pinnedAccountList:{persist:!0,anonymous:!0},hiddenAccountList:{persist:!0,anonymous:!0}};class s extends r.BaseController{constructor({messenger:e,state:t}){super({messenger:e,metadata:i,name:"AccountOrderController",state:{...a,...t}})}updateAccountsList(e){this.update((t=>(t.pinnedAccountList=e,t)))}updateHiddenAccountsList(e){this.update((t=>(t.hiddenAccountList=e,t)))}}n.AccountOrderController=s}}},{package:"$root$",file:"app/scripts/controllers/account-order.ts"}],[90,{"../../../../shared/constants/security-provider":4933,"../../../../shared/constants/transaction":4941,"./security-alerts-api":92,"@metamask/transaction-controller":2648,uuid:4839},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.generateSecurityAlertId=function(){return(0,a.v4)()},n.handlePPOMError=d,n.isChainSupported=p,n.updateSecurityAlertResponse=async function({appStateController:e,method:t,securityAlertId:n,securityAlertResponse:r,signatureController:a,transactionController:i}){const o=s.SIGNING_METHODS.includes(t),c=await async function(e,t,n,r){const a=s.SIGNING_METHODS.includes(t);for(;;){let t;if(t=a?Object.values(n.messages).find((t=>{var n;return(null===(n=t.securityAlertResponse)||void 0===n?void 0:n.securityAlertId)===e})):r.state.transactions.find((t=>{var n;return(null===(n=t.securityAlertResponse)||void 0===n?void 0:n.securityAlertId)===e})),t)return t;await new Promise((e=>setTimeout(e,100)))}}(n,t,a,i);o?e.addSignatureSecurityAlertResponse({...r,securityAlertId:n}):i.updateSecurityAlertResponse(c.id,{...r,securityAlertId:n})},n.validateRequestWithPPOM=async function({ppomController:e,request:t,securityAlertId:n,chainId:a,updateSecurityAlertResponse:s}){try{if(!await p(a))return void await s(t.method,n,i.SECURITY_ALERT_RESPONSE_CHAIN_NOT_SUPPORTED);await s(t.method,n,i.LOADING_SECURITY_ALERT_RESPONSE);const c=function(e){if(t=e,t.method!==u)return e;var t;const n=e.params[0],a=(0,r.normalizeTransactionParams)(n);return{...e,params:[a]}}(t),l=(0,o.isSecurityAlertsAPIEnabled)()?await async function(e,t,n){try{return{...await(0,o.validateWithSecurityAlertsAPI)(t,n),source:i.SecurityAlertSource.API}}catch(r){return d(r,"Error validating request with security alerts API"),await m(e,n,t)}}(e,a,c):await m(e,c,a);await s(t.method,n,l)}catch(e){await s(t.method,n,d(e,"Error validating JSON RPC using PPOM: "))}};var r=e("@metamask/transaction-controller"),a=e("uuid"),i=e("../../../../shared/constants/security-provider"),s=e("../../../../shared/constants/transaction"),o=e("./security-alerts-api");const{sentry:c}=global,u="eth_sendTransaction",l={result_type:i.BlockaidResultType.Errored,reason:i.BlockaidReason.errored};function d(e,t){const n=function(e){if("object"==typeof e||"string"==typeof e)return e;return JSON.stringify(e)}(e),r=function(e){if(e instanceof Error)return`${e.name}: ${e.message}`;return JSON.stringify(e)}(e);return null==c||c.captureException(e),console.error(t,n),{...l,description:r}}async function p(e){let t=i.SECURITY_PROVIDER_SUPPORTED_CHAIN_IDS;try{(0,o.isSecurityAlertsAPIEnabled)()&&(t=await(0,o.getSecurityAlertsAPISupportedChainIds)())}catch(e){d(e,"Error fetching supported chains from security alerts API")}return t.includes(e)}async function m(e,t,n){return{...await e.usePPOM((e=>e.validateJsonRpc(t)),n),source:i.SecurityAlertSource.Local}}}}},{package:"$root$",file:"app/scripts/lib/ppom/ppom-util.ts"}],[91,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){let r;Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.PPOM=void 0,n.initSync=function(e){if(r!==undefined)return r;const t=M();e instanceof WebAssembly.Module||(e=new WebAssembly.Module(e));const n=new WebAssembly.Instance(e,t);return P(n,e)},n.main=function(){r.main()};const a="undefined"!=typeof TextDecoder?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};"undefined"!=typeof TextDecoder&&a.decode();let i=null;function s(){return null!==i&&0!==i.byteLength||(i=new Uint8Array(r.memory.buffer)),i}function o(e,t){return e>>>=0,a.decode(s().subarray(e,e+t))}const c=new Array(128).fill(undefined);c.push(undefined,null,!0,!1);let u=c.length;function l(e){u===c.length&&c.push(c.length+1);const t=u;return u=c[t],c[t]=e,t}function d(e){return c[e]}function p(e){const t=d(e);return function(e){e<132||(c[e]=u,u=e)}(e),t}let m=0;const f="undefined"!=typeof TextEncoder?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},h="function"==typeof f.encodeInto?function(e,t){return f.encodeInto(e,t)}:function(e,t){const n=f.encode(e);return t.set(n),{read:e.length,written:n.length}};function y(e,t,n){if(n===undefined){const n=f.encode(e),r=t(n.length,1)>>>0;return s().subarray(r,r+n.length).set(n),m=n.length,r}let r=e.length,a=t(r,1)>>>0;const i=s();let o=0;for(;o<r;o++){const t=e.charCodeAt(o);if(t>127)break;i[a+o]=t}if(o!==r){0!==o&&(e=e.slice(o)),a=n(a,r,r=o+3*e.length,1)>>>0;const t=s().subarray(a+o,a+r);o+=h(e,t).written}return m=o,a}let E=null;function g(){return null!==E&&0!==E.byteLength||(E=new Int32Array(r.memory.buffer)),E}function _(e){const t=typeof e;if("number"==t||"boolean"==t||null==e)return`${e}`;if("string"==t)return`"${e}"`;if("symbol"==t){const t=e.description;return null==t?"Symbol":`Symbol(${t})`}if("function"==t){const t=e.name;return"string"==typeof t&&t.length>0?`Function(${t})`:"Function"}if(Array.isArray(e)){const t=e.length;let n="[";t>0&&(n+=_(e[0]));for(let r=1;r<t;r++)n+=", "+_(e[r]);return n+="]",n}const n=/\[object ([^\]]+)\]/.exec(toString.call(e));let r;if(!(n.length>1))return toString.call(e);if(r=n[1],"Object"==r)try{return"Object("+JSON.stringify(e)+")"}catch(e){return"Object"}return e instanceof Error?`${e.name}: ${e.message}\n${e.stack}`:r}function b(e,t,n){r.wasm_bindgen__convert__closures__invoke1_mut(e,t,l(n))}function T(e,t){r._dyn_core__ops__function__FnMut__A____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__destroy(e,t)}let v=null;function w(e,t){const n=t(4*e.length,4)>>>0,a=(null!==v&&0!==v.byteLength||(v=new Uint32Array(r.memory.buffer)),v);for(let t=0;t<e.length;t++)a[n/4+t]=l(e[t]);return m=e.length,n}function S(e,t){try{return e.apply(this,t)}catch(e){r.__wbindgen_exn_store(l(e))}}class A{static __wrap(e){e>>>=0;const t=Object.create(A.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();r.__wbg_ppom_free(e)}static new(e,t){const n=w(t,r.__wbindgen_malloc),a=m;return p(r.ppom_new(l(e),n,a))}validateJsonRpc(e){return p(r.ppom_validateJsonRpc(this.__wbg_ptr,l(e)))}static version(){return p(r.ppom_version())}}function M(){const e={wbg:{}};return e.wbg.__wbg_buffer_085ec1f694018c4f=function(e){return l(d(e).buffer)},e.wbg.__wbg_call_01734de55d61e11d=function(){return S((function(e,t,n){return l(d(e).call(d(t),d(n)))}),arguments)},e.wbg.__wbg_call_4c92f6aec1e1d6e6=function(){return S((function(e,t,n,r){return l(d(e).call(d(t),d(n),d(r)))}),arguments)},e.wbg.__wbg_from_d7c216d4616bb368=function(e){return l(Array.from(d(e)))},e.wbg.__wbg_get_44be0491f933a435=function(e,t){return l(d(e)[t>>>0])},e.wbg.__wbg_length_72e2208bbc0efc61=function(e){return d(e).length},e.wbg.__wbg_length_d813e535247d427e=function(e){return d(e).length},e.wbg.__wbg_length_fff51ee6522a1a18=function(e){return d(e).length},e.wbg.__wbg_new_43f1b47c28813cbd=function(e,t){try{var n={a:e,b:t};const a=new Promise(((e,t)=>{const a=n.a;n.a=0;try{return function(e,t,n,a){r.wasm_bindgen__convert__closures__invoke2_mut(e,t,l(n),l(a))}(a,n.b,e,t)}finally{n.a=a}}));return l(a)}finally{n.a=n.b=0}},e.wbg.__wbg_new_8125e318e6245eed=function(e){return l(new Uint8Array(d(e)))},e.wbg.__wbg_parse_670c19d4e984792e=function(){return S((function(e,t){return l(JSON.parse(o(e,t)))}),arguments)},e.wbg.__wbg_ppom_new=function(e){return l(A.__wrap(e))},e.wbg.__wbg_resolve_53698b95aaf7fcf8=function(e){return l(Promise.resolve(d(e)))},e.wbg.__wbg_set_5cf90238115182c3=function(e,t,n){d(e).set(d(t),n>>>0)},e.wbg.__wbg_stringify_e25465938f3f611f=function(){return S((function(e){return l(JSON.stringify(d(e)))}),arguments)},e.wbg.__wbg_then_b2267541e2a73865=function(e,t,n){return l(d(e).then(d(t),d(n)))},e.wbg.__wbg_then_f7e06ee3c11698eb=function(e,t){return l(d(e).then(d(t)))},e.wbg.__wbindgen_cb_drop=function(e){const t=p(e).original;if(1==t.cnt--)return t.a=0,!0;return!1},e.wbg.__wbindgen_closure_wrapper_wasm_bindgen__closure__Closure_T___wrap__breaks_if_inlined=function(e,t,n){const r=function(e,t,n,r){const a={a:e,b:t,cnt:1},i=(...e)=>{a.cnt++;const t=a.a;a.a=0;try{return r(t,a.b,...e)}finally{0==--a.cnt?n(t,a.b):a.a=t}};return i.original=a,i}(e,t,T,b);return l(r)},e.wbg.__wbindgen_debug_string=function(e,t){const n=y(_(d(t)),r.__wbindgen_malloc,r.__wbindgen_realloc),a=m;g()[e/4+1]=a,g()[e/4+0]=n},e.wbg.__wbindgen_error_new=function(e,t){return l(new Error(o(e,t)))},e.wbg.__wbindgen_is_undefined=function(e){return d(e)===undefined},e.wbg.__wbindgen_memory=function(){return l(r.memory)},e.wbg.__wbindgen_object_drop_ref=function(e){p(e)},e.wbg.__wbindgen_string_get=function(e,t){const n=d(t),a="string"==typeof n?n:undefined;var i,s=(i=a)===undefined||null===i?0:y(a,r.__wbindgen_malloc,r.__wbindgen_realloc),o=m;g()[e/4+1]=o,g()[e/4+0]=s},e.wbg.__wbindgen_string_new=function(e,t){return l(o(e,t))},e.wbg.__wbindgen_throw=function(e,t){throw new Error(o(e,t))},e}function P(e,t){return r=e.exports,C.__wbindgen_wasm_module=t,E=null,v=null,i=null,r.__wbindgen_start(),r}async function C(e){if(r!==undefined)return r;const t=M();("string"==typeof e||"function"==typeof Request&&e instanceof Request||"function"==typeof URL&&e instanceof URL)&&(e=fetch(e));const{instance:n,module:a}=await async function(e,t){if("function"==typeof Response&&e instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(e,t)}catch(t){if("application/wasm"==e.headers.get("Content-Type"))throw t;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t)}const n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}{const n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}}(await e,t);return P(n,a)}n.PPOM=A;n.default=C}}},{package:"$root$",file:"app/scripts/lib/ppom/ppom.js"}],[92,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getSecurityAlertsAPISupportedChainIds=async function(){return i(a)},n.isSecurityAlertsAPIEnabled=function(){const e="true";return"true"===e.toString()},n.validateWithSecurityAlertsAPI=async function(e,t){return i(`${r}/${e}`,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}})};const r="validate",a="supportedChains";async function i(e,t){const n=function(e){const t="https://security-alerts.api.cx.metamask.io";if(!t)throw new Error("Security alerts API URL is not set");return`${t}/${e}`}(e),r=await fetch(n,t);if(!r.ok)throw new Error(`Security alerts API request failed with status: ${r.status}`);return await r.json()}}}},{package:"$root$",file:"app/scripts/lib/ppom/security-alerts-api.ts"}],[93,{"./handlers":99,"@metamask/permission-controller":1778,"@metamask/rpc-errors":2032,"@metamask/snaps-rpc-methods":2364,"@metamask/utils":2777},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createMethodMiddleware=n.createLegacyMethodMiddleware=void 0;var r=e("@metamask/permission-controller"),a=e("@metamask/rpc-errors"),i=e("@metamask/snaps-rpc-methods"),s=e("@metamask/utils"),o=e("./handlers");const c=[...o.handlers,...r.permissionRpcMethods.handlers];n.createMethodMiddleware=u(c),n.createLegacyMethodMiddleware=u(o.legacyHandlers);function u(e){const t=e.reduce(((e,t)=>{for(const n of t.methodNames)e[n]=t;return e}),{}),n=new Set(e.flatMap((({hookNames:e})=>Object.getOwnPropertyNames(e))));return e=>{!function(e,t){const n=[];if(t.forEach((t=>{(0,s.hasProperty)(e,t)||n.push(t)})),n.length>0)throw new Error(`Missing expected hooks:\n\n${n.join("\n")}\n`);const r=Object.getOwnPropertyNames(e).filter((e=>!t.has(e)));if(r.length>0)throw new Error(`Received unexpected hooks:\n\n${r.join("\n")}\n`)}(e,n);return async(n,r,s,o)=>{const c=t[n.method];if(c){const{implementation:t,hookNames:u}=c;try{return await t(n,r,s,o,(0,i.selectHooks)(e,u))}catch(e){return o(e instanceof Error?e:a.rpcErrors.internal({data:e}))}}return s()}}}}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/createMethodMiddleware.js"}],[94,{"../../../../shared/constants/network":4927,"@metamask/rpc-errors":2032},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createUnsupportedMethodMiddleware=function(){return async function(e,t,n,i){return a.UNSUPPORTED_RPC_METHODS.has(e.method)?i(r.rpcErrors.methodNotSupported()):n()}};var r=e("@metamask/rpc-errors"),a=e("../../../../shared/constants/network")}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/createUnsupportedMethodMiddleware.ts"}],[95,{"../../../../../shared/constants/app":4911,"./ethereum-chain-utils":97,"@metamask/controller-utils":1143,"@metamask/network-controller":1620,"@metamask/rpc-errors":2032,lodash:4262,"uri-js":4814},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=l(t);if(n&&n.has(e))return n.get(e);var r={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=a?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(r,i,s):r[i]=e[i]}return r.default=e,n&&n.set(e,r),r}(e("uri-js")),a=e("@metamask/controller-utils"),i=e("@metamask/network-controller"),s=e("@metamask/rpc-errors"),o=e("lodash"),c=e("../../../../../shared/constants/app"),u=e("./ethereum-chain-utils");function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(l=function(e){return e?n:t})(e)}const d={methodNames:[c.MESSAGE_TYPE.ADD_ETHEREUM_CHAIN],implementation:async function(e,t,n,c,{addNetwork:l,updateNetwork:d,getNetworkConfigurationByChainId:p,setActiveNetwork:m,requestUserApproval:f,startApprovalFlow:h,endApprovalFlow:y,getCurrentChainIdForDomain:E,getCaveat:g,requestPermittedChainsPermission:_,grantPermittedChainsPermissionIncremental:b}){let T;try{T=(0,u.validateAddEthereumChainParams)(e.params[0],c)}catch(e){return c(e)}const{chainId:v,chainName:w,firstValidBlockExplorerUrl:S,firstValidRPCUrl:A,ticker:M}=T,{origin:P}=e,C=E(P),I=p(v);if(I&&I.chainId===v&&I.nativeCurrency!==M)return c(s.rpcErrors.invalidParams({message:`nativeCurrency.symbol does not match currency symbol for a network the user already has added with the same chainId. Received:\n${M}`}));let N,O=I,R=null==I?void 0:I.rpcEndpoints.findIndex((({url:e})=>r.equal(e,A))),k=S?null==I?void 0:I.blockExplorerUrls.findIndex((e=>r.equal(e,S))):undefined;if(!I||R!==I.defaultRpcEndpointIndex||S&&k!==I.defaultBlockExplorerUrlIndex){({id:N}=await h());try{if(await f({origin:P,type:a.ApprovalType.AddEthereumChain,requestData:{chainId:v,rpcPrefs:{blockExplorerUrl:S},chainName:w,rpcUrl:A,ticker:M}}),I){const e=(0,o.cloneDeep)(I);-1===R&&(e.rpcEndpoints=[...e.rpcEndpoints,{url:A,type:i.RpcEndpointType.Custom,name:w}],R=e.rpcEndpoints.length-1),e.defaultRpcEndpointIndex=R,S&&(-1===k&&(e.blockExplorerUrls=[...e.blockExplorerUrls,S],k=e.blockExplorerUrls.length-1),e.defaultBlockExplorerUrlIndex=k),O=await d(e.chainId,e,C===v?{replacementSelectedRpcEndpointIndex:e.defaultRpcEndpointIndex}:undefined)}else O=await l({blockExplorerUrls:S?[S]:[],defaultBlockExplorerUrlIndex:S?0:undefined,chainId:v,defaultRpcEndpointIndex:0,name:w,nativeCurrency:M,rpcEndpoints:[{url:A,name:w,type:i.RpcEndpointType.Custom}]})}catch(e){return y({id:N}),c(e)}}if(v!==C){const{networkClientId:e}=O.rpcEndpoints[O.defaultRpcEndpointIndex];return(0,u.switchChain)(t,c,v,e,N,{isAddFlow:!0,setActiveNetwork:m,endApprovalFlow:y,getCaveat:g,requestPermittedChainsPermission:_,grantPermittedChainsPermissionIncremental:b})}N&&y({id:N});return t.result=null,c()},hookNames:{addNetwork:!0,updateNetwork:!0,getNetworkConfigurationByChainId:!0,setActiveNetwork:!0,requestUserApproval:!0,startApprovalFlow:!0,endApprovalFlow:!0,getCurrentChainIdForDomain:!0,getCaveat:!0,requestPermittedChainsPermission:!0,grantPermittedChainsPermissionIncremental:!0}};n.default=d}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/add-ethereum-chain.js"}],[96,{"../../../../../shared/constants/app":4911},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;const r={methodNames:[e("../../../../../shared/constants/app").MESSAGE_TYPE.ETH_ACCOUNTS],implementation:async function(e,t,n,r,{getAccounts:a}){return t.result=await a(),r()},hookNames:{getAccounts:!0}};n.default=r}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/eth-accounts.ts"}],[97,{"../../../../../shared/constants/app":4911,"../../../../../shared/constants/permissions":4931,"../../../../../shared/modules/network.utils":4971,"../../../controllers/permissions":26,"../../util":130,"@metamask/rpc-errors":2032},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.switchChain=async function(e,t,n,a,s,{isAddFlow:c,setActiveNetwork:u,endApprovalFlow:l,getCaveat:d,requestPermittedChainsPermission:p,grantPermittedChainsPermissionIncremental:m}){try{const{value:t}=d({target:o.PermissionNames.permittedChains,caveatType:i.CaveatTypes.restrictNetworkSwitching})??{};t!==undefined&&t.includes(n)||(c?await m([n]):await p([n])),await u(a),e.result=null}catch(n){return n.code===r.errorCodes.provider.userRejectedRequest&&s?(e.result=null,t()):t(n)}finally{s&&l({id:s})}return t()},n.validateAddEthereumChainParams=function(e,t){if(!e||"object"!=typeof e)throw r.rpcErrors.invalidParams({message:`Expected single, object parameter. Received:\n${JSON.stringify(e)}`});const{chainId:n,chainName:a,blockExplorerUrls:i,nativeCurrency:o,rpcUrls:l,...d}=e,p=Object.keys(d).filter((e=>!["iconUrls"].includes(e)));if(p.length>0)throw r.rpcErrors.invalidParams({message:`Received unexpected keys on object parameter. Unsupported keys:\n${p}`});const m=u(n);if(!l||!Array.isArray(l)||0===l.length)throw r.rpcErrors.invalidParams({message:`Expected an array with at least one valid string HTTPS url 'rpcUrls', Received:\n${l}`});const f=e=>{const t=(0,c.getValidUrl)(e);return null!==t&&("localhost"===t.hostname||"127.0.0.1"===t.hostname||"https:"===t.protocol)},h=l.find((e=>f(e))),y=Array.isArray(i)?i.find((e=>f(e))):null;if(!h)throw r.rpcErrors.invalidParams({message:`Expected an array with at least one valid string HTTPS url 'rpcUrls', Received:\n${l}`});if("string"!=typeof a||!a)throw r.rpcErrors.invalidParams({message:`Expected non-empty string 'chainName'. Received:\n${a}`});const E=a.length>100?a.substring(0,100):a;if(null!==o){if("object"!=typeof o||Array.isArray(o))throw r.rpcErrors.invalidParams({message:`Expected null or object 'nativeCurrency'. Received:\n${o}`});if(18!==o.decimals)throw r.rpcErrors.invalidParams({message:`Expected the number 18 for 'nativeCurrency.decimals' when 'nativeCurrency' is provided. Received: ${o.decimals}`});if(!o.symbol||"string"!=typeof o.symbol)throw r.rpcErrors.invalidParams({message:`Expected a string 'nativeCurrency.symbol'. Received: ${o.symbol}`})}const g=(null==o?void 0:o.symbol)||s.UNKNOWN_TICKER_SYMBOL;if(g!==s.UNKNOWN_TICKER_SYMBOL&&("string"!=typeof g||g.length<1||g.length>6))throw r.rpcErrors.invalidParams({message:`Expected 1-6 character string 'nativeCurrency.symbol'. Received:\n${g}`});return{chainId:m,chainName:E,firstValidBlockExplorerUrl:y,firstValidRPCUrl:h,ticker:g}},n.validateChainId=u,n.validateSwitchEthereumChainParams=function(e,t){var n;if(null===(n=e.params)||void 0===n||!n[0]||"object"!=typeof e.params[0])throw r.rpcErrors.invalidParams({message:`Expected single, object parameter. Received:\n${JSON.stringify(e.params)}`});const{chainId:a,...i}=e.params[0];if(Object.keys(i).length>0)throw r.rpcErrors.invalidParams({message:`Received unexpected keys on object parameter. Unsupported keys:\n${Object.keys(i)}`});return u(a)};var r=e("@metamask/rpc-errors"),a=e("../../../../../shared/modules/network.utils"),i=e("../../../../../shared/constants/permissions"),s=e("../../../../../shared/constants/app"),o=e("../../../controllers/permissions"),c=e("../../util");function u(e){const t="string"==typeof e&&e.toLowerCase();if(!(0,a.isPrefixedFormattedHexString)(t))throw r.rpcErrors.invalidParams({message:`Expected 0x-prefixed, unpadded, non-zero hexadecimal string 'chainId'. Received:\n${e}`});if(!(0,a.isSafeChainId)(parseInt(t,16)))throw r.rpcErrors.invalidParams({message:`Invalid chain ID "${t}": numerical value greater than max safe value. Received:\n${e}`});return t}}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/ethereum-chain-utils.js"}],[98,{"../../../../../shared/constants/app":4911},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;const r={methodNames:[e("../../../../../shared/constants/app").MESSAGE_TYPE.GET_PROVIDER_STATE],implementation:async function(e,t,n,r,{getProviderState:a}){return t.result={...await a(e.origin)},r()},hookNames:{getProviderState:!0}};n.default=r}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/get-provider-state.ts"}],[99,{"./add-ethereum-chain":95,"./eth-accounts":96,"./get-provider-state":98,"./log-web3-shim-usage":100,"./request-accounts":101,"./send-metadata":102,"./switch-ethereum-chain":103,"./watch-asset":104},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.legacyHandlers=n.handlers=void 0;var r=d(e("./add-ethereum-chain")),a=d(e("./eth-accounts")),i=d(e("./get-provider-state")),s=d(e("./log-web3-shim-usage")),o=d(e("./request-accounts")),c=d(e("./send-metadata")),u=d(e("./switch-ethereum-chain")),l=d(e("./watch-asset"));function d(e){return e&&e.__esModule?e:{default:e}}n.handlers=[r.default,i.default,s.default,o.default,c.default,u.default,l.default],n.legacyHandlers=[a.default]}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/index.ts"}],[4,{"../../shared/constants/app":4911,"../../shared/constants/metametrics":4923,"../../shared/constants/offscreen-communication":4929,"../../shared/modules/browser-runtime.utils":4957,"../../shared/modules/mv3.utils":4970,"../../shared/modules/object.utils":4972,"../../test/e2e/background-socket/socket-background-to-mocha":4987,"../../test/e2e/default-fixture":4989,"../../test/stub/keyring-bridge":4995,"../../ui/selectors":6611,"./constants/marketing-site-whitelist":6,"./constants/sentry-state":7,"./first-time-state":37,"./fixtures/generate-wallet-state":38,"./lib/createStreamSink":65,"./lib/ens-ipfs/setup":72,"./lib/get-first-preferred-lang-code":74,"./lib/getObjStructure":75,"./lib/local-store":77,"./lib/migrator":81,"./lib/network-store":83,"./lib/notification-manager":84,"./lib/setup-initial-state-hooks":109,"./lib/util":130,"./metamask-controller":131,"./migrations":279,"./offscreen":280,"./platforms/extension":281,"@metamask/controller-utils":1143,"@metamask/notification-services-controller":1754,"@metamask/obs-store":1764,"@metamask/rpc-errors":2032,"@metamask/snaps-rpc-methods":2364,"@metamask/utils":2777,"debounce-stream":3684,events:3830,"extension-port-stream":3833,loglevel:4268,"readable-stream":4672,"webextension-polyfill":4889},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.loadStateFromPersistence=be,n.setupController=we,n.statePersistenceEvents=void 0,e("./lib/setup-initial-state-hooks");var r=$(e("events")),a=e("readable-stream"),i=$(e("debounce-stream")),s=$(e("loglevel")),o=$(e("webextension-polyfill")),c=e("@metamask/obs-store"),u=e("@metamask/utils"),l=e("@metamask/controller-utils"),d=$(e("extension-port-stream")),p=e("@metamask/rpc-errors"),m=e("@metamask/snaps-rpc-methods"),f=e("@metamask/notification-services-controller"),h=e("../../shared/constants/app"),y=e("../../shared/constants/metametrics"),E=e("../../shared/modules/browser-runtime.utils"),g=e("../../shared/modules/mv3.utils"),_=e("../../shared/modules/object.utils"),b=(e("../../test/e2e/default-fixture"),e("../../test/e2e/background-socket/socket-background-to-mocha"),e("../../shared/constants/offscreen-communication"),e("../../test/stub/keyring-bridge")),T=e("../../ui/selectors"),v=$(e("./migrations")),w=$(e("./lib/migrator")),S=$(e("./platforms/extension")),A=$(e("./lib/local-store")),M=$(e("./lib/network-store")),P=e("./constants/sentry-state"),C=$(e("./lib/createStreamSink")),I=U(e("./lib/notification-manager")),N=U(e("./metamask-controller")),O=$(e("./first-time-state")),R=$(e("./lib/get-first-preferred-lang-code")),k=$(e("./lib/getObjStructure")),D=$(e("./lib/ens-ipfs/setup")),j=e("./lib/util"),L=(e("./fixtures/generate-wallet-state"),e("./offscreen")),x=e("./constants/marketing-site-whitelist");function G(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(G=function(e){return e?n:t})(e)}function U(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=G(t);if(n&&n.has(e))return n.get(e);var r={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=a?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(r,i,s):r[i]=e[i]}return r.default=e,n&&n.set(e,r),r}function $(e){return e&&e.__esModule?e:{default:e}}const Y="#0376C9",H="#D73847",F=9,V=!1,B=V?new M.default:new A.default;global.stateHooks.getMostRecentPersistedState=()=>B.mostRecentRetrievedState;const{sentry:K}=global;let W={...O.default};const q={[h.ENVIRONMENT_TYPE_POPUP]:!0,[h.ENVIRONMENT_TYPE_NOTIFICATION]:!0,[h.ENVIRONMENT_TYPE_FULLSCREEN]:!0},z=["trezor-connect"];s.default.setLevel("info",!1);const J=new S.default,Q=new I.default;let X=0,Z=!1,ee=!1;const te={},ne={};let re,ae;const ie={};V&&(global.stateHooks.metamaskGetState=B.get.bind(B));const se=new URL("https://metamask.github.io/phishing-warning/v4.1.0/"),oe=se.toString(),ce=1e3,ue=n.statePersistenceEvents=new r.default,{promise:le,resolve:de,reject:pe}=(0,j.deferredPromise)(),me=async()=>{const e=await o.default.tabs.query({url:"<all_urls>",windowType:"normal"}).then((e=>((0,E.checkForLastErrorAndLog)(),e))).catch((()=>{(0,E.checkForLastErrorAndLog)()}));for(const t of e)o.default.tabs.sendMessage(t.id,{name:h.EXTENSION_MESSAGES.READY}).then((()=>{(0,E.checkForLastErrorAndLog)()})).catch((()=>{(0,E.checkForLastErrorAndLog)()}))};let fe,he,ye;function Ee(){const e=(new Date).toISOString();o.default.storage.session.set({timestamp:e})}async function ge(){try{const t=g.isManifestV3?(0,L.createOffscreen)():null,n=await be(),r=n.data,a=await(0,R.default)();let i;if(g.isManifestV3){var e;if(!1!==(null===(e=r.PreferencesController)||void 0===e?void 0:e.enableMV3TimestampSave)){const e=2e3;Ee(),setInterval(Ee,e)}const t=await o.default.storage.session.get(["isFirstMetaMaskControllerSetup"]);i=(null==t?void 0:t.isFirstMetaMaskControllerSetup)===undefined,await o.default.storage.session.set({isFirstMetaMaskControllerSetup:i})}we(r,a,V?{keyrings:{trezorBridge:b.FakeTrezorBridge,ledgerBridge:b.FakeLedgerBridge}}:{},i,n.meta,t),function(e){async function t(e,t){try{return await o.default.tabs.update(e,{url:t})}catch(e){return null==K?void 0:K.captureException(e)}}const n=!g.isManifestV3;o.default.webRequest.onBeforeRequest.addListener((r=>{var a,i,s;if(r.tabId===o.default.tabs.TAB_ID_NONE)return{};const{completedOnboarding:c}=e.onboardingController.state;if(!c)return{};if(!e.preferencesController.state.usePhishDetect)return{};if(r.initiator&&new URL(r.initiator).host===se.host)return{};const{hostname:u,href:l,searchParams:d}=new URL(r.url);if(V&&d.has("IN_TEST_BYPASS_EARLY_PHISHING_DETECTION"))return{};e.phishingController.maybeUpdateState();const p=e.phishingController.isBlockedRequest(r.url);let m,f;if("main_frame"!==r.type&&"sub_frame"!==r.type||(m=e.phishingController.test(r.url)),!(null!==(a=m)&&void 0!==a&&a.result||p.result))return{};f=null!==(i=m)&&void 0!==i&&i.result&&p.result?`${m.type} and ${p.type}`:null!==(s=m)&&void 0!==s&&s.result?m.type:p.type,e.metaMetricsController.trackEvent({event:y.MetaMetricsEventName.PhishingPageDisplayed,category:y.MetaMetricsEventCategory.Phishing,properties:{url:u,referrer:{url:u},reason:f}});const h=new URLSearchParams({hostname:u,href:l}),E=new URL(oe);E.hash=h.toString();const g=E.toString();return n?"sub_frame"===r.type?(t(r.tabId,g),{cancel:!0}):{redirectUrl:g}:(t(r.tabId,g),{})}),{urls:["http://*/*","https://*/*"]},n?["blocking"]:[])}(re),g.isManifestV3||await async function(){let e;try{const t=new URL(oe);let n,r;t.hash="#extensionStartup",e=window.document.createElement("iframe"),e.setAttribute("src",t.href),e.setAttribute("sandbox","allow-scripts allow-same-origin");const a=new Promise(((e,t)=>{n=e,r=t}));e.addEventListener("load",n),window.document.body.appendChild(e),setTimeout((()=>r(new _e)),ce),await a}catch(e){e instanceof _e?console.warn("Phishing warning page timeout; page not guaranteed to work offline."):console.error("Failed to initialize phishing warning page",e)}finally{e&&e.remove()}}(),await me(),s.default.info("MetaMask initialization complete."),de()}catch(e){pe(e)}}o.default.runtime.onConnect.addListener((async(...e)=>{await le,fe(...e)})),o.default.runtime.onConnectExternal.addListener((async(...e)=>{var t;await le;null!==(t=e[0].sender.tab)&&void 0!==t&&t.id,he(...e)}));class _e extends Error{constructor(){super("Timeout failed")}}async function be(){const e=new w.default({migrations:v.default,defaultVersion:null});if(e.on("error",console.warn),ae=await B.get()||e.generateInitialState(W),ae&&!ae.data&&(ae=e.generateInitialState(W),K.captureMessage("MetaMask - Empty vault found - unable to recover")),e.on("error",(e=>{const t=(0,k.default)(ae);K.captureException(e,{extra:{vaultStructure:t}})})),ae=await e.migrateData(ae),!ae)throw new Error("MetaMask - migrator returned undefined");if(!(0,u.isObject)(ae.meta))throw new Error(`MetaMask - migrator metadata has invalid type '${typeof ae.meta}'`);if("number"!=typeof ae.meta.version)throw new Error(`MetaMask - migrator metadata version has invalid type '${typeof ae.meta.version}'`);if(!(0,u.isObject)(ae.data))throw new Error(`MetaMask - migrator data has invalid type '${typeof ae.data}'`);return B.setMetadata(ae.meta),B.set(ae.data),ae}function Te(e){var t;const{metaMetricsId:n}=re.metaMetricsController.state;if(!(0,j.shouldEmitDappViewedEvent)(n))return;const r=re.controllerMessenger.call("PermissionController:getPermissions",e),a=null==r||null===(t=r.eth_accounts)||void 0===t||null===(t=t.caveats[0])||void 0===t?void 0:t.value.length;if(!a)return;const i=re.controllerMessenger.call("PreferencesController:getState"),s=Object.keys(i.identities).length;re.metaMetricsController.trackEvent({event:y.MetaMetricsEventName.DappViewed,category:y.MetaMetricsEventCategory.InpageProvider,referrer:{url:e},properties:{is_first_visit:!1,number_of_accounts:s,number_of_accounts_connected:a}})}function ve(e){if(!e.sender||!e.sender.tab||!e.sender.url)return;const t=e.sender.tab.id,n=new URL(e.sender.url),{origin:r}=n;Object.keys(ie).includes(t)||(ie[t]=r);const a=re.controllerMessenger.call("PermissionController:hasPermissions",r),i="New Tab"!==e.sender.tab.title;a&&i&&Te(r)}function we(e,t,n,r,u,E){var b;re=new N.default({infuraProjectId:"b6bf7d3508c941499b10025c0776eaf8",showUserConfirmation:Se,initState:e,initLangCode:t,platform:J,notificationManager:Q,browser:o.default,getRequestAccountTabIds:()=>ne,getOpenMetamaskTabsIds:()=>te,localStore:B,overrides:n,isFirstMetaMaskControllerSetup:r,currentMigrationVersion:u.version,featureFlags:{},offscreenPromise:E}),(0,D.default)({getCurrentChainId:()=>(0,T.getCurrentChainId)({metamask:re.networkController.state}),getIpfsGateway:re.preferencesController.getIpfsGateway.bind(re.preferencesController),getUseAddressBarEnsResolution:()=>re.preferencesController.state.useAddressBarEnsResolution,provider:re.provider}),(0,a.pipeline)((0,c.storeAsStream)(re.store),(0,i.default)(1e3),(0,C.default)((async e=>{await B.set(e),ue.emit("state-persisted",e)})),(e=>{s.default.error("MetaMask - Persistence pipeline failed",e)})),b=re,global.stateHooks.getSentryAppState=function(){const e=b.memStore.getState();return(0,_.maskObject)(e,P.SENTRY_BACKGROUND_STATE)};const v=()=>X>0||Boolean(Object.keys(te).length)||Z,w=(e,t)=>{if(!1===e)re.onClientClosed();else{if(t===h.ENVIRONMENT_TYPE_FULLSCREEN&&Boolean(Object.keys(te).length))return;re.onEnvironmentTypeClosed(t)}};function S(e,t){return e>t?`${t}+`:String(e)}function A(){const e=M(),t=function(){try{const{isNotificationServicesEnabled:e,isFeatureAnnouncementsEnabled:t}=re.notificationServicesController.state,n=Object.values(re.notificationController.state.notifications).filter((e=>null===e.readDate)).length,r=t?re.notificationServicesController.state.metamaskNotificationsList.filter((e=>!e.isRead&&e.type===f.NotificationServicesController.Constants.TRIGGER_TYPES.FEATURES_ANNOUNCEMENT)).length:0,a=e?re.notificationServicesController.state.metamaskNotificationsList.filter((e=>!e.isRead&&e.type!==f.NotificationServicesController.Constants.TRIGGER_TYPES.FEATURES_ANNOUNCEMENT)).length:0;return n+r+a}catch(e){return console.error("Failed to get unread notifications count:",e),0}}();let n="",r=Y;e?n=S(e,F):t>0&&(n=S(t,F),r=H);try{const e={text:n},t={color:r};g.isManifestV3?(o.default.action.setBadgeText(e),o.default.action.setBadgeBackgroundColor(t)):(o.default.browserAction.setBadgeText(e),o.default.browserAction.setBadgeBackgroundColor(t))}catch(e){console.error("Error updating browser badge:",e)}}function M(){try{let e=re.appStateController.waitingForUnlock.length+re.approvalController.getTotalApprovalCount();return re.preferencesController.getUseRequestQueue()&&(e+=re.queuedRequestController.state.queuedRequestCount),e}catch(e){return console.error("Failed to get pending approval count:",e),0}}fe=async e=>{var t;const r=e.name;if(z.includes(e.name))return;let i=!1;const s=(0,j.getPlatform)(),c=null!==(t=e.sender)&&void 0!==t&&t.url?new URL(e.sender.url):null;if(i=s===h.PLATFORM_FIREFOX?q[r]:(null==c?void 0:c.origin)===`chrome-extension://${o.default.runtime.id}`,i){var u;const t=(null==n||null===(u=n.getPortStream)||void 0===u?void 0:u.call(n,e))||new d.default(e);if(re.isClientOpen=!0,re.setupTrustedCommunication(t,e.sender),r===h.ENVIRONMENT_TYPE_POPUP&&(X+=1,(0,a.finished)(t,(()=>{X-=1;const e=v();re.isClientOpen=e,w(e,h.ENVIRONMENT_TYPE_POPUP)}))),r===h.ENVIRONMENT_TYPE_NOTIFICATION&&(Z=!0,(0,a.finished)(t,(()=>{Z=!1;const e=v();re.isClientOpen=e,w(e,h.ENVIRONMENT_TYPE_NOTIFICATION)}))),r===h.ENVIRONMENT_TYPE_FULLSCREEN){const n=e.sender.tab.id;te[n]=!0,(0,a.finished)(t,(()=>{delete te[n];const e=v();re.isClientOpen=e,w(e,h.ENVIRONMENT_TYPE_FULLSCREEN)}))}}else if(c&&c.origin===se.origin&&c.pathname===se.pathname){var l;const t=(null==n||null===(l=n.getPortStream)||void 0===l?void 0:l.call(n,e))||new d.default(e);re.setupPhishingCommunication({connectionStream:t})}else{if(e.sender&&e.sender.tab&&e.sender.url){const t=e.sender.tab.id,n=new URL(e.sender.url),{origin:r}=n;ve(e),e.onMessage.addListener((e=>{e.data&&e.data.method===h.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS&&(ne[r]=t)}))}if(c&&x.COOKIE_ID_MARKETING_WHITELIST_ORIGINS.some((e=>e===c.origin))){var p;const t=(null==n||null===(p=n.getPortStream)||void 0===p?void 0:p.call(n,e))||new d.default(e);re.setUpCookieHandlerCommunication({connectionStream:t})}he(e)}},he=e=>{var t;const r=(null==n||null===(t=n.getPortStream)||void 0===t?void 0:t.call(n,e))||new d.default(e);re.setupUntrustedCommunicationEip1193({connectionStream:r,sender:e.sender})},ye=async e=>{var t;if(z.includes(e.name))return;e.sender&&e.sender.tab&&e.sender.url&&ve(e);const r=(null==n||null===(t=n.getPortStream)||void 0===t?void 0:t.call(n,e))||new d.default(e);re.setupUntrustedCommunicationCaip({connectionStream:r,sender:e.sender})},null!=n&&n.registerConnectListeners&&n.registerConnectListeners(fe,he),A(),re.decryptMessageController.hub.on(N.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,A),re.encryptionPublicKeyController.hub.on(N.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,A),re.signatureController.hub.on(N.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,A),re.appStateController.on(N.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,A),re.controllerMessenger.subscribe(N.METAMASK_CONTROLLER_EVENTS.APPROVAL_STATE_CHANGE,A),re.controllerMessenger.subscribe(N.METAMASK_CONTROLLER_EVENTS.QUEUED_REQUEST_STATE_CHANGE,A),re.controllerMessenger.subscribe(N.METAMASK_CONTROLLER_EVENTS.METAMASK_NOTIFICATIONS_LIST_UPDATED,A),re.controllerMessenger.subscribe(N.METAMASK_CONTROLLER_EVENTS.METAMASK_NOTIFICATIONS_MARK_AS_READ,A),re.controllerMessenger.subscribe(N.METAMASK_CONTROLLER_EVENTS.NOTIFICATIONS_STATE_CHANGE,A),Q.on(I.NOTIFICATION_MANAGER_EVENTS.POPUP_CLOSED,(({automaticallyClosed:e})=>{e?M()>0&&Se():(re.signatureController.rejectUnapproved(y.REJECT_NOTIFICATION_CLOSE_SIG),re.decryptMessageController.rejectUnapproved(y.REJECT_NOTIFICATION_CLOSE),re.encryptionPublicKeyController.rejectUnapproved(y.REJECT_NOTIFICATION_CLOSE),Object.values(re.approvalController.state.pendingApprovals).forEach((({id:e,type:t})=>{switch(t){case l.ApprovalType.SnapDialogAlert:case l.ApprovalType.SnapDialogPrompt:case m.DIALOG_APPROVAL_TYPES.default:re.approvalController.accept(e,null);break;case l.ApprovalType.SnapDialogConfirmation:case h.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.confirmAccountCreation:case h.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.confirmAccountRemoval:case h.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.showSnapAccountRedirect:re.approvalController.accept(e,!1);break;default:re.approvalController.reject(e,p.providerErrors.userRejectedRequest())}}))),A()})),Object.values(re.snapController.state.snaps).some((e=>!e.preinstalled))&&re.snapController.updateBlockedSnaps()}async function Se(){const e=await J.getActiveTabs(),t=Boolean(e.find((e=>te[e.id]))),n=e.length>0&&e[0].extData&&e[0].extData.indexOf("vivaldi_tab")>-1;if(!ee&&(n||0===X)&&!t){ee=!0;try{const e=re.appStateController.getCurrentPopupId();await Q.showPopup((e=>re.appStateController.setCurrentPopupId(e)),e)}finally{ee=!1}}}const Ae=()=>{if(re)return re.metaMetricsController.updateTraits({[y.MetaMetricsUserTrait.InstallDateExt]:(new Date).toISOString().split("T")[0]}),void re.metaMetricsController.addEventBeforeMetricsOptIn({category:y.MetaMetricsEventCategory.App,event:y.MetaMetricsEventName.AppInstalled,properties:{}});setTimeout((()=>{Ae()}),500)};async function Me(){Boolean(await B.get())||(Ae(),J.openExtensionInBrowser()),o.default.tabs.onActivated.addListener((e=>{if(re){const{tabId:t}=e,n=ie[t];n&&re.permissionController.state.subjects[n]!==undefined&&Te(n)}}))}(async function(){await Me();try{await ge(),B.cleanUpMostRecentRetrievedState()}catch(e){s.default.error(e)}})()}}},{package:"$root$",file:"app/scripts/background.js"}]],[4],{});