LavaPack.loadBundle([[64,{loglevel:4388,"webextension-polyfill":5010},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function({location:e,registerOnboarding:t}){return async function(n,a,s,o){try{if("wallet_registerOnboarding"!==n.method)return void s();n.tabId&&n.tabId!==i.default.tabs.TAB_ID_NONE?await t(e,n.tabId):r.default.debug(`'wallet_registerOnboarding' message from ${e} ignored due to missing tabId`),a.result=!0,o()}catch(e){o(e)}}};var r=a(e("loglevel")),i=a(e("webextension-polyfill"));function a(e){return e&&e.__esModule?e:{default:e}}}}},{package:"$root$",file:"app/scripts/lib/createOnboardingMiddleware.js"}],[640,{stream:4886},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.storeAsStream=void 0;const r=e("stream");class i extends r.Duplex{constructor(e){super({objectMode:!0}),this.resume(),this.handler=e=>this.push(e),this.obsStore=e,this.obsStore.subscribe(this.handler)}pipe(e,t){const n=super.pipe(e,t);return e.write(this.obsStore.getState()),n}_write(e,t,n){this.obsStore.putState(e),n()}_read(e){return undefined}_destroy(e,t){this.obsStore.unsubscribe(this.handler),super._destroy(e,t)}}n.storeAsStream=function(e){return new i(e)}}}},{package:"@keystonehq/metamask-airgapped-keyring>@metamask/obs-store",file:"node_modules/@keystonehq/metamask-airgapped-keyring/node_modules/@metamask/obs-store/dist/asStream.js"}],[641,{"./ComposedStore":637,"./MergedStore":638,"./ObservableStore":639,"./asStream":640,"./transform":642},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){r===undefined&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){r===undefined&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),i(e("./asStream"),n),i(e("./ComposedStore"),n),i(e("./MergedStore"),n),i(e("./ObservableStore"),n),i(e("./transform"),n)}}},{package:"@keystonehq/metamask-airgapped-keyring>@metamask/obs-store",file:"node_modules/@keystonehq/metamask-airgapped-keyring/node_modules/@metamask/obs-store/dist/index.js"}],[642,{through2:656},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.storeTransformStream=void 0;const r=e("through2");n.storeTransformStream=function(e){return r.obj(((t,n,r)=>{try{return r(null,e(t)),undefined}catch(e){return r(e),undefined}}))}}}},{package:"@keystonehq/metamask-airgapped-keyring>@metamask/obs-store",file:"node_modules/@keystonehq/metamask-airgapped-keyring/node_modules/@metamask/obs-store/dist/transform.js"}],[643,{events:3874},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});const r=e("events");function i(e,t,n){try{Reflect.apply(e,t,n)}catch(e){setTimeout((()=>{throw e}))}}class a extends r.EventEmitter{emit(e,...t){let n="error"===e;const r=this._events;if(r!==undefined)n=n&&r.error===undefined;else if(!n)return!1;if(n){let e;if(t.length>0&&([e]=t),e instanceof Error)throw e;const n=new Error("Unhandled error."+(e?` (${e.message})`:""));throw n.context=e,n}const a=r[e];if(a===undefined)return!1;if("function"==typeof a)i(a,this,t);else{const e=a.length,n=function(e){const t=e.length,n=new Array(t);for(let r=0;r<t;r+=1)n[r]=e[r];return n}(a);for(let r=0;r<e;r+=1)i(n[r],this,t)}return!0}}n.default=a}}},{package:"@keystonehq/metamask-airgapped-keyring>@metamask/obs-store>@metamask/safe-event-emitter",file:"node_modules/@keystonehq/metamask-airgapped-keyring/node_modules/@metamask/safe-event-emitter/index.js"}],[644,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r={}.toString;t.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}}}},{package:"@keystonehq/metamask-airgapped-keyring>@metamask/obs-store>through2>readable-stream>isarray",file:"node_modules/@keystonehq/metamask-airgapped-keyring/node_modules/isarray/index.js"}],[645,{"./_stream_readable":647,"./_stream_writable":649,"core-util-is":3638,inherits:4187,"process-nextick-args":4523},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=e("process-nextick-args"),i=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};t.exports=d;var a=Object.create(e("core-util-is"));a.inherits=e("inherits");var s=e("./_stream_readable"),o=e("./_stream_writable");a.inherits(d,s);for(var c=i(o.prototype),u=0;u<c.length;u++){var l=c[u];d.prototype[l]||(d.prototype[l]=o.prototype[l])}function d(e){if(!(this instanceof d))return new d(e);s.call(this,e),o.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",f)}function f(){this.allowHalfOpen||this._writableState.ended||r.nextTick(p,this)}function p(e){e.end()}Object.defineProperty(d.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(d.prototype,"destroyed",{get:function(){return this._readableState!==undefined&&this._writableState!==undefined&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){this._readableState!==undefined&&this._writableState!==undefined&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),d.prototype._destroy=function(e,t){this.push(null),this.end(),r.nextTick(t,e)}}}},{package:"@keystonehq/metamask-airgapped-keyring>@metamask/obs-store>through2>readable-stream",file:"node_modules/@keystonehq/metamask-airgapped-keyring/node_modules/readable-stream/lib/_stream_duplex.js"}],[646,{"./_stream_transform":648,"core-util-is":3638,inherits:4187},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){t.exports=a;var r=e("./_stream_transform"),i=Object.create(e("core-util-is"));function a(e){if(!(this instanceof a))return new a(e);r.call(this,e)}i.inherits=e("inherits"),i.inherits(a,r),a.prototype._transform=function(e,t,n){n(null,e)}}}},{package:"@keystonehq/metamask-airgapped-keyring>@metamask/obs-store>through2>readable-stream",file:"node_modules/@keystonehq/metamask-airgapped-keyring/node_modules/readable-stream/lib/_stream_passthrough.js"}],[647,{"./_stream_duplex":645,"./internal/streams/BufferList":650,"./internal/streams/destroy":651,"./internal/streams/stream":652,_process:4524,"core-util-is":3638,events:3874,inherits:4187,isarray:644,"process-nextick-args":4523,"safe-buffer":654,"string_decoder/":655,util:3541},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(n){(function(){var r=e("process-nextick-args");t.exports=b;var i,a=e("isarray");b.ReadableState=y;e("events").EventEmitter;var s=function(e,t){return e.listeners(t).length},o=e("./internal/streams/stream"),c=e("safe-buffer").Buffer,u=global.Uint8Array||function(){};var l=Object.create(e("core-util-is"));l.inherits=e("inherits");var d=e("util"),f=void 0;f=d&&d.debuglog?d.debuglog("stream"):function(){};var p,h=e("./internal/streams/BufferList"),m=e("./internal/streams/destroy");l.inherits(b,o);var g=["error","close","destroy","pause","resume"];function y(t,n){t=t||{};var r=n instanceof(i=i||e("./_stream_duplex"));this.objectMode=!!t.objectMode,r&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var a=t.highWaterMark,s=t.readableHighWaterMark,o=this.objectMode?16:16384;this.highWaterMark=a||0===a?a:r&&(s||0===s)?s:o,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new h,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(p||(p=e("string_decoder/").StringDecoder),this.decoder=new p(t.encoding),this.encoding=t.encoding)}function b(t){if(i=i||e("./_stream_duplex"),!(this instanceof b))return new b(t);this._readableState=new y(t,this),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),o.call(this)}function _(e,t,n,r,i){var a,s=e._readableState;null===t?(s.reading=!1,function(e,t){if(t.ended)return;if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,T(e)}(e,s)):(i||(a=function(e,t){var n;r=t,c.isBuffer(r)||r instanceof u||"string"==typeof t||t===undefined||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk"));var r;return n}(s,t)),a?e.emit("error",a):s.objectMode||t&&t.length>0?("string"==typeof t||s.objectMode||Object.getPrototypeOf(t)===c.prototype||(t=function(e){return c.from(e)}(t)),r?s.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):w(e,s,t,!0):s.ended?e.emit("error",new Error("stream.push() after EOF")):(s.reading=!1,s.decoder&&!n?(t=s.decoder.write(t),s.objectMode||0!==t.length?w(e,s,t,!1):M(e,s)):w(e,s,t,!1))):r||(s.reading=!1));return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(s)}function w(e,t,n,r){t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&T(e)),M(e,t)}Object.defineProperty(b.prototype,"destroyed",{get:function(){return this._readableState!==undefined&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),b.prototype.destroy=m.destroy,b.prototype._undestroy=m.undestroy,b.prototype._destroy=function(e,t){this.push(null),t(e)},b.prototype.push=function(e,t){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof e&&((t=t||r.defaultEncoding)!==r.encoding&&(e=c.from(e,t),t=""),n=!0),_(this,e,t,!1,n)},b.prototype.unshift=function(e){return _(this,e,null,!0,!1)},b.prototype.isPaused=function(){return!1===this._readableState.flowing},b.prototype.setEncoding=function(t){return p||(p=e("string_decoder/").StringDecoder),this._readableState.decoder=new p(t),this._readableState.encoding=t,this};var E=8388608;function v(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=E?e=E:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function T(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(f("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?r.nextTick(S,e):S(e))}function S(e){f("emit readable"),e.emit("readable"),C(e)}function M(e,t){t.readingMore||(t.readingMore=!0,r.nextTick(k,e,t))}function k(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(f("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function A(e){f("readable nexttick read 0"),e.read(0)}function P(e,t){t.reading||(f("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),C(e),t.flowing&&!t.reading&&e.read(0)}function C(e){var t=e._readableState;for(f("flow",t.flowing);t.flowing&&null!==e.read(););}function O(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=function(e,t,n){var r;e<t.head.data.length?(r=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):r=e===t.head.data.length?t.shift():n?function(e,t){var n=t.head,r=1,i=n.data;e-=i.length;for(;n=n.next;){var a=n.data,s=e>a.length?a.length:e;if(s===a.length?i+=a:i+=a.slice(0,e),0===(e-=s)){s===a.length?(++r,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=a.slice(s));break}++r}return t.length-=r,i}(e,t):function(e,t){var n=c.allocUnsafe(e),r=t.head,i=1;r.data.copy(n),e-=r.data.length;for(;r=r.next;){var a=r.data,s=e>a.length?a.length:e;if(a.copy(n,n.length-e,0,s),0===(e-=s)){s===a.length?(++i,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=a.slice(s));break}++i}return t.length-=i,n}(e,t);return r}(e,t.buffer,t.decoder),n);var n}function N(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,r.nextTick(R,t,e))}function R(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function I(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}b.prototype.read=function(e){f("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return f("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?N(this):T(this),null;if(0===(e=v(e,t))&&t.ended)return 0===t.length&&N(this),null;var r,i=t.needReadable;return f("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&f("length less than watermark",i=!0),t.ended||t.reading?f("reading or ended",i=!1):i&&(f("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=v(n,t))),null===(r=e>0?O(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&N(this)),null!==r&&this.emit("data",r),r},b.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},b.prototype.pipe=function(e,t){var i=this,o=this._readableState;switch(o.pipesCount){case 0:o.pipes=e;break;case 1:o.pipes=[o.pipes,e];break;default:o.pipes.push(e)}o.pipesCount+=1,f("pipe count=%d opts=%j",o.pipesCount,t);var c=(!t||!1!==t.end)&&e!==n.stdout&&e!==n.stderr?l:_;function u(t,n){f("onunpipe"),t===i&&n&&!1===n.hasUnpiped&&(n.hasUnpiped=!0,f("cleanup"),e.removeListener("close",y),e.removeListener("finish",b),e.removeListener("drain",d),e.removeListener("error",g),e.removeListener("unpipe",u),i.removeListener("end",l),i.removeListener("end",_),i.removeListener("data",m),p=!0,!o.awaitDrain||e._writableState&&!e._writableState.needDrain||d())}function l(){f("onend"),e.end()}o.endEmitted?r.nextTick(c):i.once("end",c),e.on("unpipe",u);var d=function(e){return function(){var t=e._readableState;f("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&s(e,"data")&&(t.flowing=!0,C(e))}}(i);e.on("drain",d);var p=!1;var h=!1;function m(t){f("ondata"),h=!1,!1!==e.write(t)||h||((1===o.pipesCount&&o.pipes===e||o.pipesCount>1&&-1!==I(o.pipes,e))&&!p&&(f("false write response, pause",i._readableState.awaitDrain),i._readableState.awaitDrain++,h=!0),i.pause())}function g(t){f("onerror",t),_(),e.removeListener("error",g),0===s(e,"error")&&e.emit("error",t)}function y(){e.removeListener("finish",b),_()}function b(){f("onfinish"),e.removeListener("close",y),_()}function _(){f("unpipe"),i.unpipe(e)}return i.on("data",m),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?a(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",g),e.once("close",y),e.once("finish",b),e.emit("pipe",i),o.flowing||(f("pipe resume"),i.resume()),e},b.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n)),this;if(!e){var r=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var a=0;a<i;a++)r[a].emit("unpipe",this,n);return this}var s=I(t.pipes,e);return-1===s||(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n)),this},b.prototype.on=function(e,t){var n=o.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var i=this._readableState;i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.emittedReadable=!1,i.reading?i.length&&T(this):r.nextTick(A,this))}return n},b.prototype.addListener=b.prototype.on,b.prototype.resume=function(){var e=this._readableState;return e.flowing||(f("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,r.nextTick(P,e,t))}(this,e)),this},b.prototype.pause=function(){return f("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(f("pause"),this._readableState.flowing=!1,this.emit("pause")),this},b.prototype.wrap=function(e){var t=this,n=this._readableState,r=!1;for(var i in e.on("end",(function(){if(f("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(i){(f("wrapped data"),n.decoder&&(i=n.decoder.write(i)),!n.objectMode||null!==i&&i!==undefined)&&((n.objectMode||i&&i.length)&&(t.push(i)||(r=!0,e.pause())))})),e)this[i]===undefined&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var a=0;a<g.length;a++)e.on(g[a],this.emit.bind(this,g[a]));return this._read=function(t){f("wrapped _read",t),r&&(r=!1,e.resume())},this},Object.defineProperty(b.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),b._fromList=O}).call(this)}).call(this,e("_process"))}}},{package:"@keystonehq/metamask-airgapped-keyring>@metamask/obs-store>through2>readable-stream",file:"node_modules/@keystonehq/metamask-airgapped-keyring/node_modules/readable-stream/lib/_stream_readable.js"}],[648,{"./_stream_duplex":645,"core-util-is":3638,inherits:4187},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){t.exports=s;var r=e("./_stream_duplex"),i=Object.create(e("core-util-is"));function a(e,t){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(!r)return this.emit("error",new Error("write callback called multiple times"));n.writechunk=null,n.writecb=null,null!=t&&this.push(t),r(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function s(e){if(!(this instanceof s))return new s(e);r.call(this,e),this._transformState={afterTransform:a.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",o)}function o(){var e=this;"function"==typeof this._flush?this._flush((function(t,n){c(e,t,n)})):c(this,null,null)}function c(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}i.inherits=e("inherits"),i.inherits(s,r),s.prototype.push=function(e,t){return this._transformState.needTransform=!1,r.prototype.push.call(this,e,t)},s.prototype._transform=function(e,t,n){throw new Error("_transform() is not implemented")},s.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},s.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},s.prototype._destroy=function(e,t){var n=this;r.prototype._destroy.call(this,e,(function(e){t(e),n.emit("close")}))}}}},{package:"@keystonehq/metamask-airgapped-keyring>@metamask/obs-store>through2>readable-stream",file:"node_modules/@keystonehq/metamask-airgapped-keyring/node_modules/readable-stream/lib/_stream_transform.js"}],[649,{"./_stream_duplex":645,"./internal/streams/destroy":651,"./internal/streams/stream":652,_process:4524,"core-util-is":3638,inherits:4187,"process-nextick-args":4523,"safe-buffer":654,timers:4903,"util-deprecate":4957},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(n,r){(function(){var i=e("process-nextick-args");function a(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var r=e.entry;e.entry=null;for(;r;){var i=r.callback;t.pendingcb--,i(n),r=r.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}t.exports=y;var s,o=!n.browser&&["v0.10","v0.9."].indexOf(n.version.slice(0,5))>-1?r:i.nextTick;y.WritableState=g;var c=Object.create(e("core-util-is"));c.inherits=e("inherits");var u={deprecate:e("util-deprecate")},l=e("./internal/streams/stream"),d=e("safe-buffer").Buffer,f=global.Uint8Array||function(){};var p,h=e("./internal/streams/destroy");function m(){}function g(t,n){s=s||e("./_stream_duplex"),t=t||{};var r=n instanceof s;this.objectMode=!!t.objectMode,r&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var c=t.highWaterMark,u=t.writableHighWaterMark,l=this.objectMode?16:16384;this.highWaterMark=c||0===c?c:r&&(u||0===u)?u:l,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var d=!1===t.decodeStrings;this.decodeStrings=!d,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,r=n.sync,a=n.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,r,a){--t.pendingcb,n?(i.nextTick(a,r),i.nextTick(T,e,t),e._writableState.errorEmitted=!0,e.emit("error",r)):(a(r),e._writableState.errorEmitted=!0,e.emit("error",r),T(e,t))}(e,n,r,t,a);else{var s=E(n);s||n.corked||n.bufferProcessing||!n.bufferedRequest||w(e,n),r?o(_,e,n,s,a):_(e,n,s,a)}}(n,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new a(this)}function y(t){if(s=s||e("./_stream_duplex"),!(p.call(y,this)||this instanceof s))return new y(t);this._writableState=new g(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),l.call(this)}function b(e,t,n,r,i,a,s){t.writelen=r,t.writecb=s,t.writing=!0,t.sync=!0,n?e._writev(i,t.onwrite):e._write(i,a,t.onwrite),t.sync=!1}function _(e,t,n,r){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,r(),T(e,t)}function w(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,i=new Array(r),s=t.corkedRequestsFree;s.entry=n;for(var o=0,c=!0;n;)i[o]=n,n.isBuf||(c=!1),n=n.next,o+=1;i.allBuffers=c,b(e,t,!0,t.length,i,"",s.finish),t.pendingcb++,t.lastBufferedRequest=null,s.next?(t.corkedRequestsFree=s.next,s.next=null):t.corkedRequestsFree=new a(t),t.bufferedRequestCount=0}else{for(;n;){var u=n.chunk,l=n.encoding,d=n.callback;if(b(e,t,!1,t.objectMode?1:u.length,u,l,d),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function E(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function v(e,t){e._final((function(n){t.pendingcb--,n&&e.emit("error",n),t.prefinished=!0,e.emit("prefinish"),T(e,t)}))}function T(e,t){var n=E(t);return n&&(!function(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,i.nextTick(v,e,t)):(t.prefinished=!0,e.emit("prefinish")))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),n}c.inherits(y,l),g.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(g.prototype,"buffer",{get:u.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(p=Function.prototype[Symbol.hasInstance],Object.defineProperty(y,Symbol.hasInstance,{value:function(e){return!!p.call(this,e)||this===y&&(e&&e._writableState instanceof g)}})):p=function(e){return e instanceof this},y.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},y.prototype.write=function(e,t,n){var r,a=this._writableState,s=!1,o=!a.objectMode&&(r=e,d.isBuffer(r)||r instanceof f);return o&&!d.isBuffer(e)&&(e=function(e){return d.from(e)}(e)),"function"==typeof t&&(n=t,t=null),o?t="buffer":t||(t=a.defaultEncoding),"function"!=typeof n&&(n=m),a.ended?function(e,t){var n=new Error("write after end");e.emit("error",n),i.nextTick(t,n)}(this,n):(o||function(e,t,n,r){var a=!0,s=!1;return null===n?s=new TypeError("May not write null values to stream"):"string"==typeof n||n===undefined||t.objectMode||(s=new TypeError("Invalid non-string/buffer chunk")),s&&(e.emit("error",s),i.nextTick(r,s),a=!1),a}(this,a,e,n))&&(a.pendingcb++,s=function(e,t,n,r,i,a){if(!n){var s=function(e,t,n){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=d.from(t,n));return t}(t,r,i);r!==s&&(n=!0,i="buffer",r=s)}var o=t.objectMode?1:r.length;t.length+=o;var c=t.length<t.highWaterMark;c||(t.needDrain=!0);if(t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:i,isBuf:n,callback:a,next:null},u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else b(e,t,!1,o,r,i,a);return c}(this,a,o,e,t,n)),s},y.prototype.cork=function(){this._writableState.corked++},y.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||w(this,e))},y.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(y.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),y.prototype._write=function(e,t,n){n(new Error("_write() is not implemented"))},y.prototype._writev=null,y.prototype.end=function(e,t,n){var r=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!==e&&e!==undefined&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||function(e,t,n){t.ending=!0,T(e,t),n&&(t.finished?i.nextTick(n):e.once("finish",n));t.ended=!0,e.writable=!1}(this,r,n)},Object.defineProperty(y.prototype,"destroyed",{get:function(){return this._writableState!==undefined&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),y.prototype.destroy=h.destroy,y.prototype._undestroy=h.undestroy,y.prototype._destroy=function(e,t){this.end(),t(e)}}).call(this)}).call(this,e("_process"),e("timers").setImmediate)}}},{package:"@keystonehq/metamask-airgapped-keyring>@metamask/obs-store>through2>readable-stream",file:"node_modules/@keystonehq/metamask-airgapped-keyring/node_modules/readable-stream/lib/_stream_writable.js"}],[65,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){return function(t,n,r){t.origin=e.origin,r()}}}}},{package:"$root$",file:"app/scripts/lib/createOriginMiddleware.js"}],[650,{"safe-buffer":654,util:3541},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=e("safe-buffer").Buffer,i=e("util");t.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},e.prototype.concat=function(e){if(0===this.length)return r.alloc(0);if(1===this.length)return this.head.data;for(var t,n,i,a=r.allocUnsafe(e>>>0),s=this.head,o=0;s;)t=s.data,n=a,i=o,t.copy(n,i),o+=s.data.length,s=s.next;return a},e}(),i&&i.inspect&&i.inspect.custom&&(t.exports.prototype[i.inspect.custom]=function(){var e=i.inspect({length:this.length});return this.constructor.name+" "+e})}}},{package:"@keystonehq/metamask-airgapped-keyring>@metamask/obs-store>through2>readable-stream",file:"node_modules/@keystonehq/metamask-airgapped-keyring/node_modules/readable-stream/lib/internal/streams/BufferList.js"}],[651,{"process-nextick-args":4523},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=e("process-nextick-args");function i(e,t){e.emit("error",t)}t.exports={destroy:function(e,t){var n=this,a=this._readableState&&this._readableState.destroyed,s=this._writableState&&this._writableState.destroyed;return a||s?(t?t(e):!e||this._writableState&&this._writableState.errorEmitted||r.nextTick(i,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?(r.nextTick(i,n,e),n._writableState&&(n._writableState.errorEmitted=!0)):t&&t(e)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}}}},{package:"@keystonehq/metamask-airgapped-keyring>@metamask/obs-store>through2>readable-stream",file:"node_modules/@keystonehq/metamask-airgapped-keyring/node_modules/readable-stream/lib/internal/streams/destroy.js"}],[652,{events:3874},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){t.exports=e("events").EventEmitter}}},{package:"@keystonehq/metamask-airgapped-keyring>@metamask/obs-store>through2>readable-stream",file:"node_modules/@keystonehq/metamask-airgapped-keyring/node_modules/readable-stream/lib/internal/streams/stream-browser.js"}],[653,{"./lib/_stream_duplex.js":645,"./lib/_stream_passthrough.js":646,"./lib/_stream_readable.js":647,"./lib/_stream_transform.js":648,"./lib/_stream_writable.js":649},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(n=t.exports=e("./lib/_stream_readable.js")).Stream=n,n.Readable=n,n.Writable=e("./lib/_stream_writable.js"),n.Duplex=e("./lib/_stream_duplex.js"),n.Transform=e("./lib/_stream_transform.js"),n.PassThrough=e("./lib/_stream_passthrough.js")}}},{package:"@keystonehq/metamask-airgapped-keyring>@metamask/obs-store>through2>readable-stream",file:"node_modules/@keystonehq/metamask-airgapped-keyring/node_modules/readable-stream/readable-browser.js"}],[654,{buffer:3576},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=e("buffer"),i=r.Buffer;function a(e,t){for(var n in e)t[n]=e[n]}function s(e,t,n){return i(e,t,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?t.exports=r:(a(r,n),n.Buffer=s),a(i,s),s.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,n)},s.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=i(e);return t!==undefined?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},s.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}}}},{package:"@keystonehq/metamask-airgapped-keyring>@metamask/obs-store>through2>readable-stream>safe-buffer",file:"node_modules/@keystonehq/metamask-airgapped-keyring/node_modules/safe-buffer/index.js"}],[655,{"safe-buffer":654},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=e("safe-buffer").Buffer,i=r.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function a(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(r.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=c,this.end=u,t=4;break;case"utf8":this.fillLast=o,t=4;break;case"base64":this.text=l,this.end=d,t=3;break;default:return this.write=f,void(this.end=p)}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(t)}function s(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function o(e){var t=this.lastTotal-this.lastNeed,n=function(e,t,n){if(128!=(192&t[0]))return e.lastNeed=0,"�";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"�";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"�"}}(this,e);return n!==undefined?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function c(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var r=n.charCodeAt(n.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function u(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,n)}return t}function l(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function d(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function f(e){return e.toString(this.encoding)}function p(e){return e&&e.length?this.write(e):""}n.StringDecoder=a,a.prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if((t=this.fillLast(e))===undefined)return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},a.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"�":t},a.prototype.text=function(e,t){var n=function(e,t,n){var r=t.length-1;if(r<n)return 0;var i=s(t[r]);if(i>=0)return i>0&&(e.lastNeed=i-1),i;if(--r<n||-2===i)return 0;if(i=s(t[r]),i>=0)return i>0&&(e.lastNeed=i-2),i;if(--r<n||-2===i)return 0;if(i=s(t[r]),i>=0)return i>0&&(2===i?i=0:e.lastNeed=i-3),i;return 0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var r=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,r),e.toString("utf8",t,r)},a.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}}}},{package:"@keystonehq/metamask-airgapped-keyring>@metamask/obs-store>through2>readable-stream>string_decoder",file:"node_modules/@keystonehq/metamask-airgapped-keyring/node_modules/string_decoder/lib/string_decoder.js"}],[656,{_process:4524,"readable-stream":653,util:4960,xtend:5016},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(n){(function(){var r=e("readable-stream").Transform,i=e("util").inherits,a=e("xtend");function s(e){r.call(this,e),this._destroyed=!1}function o(e,t,n){n(null,e)}function c(e){return function(t,n,r){return"function"==typeof t&&(r=n,n=t,t={}),"function"!=typeof n&&(n=o),"function"!=typeof r&&(r=null),e(t,n,r)}}i(s,r),s.prototype.destroy=function(e){if(!this._destroyed){this._destroyed=!0;var t=this;n.nextTick((function(){e&&t.emit("error",e),t.emit("close")}))}},t.exports=c((function(e,t,n){var r=new s(e);return r._transform=t,n&&(r._flush=n),r})),t.exports.ctor=c((function(e,t,n){function r(t){if(!(this instanceof r))return new r(t);this.options=a(e,t),s.call(this,this.options)}return i(r,s),r.prototype._transform=t,n&&(r.prototype._flush=n),r})),t.exports.obj=c((function(e,t,n){var r=new s(a({objectMode:!0,highWaterMark:16},e));return r._transform=t,n&&(r._flush=n),r}))}).call(this)}).call(this,e("_process"))}}},{package:"@keystonehq/metamask-airgapped-keyring>@metamask/obs-store>through2",file:"node_modules/@keystonehq/metamask-airgapped-keyring/node_modules/through2/through2.js"}],[66,{"../../../shared/constants/app":5031,"../../../shared/constants/metametrics":5043,"../../../shared/constants/security-provider":5053,"../../../shared/constants/signatures":5054,"../../../shared/constants/transaction":5061,"../../../shared/modules/transaction.utils":5105,"../../../ui/helpers/utils/metrics":5989,"../../../ui/pages/confirmations/utils/confirm":6379,"./snap-keyring/metrics":113,"@metamask/controller-utils":1250,"eth-rpc-errors":3801,"ethereumjs-util":3832},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function({trackEvent:e,getMetricsState:t,rateLimitTimeout:n=3e5,rateLimitSamplePercent:v=.001,globalRateLimitTimeout:T=3e5,globalRateLimitMaxAmount:S=10,getAccountType:M,getDeviceModel:k,isConfirmationRedesignEnabled:A,snapAndHardwareMessenger:P,appStateController:C}){return async function(O,N,R){const{origin:I,method:j,params:x}=O,D=g[j]??m.RANDOM_SAMPLE;let L;switch(D){case m.TIMEOUT:L=void 0!==w[j];break;case m.NON_RATE_LIMITED:L=!1;break;case m.BLOCKED:L=!0;break;default:case m.RANDOM_SAMPLE:L=Math.random()>=v}const U=S>0&&E>=S,$=!0===t().participateInMetaMetrics,G=b[j],q={},B=I!==s.ORIGIN_METAMASK&&!L&&!U&&!0===$;if(B){const t=G?G.REQUESTED:o.MetaMetricsEventName.ProviderMethodCalled;if(t===o.MetaMetricsEventName.SignatureRequested){var F,Y,W,H,V;let e;var K,z;if(q.signature_type=j,(0,a.isValidAddress)(null==O||null===(F=O.params)||void 0===F?void 0:F[1]))e=null==O||null===(K=O.params)||void 0===K?void 0:K[0];else e=null==O||null===(z=O.params)||void 0===z?void 0:z[1];null!==(Y=O.securityAlertResponse)&&void 0!==Y&&Y.providerRequestsCount&&Object.keys(O.securityAlertResponse.providerRequestsCount).forEach((e=>{q[`ppom_${e}_count`]=O.securityAlertResponse.providerRequestsCount[e]})),q.security_alert_response=(null===(W=O.securityAlertResponse)||void 0===W?void 0:W.result_type)??u.BlockaidResultType.NotApplicable,q.security_alert_reason=(null===(H=O.securityAlertResponse)||void 0===H?void 0:H.reason)??u.BlockaidReason.notApplicable,null!==(V=O.securityAlertResponse)&&void 0!==V&&V.description&&(q.security_alert_description=O.securityAlertResponse.description);A()&&p.REDESIGN_APPROVAL_TYPES.find((e=>e===y[j]))&&(q.ui_customizations=[...q.ui_customizations||[],o.MetaMetricsEventUiCustomization.RedesignedConfirmation]);const t=await(0,h.getSnapAndHardwareInfoForMetrics)(M,k,P);Object.assign(q,t);try{if(j===s.MESSAGE_TYPE.PERSONAL_SIGN){const{isSIWEMessage:t}=(0,r.detectSIWE)({data:e});t&&(q.ui_customizations=[...q.ui_customizations||[],o.MetaMetricsEventUiCustomization.Siwe])}else if(j===s.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V4){const{primaryType:t}=(0,c.parseTypedDataMessage)(e);q.eip712_primary_type=t,l.PRIMARY_TYPES_PERMIT.includes(t)?q.ui_customizations=[...q.ui_customizations||[],o.MetaMetricsEventUiCustomization.Permit]:l.PRIMARY_TYPES_ORDER.includes(t)&&(q.ui_customizations=[...q.ui_customizations||[],o.MetaMetricsEventUiCustomization.Order])}}catch(e){console.warn(`createRPCMethodTrackingMiddleware: Errored - ${e}`)}}else q.method=j;const i=_[j];i&&(q.params=i(x)),e({event:t,category:o.MetaMetricsEventCategory.InpageProvider,referrer:{url:I},properties:q}),D===m.TIMEOUT&&(w[j]=setTimeout((()=>{delete w[j]}),n)),E+=1,setTimeout((()=>{E-=1}),T)}R((async t=>{var n,r,a;if(!1===B||void 0===G)return t();let s;(null===(n=N.error)||void 0===n?void 0:n.code)===i.errorCodes.provider.userRejectedRequest?s=G.REJECTED:(null===(r=N.error)||void 0===r?void 0:r.code)===i.errorCodes.rpc.internal&&"Request rejected by user or snap."===(null===(a=N.error)||void 0===a?void 0:a.message)?(s=G.REJECTED,q.status=N.error.message):s=G.APPROVED;let c={};if(d.SIGNING_METHODS.includes(j)){var l;const e=C.getSignatureSecurityAlertResponse(null===(l=O.securityAlertResponse)||void 0===l?void 0:l.securityAlertId);c=(0,f.getBlockaidMetricsProps)({securityAlertResponse:e})}const p={...q,...c,security_alert_reason:c.security_alert_response===u.BlockaidResultType.Benign?"":c.security_alert_reason};return e({event:s,category:o.MetaMetricsEventCategory.InpageProvider,referrer:{url:I},properties:p}),t()}))}};var r=e("@metamask/controller-utils"),i=e("eth-rpc-errors"),a=e("ethereumjs-util"),s=e("../../../shared/constants/app"),o=e("../../../shared/constants/metametrics"),c=e("../../../shared/modules/transaction.utils"),u=e("../../../shared/constants/security-provider"),l=e("../../../shared/constants/signatures"),d=e("../../../shared/constants/transaction"),f=e("../../../ui/helpers/utils/metrics"),p=e("../../../ui/pages/confirmations/utils/confirm"),h=e("./snap-keyring/metrics");const m={TIMEOUT:"timeout",BLOCKED:"blocked",NON_RATE_LIMITED:"non_rate_limited",RANDOM_SAMPLE:"random_sample"},g={[s.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA]:m.NON_RATE_LIMITED,[s.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V3]:m.NON_RATE_LIMITED,[s.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V4]:m.NON_RATE_LIMITED,[s.MESSAGE_TYPE.PERSONAL_SIGN]:m.NON_RATE_LIMITED,[s.MESSAGE_TYPE.ETH_DECRYPT]:m.NON_RATE_LIMITED,[s.MESSAGE_TYPE.ETH_GET_ENCRYPTION_PUBLIC_KEY]:m.NON_RATE_LIMITED,[s.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS]:m.TIMEOUT,[s.MESSAGE_TYPE.WALLET_REQUEST_PERMISSIONS]:m.TIMEOUT,[s.MESSAGE_TYPE.SEND_METADATA]:m.BLOCKED,[s.MESSAGE_TYPE.ETH_CHAIN_ID]:m.BLOCKED,[s.MESSAGE_TYPE.ETH_ACCOUNTS]:m.BLOCKED,[s.MESSAGE_TYPE.LOG_WEB3_SHIM_USAGE]:m.BLOCKED,[s.MESSAGE_TYPE.GET_PROVIDER_STATE]:m.BLOCKED},y={[s.MESSAGE_TYPE.PERSONAL_SIGN]:r.ApprovalType.PersonalSign,[s.MESSAGE_TYPE.SIGN]:r.ApprovalType.SignTransaction,[s.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA]:r.ApprovalType.EthSignTypedData,[s.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V1]:r.ApprovalType.EthSignTypedData,[s.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V3]:r.ApprovalType.EthSignTypedData,[s.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V4]:r.ApprovalType.EthSignTypedData},b={[s.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA]:{APPROVED:o.MetaMetricsEventName.SignatureApproved,REJECTED:o.MetaMetricsEventName.SignatureRejected,REQUESTED:o.MetaMetricsEventName.SignatureRequested},[s.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V3]:{APPROVED:o.MetaMetricsEventName.SignatureApproved,REJECTED:o.MetaMetricsEventName.SignatureRejected,REQUESTED:o.MetaMetricsEventName.SignatureRequested},[s.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V4]:{APPROVED:o.MetaMetricsEventName.SignatureApproved,REJECTED:o.MetaMetricsEventName.SignatureRejected,REQUESTED:o.MetaMetricsEventName.SignatureRequested},[s.MESSAGE_TYPE.PERSONAL_SIGN]:{APPROVED:o.MetaMetricsEventName.SignatureApproved,REJECTED:o.MetaMetricsEventName.SignatureRejected,REQUESTED:o.MetaMetricsEventName.SignatureRequested},[s.MESSAGE_TYPE.ETH_DECRYPT]:{APPROVED:o.MetaMetricsEventName.DecryptionApproved,REJECTED:o.MetaMetricsEventName.DecryptionRejected,REQUESTED:o.MetaMetricsEventName.DecryptionRequested},[s.MESSAGE_TYPE.ETH_GET_ENCRYPTION_PUBLIC_KEY]:{APPROVED:o.MetaMetricsEventName.EncryptionPublicKeyApproved,REJECTED:o.MetaMetricsEventName.EncryptionPublicKeyRejected,REQUESTED:o.MetaMetricsEventName.EncryptionPublicKeyRequested},[s.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS]:{APPROVED:o.MetaMetricsEventName.PermissionsApproved,REJECTED:o.MetaMetricsEventName.PermissionsRejected,REQUESTED:o.MetaMetricsEventName.PermissionsRequested},[s.MESSAGE_TYPE.WALLET_REQUEST_PERMISSIONS]:{APPROVED:o.MetaMetricsEventName.PermissionsApproved,REJECTED:o.MetaMetricsEventName.PermissionsRejected,REQUESTED:o.MetaMetricsEventName.PermissionsRequested}},_={[s.MESSAGE_TYPE.WATCH_ASSET]:({type:e})=>({type:e})},w={};let E=0}}},{package:"$root$",file:"app/scripts/lib/createRPCMethodTrackingMiddleware.js"}],[67,{"promise-to-callback":4525,"readable-stream":4794},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,t){return new s(e,t)};var r,i=e("readable-stream"),a=(r=e("promise-to-callback"))&&r.__esModule?r:{default:r};class s extends i.Writable{constructor(e,t){super({objectMode:!0,...t}),this._asyncWriteFn=e}_write(e,t,n){(0,a.default)(this._asyncWriteFn(e,t))(n)}}}}},{package:"$root$",file:"app/scripts/lib/createStreamSink.js"}],[68,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){return function(t,n,r){t.tabId=e.tabId,r()}}}}},{package:"$root$",file:"app/scripts/lib/createTabIdMiddleware.js"}],[69,{"@metamask/browser-passworder":1242},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.encryptorFactory=void 0;var r=e("@metamask/browser-passworder");const i=e=>async(t,n,i,a)=>(0,r.encrypt)(t,n,i,a,{algorithm:"PBKDF2",params:{iterations:e}}),a=e=>async(t,n,i)=>(0,r.encryptWithDetail)(t,n,i,{algorithm:"PBKDF2",params:{iterations:e}}),s=e=>async(t,n,i,a)=>(0,r.keyFromPassword)(t,n,i,a??{algorithm:"PBKDF2",params:{iterations:e}}),o=e=>t=>(0,r.isVaultUpdated)(t,{algorithm:"PBKDF2",params:{iterations:e}});n.encryptorFactory=e=>({encrypt:i(e),encryptWithKey:r.encryptWithKey,encryptWithDetail:a(e),decrypt:r.decrypt,decryptWithKey:r.decryptWithKey,decryptWithDetail:r.decryptWithDetail,keyFromPassword:s(e),isVaultUpdated:o(e),importKey:r.importKey,exportKey:r.exportKey,generateSalt:r.generateSalt})}}},{package:"$root$",file:"app/scripts/lib/encryptor-factory.ts"}],[70,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default=[{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"resolver",outputs:[{name:"",type:"address"}],payable:!1,type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"owner",outputs:[{name:"",type:"address"}],payable:!1,type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"label",type:"bytes32"},{name:"owner",type:"address"}],name:"setSubnodeOwner",outputs:[],payable:!1,type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"ttl",type:"uint64"}],name:"setTTL",outputs:[],payable:!1,type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"ttl",outputs:[{name:"",type:"uint64"}],payable:!1,type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"resolver",type:"address"}],name:"setResolver",outputs:[],payable:!1,type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"owner",type:"address"}],name:"setOwner",outputs:[],payable:!1,type:"function"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"owner",type:"address"}],name:"Transfer",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!0,name:"label",type:"bytes32"},{indexed:!1,name:"owner",type:"address"}],name:"NewOwner",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"resolver",type:"address"}],name:"NewResolver",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"ttl",type:"uint64"}],name:"NewTTL",type:"event"}]}}},{package:"$root$",file:"app/scripts/lib/ens-ipfs/contracts/registry.js"}],[71,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default=[{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"hash",type:"bytes32"}],name:"setContent",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"content",outputs:[{name:"",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"interfaceID",type:"bytes4"}],name:"supportsInterface",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"pure",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"key",type:"string"},{name:"value",type:"string"}],name:"setText",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"},{name:"contentTypes",type:"uint256"}],name:"ABI",outputs:[{name:"contentType",type:"uint256"},{name:"data",type:"bytes"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"x",type:"bytes32"},{name:"y",type:"bytes32"}],name:"setPubkey",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"hash",type:"bytes"}],name:"setContenthash",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"addr",outputs:[{name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"},{name:"key",type:"string"}],name:"text",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"contentType",type:"uint256"},{name:"data",type:"bytes"}],name:"setABI",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"name",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"name",type:"string"}],name:"setName",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"contenthash",outputs:[{name:"",type:"bytes"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"pubkey",outputs:[{name:"x",type:"bytes32"},{name:"y",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"addr",type:"address"}],name:"setAddr",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[{name:"ensAddr",type:"address"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"a",type:"address"}],name:"AddrChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"name",type:"string"}],name:"NameChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!0,name:"contentType",type:"uint256"}],name:"ABIChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"x",type:"bytes32"},{indexed:!1,name:"y",type:"bytes32"}],name:"PubkeyChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"indexedKey",type:"string"},{indexed:!1,name:"key",type:"string"}],name:"TextChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"hash",type:"bytes"}],name:"ContenthashChanged",type:"event"}]}}},{package:"$root$",file:"app/scripts/lib/ens-ipfs/contracts/resolver.js"}],[72,{"./contracts/registry":70,"./contracts/resolver":71,"@ensdomains/content-hash":385,"@metamask/ethjs-contract":1466,"@metamask/ethjs-query":1470,"eth-ens-namehash":3768},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=async function({provider:e,name:t}){const n=new i.default(e),u=r.default.hash(t),d=new a.default(n),f=Number.parseInt(await n.net_version(),10),p=function(e){switch(e){case 1:case 3:case 4:case 5:case 6:return"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e";default:return null}}(f);if(!p)throw new Error(`EnsIpfsResolver - no known ens-ipfs registry for chainId "${f}"`);const h=d(o.default).at(p),m=(await h.resolver(u))[0];if(l(m))throw new Error(`EnsIpfsResolver - no resolver found for name "${t}"`);const g=d(c.default).at(m),y=await g.supportsInterface("0xbc1c58d1"),b=await g.supportsInterface("0xd8389dc5");if(y[0]){const e=(await g.contenthash(u))[0];let t=s.default.decode(e);const n=s.default.getCodec(e);return"ipfs-ns"!==n&&"ipns-ns"!==n||(t=s.default.helpers.cidV0ToV1Base32(t)),{type:n,hash:t}}if(b[0]){const e=(await g.content(u))[0];if(l(e))throw new Error(`EnsIpfsResolver - no content ID found for name "${t}"`);return{type:"swarm-ns",hash:e.slice(2)}}throw new Error(`EnsIpfsResolver - the resolver for name "${t}" is not standard, it should either supports contenthash() or content()`)};var r=u(e("eth-ens-namehash")),i=u(e("@metamask/ethjs-query")),a=u(e("@metamask/ethjs-contract")),s=u(e("@ensdomains/content-hash")),o=u(e("./contracts/registry")),c=u(e("./contracts/resolver"));function u(e){return e&&e.__esModule?e:{default:e}}function l(e){return[undefined,null,"0x","0x0","0x0000000000000000000000000000000000000000000000000000000000000000"].includes(e)}}}},{package:"$root$",file:"app/scripts/lib/ens-ipfs/resolver.js"}],[73,{"../../../../shared/modules/fetch-with-timeout":5086,"./resolver":72,"base32-encode":3478,"base64-js":3479,"webextension-polyfill":5010},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function({provider:e,getCurrentChainId:t,getIpfsGateway:n,getUseAddressBarEnsResolution:r}){a.map((e=>`*://*.${e}/*`))};i(e("base32-encode")),i(e("base64-js")),i(e("webextension-polyfill"));var r=i(e("../../../../shared/modules/fetch-with-timeout"));i(e("./resolver"));function i(e){return e&&e.__esModule?e:{default:e}}(0,r.default)();const a=["eth"]}}},{package:"$root$",file:"app/scripts/lib/ens-ipfs/setup.js"}],[76,{lodash:4382},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){return i((0,r.cloneDeep)(e),(e=>null===e?"null":typeof e))};var r=e("lodash");function i(e={},t){return Object.entries(e).forEach((([n,r])=>{e[n]="object"==typeof r&&null!==r?i(r,t):t(r)})),e}}}},{package:"$root$",file:"app/scripts/lib/getObjStructure.js"}],[77,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.hardwareKeyringBuilderFactory=function(e,t){const n=()=>new e({bridge:new t});return n.type=e.type,n}}}},{package:"$root$",file:"app/scripts/lib/hardware-keyring-builder-factory.ts"}],[8,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.PHISHING_STREAM=n.PHISHING_SAFELIST=n.METAMASK_PROVIDER=n.METAMASK_INPAGE=n.METAMASK_COOKIE_HANDLER=n.LEGACY_PUBLIC_CONFIG=n.LEGACY_PROVIDER=n.LEGACY_INPAGE=n.LEGACY_CONTENT_SCRIPT=n.CONTENT_SCRIPT=void 0;n.CONTENT_SCRIPT="metamask-contentscript",n.METAMASK_INPAGE="metamask-inpage",n.METAMASK_PROVIDER="metamask-provider",n.METAMASK_COOKIE_HANDLER="metamask-cookie-handler",n.PHISHING_SAFELIST="metamask-phishing-safelist",n.PHISHING_STREAM="phishing",n.LEGACY_CONTENT_SCRIPT="contentscript",n.LEGACY_INPAGE="inpage",n.LEGACY_PROVIDER="provider",n.LEGACY_PUBLIC_CONFIG="publicConfig"}}},{package:"$root$",file:"app/scripts/constants/stream.ts"}],[80,{"../util":128,"json-rpc-engine":4226},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createPendingNonceMiddleware=function({getPendingNonce:e}){return(0,r.createAsyncMiddleware)((async(t,n,r)=>{const{method:i,params:a}=t;if("eth_getTransactionCount"!==i)return void r();const[s,o]=a;"pending"===o?n.result=await e(s,t.networkClientId):r()}))},n.createPendingTxMiddleware=function({getPendingTransactionByHash:e}){return(0,r.createAsyncMiddleware)((async(t,n,r)=>{const{method:a,params:s}=t;if("eth_getTransactionByHash"!==a)return void r();const[o]=s,c=e(o);c?n.result=(0,i.formatTxMetaForRpcResult)(c):r()}))};var r=e("json-rpc-engine"),i=e("../util")}}},{package:"$root$",file:"app/scripts/lib/middleware/pending.js"}],[81,{events:3874,loglevel:4388},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=a(e("events")),i=a(e("loglevel"));function a(e){return e&&e.__esModule?e:{default:e}}class s extends r.default{constructor(e={}){super();const t=e.migrations||[];this.migrations=t.sort(((e,t)=>e.version-t.version));const n=this.migrations.slice(-1)[0];this.defaultVersion=e.defaultVersion||n&&n.version||0}async migrateData(e=this.generateInitialState()){const t=this.migrations.filter((function(t){return t.version>e.meta.version}));for(const n of t)try{i.default.info(`Running migration ${n.version}...`);const t=await n.migrate(e);if(!t.data)throw new Error("Migrator - migration returned empty data");if(t.version!==undefined&&t.meta.version!==n.version)throw new Error("Migrator - Migration did not update version number correctly");e=t,i.default.info(`Migration ${n.version} complete`)}catch(t){const r=t.message;return t.message=`MetaMask Migration Error #${n.version}: ${r}`,this.emit("error",t),e}return e}generateInitialState(e){return{meta:{version:this.defaultVersion},data:e}}}n.default=s}}},{package:"$root$",file:"app/scripts/lib/migrator/index.js"}],[84,{"../../../shared/constants/notifications":5048,"../platforms/extension":272,"@metamask/safe-event-emitter":2028},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.NOTIFICATION_MANAGER_EVENTS=void 0;var r=s(e("@metamask/safe-event-emitter")),i=s(e("../platforms/extension")),a=e("../../../shared/constants/notifications");function s(e){return e&&e.__esModule?e:{default:e}}const o=n.NOTIFICATION_MANAGER_EVENTS={POPUP_CLOSED:"onPopupClosed"};class c extends r.default{constructor(){super(),this.platform=new i.default,this.platform.addOnRemovedListener(this._onWindowClosed.bind(this))}markAsAutomaticallyClosed(){this._popupAutomaticallyClosed=!0}async showPopup(e,t){this._popupId=t,this._setCurrentPopupId=e;const n=await this._getPopup(t);if(n)await this.platform.focusWindow(n.id);else{let e=0,t=0;try{const n=await this.platform.getLastFocusedWindow();t=n.top,e=Math.max(n.left+(n.width-a.NOTIFICATION_WIDTH),0)}catch(n){const{screenX:r,screenY:i,outerWidth:s}=window;t=Math.max(i,0),e=Math.max(r+(s-a.NOTIFICATION_WIDTH),0)}const n=await this.platform.openWindow({url:"notification.html",type:"popup",width:a.NOTIFICATION_WIDTH,height:a.NOTIFICATION_HEIGHT,left:e,top:t});n.left!==e&&"fullscreen"!==n.state&&await this.platform.updateWindowPosition(n.id,e,t),this._setCurrentPopupId(n.id),this._popupId=n.id}}_onWindowClosed(e){e===this._popupId&&(this._setCurrentPopupId(undefined),this._popupId=undefined,this.emit(o.POPUP_CLOSED,{automaticallyClosed:this._popupAutomaticallyClosed}),this._popupAutomaticallyClosed=undefined)}async _getPopup(){const e=await this.platform.getAllWindows();return this._getPopupIn(e)}_getPopupIn(e){return e?e.find((e=>e&&"popup"===e.type&&e.id===this._popupId)):null}}n.default=c}}},{package:"$root$",file:"app/scripts/lib/notification-manager.js"}],[85,{"../../../../shared/constants/offscreen-communication":5049,"eth-lattice-keyring":3769},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.LatticeKeyringOffscreen=void 0;var r,i=(r=e("eth-lattice-keyring"))&&r.__esModule?r:{default:r},a=e("../../../../shared/constants/offscreen-communication");class s extends i.default{constructor(e={}){super(e)}async _getCreds(){try{const e=this.appName?this.appName:"Unknown",t=`${a.KnownOrigins.lattice}?keyring=${e}&forceLogin=true`;return await new Promise(((e,n)=>{chrome.runtime.sendMessage({target:a.OffscreenCommunicationTarget.latticeOffscreen,params:{url:t}},(t=>{t.error&&n(t.error),e(t.result)}))}))}catch(e){throw new Error(e)}}}n.LatticeKeyringOffscreen=s,function(e,t,n){(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(n!==undefined){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(s,"type",void 0),s.type=i.default.type}}},{package:"$root$",file:"app/scripts/lib/offscreen-bridge/lattice-offscreen-keyring.ts"}],[86,{"../../../../shared/constants/offscreen-communication":5049},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.LedgerOffscreenBridge=void 0;var r=e("../../../../shared/constants/offscreen-communication");function i(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(n!==undefined){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.LedgerOffscreenBridge=class{constructor(){i(this,"isDeviceConnected",!1)}init(){return chrome.runtime.onMessage.addListener((e=>{e.target===r.OffscreenCommunicationTarget.extension&&e.event===r.OffscreenCommunicationEvents.ledgerDeviceConnect&&(this.isDeviceConnected=!0)})),Promise.resolve()}destroy(){return Promise.resolve()}attemptMakeApp(){return new Promise(((e,t)=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.ledgerOffscreen,action:r.LedgerAction.makeApp},(n=>{n.success?e(!0):n.error?t(n.error):t(new Error("Unknown error occurred"))}))}))}updateTransportMethod(e){return new Promise(((t,n)=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.ledgerOffscreen,action:r.LedgerAction.updateTransport,params:{transportType:e}},(e=>{e.success?t(!0):n(new Error("Ledger transport could not be updated"))}))}))}getPublicKey(e){return new Promise(((t,n)=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.ledgerOffscreen,action:r.LedgerAction.getPublicKey,params:e},(e=>{e.success?t(e.payload):n(e.payload.error)}))}))}deviceSignTransaction(e){return new Promise(((t,n)=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.ledgerOffscreen,action:r.LedgerAction.signTransaction,params:e},(e=>{e.success?t(e.payload):n(e.payload.error)}))}))}deviceSignMessage(e){return new Promise(((t,n)=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.ledgerOffscreen,action:r.LedgerAction.signPersonalMessage,params:e},(e=>{e.success?t(e.payload):n(e.payload.error)}))}))}deviceSignTypedData(e){return new Promise(((t,n)=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.ledgerOffscreen,action:r.LedgerAction.signTypedData,params:e},(e=>{e.success?t(e.payload):n(e.payload.error)}))}))}}}}},{package:"$root$",file:"app/scripts/lib/offscreen-bridge/ledger-offscreen-bridge.ts"}],[87,{"../../../../shared/constants/offscreen-communication":5049},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.TrezorOffscreenBridge=void 0;var r=e("../../../../shared/constants/offscreen-communication");function i(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(n!==undefined){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.TrezorOffscreenBridge=class{constructor(){i(this,"model",void 0)}init(e){return chrome.runtime.onMessage.addListener((e=>{e.target===r.OffscreenCommunicationTarget.extension&&e.event===r.OffscreenCommunicationEvents.trezorDeviceConnect&&(this.model=e.payload)})),new Promise((t=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.trezorOffscreen,action:r.TrezorAction.init,params:e},(()=>{t()}))}))}dispose(){return new Promise((e=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.trezorOffscreen,action:r.TrezorAction.dispose},(()=>{e()}))}))}getPublicKey(e){return new Promise((t=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.trezorOffscreen,action:r.TrezorAction.getPublicKey,params:e},(e=>{t(e)}))}))}ethereumSignTransaction(e){return new Promise((t=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.trezorOffscreen,action:r.TrezorAction.signTransaction,params:e},(e=>{t(e)}))}))}ethereumSignMessage(e){return new Promise((t=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.trezorOffscreen,action:r.TrezorAction.signMessage,params:e},(e=>{t(e)}))}))}ethereumSignTypedData(e){return new Promise((t=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.trezorOffscreen,action:r.TrezorAction.signTypedData,params:e},(e=>{t(e)}))}))}}}}},{package:"$root$",file:"app/scripts/lib/offscreen-bridge/trezor-offscreen-bridge.ts"}],[88,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function r(e,t){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.add(e)}function i(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(n!==undefined){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(n,"__esModule",{value:!0}),n.IndexedDBPPOMStorage=void 0;const a=async(e,t,n)=>{const r=await crypto.subtle.digest("SHA-256",t);if(Array.from(new Uint8Array(r)).map((e=>e.toString(16).padStart(2,"0"))).join("")!==n)throw new Error(`Checksum mismatch for key ${e}`)};var s=new WeakSet;function o(e){return new Promise(((t,n)=>{const r=indexedDB.open(this.storeName,this.dbVersion);r.onerror=e=>{var t;n(new Error(`Failed to open database ${this.storeName}: ${null===(t=e.target)||void 0===t?void 0:t.error}`))},r.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(this.storeName)||t.createObjectStore(this.storeName,{keyPath:["name","chainId"]})},r.onsuccess=n=>{const r=n.target.result.transaction([this.storeName],e).objectStore(this.storeName);t(r)}}))}n.IndexedDBPPOMStorage=class{constructor(e,t){r(this,s),i(this,"storeName",void 0),i(this,"dbVersion",void 0),this.storeName=e,this.dbVersion=t}async objectStoreAction(e,t,n="readonly"){return new Promise(((r,i)=>{(function(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n})(this,s,o).call(this,n).then((n=>{const a=n[e](t);a.onsuccess=async e=>{r(e)},a.onerror=t=>{var n;i(new Error(`Error in indexDB operation ${e}: ${null===(n=t.target)||void 0===n?void 0:n.error}`))}})).catch((e=>{i(e)}))}))}async read(e,t){var n;const r=null===(n=(await this.objectStoreAction("get",[e.name,e.chainId])).target)||void 0===n||null===(n=n.result)||void 0===n?void 0:n.data;return await a(e,r,t),r}async write(e,t,n){await a(e,t,n),await this.objectStoreAction("put",{...e,data:t},"readwrite")}async delete(e){await this.objectStoreAction("delete",[e.name,e.chainId],"readwrite")}async dir(){var e;return null===(e=(await this.objectStoreAction("getAllKeys")).target)||void 0===e?void 0:e.result.map((([e,t])=>({name:e,chainId:t})))}}}}},{package:"$root$",file:"app/scripts/lib/ppom/indexed-db-backend.ts"}],[89,{"../../../../shared/constants/app":5031,"../../../../shared/constants/security-provider":5053,"../../../../shared/constants/transaction":5061,"./ppom-util":90,"@metamask/controller-utils":1250},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createPPOMMiddleware=function(e,t,n,u,l,d){return async(f,p,h)=>{try{var m,g;const p=null===(m=t.store.getState())||void 0===m?void 0:m.securityAlertsEnabled,{chainId:h}=n.state.providerConfig,b=await(0,o.isChainSupported)(h);if(!p||!c.includes(f.method)||!b)return;const{isSIWEMessage:_}=(0,r.detectSIWE)({data:null==f||null===(g=f.params)||void 0===g?void 0:g[0]});if(_)return;if(f.method===i.MESSAGE_TYPE.ETH_SEND_TRANSACTION){var y;const{to:e}=(null==f||null===(y=f.params)||void 0===y?void 0:y[0])??{},t=l.listAccounts();if(t.some((({address:t})=>(null==t?void 0:t.toLowerCase())===(null==e?void 0:e.toLowerCase()))))return}const w=(0,o.generateSecurityAlertId)();(0,o.validateRequestWithPPOM)({ppomController:e,request:f,securityAlertId:w,chainId:h}).then((e=>{d(f.method,w,e)}));const E={...s.LOADING_SECURITY_ALERT_RESPONSE,securityAlertId:w};a.SIGNING_METHODS.includes(f.method)&&u.addSignatureSecurityAlertResponse(E),f.securityAlertResponse=E}catch(e){f.securityAlertResponse=(0,o.handlePPOMError)(e,"Error createPPOMMiddleware: ")}finally{h()}}};var r=e("@metamask/controller-utils"),i=e("../../../../shared/constants/app"),a=e("../../../../shared/constants/transaction"),s=e("../../../../shared/constants/security-provider"),o=e("./ppom-util");const c=Object.freeze(["eth_sendRawTransaction","eth_sendTransaction",...a.SIGNING_METHODS])}}},{package:"$root$",file:"app/scripts/lib/ppom/ppom-middleware.ts"}],[9,{"@metamask/base-controller":1241},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.AccountOrderController=void 0;var r=e("@metamask/base-controller");const i={pinnedAccountList:[],hiddenAccountList:[]},a={pinnedAccountList:{persist:!0,anonymous:!0},hiddenAccountList:{persist:!0,anonymous:!0}};class s extends r.BaseController{constructor({messenger:e,state:t}){super({messenger:e,metadata:a,name:"AccountOrderController",state:{...i,...t}})}updateAccountsList(e){this.update((t=>(t.pinnedAccountList=e,t)))}updateHiddenAccountsList(e){this.update((t=>(t.hiddenAccountList=e,t)))}}n.AccountOrderController=s}}},{package:"$root$",file:"app/scripts/controllers/account-order.ts"}],[90,{"../../../../shared/constants/security-provider":5053,"../../../../shared/constants/transaction":5061,"./security-alerts-api":92,"@metamask/transaction-controller":2685,uuid:4961},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.generateSecurityAlertId=function(){return(0,i.v4)()},n.handlePPOMError=d,n.isChainSupported=async function(e){let t=a.SECURITY_PROVIDER_SUPPORTED_CHAIN_IDS;try{(0,o.isSecurityAlertsAPIEnabled)()&&(t=await(0,o.getSecurityAlertsAPISupportedChainIds)())}catch(e){d(e,"Error fetching supported chains from security alerts API")}return t.includes(e)},n.updateSecurityAlertResponse=async function({appStateController:e,method:t,securityAlertId:n,securityAlertResponse:r,signatureController:i,transactionController:a}){const o=s.SIGNING_METHODS.includes(t),c=await async function(e,t,n,r){const i=s.SIGNING_METHODS.includes(t);for(;;){let t;if(t=i?Object.values(n.messages).find((t=>{var n;return(null===(n=t.securityAlertResponse)||void 0===n?void 0:n.securityAlertId)===e})):r.state.transactions.find((t=>{var n;return(null===(n=t.securityAlertResponse)||void 0===n?void 0:n.securityAlertId)===e})),t)return t;await new Promise((e=>setTimeout(e,100)))}}(n,t,i,a);o?e.addSignatureSecurityAlertResponse(r):a.updateSecurityAlertResponse(c.id,r)},n.validateRequestWithPPOM=async function({ppomController:e,request:t,securityAlertId:n,chainId:i}){try{const s=function(e){if(t=e,t.method!==u)return e;var t;const n=e.params[0],i=(0,r.normalizeTransactionParams)(n);return{...e,params:[i]}}(t),c=(0,o.isSecurityAlertsAPIEnabled)()?await async function(e,t,n){try{return{...await(0,o.validateWithSecurityAlertsAPI)(t,n),source:a.SecurityAlertSource.API}}catch(t){return d(t,"Error validating request with security alerts API"),await f(e,n)}}(e,i,s):await f(e,s);return{...c,securityAlertId:n}}catch(e){return d(e,"Error validating JSON RPC using PPOM: ")}};var r=e("@metamask/transaction-controller"),i=e("uuid"),a=e("../../../../shared/constants/security-provider"),s=e("../../../../shared/constants/transaction"),o=e("./security-alerts-api");const{sentry:c}=global,u="eth_sendTransaction",l={result_type:a.BlockaidResultType.Errored,reason:a.BlockaidReason.errored};function d(e,t){const n=function(e){if("object"==typeof e||"string"==typeof e)return e;return JSON.stringify(e)}(e),r=function(e){if(e instanceof Error)return`${e.name}: ${e.message}`;return JSON.stringify(e)}(e);return null==c||c.captureException(e),console.error(t,n),{...l,description:r}}async function f(e,t){return{...await e.usePPOM((e=>e.validateJsonRpc(t))),source:a.SecurityAlertSource.Local}}}}},{package:"$root$",file:"app/scripts/lib/ppom/ppom-util.ts"}],[91,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){let r;Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.PPOM=void 0,n.initSync=function(e){if(r!==undefined)return r;const t=k();e instanceof WebAssembly.Module||(e=new WebAssembly.Module(e));const n=new WebAssembly.Instance(e,t);return A(n,e)},n.main=function(){r.main()};const i="undefined"!=typeof TextDecoder?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};"undefined"!=typeof TextDecoder&&i.decode();let a=null;function s(){return null!==a&&0!==a.byteLength||(a=new Uint8Array(r.memory.buffer)),a}function o(e,t){return e>>>=0,i.decode(s().subarray(e,e+t))}const c=new Array(128).fill(undefined);c.push(undefined,null,!0,!1);let u=c.length;function l(e){u===c.length&&c.push(c.length+1);const t=u;return u=c[t],c[t]=e,t}function d(e){return c[e]}function f(e){const t=d(e);return function(e){e<132||(c[e]=u,u=e)}(e),t}let p=0;const h="undefined"!=typeof TextEncoder?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},m="function"==typeof h.encodeInto?function(e,t){return h.encodeInto(e,t)}:function(e,t){const n=h.encode(e);return t.set(n),{read:e.length,written:n.length}};function g(e,t,n){if(n===undefined){const n=h.encode(e),r=t(n.length,1)>>>0;return s().subarray(r,r+n.length).set(n),p=n.length,r}let r=e.length,i=t(r,1)>>>0;const a=s();let o=0;for(;o<r;o++){const t=e.charCodeAt(o);if(t>127)break;a[i+o]=t}if(o!==r){0!==o&&(e=e.slice(o)),i=n(i,r,r=o+3*e.length,1)>>>0;const t=s().subarray(i+o,i+r);o+=m(e,t).written}return p=o,i}let y=null;function b(){return null!==y&&0!==y.byteLength||(y=new Int32Array(r.memory.buffer)),y}function _(e){const t=typeof e;if("number"==t||"boolean"==t||null==e)return`${e}`;if("string"==t)return`"${e}"`;if("symbol"==t){const t=e.description;return null==t?"Symbol":`Symbol(${t})`}if("function"==t){const t=e.name;return"string"==typeof t&&t.length>0?`Function(${t})`:"Function"}if(Array.isArray(e)){const t=e.length;let n="[";t>0&&(n+=_(e[0]));for(let r=1;r<t;r++)n+=", "+_(e[r]);return n+="]",n}const n=/\[object ([^\]]+)\]/.exec(toString.call(e));let r;if(!(n.length>1))return toString.call(e);if(r=n[1],"Object"==r)try{return"Object("+JSON.stringify(e)+")"}catch(e){return"Object"}return e instanceof Error?`${e.name}: ${e.message}\n${e.stack}`:r}function w(e,t,n){r.wasm_bindgen__convert__closures__invoke1_mut(e,t,l(n))}function E(e,t){r._dyn_core__ops__function__FnMut__A____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__destroy(e,t)}let v=null;function T(e,t){const n=t(4*e.length,4)>>>0,i=(null!==v&&0!==v.byteLength||(v=new Uint32Array(r.memory.buffer)),v);for(let t=0;t<e.length;t++)i[n/4+t]=l(e[t]);return p=e.length,n}function S(e,t){try{return e.apply(this,t)}catch(e){r.__wbindgen_exn_store(l(e))}}class M{static __wrap(e){e>>>=0;const t=Object.create(M.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();r.__wbg_ppom_free(e)}static new(e,t){const n=T(t,r.__wbindgen_malloc),i=p;return f(r.ppom_new(l(e),n,i))}validateJsonRpc(e){return f(r.ppom_validateJsonRpc(this.__wbg_ptr,l(e)))}static version(){return f(r.ppom_version())}}function k(){const e={wbg:{}};return e.wbg.__wbg_buffer_085ec1f694018c4f=function(e){return l(d(e).buffer)},e.wbg.__wbg_call_01734de55d61e11d=function(){return S((function(e,t,n){return l(d(e).call(d(t),d(n)))}),arguments)},e.wbg.__wbg_call_4c92f6aec1e1d6e6=function(){return S((function(e,t,n,r){return l(d(e).call(d(t),d(n),d(r)))}),arguments)},e.wbg.__wbg_from_d7c216d4616bb368=function(e){return l(Array.from(d(e)))},e.wbg.__wbg_get_44be0491f933a435=function(e,t){return l(d(e)[t>>>0])},e.wbg.__wbg_length_72e2208bbc0efc61=function(e){return d(e).length},e.wbg.__wbg_length_d813e535247d427e=function(e){return d(e).length},e.wbg.__wbg_length_fff51ee6522a1a18=function(e){return d(e).length},e.wbg.__wbg_new_43f1b47c28813cbd=function(e,t){try{var n={a:e,b:t};const i=new Promise(((e,t)=>{const i=n.a;n.a=0;try{return function(e,t,n,i){r.wasm_bindgen__convert__closures__invoke2_mut(e,t,l(n),l(i))}(i,n.b,e,t)}finally{n.a=i}}));return l(i)}finally{n.a=n.b=0}},e.wbg.__wbg_new_8125e318e6245eed=function(e){return l(new Uint8Array(d(e)))},e.wbg.__wbg_parse_670c19d4e984792e=function(){return S((function(e,t){return l(JSON.parse(o(e,t)))}),arguments)},e.wbg.__wbg_ppom_new=function(e){return l(M.__wrap(e))},e.wbg.__wbg_resolve_53698b95aaf7fcf8=function(e){return l(Promise.resolve(d(e)))},e.wbg.__wbg_set_5cf90238115182c3=function(e,t,n){d(e).set(d(t),n>>>0)},e.wbg.__wbg_stringify_e25465938f3f611f=function(){return S((function(e){return l(JSON.stringify(d(e)))}),arguments)},e.wbg.__wbg_then_b2267541e2a73865=function(e,t,n){return l(d(e).then(d(t),d(n)))},e.wbg.__wbg_then_f7e06ee3c11698eb=function(e,t){return l(d(e).then(d(t)))},e.wbg.__wbindgen_cb_drop=function(e){const t=f(e).original;if(1==t.cnt--)return t.a=0,!0;return!1},e.wbg.__wbindgen_closure_wrapper_wasm_bindgen__closure__Closure_T___wrap__breaks_if_inlined=function(e,t,n){const r=function(e,t,n,r){const i={a:e,b:t,cnt:1},a=(...e)=>{i.cnt++;const t=i.a;i.a=0;try{return r(t,i.b,...e)}finally{0==--i.cnt?n(t,i.b):i.a=t}};return a.original=i,a}(e,t,E,w);return l(r)},e.wbg.__wbindgen_debug_string=function(e,t){const n=g(_(d(t)),r.__wbindgen_malloc,r.__wbindgen_realloc),i=p;b()[e/4+1]=i,b()[e/4+0]=n},e.wbg.__wbindgen_error_new=function(e,t){return l(new Error(o(e,t)))},e.wbg.__wbindgen_is_undefined=function(e){return d(e)===undefined},e.wbg.__wbindgen_memory=function(){return l(r.memory)},e.wbg.__wbindgen_object_drop_ref=function(e){f(e)},e.wbg.__wbindgen_string_get=function(e,t){const n=d(t),i="string"==typeof n?n:undefined;var a,s=(a=i)===undefined||null===a?0:g(i,r.__wbindgen_malloc,r.__wbindgen_realloc),o=p;b()[e/4+1]=o,b()[e/4+0]=s},e.wbg.__wbindgen_string_new=function(e,t){return l(o(e,t))},e.wbg.__wbindgen_throw=function(e,t){throw new Error(o(e,t))},e}function A(e,t){return r=e.exports,P.__wbindgen_wasm_module=t,y=null,v=null,a=null,r.__wbindgen_start(),r}async function P(e){if(r!==undefined)return r;const t=k();("string"==typeof e||"function"==typeof Request&&e instanceof Request||"function"==typeof URL&&e instanceof URL)&&(e=fetch(e));const{instance:n,module:i}=await async function(e,t){if("function"==typeof Response&&e instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(e,t)}catch(t){if("application/wasm"==e.headers.get("Content-Type"))throw t;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t)}const n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}{const n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}}(await e,t);return A(n,i)}n.PPOM=M;n.default=P}}},{package:"$root$",file:"app/scripts/lib/ppom/ppom.js"}],[92,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getSecurityAlertsAPISupportedChainIds=async function(){return a(i)},n.isSecurityAlertsAPIEnabled=function(){return"true"==="".toString()},n.validateWithSecurityAlertsAPI=async function(e,t){return a(`${r}/${e}`,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}})};const r="validate",i="supportedChains";async function a(e,t){const n=function(e){const t="http://localhost:3000";if(!t)throw new Error("Security alerts API URL is not set");return`${t}/${e}`}(e),r=await fetch(n,t);if(!r.ok)throw new Error(`Security alerts API request failed with status: ${r.status}`);return r.json()}}}},{package:"$root$",file:"app/scripts/lib/ppom/security-alerts-api.ts"}],[93,{"./handlers":99,"@metamask/permission-controller":1885,"@metamask/snaps-rpc-methods":2479,"@metamask/utils":2787,"eth-rpc-errors":3801},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createMethodMiddleware=n.createLegacyMethodMiddleware=void 0;var r=e("@metamask/permission-controller"),i=e("@metamask/snaps-rpc-methods"),a=e("@metamask/utils"),s=e("eth-rpc-errors"),o=e("./handlers");const c=[...o.handlers,...r.permissionRpcMethods.handlers];n.createMethodMiddleware=u(c),n.createLegacyMethodMiddleware=u(o.legacyHandlers);function u(e){const t=e.reduce(((e,t)=>{for(const n of t.methodNames)e[n]=t;return e}),{}),n=new Set(e.flatMap((({hookNames:e})=>Object.getOwnPropertyNames(e))));return e=>{!function(e,t){const n=[];if(t.forEach((t=>{(0,a.hasProperty)(e,t)||n.push(t)})),n.length>0)throw new Error(`Missing expected hooks:\n\n${n.join("\n")}\n`);const r=Object.getOwnPropertyNames(e).filter((e=>!t.has(e)));if(r.length>0)throw new Error(`Received unexpected hooks:\n\n${r.join("\n")}\n`)}(e,n);return async(n,r,a,o)=>{const c=t[n.method];if(c){const{implementation:t,hookNames:u}=c;try{return await t(n,r,a,o,(0,i.selectHooks)(e,u))}catch(e){return o(e instanceof Error?e:s.ethErrors.rpc.internal({data:e}))}}return a()}}}}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/createMethodMiddleware.js"}],[94,{"../../../../shared/constants/network":5047,"eth-rpc-errors":3801},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createUnsupportedMethodMiddleware=function(){return async function(e,t,n,a){return i.UNSUPPORTED_RPC_METHODS.has(e.method)?a(r.ethErrors.rpc.methodNotSupported()):n()}};var r=e("eth-rpc-errors"),i=e("../../../../shared/constants/network")}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/createUnsupportedMethodMiddleware.ts"}],[95,{"../../../../../shared/constants/app":5031,"./ethereum-chain-utils":97,"@metamask/controller-utils":1250,"eth-rpc-errors":3801},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=e("eth-rpc-errors"),i=e("@metamask/controller-utils"),a=e("../../../../../shared/constants/app"),s=e("./ethereum-chain-utils");const o={methodNames:[a.MESSAGE_TYPE.ADD_ETHEREUM_CHAIN],implementation:async function(e,t,n,a,{upsertNetworkConfiguration:o,getCurrentRpcUrl:c,findNetworkConfigurationBy:u,setActiveNetwork:l,requestUserApproval:d,startApprovalFlow:f,endApprovalFlow:p,getCurrentChainIdForDomain:h,getCaveat:m,requestPermittedChainsPermission:g,getChainPermissionsFeatureFlag:y}){let b;try{b=(0,s.validateAddEthereumChainParams)(e.params[0],a)}catch(e){return a(e)}const{chainId:_,chainName:w,firstValidBlockExplorerUrl:E,firstValidRPCUrl:v,ticker:T}=b,{origin:S}=e,M=h(S),k=(0,s.findExistingNetwork)(M,u),A=(0,s.findExistingNetwork)(_,u);if(A&&A.chainId===_&&A.ticker!==T)return a(r.ethErrors.rpc.invalidParams({message:`nativeCurrency.symbol does not match currency symbol for a network the user already has added with the same chainId. Received:\n${T}`}));let P,C,O;if(A&&A.rpcUrl===v){P=A.id??A.type;const e=c();if(M===_&&e===v)return t.result=null,a();C={toNetworkConfiguration:A,fromNetworkConfiguration:k}}else{({id:O}=await f());try{await d({origin:S,type:i.ApprovalType.AddEthereumChain,requestData:{chainId:_,rpcPrefs:{blockExplorerUrl:E},chainName:w,rpcUrl:v,ticker:T}}),P=await o({chainId:_,rpcPrefs:{blockExplorerUrl:E},nickname:w,rpcUrl:v,ticker:T},{source:"dapp",referrer:S})}catch(e){return p({id:O}),a(e)}C={toNetworkConfiguration:{rpcUrl:v,chainId:_,nickname:w,ticker:T,networkClientId:P},fromNetworkConfiguration:k}}return(0,s.switchChain)(t,a,S,_,C,P,O,{getChainPermissionsFeatureFlag:y,setActiveNetwork:l,requestUserApproval:d,getCaveat:m,requestPermittedChainsPermission:g,endApprovalFlow:p})},hookNames:{upsertNetworkConfiguration:!0,getCurrentRpcUrl:!0,findNetworkConfigurationBy:!0,setActiveNetwork:!0,requestUserApproval:!0,startApprovalFlow:!0,endApprovalFlow:!0,getCurrentChainIdForDomain:!0,getCaveat:!0,requestPermittedChainsPermission:!0,getChainPermissionsFeatureFlag:!0}};n.default=o}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/add-ethereum-chain.js"}],[96,{"../../../../../shared/constants/app":5031},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;const r={methodNames:[e("../../../../../shared/constants/app").MESSAGE_TYPE.ETH_ACCOUNTS],implementation:async function(e,t,n,r,{getAccounts:i}){return t.result=await i(),r()},hookNames:{getAccounts:!0}};n.default=r}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/eth-accounts.js"}],[97,{"../../../../../shared/constants/app":5031,"../../../../../shared/constants/network":5047,"../../../../../shared/constants/permissions":5051,"../../../../../shared/modules/network.utils":5093,"../../../controllers/permissions":33,"../../util":128,"@metamask/controller-utils":1250,"eth-rpc-errors":3801},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.findExistingNetwork=function(e,t){if(Object.values(a.BUILT_IN_INFURA_NETWORKS).map((({chainId:e})=>e)).includes(e))return{chainId:e,ticker:a.CURRENCY_SYMBOLS.ETH,nickname:a.NETWORK_TO_NAME_MAP[e],rpcUrl:a.CHAIN_ID_TO_RPC_URL_MAP[e],type:a.CHAIN_ID_TO_TYPE_MAP[e]};return t({chainId:e})},n.switchChain=async function(e,t,n,a,s,c,l,{getChainPermissionsFeatureFlag:d,setActiveNetwork:f,endApprovalFlow:p,requestUserApproval:h,getCaveat:m,requestPermittedChainsPermission:g}){try{if(d()){const{value:e}=m({target:u.PermissionNames.permittedChains,caveatType:o.CaveatTypes.restrictNetworkSwitching})??{};e!==undefined&&e.includes(a)||await g([a])}else await h({origin:n,type:i.ApprovalType.SwitchEthereumChain,requestData:s});await f(c),e.result=null}catch(n){return n.code===r.errorCodes.provider.userRejectedRequest&&l?(e.result=null,t()):t(n)}finally{l&&p({id:l})}return t()},n.validateAddEthereumChainParams=function(e,t){if(!e||"object"!=typeof e)throw r.ethErrors.rpc.invalidParams({message:`Expected single, object parameter. Received:\n${JSON.stringify(e)}`});const{chainId:n,chainName:i,blockExplorerUrls:a,nativeCurrency:s,rpcUrls:o,...u}=e,f=Object.keys(u).filter((e=>!["iconUrls"].includes(e)));if(f.length>0)throw r.ethErrors.rpc.invalidParams({message:`Received unexpected keys on object parameter. Unsupported keys:\n${f}`});const p=d(n);if(!o||!Array.isArray(o)||0===o.length)throw r.ethErrors.rpc.invalidParams({message:`Expected an array with at least one valid string HTTPS url 'rpcUrls', Received:\n${o}`});const h=e=>{const t=(0,l.getValidUrl)(e);return null!==t&&("localhost"===t.hostname||"127.0.0.1"===t.hostname||"https:"===t.protocol)},m=o.find((e=>h(e))),g=Array.isArray(a)?a.find((e=>h(e))):null;if(!m)throw r.ethErrors.rpc.invalidParams({message:`Expected an array with at least one valid string HTTPS url 'rpcUrls', Received:\n${o}`});if("string"!=typeof i||!i)throw r.ethErrors.rpc.invalidParams({message:`Expected non-empty string 'chainName'. Received:\n${i}`});const y=i.length>100?i.substring(0,100):i;if(null!==s){if("object"!=typeof s||Array.isArray(s))throw r.ethErrors.rpc.invalidParams({message:`Expected null or object 'nativeCurrency'. Received:\n${s}`});if(18!==s.decimals)throw r.ethErrors.rpc.invalidParams({message:`Expected the number 18 for 'nativeCurrency.decimals' when 'nativeCurrency' is provided. Received: ${s.decimals}`});if(!s.symbol||"string"!=typeof s.symbol)throw r.ethErrors.rpc.invalidParams({message:`Expected a string 'nativeCurrency.symbol'. Received: ${s.symbol}`})}const b=(null==s?void 0:s.symbol)||c.UNKNOWN_TICKER_SYMBOL;if(b!==c.UNKNOWN_TICKER_SYMBOL&&("string"!=typeof b||b.length<1||b.length>6))throw r.ethErrors.rpc.invalidParams({message:`Expected 1-6 character string 'nativeCurrency.symbol'. Received:\n${b}`});return{chainId:p,chainName:y,firstValidBlockExplorerUrl:g,firstValidRPCUrl:m,ticker:b}},n.validateChainId=d,n.validateSwitchEthereumChainParams=function(e,t){var n;if(null===(n=e.params)||void 0===n||!n[0]||"object"!=typeof e.params[0])throw r.ethErrors.rpc.invalidParams({message:`Expected single, object parameter. Received:\n${JSON.stringify(e.params)}`});const{chainId:i,...a}=e.params[0];if(Object.keys(a).length>0)throw r.ethErrors.rpc.invalidParams({message:`Received unexpected keys on object parameter. Unsupported keys:\n${Object.keys(a)}`});return d(i)};var r=e("eth-rpc-errors"),i=e("@metamask/controller-utils"),a=e("../../../../../shared/constants/network"),s=e("../../../../../shared/modules/network.utils"),o=e("../../../../../shared/constants/permissions"),c=e("../../../../../shared/constants/app"),u=e("../../../controllers/permissions"),l=e("../../util");function d(e){const t="string"==typeof e&&e.toLowerCase();if(!(0,s.isPrefixedFormattedHexString)(t))throw r.ethErrors.rpc.invalidParams({message:`Expected 0x-prefixed, unpadded, non-zero hexadecimal string 'chainId'. Received:\n${e}`});if(!(0,s.isSafeChainId)(parseInt(t,16)))throw r.ethErrors.rpc.invalidParams({message:`Invalid chain ID "${t}": numerical value greater than max safe value. Received:\n${e}`});return t}}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/ethereum-chain-utils.js"}],[98,{"../../../../../shared/constants/app":5031},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;const r={methodNames:[e("../../../../../shared/constants/app").MESSAGE_TYPE.GET_PROVIDER_STATE],implementation:async function(e,t,n,r,{getProviderState:i}){return t.result={...await i(e.origin)},r()},hookNames:{getProviderState:!0}};n.default=r}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/get-provider-state.js"}],[99,{"./add-ethereum-chain":95,"./eth-accounts":96,"./get-provider-state":98,"./log-web3-shim-usage":100,"./request-accounts":101,"./send-metadata":102,"./switch-ethereum-chain":103,"./watch-asset":104},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.legacyHandlers=n.handlers=void 0;var r=d(e("./add-ethereum-chain")),i=d(e("./eth-accounts")),a=d(e("./get-provider-state")),s=d(e("./log-web3-shim-usage")),o=d(e("./request-accounts")),c=d(e("./send-metadata")),u=d(e("./switch-ethereum-chain")),l=d(e("./watch-asset"));function d(e){return e&&e.__esModule?e:{default:e}}n.handlers=[r.default,a.default,s.default,o.default,c.default,u.default,l.default],n.legacyHandlers=[i.default]}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/index.ts"}],[4,{"../../shared/constants/app":5031,"../../shared/constants/metametrics":5043,"../../shared/constants/offscreen-communication":5049,"../../shared/modules/browser-runtime.utils":5077,"../../shared/modules/mv3.utils":5092,"../../shared/modules/object.utils":5094,"../../test/e2e/background-socket/socket-background-to-mocha":5109,"../../test/e2e/default-fixture":5110,"../../test/stub/keyring-bridge":5111,"./constants/marketing-site-whitelist":6,"./constants/sentry-state":7,"./controllers/metamask-notifications/constants/notification-schema":19,"./first-time-state":47,"./lib/createStreamSink":67,"./lib/ens-ipfs/setup":73,"./lib/get-first-preferred-lang-code":75,"./lib/getObjStructure":76,"./lib/local-store":78,"./lib/migrator":81,"./lib/network-store":83,"./lib/notification-manager":84,"./lib/setup-initial-state-hooks":109,"./lib/util":128,"./metamask-controller":129,"./migrations":270,"./offscreen":271,"./platforms/extension":272,"./skip-onboarding":273,"@metamask/controller-utils":1250,"@metamask/obs-store":1871,"@metamask/snaps-rpc-methods":2479,"@metamask/utils":2787,"debounce-stream":3718,"eth-rpc-errors":3801,events:3874,"extension-port-stream":3877,loglevel:4388,"readable-stream":4794,"webextension-polyfill":5010},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.loadStateFromPersistence=_e,n.setupController=ve,n.statePersistenceEvents=void 0,e("./lib/setup-initial-state-hooks");var r=$(e("events")),i=e("readable-stream"),a=$(e("debounce-stream")),s=$(e("loglevel")),o=$(e("webextension-polyfill")),c=e("@metamask/obs-store"),u=e("@metamask/utils"),l=e("@metamask/controller-utils"),d=$(e("extension-port-stream")),f=e("eth-rpc-errors"),p=e("@metamask/snaps-rpc-methods"),h=e("../../shared/constants/app"),m=e("../../shared/constants/metametrics"),g=e("../../shared/modules/browser-runtime.utils"),y=e("../../shared/modules/mv3.utils"),b=e("../../shared/modules/object.utils"),_=(e("../../test/e2e/default-fixture"),e("../../test/e2e/background-socket/socket-background-to-mocha"),e("../../shared/constants/offscreen-communication"),e("../../test/stub/keyring-bridge")),w=$(e("./migrations")),E=$(e("./lib/migrator")),v=$(e("./platforms/extension")),T=$(e("./lib/local-store")),S=$(e("./lib/network-store")),M=e("./constants/sentry-state"),k=$(e("./lib/createStreamSink")),A=U(e("./lib/notification-manager")),P=U(e("./metamask-controller")),C=$(e("./first-time-state")),O=$(e("./lib/get-first-preferred-lang-code")),N=$(e("./lib/getObjStructure")),R=$(e("./lib/ens-ipfs/setup")),I=e("./lib/util"),j=(e("./skip-onboarding"),e("./offscreen")),x=e("./controllers/metamask-notifications/constants/notification-schema"),D=e("./constants/marketing-site-whitelist");function L(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(L=function(e){return e?n:t})(e)}function U(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=L(t);if(n&&n.has(e))return n.get(e);var r={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=i?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(r,a,s):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}function $(e){return e&&e.__esModule?e:{default:e}}const G="#0376C9",q="#D73847",B=9,F=!1,Y=F?new S.default:new T.default;global.stateHooks.getMostRecentPersistedState=()=>Y.mostRecentRetrievedState;const{sentry:W}=global;let H={...C.default};const V={[h.ENVIRONMENT_TYPE_POPUP]:!0,[h.ENVIRONMENT_TYPE_NOTIFICATION]:!0,[h.ENVIRONMENT_TYPE_FULLSCREEN]:!0},K=["trezor-connect"];s.default.setLevel("info",!1);const z=new v.default,J=new A.default;let Q=0,X=!1,Z=!1;const ee={},te={};let ne,re;const ie={};F&&(global.stateHooks.metamaskGetState=Y.get.bind(Y));const ae=new URL("https://metamask.github.io/phishing-warning/v3.0.3/"),se=ae.toString(),oe=1e3,ce=n.statePersistenceEvents=new r.default,{promise:ue,resolve:le,reject:de}=(0,I.deferredPromise)(),fe=async()=>{const e=await o.default.tabs.query({url:"<all_urls>",windowType:"normal"}).then((e=>((0,g.checkForLastErrorAndLog)(),e))).catch((()=>{(0,g.checkForLastErrorAndLog)()}));for(const t of e)o.default.tabs.sendMessage(t.id,{name:h.EXTENSION_MESSAGES.READY}).then((()=>{(0,g.checkForLastErrorAndLog)()})).catch((()=>{(0,g.checkForLastErrorAndLog)()}))};let pe,he,me;function ge(){const e=(new Date).toISOString();o.default.storage.session.set({timestamp:e})}async function ye(){try{const t=y.isManifestV3?(0,j.createOffscreen)():null,n=await _e(),r=n.data,i=await(0,O.default)();let a;if(y.isManifestV3){var e;if(!1!==(null===(e=r.PreferencesController)||void 0===e?void 0:e.enableMV3TimestampSave)){const e=2e3;ge(),setInterval(ge,e)}const t=await o.default.storage.session.get(["isFirstMetaMaskControllerSetup"]);a=(null==t?void 0:t.isFirstMetaMaskControllerSetup)===undefined,await o.default.storage.session.set({isFirstMetaMaskControllerSetup:a})}ve(r,i,F?{keyrings:{trezorBridge:_.FakeTrezorBridge,ledgerBridge:_.FakeLedgerBridge}}:{},a,n.meta,t),function(e){async function t(e,t){try{return await o.default.tabs.update(e,{url:t})}catch(e){return null==W?void 0:W.captureException(e)}}const n=!y.isManifestV3;o.default.webRequest.onBeforeRequest.addListener((r=>{if(r.tabId===o.default.tabs.TAB_ID_NONE)return{};if(!e.onboardingController.store.getState().completedOnboarding)return{};if(!e.preferencesController.store.getState().usePhishDetect)return{};if(r.initiator&&new URL(r.initiator).host===ae.host)return{};const{hostname:i,href:a,searchParams:s}=new URL(r.url);if(F&&s.has("IN_TEST_BYPASS_EARLY_PHISHING_DETECTION"))return{};e.phishingController.maybeUpdateState();const c=e.phishingController.test(i);if(null==c||!c.result)return{};e.metaMetricsController.trackEvent({event:m.MetaMetricsEventName.PhishingPageDisplayed,category:m.MetaMetricsEventCategory.Phishing,properties:{url:i}});const u=new URLSearchParams({hostname:i,href:a}),l=new URL(se);l.hash=u.toString();const d=l.toString();return n?"sub_frame"===r.type?(t(r.tabId,d),{cancel:!0}):{redirectUrl:d}:(t(r.tabId,d),{})}),{types:["main_frame","sub_frame"],urls:["http://*/*","https://*/*"]},n?["blocking"]:[])}(ne),y.isManifestV3||await async function(){let e;try{const t=new URL(se);let n,r;t.hash="#extensionStartup",e=window.document.createElement("iframe"),e.setAttribute("src",t.href),e.setAttribute("sandbox","allow-scripts allow-same-origin");const i=new Promise(((e,t)=>{n=e,r=t}));e.addEventListener("load",n),window.document.body.appendChild(e),setTimeout((()=>r(new be)),oe),await i}catch(e){e instanceof be?console.warn("Phishing warning page timeout; page not guaranteed to work offline."):console.error("Failed to initialize phishing warning page",e)}finally{e&&e.remove()}}(),await fe(),s.default.info("MetaMask initialization complete."),le()}catch(e){de(e)}}o.default.runtime.onConnect.addListener((async(...e)=>{await ue,pe(...e)})),o.default.runtime.onConnectExternal.addListener((async(...e)=>{var t;await ue;null!==(t=e[0].sender.tab)&&void 0!==t&&t.id,he(...e)}));class be extends Error{constructor(){super("Timeout failed")}}async function _e(){const e=new E.default({migrations:w.default,defaultVersion:null});if(e.on("error",console.warn),re=await Y.get()||e.generateInitialState(H),re&&!re.data&&(re=e.generateInitialState(H),W.captureMessage("MetaMask - Empty vault found - unable to recover")),e.on("error",(e=>{const t=(0,N.default)(re);W.captureException(e,{extra:{vaultStructure:t}})})),re=await e.migrateData(re),!re)throw new Error("MetaMask - migrator returned undefined");if(!(0,u.isObject)(re.meta))throw new Error(`MetaMask - migrator metadata has invalid type '${typeof re.meta}'`);if("number"!=typeof re.meta.version)throw new Error(`MetaMask - migrator metadata version has invalid type '${typeof re.meta.version}'`);if(!(0,u.isObject)(re.data))throw new Error(`MetaMask - migrator data has invalid type '${typeof re.data}'`);return Y.setMetadata(re.meta),Y.set(re.data),re}function we(e){var t;const{metaMetricsId:n}=ne.metaMetricsController.state;if(!(0,I.shouldEmitDappViewedEvent)(n))return;const r=ne.controllerMessenger.call("PermissionController:getPermissions",e),i=null==r||null===(t=r.eth_accounts)||void 0===t||null===(t=t.caveats[0])||void 0===t?void 0:t.value.length;if(!i)return;const a=ne.controllerMessenger.call("PreferencesController:getState"),s=Object.keys(a.identities).length;ne.metaMetricsController.trackEvent({event:m.MetaMetricsEventName.DappViewed,category:m.MetaMetricsEventCategory.InpageProvider,referrer:{url:e},properties:{is_first_visit:!1,number_of_accounts:s,number_of_accounts_connected:i}})}function Ee(e){if(!e.sender||!e.sender.tab||!e.sender.url)return;const t=e.sender.tab.id,n=new URL(e.sender.url),{origin:r}=n;Object.keys(ie).includes(t)||(ie[t]=r);const i=ne.controllerMessenger.call("PermissionController:hasPermissions",r),a="New Tab"!==e.sender.tab.title;i&&a&&we(r)}function ve(e,t,n,r,u,g){var _;ne=new P.default({infuraProjectId:"b6bf7d3508c941499b10025c0776eaf8",showUserConfirmation:Te,initState:e,initLangCode:t,platform:z,notificationManager:J,browser:o.default,getRequestAccountTabIds:()=>te,getOpenMetamaskTabsIds:()=>ee,localStore:Y,overrides:n,isFirstMetaMaskControllerSetup:r,currentMigrationVersion:u.version,featureFlags:{},offscreenPromise:g}),(0,R.default)({getCurrentChainId:()=>ne.networkController.state.providerConfig.chainId,getIpfsGateway:ne.preferencesController.getIpfsGateway.bind(ne.preferencesController),getUseAddressBarEnsResolution:()=>ne.preferencesController.store.getState().useAddressBarEnsResolution,provider:ne.provider}),(0,i.pipeline)((0,c.storeAsStream)(ne.store),(0,a.default)(1e3),(0,k.default)((async e=>{await Y.set(e),ce.emit("state-persisted",e)})),(e=>{s.default.error("MetaMask - Persistence pipeline failed",e)})),_=ne,global.stateHooks.getSentryAppState=function(){const e=_.memStore.getState();return(0,b.maskObject)(e,M.SENTRY_BACKGROUND_STATE)};const w=()=>Q>0||Boolean(Object.keys(ee).length)||X,E=(e,t)=>{if(!1===e)ne.onClientClosed();else{if(t===h.ENVIRONMENT_TYPE_FULLSCREEN&&Boolean(Object.keys(ee).length))return;ne.onEnvironmentTypeClosed(t)}};function v(e,t){return e>t?`${t}+`:String(e)}function T(){const e=S(),t=function(){try{const{isMetamaskNotificationsEnabled:e,isFeatureAnnouncementsEnabled:t}=ne.metamaskNotificationsController.state,n=Object.values(ne.notificationController.state.notifications).filter((e=>null===e.readDate)).length,r=t?ne.metamaskNotificationsController.state.metamaskNotificationsList.filter((e=>!e.isRead&&e.type===x.TRIGGER_TYPES.FEATURES_ANNOUNCEMENT)).length:0,i=e?ne.metamaskNotificationsController.state.metamaskNotificationsList.filter((e=>!e.isRead&&e.type!==x.TRIGGER_TYPES.FEATURES_ANNOUNCEMENT)).length:0;return n+r+i}catch(e){return console.error("Failed to get unread notifications count:",e),0}}();let n="",r=G;e?n=v(e,B):t>0&&(n=v(t,B),r=q);try{const e={text:n},t={color:r};y.isManifestV3?(o.default.action.setBadgeText(e),o.default.action.setBadgeBackgroundColor(t)):(o.default.browserAction.setBadgeText(e),o.default.browserAction.setBadgeBackgroundColor(t))}catch(e){console.error("Error updating browser badge:",e)}}function S(){try{let e=ne.appStateController.waitingForUnlock.length+ne.approvalController.getTotalApprovalCount();return ne.preferencesController.getUseRequestQueue()&&(e+=ne.queuedRequestController.state.queuedRequestCount),e}catch(e){return console.error("Failed to get pending approval count:",e),0}}pe=async e=>{var t;const r=e.name;if(K.includes(e.name))return;let a=!1;const s=(0,I.getPlatform)(),c=null!==(t=e.sender)&&void 0!==t&&t.url?new URL(e.sender.url):null;if(a=s===h.PLATFORM_FIREFOX?V[r]:(null==c?void 0:c.origin)===`chrome-extension://${o.default.runtime.id}`,a){var u;const t=(null==n||null===(u=n.getPortStream)||void 0===u?void 0:u.call(n,e))||new d.default(e);if(ne.isClientOpen=!0,ne.setupTrustedCommunication(t,e.sender),r===h.ENVIRONMENT_TYPE_POPUP&&(Q+=1,(0,i.finished)(t,(()=>{Q-=1;const e=w();ne.isClientOpen=e,E(e,h.ENVIRONMENT_TYPE_POPUP)}))),r===h.ENVIRONMENT_TYPE_NOTIFICATION&&(X=!0,(0,i.finished)(t,(()=>{X=!1;const e=w();ne.isClientOpen=e,E(e,h.ENVIRONMENT_TYPE_NOTIFICATION)}))),r===h.ENVIRONMENT_TYPE_FULLSCREEN){const n=e.sender.tab.id;ee[n]=!0,(0,i.finished)(t,(()=>{delete ee[n];const e=w();ne.isClientOpen=e,E(e,h.ENVIRONMENT_TYPE_FULLSCREEN)}))}}else if(c&&c.origin===ae.origin&&c.pathname===ae.pathname){var l;const t=(null==n||null===(l=n.getPortStream)||void 0===l?void 0:l.call(n,e))||new d.default(e);ne.setupPhishingCommunication({connectionStream:t})}else{if(e.sender&&e.sender.tab&&e.sender.url){const t=e.sender.tab.id,n=new URL(e.sender.url),{origin:r}=n;Ee(e),e.onMessage.addListener((e=>{e.data&&e.data.method===h.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS&&(te[r]=t)}))}if(c&&D.COOKIE_ID_MARKETING_WHITELIST_ORIGINS.some((e=>e===c.origin))){var f;const t=(null==n||null===(f=n.getPortStream)||void 0===f?void 0:f.call(n,e))||new d.default(e);ne.setUpCookieHandlerCommunication({connectionStream:t})}he(e)}},he=e=>{var t;const r=(null==n||null===(t=n.getPortStream)||void 0===t?void 0:t.call(n,e))||new d.default(e);ne.setupUntrustedCommunicationEip1193({connectionStream:r,sender:e.sender})},me=async e=>{var t;if(K.includes(e.name))return;e.sender&&e.sender.tab&&e.sender.url&&Ee(e);const r=(null==n||null===(t=n.getPortStream)||void 0===t?void 0:t.call(n,e))||new d.default(e);ne.setupUntrustedCommunicationCaip({connectionStream:r,sender:e.sender})},null!=n&&n.registerConnectListeners&&n.registerConnectListeners(pe,he),T(),ne.decryptMessageController.hub.on(P.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,T),ne.encryptionPublicKeyController.hub.on(P.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,T),ne.signatureController.hub.on(P.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,T),ne.appStateController.on(P.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,T),ne.controllerMessenger.subscribe(P.METAMASK_CONTROLLER_EVENTS.APPROVAL_STATE_CHANGE,T),ne.controllerMessenger.subscribe(P.METAMASK_CONTROLLER_EVENTS.QUEUED_REQUEST_STATE_CHANGE,T),ne.controllerMessenger.subscribe(P.METAMASK_CONTROLLER_EVENTS.METAMASK_NOTIFICATIONS_LIST_UPDATED,T),ne.controllerMessenger.subscribe(P.METAMASK_CONTROLLER_EVENTS.METAMASK_NOTIFICATIONS_MARK_AS_READ,T),ne.controllerMessenger.subscribe(P.METAMASK_CONTROLLER_EVENTS.NOTIFICATIONS_STATE_CHANGE,T),J.on(A.NOTIFICATION_MANAGER_EVENTS.POPUP_CLOSED,(({automaticallyClosed:e})=>{e?S()>0&&Te():(ne.signatureController.rejectUnapproved(m.REJECT_NOTIFICATION_CLOSE_SIG),ne.decryptMessageController.rejectUnapproved(m.REJECT_NOTIFICATION_CLOSE),ne.encryptionPublicKeyController.rejectUnapproved(m.REJECT_NOTIFICATION_CLOSE),Object.values(ne.approvalController.state.pendingApprovals).forEach((({id:e,type:t})=>{switch(t){case l.ApprovalType.SnapDialogAlert:case l.ApprovalType.SnapDialogPrompt:case p.DIALOG_APPROVAL_TYPES.default:ne.approvalController.accept(e,null);break;case l.ApprovalType.SnapDialogConfirmation:case h.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.confirmAccountCreation:case h.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.confirmAccountRemoval:case h.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.showSnapAccountRedirect:ne.approvalController.accept(e,!1);break;default:ne.approvalController.reject(e,f.ethErrors.provider.userRejectedRequest())}}))),T()})),Object.values(ne.snapController.state.snaps).some((e=>!e.preinstalled))&&ne.snapController.updateBlockedSnaps()}async function Te(){const e=await z.getActiveTabs(),t=Boolean(e.find((e=>ee[e.id]))),n=e.length>0&&e[0].extData&&e[0].extData.indexOf("vivaldi_tab")>-1;if(!Z&&(n||0===Q)&&!t){Z=!0;try{const e=ne.appStateController.getCurrentPopupId();await J.showPopup((e=>ne.appStateController.setCurrentPopupId(e)),e)}finally{Z=!1}}}const Se=()=>{if(ne)return ne.metaMetricsController.updateTraits({[m.MetaMetricsUserTrait.InstallDateExt]:(new Date).toISOString().split("T")[0]}),void ne.metaMetricsController.addEventBeforeMetricsOptIn({category:m.MetaMetricsEventCategory.App,event:m.MetaMetricsEventName.AppInstalled,properties:{}});setTimeout((()=>{Se()}),500)};async function Me(){Boolean(await Y.get())||(Se(),z.openExtensionInBrowser()),o.default.tabs.onActivated.addListener((e=>{if(ne){const{tabId:t}=e,n=ie[t];n&&ne.permissionController.state.subjects[n]!==undefined&&we(n)}}))}(async function(){await Me();try{await ye(),Y.cleanUpMostRecentRetrievedState()}catch(e){s.default.error(e)}})()}}},{package:"$root$",file:"app/scripts/background.js"}]],[4],{});